const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./firebase-enhanced-Bq4h_lrM.js","./jsx-runtime-BTJTZTIL.js","./index-ChsGqxH_.js","./iframe-DyUDVaki.js","./index-CJ_LmFaV.js","./_commonjsHelpers-D6-XlEtG.js","./Card-oKz5vSZ3.js","./index.esm-BgrrfS07.js","./index.esm-Cy2Pwpsk.js","./index.esm-B3xUtUBk.js","./storage-helper-BKfUg6bs.js"])))=>i.map(i=>d[i]);
import{j as T}from"./jsx-runtime-BTJTZTIL.js";import{_ as st}from"./iframe-DyUDVaki.js";import{r as x,R as wc}from"./index-CJ_LmFaV.js";import{C as Nt}from"./Card-oKz5vSZ3.js";/**
 * react-router v7.9.4
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Je(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Jt(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Bc({pathname:r="/",search:e="",hash:t=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(r+=t.charAt(0)==="#"?t:"#"+t),r}function Fl(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substring(t),r=r.substring(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substring(n),r=r.substring(0,n)),r&&(e.pathname=r)}return e}function km(r,e,t="/"){return tv(r,e,t,!1)}function tv(r,e,t,n){let s=typeof e=="string"?Fl(e):e,i=Nn(s.pathname||"/",t);if(i==null)return null;let o=Dm(r);nv(o);let c=null;for(let l=0;c==null&&l<o.length;++l){let u=fv(i);c=hv(o[l],u,n)}return c}function Dm(r,e=[],t=[],n="",s=!1){let i=(o,c,l=s,u)=>{let d={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:c,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(n)&&l)return;Je(d.relativePath.startsWith(n),`Absolute route path "${d.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(n.length)}let m=Yt([n,d.relativePath]),p=t.concat(d);o.children&&o.children.length>0&&(Je(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),Dm(o.children,e,p,m,l)),!(o.path==null&&!o.index)&&e.push({path:m,score:lv(m,o.index),routesMeta:p})};return r.forEach((o,c)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,c);else for(let u of Vm(o.path))i(o,c,!0,u)}),e}function Vm(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(n.length===0)return s?[i,""]:[i];let o=Vm(n.join("/")),c=[];return c.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&c.push(...o),c.map(l=>r.startsWith("/")&&l===""?"/":l)}function nv(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:uv(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var rv=/^:[\w-]+$/,sv=3,iv=2,ov=1,av=10,cv=-2,Zh=r=>r==="*";function lv(r,e){let t=r.split("/"),n=t.length;return t.some(Zh)&&(n+=cv),e&&(n+=iv),t.filter(s=>!Zh(s)).reduce((s,i)=>s+(rv.test(i)?sv:i===""?ov:av),n)}function uv(r,e){return r.length===e.length&&r.slice(0,-1).every((n,s)=>n===e[s])?r[r.length-1]-e[e.length-1]:0}function hv(r,e,t=!1){let{routesMeta:n}=r,s={},i="/",o=[];for(let c=0;c<n.length;++c){let l=n[c],u=c===n.length-1,d=i==="/"?e:e.slice(i.length)||"/",m=Wo({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),p=l.route;if(!m&&u&&t&&!n[n.length-1].route.index&&(m=Wo({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!m)return null;Object.assign(s,m.params),o.push({params:s,pathname:Yt([i,m.pathname]),pathnameBase:yv(Yt([i,m.pathnameBase])),route:p}),m.pathnameBase!=="/"&&(i=Yt([i,m.pathnameBase]))}return o}function Wo(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=dv(r.path,r.caseSensitive,r.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:n.reduce((u,{paramName:d,isOptional:m},p)=>{if(d==="*"){let R=c[p]||"";o=i.slice(0,i.length-R.length).replace(/(.)\/+$/,"$1")}const b=c[p];return m&&!b?u[d]=void 0:u[d]=(b||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:r}}function dv(r,e=!1,t=!0){Jt(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let n=[],s="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,c,l)=>(n.push({paramName:c,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return r.endsWith("*")?(n.push({paramName:"*"}),s+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":r!==""&&r!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),n]}function fv(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Jt(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function Nn(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}function mv(r,e="/"){let{pathname:t,search:n="",hash:s=""}=typeof r=="string"?Fl(r):r;return{pathname:t?t.startsWith("/")?t:pv(t,e):e,search:_v(n),hash:vv(s)}}function pv(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Ec(r,e,t,n){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function gv(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Om(r){let e=gv(r);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function Lm(r,e,t,n=!1){let s;typeof r=="string"?s=Fl(r):(s={...r},Je(!s.pathname||!s.pathname.includes("?"),Ec("?","pathname","search",s)),Je(!s.pathname||!s.pathname.includes("#"),Ec("#","pathname","hash",s)),Je(!s.search||!s.search.includes("#"),Ec("#","search","hash",s)));let i=r===""||s.pathname==="",o=i?"/":s.pathname,c;if(o==null)c=t;else{let m=e.length-1;if(!n&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),m-=1;s.pathname=p.join("/")}c=m>=0?e[m]:"/"}let l=mv(s,c),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}var Yt=r=>r.join("/").replace(/\/\/+/g,"/"),yv=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),_v=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,vv=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function wv(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var Mm=["POST","PUT","PATCH","DELETE"];new Set(Mm);var Ev=["GET",...Mm];new Set(Ev);var hs=x.createContext(null);hs.displayName="DataRouter";var Aa=x.createContext(null);Aa.displayName="DataRouterState";x.createContext(!1);var Fm=x.createContext({isTransitioning:!1});Fm.displayName="ViewTransition";var Iv=x.createContext(new Map);Iv.displayName="Fetchers";var bv=x.createContext(null);bv.displayName="Await";var nn=x.createContext(null);nn.displayName="Navigation";var Ul=x.createContext(null);Ul.displayName="Location";var qt=x.createContext({outlet:null,matches:[],isDataRoute:!1});qt.displayName="Route";var jl=x.createContext(null);jl.displayName="RouteError";function Tv(r,{relative:e}={}){Je(Ra(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=x.useContext(nn),{hash:s,pathname:i,search:o}=Li(r,{relative:e}),c=i;return t!=="/"&&(c=i==="/"?t:Yt([t,i])),n.createHref({pathname:c,search:o,hash:s})}function Ra(){return x.useContext(Ul)!=null}function Sr(){return Je(Ra(),"useLocation() may be used only in the context of a <Router> component."),x.useContext(Ul).location}var Um="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function jm(r){x.useContext(nn).static||x.useLayoutEffect(r)}function Bl(){let{isDataRoute:r}=x.useContext(qt);return r?Uv():Sv()}function Sv(){Je(Ra(),"useNavigate() may be used only in the context of a <Router> component.");let r=x.useContext(hs),{basename:e,navigator:t}=x.useContext(nn),{matches:n}=x.useContext(qt),{pathname:s}=Sr(),i=JSON.stringify(Om(n)),o=x.useRef(!1);return jm(()=>{o.current=!0}),x.useCallback((l,u={})=>{if(Jt(o.current,Um),!o.current)return;if(typeof l=="number"){t.go(l);return}let d=Lm(l,JSON.parse(i),s,u.relative==="path");r==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Yt([e,d.pathname])),(u.replace?t.replace:t.push)(d,u.state,u)},[e,t,i,s,r])}var Av=x.createContext(null);function Rv(r){let e=x.useContext(qt).outlet;return x.useMemo(()=>e&&x.createElement(Av.Provider,{value:r},e),[e,r])}function Li(r,{relative:e}={}){let{matches:t}=x.useContext(qt),{pathname:n}=Sr(),s=JSON.stringify(Om(t));return x.useMemo(()=>Lm(r,JSON.parse(s),n,e==="path"),[r,s,n,e])}function Pv(r,e,t,n,s){Je(Ra(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=x.useContext(nn),{matches:o}=x.useContext(qt),c=o[o.length-1],l=c?c.params:{},u=c?c.pathname:"/",d=c?c.pathnameBase:"/",m=c&&c.route;{let V=m&&m.path||"";Bm(u,!m||V.endsWith("*")||V.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${V}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${V}"> to <Route path="${V==="/"?"*":`${V}/*`}">.`)}let p=Sr(),b;b=p;let R=b.pathname||"/",A=R;if(d!=="/"){let V=d.replace(/^\//,"").split("/");A="/"+R.replace(/^\//,"").split("/").slice(V.length).join("/")}let N=km(r,{pathname:A});return Jt(m||N!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),Jt(N==null||N[N.length-1].route.element!==void 0||N[N.length-1].route.Component!==void 0||N[N.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),Dv(N&&N.map(V=>Object.assign({},V,{params:Object.assign({},l,V.params),pathname:Yt([d,i.encodeLocation?i.encodeLocation(V.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:V.pathname]),pathnameBase:V.pathnameBase==="/"?d:Yt([d,i.encodeLocation?i.encodeLocation(V.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:V.pathnameBase])})),o,t,n,s)}function Cv(){let r=Fv(),e=wv(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,n="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:n},i={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",r),o=x.createElement(x.Fragment,null,x.createElement("p",null,"💿 Hey developer 👋"),x.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",x.createElement("code",{style:i},"ErrorBoundary")," or"," ",x.createElement("code",{style:i},"errorElement")," prop on your route.")),x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},e),t?x.createElement("pre",{style:s},t):null,o)}var xv=x.createElement(Cv,null),Nv=class extends x.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){this.props.unstable_onError?this.props.unstable_onError(r,e):console.error("React Router caught the following error during render",r)}render(){return this.state.error!==void 0?x.createElement(qt.Provider,{value:this.props.routeContext},x.createElement(jl.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function kv({routeContext:r,match:e,children:t}){let n=x.useContext(hs);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),x.createElement(qt.Provider,{value:r},t)}function Dv(r,e=[],t=null,n=null,s=null){if(r==null){if(!t)return null;if(t.errors)r=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let i=r,o=t==null?void 0:t.errors;if(o!=null){let u=i.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);Je(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,u+1))}let c=!1,l=-1;if(t)for(let u=0;u<i.length;u++){let d=i[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=u),d.route.id){let{loaderData:m,errors:p}=t,b=d.route.loader&&!m.hasOwnProperty(d.route.id)&&(!p||p[d.route.id]===void 0);if(d.route.lazy||b){c=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}return i.reduceRight((u,d,m)=>{let p,b=!1,R=null,A=null;t&&(p=o&&d.route.id?o[d.route.id]:void 0,R=d.route.errorElement||xv,c&&(l<0&&m===0?(Bm("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),b=!0,A=null):l===m&&(b=!0,A=d.route.hydrateFallbackElement||null)));let N=e.concat(i.slice(0,m+1)),D=()=>{let V;return p?V=R:b?V=A:d.route.Component?V=x.createElement(d.route.Component,null):d.route.element?V=d.route.element:V=u,x.createElement(kv,{match:d,routeContext:{outlet:u,matches:N,isDataRoute:t!=null},children:V})};return t&&(d.route.ErrorBoundary||d.route.errorElement||m===0)?x.createElement(Nv,{location:t.location,revalidation:t.revalidation,component:R,error:p,children:D(),routeContext:{outlet:null,matches:N,isDataRoute:!0},unstable_onError:n}):D()},null)}function ql(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Vv(r){let e=x.useContext(hs);return Je(e,ql(r)),e}function Ov(r){let e=x.useContext(Aa);return Je(e,ql(r)),e}function Lv(r){let e=x.useContext(qt);return Je(e,ql(r)),e}function $l(r){let e=Lv(r),t=e.matches[e.matches.length-1];return Je(t.route.id,`${r} can only be used on routes that contain a unique "id"`),t.route.id}function Mv(){return $l("useRouteId")}function Fv(){var n;let r=x.useContext(jl),e=Ov("useRouteError"),t=$l("useRouteError");return r!==void 0?r:(n=e.errors)==null?void 0:n[t]}function Uv(){let{router:r}=Vv("useNavigate"),e=$l("useNavigate"),t=x.useRef(!1);return jm(()=>{t.current=!0}),x.useCallback(async(s,i={})=>{Jt(t.current,Um),t.current&&(typeof s=="number"?r.navigate(s):await r.navigate(s,{fromRouteId:e,...i}))},[r,e])}var ed={};function Bm(r,e,t){!e&&!ed[r]&&(ed[r]=!0,Jt(!1,t))}x.memo(jv);function jv({routes:r,future:e,state:t,unstable_onError:n}){return Pv(r,void 0,t,n,e)}function Bv(r){return Rv(r.context)}var Po="get",Co="application/x-www-form-urlencoded";function Pa(r){return r!=null&&typeof r.tagName=="string"}function qv(r){return Pa(r)&&r.tagName.toLowerCase()==="button"}function $v(r){return Pa(r)&&r.tagName.toLowerCase()==="form"}function zv(r){return Pa(r)&&r.tagName.toLowerCase()==="input"}function Hv(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function Gv(r,e){return r.button===0&&(!e||e==="_self")&&!Hv(r)}var go=null;function Kv(){if(go===null)try{new FormData(document.createElement("form"),0),go=!1}catch{go=!0}return go}var Wv=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ic(r){return r!=null&&!Wv.has(r)?(Jt(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Co}"`),null):r}function Qv(r,e){let t,n,s,i,o;if($v(r)){let c=r.getAttribute("action");n=c?Nn(c,e):null,t=r.getAttribute("method")||Po,s=Ic(r.getAttribute("enctype"))||Co,i=new FormData(r)}else if(qv(r)||zv(r)&&(r.type==="submit"||r.type==="image")){let c=r.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=r.getAttribute("formaction")||c.getAttribute("action");if(n=l?Nn(l,e):null,t=r.getAttribute("formmethod")||c.getAttribute("method")||Po,s=Ic(r.getAttribute("formenctype"))||Ic(c.getAttribute("enctype"))||Co,i=new FormData(c,r),!Kv()){let{name:u,type:d,value:m}=r;if(d==="image"){let p=u?`${u}.`:"";i.append(`${p}x`,"0"),i.append(`${p}y`,"0")}else u&&i.append(u,m)}}else{if(Pa(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Po,n=null,s=Co,o=r}return i&&s==="text/plain"&&(o=i,i=void 0),{action:n,method:t.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function zl(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Yv(r,e,t){let n=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return n.pathname==="/"?n.pathname=`_root.${t}`:e&&Nn(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${t}`,n}async function Jv(r,e){if(r.id in e)return e[r.id];try{let t=await import(r.module);return e[r.id]=t,t}catch(t){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Xv(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function Zv(r,e,t){let n=await Promise.all(r.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await Jv(i,t);return o.links?o.links():[]}return[]}));return rw(n.flat(1).filter(Xv).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function td(r,e,t,n,s,i){let o=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,c=(l,u)=>{var d;return t[u].pathname!==l.pathname||((d=t[u].route.path)==null?void 0:d.endsWith("*"))&&t[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||c(l,u)):i==="data"?e.filter((l,u)=>{var m;let d=n.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,u)||c(l,u))return!0;if(l.route.shouldRevalidate){let p=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((m=t[0])==null?void 0:m.params)||{},nextUrl:new URL(r,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function ew(r,e,{includeHydrateFallback:t}={}){return tw(r.map(n=>{let s=e.routes[n.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function tw(r){return[...new Set(r)]}function nw(r){let e={},t=Object.keys(r).sort();for(let n of t)e[n]=r[n];return e}function rw(r,e){let t=new Set;return new Set(e),r.reduce((n,s)=>{let i=JSON.stringify(nw(s));return t.has(i)||(t.add(i),n.push({key:i,link:s})),n},[])}function qm(){let r=x.useContext(hs);return zl(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function sw(){let r=x.useContext(Aa);return zl(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var Hl=x.createContext(void 0);Hl.displayName="FrameworkContext";function $m(){let r=x.useContext(Hl);return zl(r,"You must render this element inside a <HydratedRouter> element"),r}function iw(r,e){let t=x.useContext(Hl),[n,s]=x.useState(!1),[i,o]=x.useState(!1),{onFocus:c,onBlur:l,onMouseEnter:u,onMouseLeave:d,onTouchStart:m}=e,p=x.useRef(null);x.useEffect(()=>{if(r==="render"&&o(!0),r==="viewport"){let A=D=>{D.forEach(V=>{o(V.isIntersecting)})},N=new IntersectionObserver(A,{threshold:.5});return p.current&&N.observe(p.current),()=>{N.disconnect()}}},[r]),x.useEffect(()=>{if(n){let A=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(A)}}},[n]);let b=()=>{s(!0)},R=()=>{s(!1),o(!1)};return t?r!=="intent"?[i,p,{}]:[i,p,{onFocus:Bs(c,b),onBlur:Bs(l,R),onMouseEnter:Bs(u,b),onMouseLeave:Bs(d,R),onTouchStart:Bs(m,b)}]:[!1,p,{}]}function Bs(r,e){return t=>{r&&r(t),t.defaultPrevented||e(t)}}function ow({page:r,...e}){let{router:t}=qm(),n=x.useMemo(()=>km(t.routes,r,t.basename),[t.routes,r,t.basename]);return n?x.createElement(cw,{page:r,matches:n,...e}):null}function aw(r){let{manifest:e,routeModules:t}=$m(),[n,s]=x.useState([]);return x.useEffect(()=>{let i=!1;return Zv(r,e,t).then(o=>{i||s(o)}),()=>{i=!0}},[r,e,t]),n}function cw({page:r,matches:e,...t}){let n=Sr(),{manifest:s,routeModules:i}=$m(),{basename:o}=qm(),{loaderData:c,matches:l}=sw(),u=x.useMemo(()=>td(r,e,l,s,n,"data"),[r,e,l,s,n]),d=x.useMemo(()=>td(r,e,l,s,n,"assets"),[r,e,l,s,n]),m=x.useMemo(()=>{if(r===n.pathname+n.search+n.hash)return[];let R=new Set,A=!1;if(e.forEach(D=>{var j;let V=s.routes[D.route.id];!V||!V.hasLoader||(!u.some(U=>U.route.id===D.route.id)&&D.route.id in c&&((j=i[D.route.id])!=null&&j.shouldRevalidate)||V.hasClientLoader?A=!0:R.add(D.route.id))}),R.size===0)return[];let N=Yv(r,o,"data");return A&&R.size>0&&N.searchParams.set("_routes",e.filter(D=>R.has(D.route.id)).map(D=>D.route.id).join(",")),[N.pathname+N.search]},[o,c,n,s,u,e,r,i]),p=x.useMemo(()=>ew(d,s),[d,s]),b=aw(d);return x.createElement(x.Fragment,null,m.map(R=>x.createElement("link",{key:R,rel:"prefetch",as:"fetch",href:R,...t})),p.map(R=>x.createElement("link",{key:R,rel:"modulepreload",href:R,...t})),b.map(({key:R,link:A})=>x.createElement("link",{key:R,nonce:t.nonce,...A})))}function lw(...r){return e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var zm=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{zm&&(window.__reactRouterVersion="7.9.4")}catch{}var Hm=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Gl=x.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:s,reloadDocument:i,replace:o,state:c,target:l,to:u,preventScrollReset:d,viewTransition:m,...p},b){let{basename:R}=x.useContext(nn),A=typeof u=="string"&&Hm.test(u),N,D=!1;if(typeof u=="string"&&A&&(N=u,zm))try{let y=new URL(window.location.href),w=u.startsWith("//")?new URL(y.protocol+u):new URL(u),_=Nn(w.pathname,R);w.origin===y.origin&&_!=null?u=_+w.search+w.hash:D=!0}catch{Jt(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let V=Tv(u,{relative:s}),[j,U,Q]=iw(n,p),H=dw(u,{replace:o,state:c,target:l,preventScrollReset:d,relative:s,viewTransition:m});function I(y){e&&e(y),y.defaultPrevented||H(y)}let E=x.createElement("a",{...p,...Q,href:N||V,onClick:D||i?e:I,ref:lw(b,U),target:l,"data-discover":!A&&t==="render"?"true":void 0});return j&&!A?x.createElement(x.Fragment,null,E,x.createElement(ow,{page:V})):E});Gl.displayName="Link";var Gm=x.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:s=!1,style:i,to:o,viewTransition:c,children:l,...u},d){let m=Li(o,{relative:u.relative}),p=Sr(),b=x.useContext(Aa),{navigator:R,basename:A}=x.useContext(nn),N=b!=null&&yw(m)&&c===!0,D=R.encodeLocation?R.encodeLocation(m).pathname:m.pathname,V=p.pathname,j=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;t||(V=V.toLowerCase(),j=j?j.toLowerCase():null,D=D.toLowerCase()),j&&A&&(j=Nn(j,A)||j);const U=D!=="/"&&D.endsWith("/")?D.length-1:D.length;let Q=V===D||!s&&V.startsWith(D)&&V.charAt(U)==="/",H=j!=null&&(j===D||!s&&j.startsWith(D)&&j.charAt(D.length)==="/"),I={isActive:Q,isPending:H,isTransitioning:N},E=Q?e:void 0,y;typeof n=="function"?y=n(I):y=[n,Q?"active":null,H?"pending":null,N?"transitioning":null].filter(Boolean).join(" ");let w=typeof i=="function"?i(I):i;return x.createElement(Gl,{...u,"aria-current":E,className:y,ref:d,style:w,to:o,viewTransition:c},typeof l=="function"?l(I):l)});Gm.displayName="NavLink";var uw=x.forwardRef(({discover:r="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:s,state:i,method:o=Po,action:c,onSubmit:l,relative:u,preventScrollReset:d,viewTransition:m,...p},b)=>{let R=pw(),A=gw(c,{relative:u}),N=o.toLowerCase()==="get"?"get":"post",D=typeof c=="string"&&Hm.test(c),V=j=>{if(l&&l(j),j.defaultPrevented)return;j.preventDefault();let U=j.nativeEvent.submitter,Q=(U==null?void 0:U.getAttribute("formmethod"))||o;R(U||j.currentTarget,{fetcherKey:e,method:Q,navigate:t,replace:s,state:i,relative:u,preventScrollReset:d,viewTransition:m})};return x.createElement("form",{ref:b,method:N,action:A,onSubmit:n?l:V,...p,"data-discover":!D&&r==="render"?"true":void 0})});uw.displayName="Form";function hw(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Km(r){let e=x.useContext(hs);return Je(e,hw(r)),e}function dw(r,{target:e,replace:t,state:n,preventScrollReset:s,relative:i,viewTransition:o}={}){let c=Bl(),l=Sr(),u=Li(r,{relative:i});return x.useCallback(d=>{if(Gv(d,e)){d.preventDefault();let m=t!==void 0?t:Bc(l)===Bc(u);c(r,{replace:m,state:n,preventScrollReset:s,relative:i,viewTransition:o})}},[l,c,u,t,n,e,r,s,i,o])}var fw=0,mw=()=>`__${String(++fw)}__`;function pw(){let{router:r}=Km("useSubmit"),{basename:e}=x.useContext(nn),t=Mv();return x.useCallback(async(n,s={})=>{let{action:i,method:o,encType:c,formData:l,body:u}=Qv(n,e);if(s.navigate===!1){let d=s.fetcherKey||mw();await r.fetch(d,t,s.action||i,{preventScrollReset:s.preventScrollReset,formData:l,body:u,formMethod:s.method||o,formEncType:s.encType||c,flushSync:s.flushSync})}else await r.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:l,body:u,formMethod:s.method||o,formEncType:s.encType||c,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[r,e,t])}function gw(r,{relative:e}={}){let{basename:t}=x.useContext(nn),n=x.useContext(qt);Je(n,"useFormAction must be used inside a RouteContext");let[s]=n.matches.slice(-1),i={...Li(r||".",{relative:e})},o=Sr();if(r==null){i.search=o.search;let c=new URLSearchParams(i.search),l=c.getAll("index");if(l.some(d=>d==="")){c.delete("index"),l.filter(m=>m).forEach(m=>c.append("index",m));let d=c.toString();i.search=d?`?${d}`:""}}return(!r||r===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:Yt([t,i.pathname])),Bc(i)}function yw(r,{relative:e}={}){let t=x.useContext(Fm);Je(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=Km("useViewTransitionState"),s=Li(r,{relative:e});if(!t.isTransitioning)return!1;let i=Nn(t.currentLocation.pathname,n)||t.currentLocation.pathname,o=Nn(t.nextLocation.pathname,n)||t.nextLocation.pathname;return Wo(s.pathname,o)!=null||Wo(s.pathname,i)!=null}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _w=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),vw=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),nd=r=>{const e=vw(r);return e.charAt(0).toUpperCase()+e.slice(1)},Wm=(...r)=>r.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),ww=r=>{for(const e in r)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ew={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iw=x.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:o,...c},l)=>x.createElement("svg",{ref:l,...Ew,width:e,height:e,stroke:r,strokeWidth:n?Number(t)*24/Number(e):t,className:Wm("lucide",s),...!i&&!ww(c)&&{"aria-hidden":"true"},...c},[...o.map(([u,d])=>x.createElement(u,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=(r,e)=>{const t=x.forwardRef(({className:n,...s},i)=>x.createElement(Iw,{ref:i,iconNode:e,className:Wm(`lucide-${_w(nd(r))}`,`lucide-${r}`,n),...s}));return t.displayName=nd(r),t};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bw=[["path",{d:"M12 22V8",key:"qkxhtm"}],["path",{d:"M5 12H2a10 10 0 0 0 20 0h-3",key:"1hv3nh"}],["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}]],Tw=Te("anchor",bw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sw=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Qm=Te("award",Sw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aw=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],Rw=Te("bell-off",Aw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pw=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],qc=Te("bell",Pw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cw=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],xw=Te("book-open",Cw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nw=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],kw=Te("calendar",Nw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dw=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Vw=Te("camera",Dw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ow=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Lw=Te("download",Ow);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mw=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5",key:"14wa3c"}],["path",{d:"M12 7.5V9",key:"1oy5b0"}],["path",{d:"M7.5 12H9",key:"eltsq1"}],["path",{d:"M16.5 12H15",key:"vk5kw4"}],["path",{d:"M12 16.5V15",key:"k7eayi"}],["path",{d:"m8 8 1.88 1.88",key:"nxy4qf"}],["path",{d:"M14.12 9.88 16 8",key:"1lst6k"}],["path",{d:"m8 16 1.88-1.88",key:"h2eex1"}],["path",{d:"M14.12 14.12 16 16",key:"uqkrx3"}]],Fw=Te("flower",Mw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uw=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],jw=Te("house",Uw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bw=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],qw=Te("info",Bw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $w=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],rd=Te("map-pin",$w);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zw=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Hw=Te("message-square",zw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gw=[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["circle",{cx:"18.5",cy:"15.5",r:"2.5",key:"b5zd12"}],["path",{d:"M20.27 17.27 22 19",key:"1l4muz"}]],Kw=Te("package-search",Gw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ww=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Qw=Te("pencil",Ww);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yw=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],Ym=Te("qr-code",Yw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jw=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],Xw=Te("scan-line",Jw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zw=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],eE=Te("send",Zw);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tE=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],bc=Te("shield-check",tE);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nE=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],rE=Te("star",nE);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sE=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],iE=Te("sun",sE);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oE=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],aE=Te("trophy",oE);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cE=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Jm=Te("x",cE);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lE=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],$c=Te("zap",lE);function uE(){if(console&&console.warn){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];typeof e[0]=="string"&&(e[0]=`react-i18next:: ${e[0]}`),console.warn(...e)}}const sd={};function zc(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];typeof e[0]=="string"&&sd[e[0]]||(typeof e[0]=="string"&&(sd[e[0]]=new Date),uE(...e))}const Xm=(r,e)=>()=>{if(r.isInitialized)e();else{const t=()=>{setTimeout(()=>{r.off("initialized",t)},0),e()};r.on("initialized",t)}};function id(r,e,t){r.loadNamespaces(e,Xm(r,t))}function od(r,e,t,n){typeof t=="string"&&(t=[t]),t.forEach(s=>{r.options.ns.indexOf(s)<0&&r.options.ns.push(s)}),r.loadLanguages(e,Xm(r,n))}function hE(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=e.languages[0],s=e.options?e.options.fallbackLng:!1,i=e.languages[e.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const o=(c,l)=>{const u=e.services.backendConnector.state[`${c}|${l}`];return u===-1||u===2};return t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&e.services.backendConnector.backend&&e.isLanguageChangingTo&&!o(e.isLanguageChangingTo,r)?!1:!!(e.hasResourceBundle(n,r)||!e.services.backendConnector.backend||e.options.resources&&!e.options.partialBundledLanguages||o(n,r)&&(!s||o(i,r)))}function dE(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return!e.languages||!e.languages.length?(zc("i18n.languages were undefined or empty",e.languages),!0):e.options.ignoreJSONStructure!==void 0?e.hasLoadedNamespace(r,{lng:t.lng,precheck:(s,i)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!i(s.isLanguageChangingTo,r))return!1}}):hE(r,e,t)}const fE=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,mE={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},pE=r=>mE[r],gE=r=>r.replace(fE,pE);let Hc={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:gE};function yE(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Hc={...Hc,...r}}function _E(){return Hc}let Zm;function vE(r){Zm=r}function wE(){return Zm}const EE={type:"3rdParty",init(r){yE(r.options.react),vE(r)}},IE=x.createContext();class bE{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const TE=(r,e)=>{const t=x.useRef();return x.useEffect(()=>{t.current=r},[r,e]),t.current};function ep(r,e,t,n){return r.getFixedT(e,t,n)}function SE(r,e,t,n){return x.useCallback(ep(r,e,t,n),[r,e,t,n])}function Ar(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{i18n:t}=e,{i18n:n,defaultNS:s}=x.useContext(IE)||{},i=t||n||wE();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new bE),!i){zc("You will need to pass in an i18next instance by using initReactI18next");const U=(H,I)=>typeof I=="string"?I:I&&typeof I=="object"&&typeof I.defaultValue=="string"?I.defaultValue:Array.isArray(H)?H[H.length-1]:H,Q=[U,{},!1];return Q.t=U,Q.i18n={},Q.ready=!1,Q}i.options.react&&i.options.react.wait!==void 0&&zc("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={..._E(),...i.options.react,...e},{useSuspense:c,keyPrefix:l}=o;let u=s||i.options&&i.options.defaultNS;u=typeof u=="string"?[u]:u||["translation"],i.reportNamespaces.addUsedNamespaces&&i.reportNamespaces.addUsedNamespaces(u);const d=(i.isInitialized||i.initializedStoreOnce)&&u.every(U=>dE(U,i,o)),m=SE(i,e.lng||null,o.nsMode==="fallback"?u:u[0],l),p=()=>m,b=()=>ep(i,e.lng||null,o.nsMode==="fallback"?u:u[0],l),[R,A]=x.useState(p);let N=u.join();e.lng&&(N=`${e.lng}${N}`);const D=TE(N),V=x.useRef(!0);x.useEffect(()=>{const{bindI18n:U,bindI18nStore:Q}=o;V.current=!0,!d&&!c&&(e.lng?od(i,e.lng,u,()=>{V.current&&A(b)}):id(i,u,()=>{V.current&&A(b)})),d&&D&&D!==N&&V.current&&A(b);function H(){V.current&&A(b)}return U&&i&&i.on(U,H),Q&&i&&i.store.on(Q,H),()=>{V.current=!1,U&&i&&U.split(" ").forEach(I=>i.off(I,H)),Q&&i&&Q.split(" ").forEach(I=>i.store.off(I,H))}},[i,N]),x.useEffect(()=>{V.current&&d&&A(p)},[i,l,d]);const j=[R,i,d];if(j.t=R,j.i18n=i,j.ready=d,d||!d&&!c)return j;throw new Promise(U=>{e.lng?od(i,e.lng,u,()=>U()):id(i,u,()=>U())})}var re=(r=>(r.Citizen="Citizen",r.NGO="NGO",r.PublicWorker="PublicWorker",r.Admin="Admin",r))(re||{}),xo=(r=>(r.Food="Food",r.Shelter="Shelter",r.Medical="Medical",r.Emotional="Emotional",r.Legal="Legal",r.Employment="Employment",r))(xo||{}),No=(r=>(r.Silent="Silent",r.Loud="Loud",r))(No||{}),gt=(r=>(r.SilentHero="SilentHero",r.VoiceOfCompassion="VoiceOfCompassion",r.CommunityBuilder="CommunityBuilder",r.CommunityGift="CommunityGift",r.Ritual="Ritual",r))(gt||{}),Ht=(r=>(r.Open="Open",r.Pending="Pending",r.Fulfilled="Fulfilled",r.Closed="Closed",r))(Ht||{}),sr=(r=>(r.Gold="Gold",r.Blue="Blue",r.Amber="Amber",r))(sr||{}),ir=(r=>(r.Spirals="Spirals",r.Lines="Lines",r.Waves="Waves",r))(ir||{}),tp=(r=>(r.Volunteer="Volunteer",r.Event="Event",r))(tp||{}),Gc=(r=>(r.Food="Food",r.Health="Health",r.Legal="Legal",r.Education="Education",r.Shelter="Shelter",r))(Gc||{});const AE={type:"logger",log(r){this.output("log",r)},warn(r){this.output("warn",r)},error(r){this.output("error",r)},output(r,e){console&&console[r]&&console[r].apply(console,e)}};let RE=class Kc{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||AE,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,s){return s&&!this.debug?null:(typeof e[0]=="string"&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Kc(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Kc(this.logger,e)}};var Dt=new RE;class Ca{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const s=this.observers[n].get(t)||0;this.observers[n].set(t,s+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[c,l]=o;for(let u=0;u<l;u++)c(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[c,l]=o;for(let u=0;u<l;u++)c.apply(c,[e,...n])})}}function qs(){let r,e;const t=new Promise((n,s)=>{r=n,e=s});return t.resolve=r,t.reject=e,t}function ad(r){return r==null?"":""+r}function PE(r,e,t){r.forEach(n=>{e[n]&&(t[n]=e[n])})}const CE=/###/g;function ci(r,e,t){function n(c){return c&&c.indexOf("###")>-1?c.replace(CE,"."):c}function s(){return!r||typeof r=="string"}const i=typeof e!="string"?e:e.split(".");let o=0;for(;o<i.length-1;){if(s())return{};const c=n(i[o]);!r[c]&&t&&(r[c]=new t),Object.prototype.hasOwnProperty.call(r,c)?r=r[c]:r={},++o}return s()?{}:{obj:r,k:n(i[o])}}function cd(r,e,t){const{obj:n,k:s}=ci(r,e,Object);if(n!==void 0||e.length===1){n[s]=t;return}let i=e[e.length-1],o=e.slice(0,e.length-1),c=ci(r,o,Object);for(;c.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),c=ci(r,o,Object),c&&c.obj&&typeof c.obj[`${c.k}.${i}`]<"u"&&(c.obj=void 0);c.obj[`${c.k}.${i}`]=t}function xE(r,e,t,n){const{obj:s,k:i}=ci(r,e,Object);s[i]=s[i]||[],s[i].push(t)}function Qo(r,e){const{obj:t,k:n}=ci(r,e);if(t)return t[n]}function NE(r,e,t){const n=Qo(r,t);return n!==void 0?n:Qo(e,t)}function np(r,e,t){for(const n in e)n!=="__proto__"&&n!=="constructor"&&(n in r?typeof r[n]=="string"||r[n]instanceof String||typeof e[n]=="string"||e[n]instanceof String?t&&(r[n]=e[n]):np(r[n],e[n],t):r[n]=e[n]);return r}function Dr(r){return r.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var kE={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function DE(r){return typeof r=="string"?r.replace(/[&<>"'\/]/g,e=>kE[e]):r}class VE{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}const OE=[" ",",","?","!",";"],LE=new VE(20);function ME(r,e,t){e=e||"",t=t||"";const n=OE.filter(o=>e.indexOf(o)<0&&t.indexOf(o)<0);if(n.length===0)return!0;const s=LE.getRegExp(`(${n.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!s.test(r);if(!i){const o=r.indexOf(t);o>0&&!s.test(r.substring(0,o))&&(i=!0)}return i}function Wc(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!r)return;if(r[e])return r[e];const n=e.split(t);let s=r;for(let i=0;i<n.length;){if(!s||typeof s!="object")return;let o,c="";for(let l=i;l<n.length;++l)if(l!==i&&(c+=t),c+=n[l],o=s[c],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&l<n.length-1)continue;i+=l-i+1;break}s=o}return s}function Yo(r){return r&&r.indexOf("_")>0?r.replace("_","-"):r}class ld extends Ca{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,o=s.ignoreJSONStructure!==void 0?s.ignoreJSONStructure:this.options.ignoreJSONStructure;let c;e.indexOf(".")>-1?c=e.split("."):(c=[e,t],n&&(Array.isArray(n)?c.push(...n):typeof n=="string"&&i?c.push(...n.split(i)):c.push(n)));const l=Qo(this.data,c);return!l&&!t&&!n&&e.indexOf(".")>-1&&(e=c[0],t=c[1],n=c.slice(2).join(".")),l||!o||typeof n!="string"?l:Wc(this.data&&this.data[e]&&this.data[e][t],n,i)}addResource(e,t,n,s){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let c=[e,t];n&&(c=c.concat(o?n.split(o):n)),e.indexOf(".")>-1&&(c=e.split("."),s=t,t=c[1]),this.addNamespaces(t),cd(this.data,c,s),i.silent||this.emit("added",e,t,n,s)}addResources(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in n)(typeof n[i]=="string"||Array.isArray(n[i]))&&this.addResource(e,t,i,n[i],{silent:!0});s.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,s,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},c=[e,t];e.indexOf(".")>-1&&(c=e.split("."),s=n,n=t,t=c[1]),this.addNamespaces(t);let l=Qo(this.data,c)||{};o.skipCopy||(n=JSON.parse(JSON.stringify(n))),s?np(l,n,i):l={...l,...n},cd(this.data,c,l),o.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(s=>t[s]&&Object.keys(t[s]).length>0)}toJSON(){return this.data}}var rp={processors:{},addPostProcessor(r){this.processors[r.name]=r},handle(r,e,t,n,s){return r.forEach(i=>{this.processors[i]&&(e=this.processors[i].process(e,t,n,s))}),e}};const ud={};class Jo extends Ca{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),PE(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Dt.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const n=this.resolve(e,t);return n&&n.res!==void 0}extractFromKey(e,t){let n=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const s=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const o=n&&e.indexOf(n)>-1,c=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!ME(e,n,s);if(o&&!c){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:i};const u=e.split(n);(n!==s||n===s&&this.options.ns.indexOf(u[0])>-1)&&(i=u.shift()),e=u.join(s)}return typeof i=="string"&&(i=[i]),{key:e,namespaces:i}}translate(e,t,n){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const s=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,i=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:o,namespaces:c}=this.extractFromKey(e[e.length-1],t),l=c[c.length-1],u=t.lng||this.language,d=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&u.toLowerCase()==="cimode"){if(d){const U=t.nsSeparator||this.options.nsSeparator;return s?{res:`${l}${U}${o}`,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${U}${o}`}return s?{res:o,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:o}const m=this.resolve(e,t);let p=m&&m.res;const b=m&&m.usedKey||o,R=m&&m.exactUsedKey||o,A=Object.prototype.toString.apply(p),N=["[object Number]","[object Function]","[object RegExp]"],D=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,V=!this.i18nFormat||this.i18nFormat.handleAsObject;if(V&&p&&(typeof p!="string"&&typeof p!="boolean"&&typeof p!="number")&&N.indexOf(A)<0&&!(typeof D=="string"&&Array.isArray(p))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const U=this.options.returnedObjectHandler?this.options.returnedObjectHandler(b,p,{...t,ns:c}):`key '${o} (${this.language})' returned an object instead of string.`;return s?(m.res=U,m.usedParams=this.getUsedParamsDetails(t),m):U}if(i){const U=Array.isArray(p),Q=U?[]:{},H=U?R:b;for(const I in p)if(Object.prototype.hasOwnProperty.call(p,I)){const E=`${H}${i}${I}`;Q[I]=this.translate(E,{...t,joinArrays:!1,ns:c}),Q[I]===E&&(Q[I]=p[I])}p=Q}}else if(V&&typeof D=="string"&&Array.isArray(p))p=p.join(D),p&&(p=this.extendTranslation(p,e,t,n));else{let U=!1,Q=!1;const H=t.count!==void 0&&typeof t.count!="string",I=Jo.hasDefaultValue(t),E=H?this.pluralResolver.getSuffix(u,t.count,t):"",y=t.ordinal&&H?this.pluralResolver.getSuffix(u,t.count,{ordinal:!1}):"",w=H&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),_=w&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${E}`]||t[`defaultValue${y}`]||t.defaultValue;!this.isValidLookup(p)&&I&&(U=!0,p=_),this.isValidLookup(p)||(Q=!0,p=o);const v=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Q?void 0:p,ie=I&&_!==p&&this.options.updateMissing;if(Q||U||ie){if(this.logger.log(ie?"updateKey":"missingKey",u,l,o,ie?_:p),i){const xe=this.resolve(o,{...t,keySeparator:!1});xe&&xe.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let _e=[];const Ce=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Ce&&Ce[0])for(let xe=0;xe<Ce.length;xe++)_e.push(Ce[xe]);else this.options.saveMissingTo==="all"?_e=this.languageUtils.toResolveHierarchy(t.lng||this.language):_e.push(t.lng||this.language);const at=(xe,Xe,Et)=>{const X=I&&Et!==p?Et:v;this.options.missingKeyHandler?this.options.missingKeyHandler(xe,l,Xe,X,ie,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(xe,l,Xe,X,ie,t),this.emit("missingKey",xe,l,Xe,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&H?_e.forEach(xe=>{const Xe=this.pluralResolver.getSuffixes(xe,t);w&&t[`defaultValue${this.options.pluralSeparator}zero`]&&Xe.indexOf(`${this.options.pluralSeparator}zero`)<0&&Xe.push(`${this.options.pluralSeparator}zero`),Xe.forEach(Et=>{at([xe],o+Et,t[`defaultValue${Et}`]||_)})}):at(_e,o,_))}p=this.extendTranslation(p,e,t,m,n),Q&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${l}:${o}`),(Q||U)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${o}`:o,U?p:void 0):p=this.options.parseMissingKeyHandler(p))}return s?(m.res=p,m.usedParams=this.getUsedParamsDetails(t),m):p}extendTranslation(e,t,n,s,i){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||s.usedLng,s.usedNS,s.usedKey,{resolved:s});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const u=typeof e=="string"&&(n&&n.interpolation&&n.interpolation.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(u){const p=e.match(this.interpolator.nestingRegexp);d=p&&p.length}let m=n.replace&&typeof n.replace!="string"?n.replace:n;if(this.options.interpolation.defaultVariables&&(m={...this.options.interpolation.defaultVariables,...m}),e=this.interpolator.interpolate(e,m,n.lng||this.language,n),u){const p=e.match(this.interpolator.nestingRegexp),b=p&&p.length;d<b&&(n.nest=!1)}!n.lng&&this.options.compatibilityAPI!=="v1"&&s&&s.res&&(n.lng=s.usedLng),n.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var p=arguments.length,b=new Array(p),R=0;R<p;R++)b[R]=arguments[R];return i&&i[0]===b[0]&&!n.context?(o.logger.warn(`It seems you are nesting recursively key: ${b[0]} in key: ${t[0]}`),null):o.translate(...b,t)},n)),n.interpolation&&this.interpolator.reset()}const c=n.postProcess||this.options.postProcess,l=typeof c=="string"?[c]:c;return e!=null&&l&&l.length&&n.applyPostProcessor!==!1&&(e=rp.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...s,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n,s,i,o,c;return typeof e=="string"&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(n))return;const u=this.extractFromKey(l,t),d=u.key;s=d;let m=u.namespaces;this.options.fallbackNS&&(m=m.concat(this.options.fallbackNS));const p=t.count!==void 0&&typeof t.count!="string",b=p&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),R=t.context!==void 0&&(typeof t.context=="string"||typeof t.context=="number")&&t.context!=="",A=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);m.forEach(N=>{this.isValidLookup(n)||(c=N,!ud[`${A[0]}-${N}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(c)&&(ud[`${A[0]}-${N}`]=!0,this.logger.warn(`key "${s}" for languages "${A.join(", ")}" won't get resolved as namespace "${c}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),A.forEach(D=>{if(this.isValidLookup(n))return;o=D;const V=[d];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(V,d,D,N,t);else{let U;p&&(U=this.pluralResolver.getSuffix(D,t.count,t));const Q=`${this.options.pluralSeparator}zero`,H=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(V.push(d+U),t.ordinal&&U.indexOf(H)===0&&V.push(d+U.replace(H,this.options.pluralSeparator)),b&&V.push(d+Q)),R){const I=`${d}${this.options.contextSeparator}${t.context}`;V.push(I),p&&(V.push(I+U),t.ordinal&&U.indexOf(H)===0&&V.push(I+U.replace(H,this.options.pluralSeparator)),b&&V.push(I+Q))}}let j;for(;j=V.pop();)this.isValidLookup(n)||(i=j,n=this.getResource(D,N,j,t))}))})}),{res:n,usedKey:s,exactUsedKey:i,usedLng:o,usedNS:c}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,s):this.resourceStore.getResource(e,t,n,s)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&typeof e.replace!="string";let s=n?e.replace:e;if(n&&typeof e.count<"u"&&(s.count=e.count),this.options.interpolation.defaultVariables&&(s={...this.options.interpolation.defaultVariables,...s}),!n){s={...s};for(const i of t)delete s[i]}return s}static hasDefaultValue(e){const t="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,t.length)&&e[n]!==void 0)return!0;return!1}}function Tc(r){return r.charAt(0).toUpperCase()+r.slice(1)}class hd{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Dt.create("languageUtils")}getScriptPartFromCode(e){if(e=Yo(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=Yo(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(typeof e=="string"&&e.indexOf("-")>-1){const t=["hans","hant","latn","cyrl","cans","mong","arab"];let n=e.split("-");return this.options.lowerCaseLng?n=n.map(s=>s.toLowerCase()):n.length===2?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=Tc(n[1].toLowerCase()))):n.length===3&&(n[0]=n[0].toLowerCase(),n[1].length===2&&(n[1]=n[1].toUpperCase()),n[0]!=="sgn"&&n[2].length===2&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=Tc(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=Tc(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(n=>{if(t)return;const s=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(s))&&(t=s)}),!t&&this.options.supportedLngs&&e.forEach(n=>{if(t)return;const s=this.getLanguagePartFromCode(n);if(this.isSupportedCode(s))return t=s;t=this.options.supportedLngs.find(i=>{if(i===s)return i;if(!(i.indexOf("-")<0&&s.indexOf("-")<0)&&(i.indexOf("-")>0&&s.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===s||i.indexOf(s)===0&&s.length>1))return i})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),typeof e=="string"&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){const n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),s=[],i=o=>{o&&(this.isSupportedCode(o)?s.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return typeof e=="string"&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):typeof e=="string"&&i(this.formatLanguageCode(e)),n.forEach(o=>{s.indexOf(o)<0&&i(this.formatLanguageCode(o))}),s}}let FE=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],UE={1:function(r){return+(r>1)},2:function(r){return+(r!=1)},3:function(r){return 0},4:function(r){return r%10==1&&r%100!=11?0:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?1:2},5:function(r){return r==0?0:r==1?1:r==2?2:r%100>=3&&r%100<=10?3:r%100>=11?4:5},6:function(r){return r==1?0:r>=2&&r<=4?1:2},7:function(r){return r==1?0:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?1:2},8:function(r){return r==1?0:r==2?1:r!=8&&r!=11?2:3},9:function(r){return+(r>=2)},10:function(r){return r==1?0:r==2?1:r<7?2:r<11?3:4},11:function(r){return r==1||r==11?0:r==2||r==12?1:r>2&&r<20?2:3},12:function(r){return+(r%10!=1||r%100==11)},13:function(r){return+(r!==0)},14:function(r){return r==1?0:r==2?1:r==3?2:3},15:function(r){return r%10==1&&r%100!=11?0:r%10>=2&&(r%100<10||r%100>=20)?1:2},16:function(r){return r%10==1&&r%100!=11?0:r!==0?1:2},17:function(r){return r==1||r%10==1&&r%100!=11?0:1},18:function(r){return r==0?0:r==1?1:2},19:function(r){return r==1?0:r==0||r%100>1&&r%100<11?1:r%100>10&&r%100<20?2:3},20:function(r){return r==1?0:r==0||r%100>0&&r%100<20?1:2},21:function(r){return r%100==1?1:r%100==2?2:r%100==3||r%100==4?3:0},22:function(r){return r==1?0:r==2?1:(r<0||r>10)&&r%10==0?2:3}};const jE=["v1","v2","v3"],BE=["v4"],dd={zero:0,one:1,two:2,few:3,many:4,other:5};function qE(){const r={};return FE.forEach(e=>{e.lngs.forEach(t=>{r[t]={numbers:e.nr,plurals:UE[e.fc]}})}),r}class $E{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Dt.create("pluralResolver"),(!this.options.compatibilityJSON||BE.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=qE()}addRule(e,t){this.rules[e]=t}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(Yo(e==="dev"?"en":e),{type:t.ordinal?"ordinal":"cardinal"})}catch{return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}getPluralFormsOfKey(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,n).map(s=>`${t}${s}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.getRule(e,t);return n?this.shouldUseIntlApi()?n.resolvedOptions().pluralCategories.sort((s,i)=>dd[s]-dd[i]).map(s=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${s}`):n.numbers.map(s=>this.getSuffix(e,s,t)):[]}getSuffix(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=this.getRule(e,n);return s?this.shouldUseIntlApi()?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${s.select(t)}`:this.getSuffixRetroCompatible(s,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const n=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let s=e.numbers[n];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(s===2?s="plural":s===1&&(s=""));const i=()=>this.options.prepend&&s.toString()?this.options.prepend+s.toString():s.toString();return this.options.compatibilityJSON==="v1"?s===1?"":typeof s=="number"?`_plural_${s.toString()}`:i():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?i():this.options.prepend&&n.toString()?this.options.prepend+n.toString():n.toString()}shouldUseIntlApi(){return!jE.includes(this.options.compatibilityJSON)}}function fd(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=NE(r,e,t);return!i&&s&&typeof t=="string"&&(i=Wc(r,t,n),i===void 0&&(i=Wc(e,t,n))),i}class zE{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Dt.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:n,useRawValueToEscape:s,prefix:i,prefixEscaped:o,suffix:c,suffixEscaped:l,formatSeparator:u,unescapeSuffix:d,unescapePrefix:m,nestingPrefix:p,nestingPrefixEscaped:b,nestingSuffix:R,nestingSuffixEscaped:A,nestingOptionsSeparator:N,maxReplaces:D,alwaysFormat:V}=e.interpolation;this.escape=t!==void 0?t:DE,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=s!==void 0?s:!1,this.prefix=i?Dr(i):o||"{{",this.suffix=c?Dr(c):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=d?"":m||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=p?Dr(p):b||Dr("$t("),this.nestingSuffix=R?Dr(R):A||Dr(")"),this.nestingOptionsSeparator=N||",",this.maxReplaces=D||1e3,this.alwaysFormat=V!==void 0?V:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,n)=>t&&t.source===n?(t.lastIndex=0,t):new RegExp(n,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,n,s){let i,o,c;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function u(R){return R.replace(/\$/g,"$$$$")}const d=R=>{if(R.indexOf(this.formatSeparator)<0){const V=fd(t,l,R,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(V,void 0,n,{...s,...t,interpolationkey:R}):V}const A=R.split(this.formatSeparator),N=A.shift().trim(),D=A.join(this.formatSeparator).trim();return this.format(fd(t,l,N,this.options.keySeparator,this.options.ignoreJSONStructure),D,n,{...s,...t,interpolationkey:N})};this.resetRegExp();const m=s&&s.missingInterpolationHandler||this.options.missingInterpolationHandler,p=s&&s.interpolation&&s.interpolation.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:R=>u(R)},{regex:this.regexp,safeValue:R=>this.escapeValue?u(this.escape(R)):u(R)}].forEach(R=>{for(c=0;i=R.regex.exec(e);){const A=i[1].trim();if(o=d(A),o===void 0)if(typeof m=="function"){const D=m(e,i,s);o=typeof D=="string"?D:""}else if(s&&Object.prototype.hasOwnProperty.call(s,A))o="";else if(p){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${A} for interpolating ${e}`),o="";else typeof o!="string"&&!this.useRawValueToEscape&&(o=ad(o));const N=R.safeValue(o);if(e=e.replace(i[0],N),p?(R.regex.lastIndex+=o.length,R.regex.lastIndex-=i[0].length):R.regex.lastIndex=0,c++,c>=this.maxReplaces)break}}),e}nest(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s,i,o;function c(l,u){const d=this.nestingOptionsSeparator;if(l.indexOf(d)<0)return l;const m=l.split(new RegExp(`${d}[ ]*{`));let p=`{${m[1]}`;l=m[0],p=this.interpolate(p,o);const b=p.match(/'/g),R=p.match(/"/g);(b&&b.length%2===0&&!R||R.length%2!==0)&&(p=p.replace(/'/g,'"'));try{o=JSON.parse(p),u&&(o={...u,...o})}catch(A){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,A),`${l}${d}${p}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,l}for(;s=this.nestingRegexp.exec(e);){let l=[];o={...n},o=o.replace&&typeof o.replace!="string"?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let u=!1;if(s[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(s[1])){const d=s[1].split(this.formatSeparator).map(m=>m.trim());s[1]=d.shift(),l=d,u=!0}if(i=t(c.call(this,s[1].trim(),o),o),i&&s[0]===e&&typeof i!="string")return i;typeof i!="string"&&(i=ad(i)),i||(this.logger.warn(`missed to resolve ${s[1]} for nesting ${e}`),i=""),u&&(i=l.reduce((d,m)=>this.format(d,m,n.lng,{...n,interpolationkey:s[1].trim()}),i.trim())),e=e.replace(s[0],i),this.regexp.lastIndex=0}return e}}function HE(r){let e=r.toLowerCase().trim();const t={};if(r.indexOf("(")>-1){const n=r.split("(");e=n[0].toLowerCase().trim();const s=n[1].substring(0,n[1].length-1);e==="currency"&&s.indexOf(":")<0?t.currency||(t.currency=s.trim()):e==="relativetime"&&s.indexOf(":")<0?t.range||(t.range=s.trim()):s.split(";").forEach(o=>{if(o){const[c,...l]=o.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),d=c.trim();t[d]||(t[d]=u),u==="false"&&(t[d]=!1),u==="true"&&(t[d]=!0),isNaN(u)||(t[d]=parseInt(u,10))}})}return{formatName:e,formatOptions:t}}function Vr(r){const e={};return function(n,s,i){const o=s+JSON.stringify(i);let c=e[o];return c||(c=r(Yo(s),i),e[o]=c),c(n)}}class GE{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Dt.create("formatter"),this.options=e,this.formats={number:Vr((t,n)=>{const s=new Intl.NumberFormat(t,{...n});return i=>s.format(i)}),currency:Vr((t,n)=>{const s=new Intl.NumberFormat(t,{...n,style:"currency"});return i=>s.format(i)}),datetime:Vr((t,n)=>{const s=new Intl.DateTimeFormat(t,{...n});return i=>s.format(i)}),relativetime:Vr((t,n)=>{const s=new Intl.RelativeTimeFormat(t,{...n});return i=>s.format(i,n.range||"day")}),list:Vr((t,n)=>{const s=new Intl.ListFormat(t,{...n});return i=>s.format(i)})},this.init(e)}init(e){const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=n.formatSeparator?n.formatSeparator:n.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Vr(t)}format(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return t.split(this.formatSeparator).reduce((c,l)=>{const{formatName:u,formatOptions:d}=HE(l);if(this.formats[u]){let m=c;try{const p=s&&s.formatParams&&s.formatParams[s.interpolationkey]||{},b=p.locale||p.lng||s.locale||s.lng||n;m=this.formats[u](c,b,{...d,...s,...p})}catch(p){this.logger.warn(p)}return m}else this.logger.warn(`there was no format function for ${u}`);return c},e)}}function KE(r,e){r.pending[e]!==void 0&&(delete r.pending[e],r.pendingCount--)}class WE extends Ca{constructor(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=s,this.logger=Dt.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=s.maxParallelReads||10,this.readingCalls=0,this.maxRetries=s.maxRetries>=0?s.maxRetries:5,this.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(n,s.backend,s)}queueLoad(e,t,n,s){const i={},o={},c={},l={};return e.forEach(u=>{let d=!0;t.forEach(m=>{const p=`${u}|${m}`;!n.reload&&this.store.hasResourceBundle(u,m)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?o[p]===void 0&&(o[p]=!0):(this.state[p]=1,d=!1,o[p]===void 0&&(o[p]=!0),i[p]===void 0&&(i[p]=!0),l[m]===void 0&&(l[m]=!0)))}),d||(c[u]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:s}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(c),toLoadNamespaces:Object.keys(l)}}loaded(e,t,n){const s=e.split("|"),i=s[0],o=s[1];t&&this.emit("failedLoading",i,o,t),n&&this.store.addResourceBundle(i,o,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2;const c={};this.queue.forEach(l=>{xE(l.loaded,[i],o),KE(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{c[u]||(c[u]={});const d=l.loaded[u];d.length&&d.forEach(m=>{c[u][m]===void 0&&(c[u][m]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",c),this.queue=this.queue.filter(l=>!l.done)}read(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:n,tried:s,wait:i,callback:o});return}this.readingCalls++;const c=(u,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const m=this.waitingReads.shift();this.read(m.lng,m.ns,m.fcName,m.tried,m.wait,m.callback)}if(u&&d&&s<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,n,s+1,i*2,o)},i);return}o(u,d)},l=this.backend[n].bind(this.backend);if(l.length===2){try{const u=l(e,t);u&&typeof u.then=="function"?u.then(d=>c(null,d)).catch(c):c(null,u)}catch(u){c(u)}return}return l(e,t,c)}prepareLoading(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();typeof e=="string"&&(e=this.languageUtils.toResolveHierarchy(e)),typeof t=="string"&&(t=[t]);const i=this.queueLoad(e,t,n,s);if(!i.toLoad.length)return i.pending.length||s(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=e.split("|"),s=n[0],i=n[1];this.read(s,i,"read",void 0,void 0,(o,c)=>{o&&this.logger.warn(`${t}loading namespace ${i} for language ${s} failed`,o),!o&&c&&this.logger.log(`${t}loaded namespace ${i} for language ${s}`,c),this.loaded(e,o,c)})}saveMissing(e,t,n,s,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${n}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if(this.backend&&this.backend.create){const l={...o,isUpdate:i},u=this.backend.create.bind(this.backend);if(u.length<6)try{let d;u.length===5?d=u(e,t,n,s,l):d=u(e,t,n,s),d&&typeof d.then=="function"?d.then(m=>c(null,m)).catch(c):c(null,d)}catch(d){c(d)}else u(e,t,n,s,c,l)}!e||!e[0]||this.store.addResource(e[0],t,n,s)}}}function md(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){let t={};if(typeof e[1]=="object"&&(t=e[1]),typeof e[1]=="string"&&(t.defaultValue=e[1]),typeof e[2]=="string"&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const n=e[3]||e[2];Object.keys(n).forEach(s=>{t[s]=n[s]})}return t},interpolation:{escapeValue:!0,format:r=>r,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function pd(r){return typeof r.ns=="string"&&(r.ns=[r.ns]),typeof r.fallbackLng=="string"&&(r.fallbackLng=[r.fallbackLng]),typeof r.fallbackNS=="string"&&(r.fallbackNS=[r.fallbackNS]),r.supportedLngs&&r.supportedLngs.indexOf("cimode")<0&&(r.supportedLngs=r.supportedLngs.concat(["cimode"])),r}function yo(){}function QE(r){Object.getOwnPropertyNames(Object.getPrototypeOf(r)).forEach(t=>{typeof r[t]=="function"&&(r[t]=r[t].bind(r))})}class vi extends Ca{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=pd(e),this.services={},this.logger=Dt,this.modules={external:[]},QE(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(n=t,t={}),!t.defaultNS&&t.defaultNS!==!1&&t.ns&&(typeof t.ns=="string"?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const s=md();this.options={...s,...this.options,...pd(t)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...s.interpolation,...this.options.interpolation}),t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);function i(d){return d?typeof d=="function"?new d:d:null}if(!this.options.isClone){this.modules.logger?Dt.init(i(this.modules.logger),this.options):Dt.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:typeof Intl<"u"&&(d=GE);const m=new hd(this.options);this.store=new ld(this.options.resources,this.options);const p=this.services;p.logger=Dt,p.resourceStore=this.store,p.languageUtils=m,p.pluralResolver=new $E(m,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),d&&(!this.options.interpolation.format||this.options.interpolation.format===s.interpolation.format)&&(p.formatter=i(d),p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new zE(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new WE(i(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",function(b){for(var R=arguments.length,A=new Array(R>1?R-1:0),N=1;N<R;N++)A[N-1]=arguments[N];e.emit(b,...A)}),this.modules.languageDetector&&(p.languageDetector=i(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=i(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new Jo(this.services,this.options),this.translator.on("*",function(b){for(var R=arguments.length,A=new Array(R>1?R-1:0),N=1;N<R;N++)A[N-1]=arguments[N];e.emit(b,...A)}),this.modules.external.forEach(b=>{b.init&&b.init(this)})}if(this.format=this.options.interpolation.format,n||(n=yo),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=function(){return e.store[d](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=function(){return e.store[d](...arguments),e}});const l=qs(),u=()=>{const d=(m,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(p),n(m,p)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}loadResources(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yo;const s=typeof e=="string"?e:this.language;if(typeof e=="function"&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(s&&s.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const i=[],o=c=>{if(!c||c==="cimode")return;this.services.languageUtils.toResolveHierarchy(c).forEach(u=>{u!=="cimode"&&i.indexOf(u)<0&&i.push(u)})};s?o(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>o(l)),this.options.preload&&this.options.preload.forEach(c=>o(c)),this.services.backendConnector.load(i,this.options.ns,c=>{!c&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(c)})}else n(null)}reloadResources(e,t,n){const s=qs();return e||(e=this.languages),t||(t=this.options.ns),n||(n=yo),this.services.backendConnector.reload(e,t,i=>{s.resolve(),n(i)}),s}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&rp.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const n=this.languages[t];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}changeLanguage(e,t){var n=this;this.isLanguageChangingTo=e;const s=qs();this.emit("languageChanging",e);const i=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},o=(l,u)=>{u?(i(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,s.resolve(function(){return n.t(...arguments)}),t&&t(l,function(){return n.t(...arguments)})},c=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const u=typeof l=="string"?l:this.services.languageUtils.getBestMatchFromCodes(l);u&&(this.language||i(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(u)),this.loadResources(u,d=>{o(d,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?c(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(c):this.services.languageDetector.detect(c):c(e),s}getFixedT(e,t,n){var s=this;const i=function(o,c){let l;if(typeof c!="object"){for(var u=arguments.length,d=new Array(u>2?u-2:0),m=2;m<u;m++)d[m-2]=arguments[m];l=s.options.overloadTranslationOptionHandler([o,c].concat(d))}else l={...c};l.lng=l.lng||i.lng,l.lngs=l.lngs||i.lngs,l.ns=l.ns||i.ns,l.keyPrefix=l.keyPrefix||n||i.keyPrefix;const p=s.options.keySeparator||".";let b;return l.keyPrefix&&Array.isArray(o)?b=o.map(R=>`${l.keyPrefix}${p}${R}`):b=l.keyPrefix?`${l.keyPrefix}${p}${o}`:o,s.t(b,l)};return typeof e=="string"?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=n,i}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=t.lng||this.resolvedLanguage||this.languages[0],s=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const o=(c,l)=>{const u=this.services.backendConnector.state[`${c}|${l}`];return u===-1||u===2};if(t.precheck){const c=t.precheck(this,o);if(c!==void 0)return c}return!!(this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(n,e)&&(!s||o(i,e)))}loadNamespaces(e,t){const n=qs();return this.options.ns?(typeof e=="string"&&(e=[e]),e.forEach(s=>{this.options.ns.indexOf(s)<0&&this.options.ns.push(s)}),this.loadResources(s=>{n.resolve(),t&&t(s)}),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){const n=qs();typeof e=="string"&&(e=[e]);const s=this.options.preload||[],i=e.filter(o=>s.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=s.concat(i),this.loadResources(o=>{n.resolve(),t&&t(o)}),n):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=this.services&&this.services.languageUtils||new hd(md());return t.indexOf(n.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new vi(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yo;const n=e.forkResourceStore;n&&delete e.forkResourceStore;const s={...this.options,...e,isClone:!0},i=new vi(s);return(e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(c=>{i[c]=this[c]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},n&&(i.store=new ld(this.store.data,s),i.services.resourceStore=i.store),i.translator=new Jo(i.services,s),i.translator.on("*",function(c){for(var l=arguments.length,u=new Array(l>1?l-1:0),d=1;d<l;d++)u[d-1]=arguments[d];i.emit(c,...u)}),i.init(s,t),i.translator.options=s,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const de=vi.createInstance();de.createInstance=vi.createInstance;de.createInstance;de.dir;de.init;de.loadResources;de.reloadResources;de.use;de.changeLanguage;de.getFixedT;de.t;de.exists;de.setDefaultNamespace;de.hasLoadedNamespace;de.loadNamespaces;de.loadLanguages;const{slice:YE,forEach:JE}=[];function XE(r){return JE.call(YE.call(arguments,1),e=>{if(e)for(const t in e)r[t]===void 0&&(r[t]=e[t])}),r}const gd=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,ZE=(r,e,t)=>{const n=t||{};n.path=n.path||"/";const s=encodeURIComponent(e);let i=`${r}=${s}`;if(n.maxAge>0){const o=n.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");i+=`; Max-Age=${Math.floor(o)}`}if(n.domain){if(!gd.test(n.domain))throw new TypeError("option domain is invalid");i+=`; Domain=${n.domain}`}if(n.path){if(!gd.test(n.path))throw new TypeError("option path is invalid");i+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");i+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(i+="; HttpOnly"),n.secure&&(i+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i},yd={create(r,e,t,n){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(s.expires=new Date,s.expires.setTime(s.expires.getTime()+t*60*1e3)),n&&(s.domain=n),document.cookie=ZE(r,encodeURIComponent(e),s)},read(r){const e=`${r}=`,t=document.cookie.split(";");for(let n=0;n<t.length;n++){let s=t[n];for(;s.charAt(0)===" ";)s=s.substring(1,s.length);if(s.indexOf(e)===0)return s.substring(e.length,s.length)}return null},remove(r){this.create(r,"",-1)}};var eI={name:"cookie",lookup(r){let{lookupCookie:e}=r;if(e&&typeof document<"u")return yd.read(e)||void 0},cacheUserLanguage(r,e){let{lookupCookie:t,cookieMinutes:n,cookieDomain:s,cookieOptions:i}=e;t&&typeof document<"u"&&yd.create(t,r,n,s,i)}},tI={name:"querystring",lookup(r){var n;let{lookupQuerystring:e}=r,t;if(typeof window<"u"){let{search:s}=window.location;!window.location.search&&((n=window.location.hash)==null?void 0:n.indexOf("?"))>-1&&(s=window.location.hash.substring(window.location.hash.indexOf("?")));const o=s.substring(1).split("&");for(let c=0;c<o.length;c++){const l=o[c].indexOf("=");l>0&&o[c].substring(0,l)===e&&(t=o[c].substring(l+1))}}return t}};let $s=null;const _d=()=>{if($s!==null)return $s;try{$s=window!=="undefined"&&window.localStorage!==null;const r="i18next.translate.boo";window.localStorage.setItem(r,"foo"),window.localStorage.removeItem(r)}catch{$s=!1}return $s};var nI={name:"localStorage",lookup(r){let{lookupLocalStorage:e}=r;if(e&&_d())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(r,e){let{lookupLocalStorage:t}=e;t&&_d()&&window.localStorage.setItem(t,r)}};let zs=null;const vd=()=>{if(zs!==null)return zs;try{zs=window!=="undefined"&&window.sessionStorage!==null;const r="i18next.translate.boo";window.sessionStorage.setItem(r,"foo"),window.sessionStorage.removeItem(r)}catch{zs=!1}return zs};var rI={name:"sessionStorage",lookup(r){let{lookupSessionStorage:e}=r;if(e&&vd())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(r,e){let{lookupSessionStorage:t}=e;t&&vd()&&window.sessionStorage.setItem(t,r)}},sI={name:"navigator",lookup(r){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:n,language:s}=navigator;if(t)for(let i=0;i<t.length;i++)e.push(t[i]);n&&e.push(n),s&&e.push(s)}return e.length>0?e:void 0}},iI={name:"htmlTag",lookup(r){let{htmlTag:e}=r,t;const n=e||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(t=n.getAttribute("lang")),t}},oI={name:"path",lookup(r){var s;let{lookupFromPathIndex:e}=r;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?(s=t[typeof e=="number"?e:0])==null?void 0:s.replace("/",""):void 0}},aI={name:"subdomain",lookup(r){var s,i;let{lookupFromSubdomainIndex:e}=r;const t=typeof e=="number"?e+1:1,n=typeof window<"u"&&((i=(s=window.location)==null?void 0:s.hostname)==null?void 0:i.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(n)return n[t]}};function cI(){return{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:r=>r}}class sp{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e||{languageUtils:{}},this.options=XE(t,this.options||{},cI()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=s=>s.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(eI),this.addDetector(tI),this.addDetector(nI),this.addDetector(rI),this.addDetector(sI),this.addDetector(iI),this.addDetector(oI),this.addDetector(aI)}addDetector(e){return this.detectors[e.name]=e,this}detect(e){e||(e=this.options.order);let t=[];return e.forEach(n=>{if(this.detectors[n]){let s=this.detectors[n].lookup(this.options);s&&typeof s=="string"&&(s=[s]),s&&(t=t.concat(s))}}),t=t.map(n=>this.options.convertDetectedLanguage(n)),this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e,t){t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(e,this.options)}))}}sp.type="languageDetector";const lI="Mitché",uI="حيث يتردد صدى الأمل",hI={close:"إغلاق"},dI={home:"الرئيسية",echoes:"صدى",resources:"موارد",events:"فعاليات",leaderboard:"المتصدرون",constellation:"الملف الشخصي",tapestry:"نسيج الأمل",admin:"الإدارة"},fI={welcome:"مرحباً بك في Mitché",startJourney:"ابدأ رحلتك",safeHavenTitle:"ملاذك الآمن",safeHavenDesc:"Mitché هو ملاذ آمن لتقديم وتلقي المساعدة مع الحفاظ على سرية الهوية. هنا، طلبات المساعدة هي 'أصداء'، وعروض الدعم هي 'عطايا'. هويتك محمية، مما يسمح للكرامة والرحمة بالازدهار.",agreement:"بالدخول، أنت توافق على مبدأ السرية والاحترام المتبادل الذي تقوم عليه منصتنا."},mI={modalTitle:"الدخول إلى الملاذ",login:"تسجيل الدخول",signup:"إنشاء حساب",username:"اسم المستخدم",password:"كلمة المرور",loginLoading:"...جاري الدخول",signupLoading:"...جاري الإنشاء",errorInvalid:"اسم المستخدم أو كلمة المرور غير صحيحة.",errorExists:"اسم المستخدم موجود بالفعل.",errorPassword:"الرجاء إدخال كلمة مرور.",errorUsernameRequired:"الرجاء إدخال اسم مستخدم.",errorSymbolicName:"الرجاء اختيار اسم رمزي.",identityChoiceInfo:"ستختار هويتك الرمزية بعد إنشاء حسابك.",role:"الدور",uploadDocs:"تحميل مستندات التحقق (إن وجدت)",documentsSelected:"مستندات مختارة",pendingApproval:"تم تقديم حسابك للمراجعة. سيقوم المسؤول بمراجعة المستندات والموافقة على حسابك قريبًا.",errorUsernameNotSelected:"الرجاء اختيار اسم مستخدم.",generatingUsernames:"جاري إنشاء أسماء فريدة...",chooseUsername:"اختر اسم المستخدم الخاص بك",refreshUsernames:"تحديث الأسماء",googleSignIn:"تسجيل الدخول عبر Google",googleSignInLoading:"جارٍ تسجيل الدخول عبر Google...",orDivider:"أو",errorGoogleSignIn:"فشل تسجيل الدخول عبر Google. الرجاء المحاولة مرة أخرى."},pI={step1:{title:"مرحباً بك في Mitché",subtitle:"ملاذ يتردد فيه صدى الأمل. دعنا نستعرض المبادئ الأساسية التي تشكل عالمنا."},step2:{title:"الأصداء: نداءات الأمل",description:"عندما تحتاج إلى مساعدة، يمكنك إطلاق 'صدى'. إنه طلبك المجهول الذي يصل إلى المجتمع، كتموج في بركة هادئة."},step3:{title:"العطايا: بذور التعاطف",description:"يمكنك الرد على الأصداء بـ 'عطايا' - سواء كانت مساعدة مادية أو كلمات تشجيع. كل عطاء هو نور في الظلام."},step4:{title:"هويتك: حامل الأمل",description:"هنا، أنت معروف باسمك ورمزك الذي اخترته، مما يضمن الكرامة والأمان للجميع. هذا هو الدرع الذي يحمي هويتك الحقيقية."},step5:{title:"اصنع هويتك الرمزية",subtitle:"اختر الاسم والرمز اللذين سيمثلان نورك في هذا المجتمع.",chooseName:"اختر اسمك",chooseIcon:"اختر رمزك"},step6:{title:"أنت الآن جزء من النسيج",subtitle:"هذه هي هويتك كحامل للأمل. تذكر، خلف كل رمز يكمن قلب إنسان."},buttons:{begin:"ابدأ",next:"التالي",back:"رجوع",createIdentity:"اصنع هويتك",complete:"ادخل إلى الملاذ"},selectName:"-- اختر اسماً --",symbolicNames:{hopeBearer:"حامل الأمل",voiceOfLight:"صوت النور",helpingHand:"يد العون",morningStar:"نجمة الصباح",braveHeart:"قلب شجاع"}},gI={welcome:"أهلاً بك، {{name}}",quote:'"ليكن نورك صدى في هذا العالم"',tiles:{echoes:"جدار الصدى",echoesSub:"اطلب أو استجب للنداءات",events:"الفعاليات المجتمعية",eventsSub:"شارك في المبادرات المجتمعية",tapestry:"نسيج الأمل",tapestrySub:"اقرأ قصص الصمود"}},yI={title:"جدار الصدى",subtitle:"هنا ترتفع الأصوات وتتلاقى الأيادي",filter:"تصفية",allCategories:"كل الفئات",loading:"جاري تحميل الأصداء...",emptyTitle:"الجدار ملاذ للسكينة",emptySubtitle:"صمته علامة على أن الاحتياجات ملباة في الوقت الحالي. ستظهر الأصداء الجديدة عندما يطلقها أفراد المجتمع.",time:{just_now:"الآن",seconds_ago_one:"منذ ثانية واحدة",seconds_ago_two:"منذ ثانيتين",seconds_ago_few:"منذ {{count}} ثوان",seconds_ago_many:"منذ {{count}} ثانية",seconds_ago_other:"منذ {{count}} ثانية",minutes_ago_one:"منذ دقيقة واحدة",minutes_ago_two:"منذ دقيقتين",minutes_ago_few:"منذ {{count}} دقائق",minutes_ago_many:"منذ {{count}} دقيقة",minutes_ago_other:"منذ {{count}} دقيقة",hours_ago_one:"منذ ساعة واحدة",hours_ago_two:"منذ ساعتين",hours_ago_few:"منذ {{count}} ساعات",hours_ago_many:"منذ {{count}} ساعة",hours_ago_other:"منذ {{count}} ساعة",days_ago_one:"منذ يوم واحد",days_ago_two:"منذ يومين",days_ago_few:"منذ {{count}} أيام",days_ago_many:"منذ {{count}} يوماً",days_ago_other:"منذ {{count}} يوماً",months_ago_one:"منذ شهر واحد",months_ago_two:"منذ شهرين",months_ago_few:"منذ {{count}} أشهر",months_ago_many:"منذ {{count}} شهراً",months_ago_other:"منذ {{count}} شهراً",years_ago_one:"منذ سنة واحدة",years_ago_two:"منذ سنتين",years_ago_few:"منذ {{count}} سنوات",years_ago_many:"منذ {{count}} سنة",years_ago_other:"منذ {{count}} سنة"},card:{provideHelp:"تقديم مساعدة",sendEncouragement:"إرسال تشجيع",confirmReceipt:"تأكيد استلام المساعدة",claimHopePoints:"المطالبة بنقاط الأمل",waitingReceipt:"بانتظار تأكيد الاستلام"},helpModal:{titleHelp:"تقديم مساعدة",bodyHelp:"أنت على وشك بدء المساعدة في هذا الطلب. سيتم إخطار صاحب الطلب. الرجاء التواصل معه عبر الرقم أدناه للمتابعة.",phoneNumber:"📞 +961 71 123 456",dummyPhone:"(هذا رقم وهمي لأغراض العرض)",confirmHelp:"أؤكد، سأقوم بالمساعدة"},encourageModal:{title:"إرسال رسالة تشجيع",placeholder:"اكتب رسالتك هنا... كلماتك قد تكون الضوء الذي يحتاجه أحدهم.",send:"إرسال"}},_I={title:"اطلق نداءك",subtitle:"كل طلب هو بذرة أمل. صف ما تحتاجه بصدق.",form:{title:"عنوان الطلب",titlePlaceholder:"مثال: بحاجة إلى دعم نفسي",category:"فئة الطلب",region:"المنطقة",regionPlaceholder:"مثال: بيروت",description:"وصف الطلب",descriptionPlaceholder:"اشرح طلبك بالتفصيل...",mode:"نوع الطلب",modeLoud:"طلب عالي (علني)",modeLoudDesc:"يظهر على جدار الصدى للجميع",modeSilent:"طلب صامت (خاص)",modeSilentDesc:"يُرسل فقط للمنظمات والجهات المعنية",submit:"إرسال الطلب"},discardTitle:"تجاهل الطلب؟",discardConfirm:"نعم، تجاهل",discardCancel:"إلغاء",discardBody:"هل أنت متأكد أنك تريد تجاهل هذا الطلب؟ لن يتم حفظ التغييرات التي قمت بها."},vI={starOfHope:"نجم في كوكبة الأمل",totalHopePoints:"مجموع نقاط الأمل",quote:'"كل نقطة هي شهادة على نورك"',breakdownTitle:"تفصيل نقاط الأمل",installApp:"تثبيت التطبيق",appInstalled:"تم تثبيت التطبيق",awardNominations:"ترشيحات الجوائز",privacySettings:"إعدادات الخصوصية",logout:"تسجيل الخروج",scanToGiveHope:"امسح لتهدي نقطة أمل",accessCamera:"الوصول إلى الكاميرا",cameraAccessGranted:"تم منح الوصول إلى الكاميرا!",cameraAccessDenied:"تم رفض الوصول إلى الكاميرا. يرجى التحقق من أذونات المتصفح.",cameraNotSupported:"الوصول إلى الكاميرا غير مدعوم في متصفحك.",yourEvents:"فعالياتك",noEvents:"لم تقم بإنشاء أي فعاليات بعد.",accolades:{title:"الأوسمة والشارات"},achievements:{firstEcho:{title:"الصدى الأول",description:"قمت بأول طلب مساعدة لك."},firstOffering:{title:"العطاء الأول",description:"قدمت أول مساعدة أو تشجيع."},compassionateVoice:{title:"صوت رحيم",description:"أرسلت 3 رسائل تشجيع."},communityPillar:{title:"عمود المجتمع",description:"أكملت مساعدة طلبين."},beaconOfHope:{title:"منارة أمل",description:"حصلت قصة كُرِّمت فيها على 10 أصداء."}},activity:{title:"النشاط الأخير",noActivity:"لا يوجد نشاط حديث لعرضه.",createdRequest:'أنشأت طلباً: "{{title}}"',helpedRequest:'ساعدت في طلب: "{{title}}"',sentEncouragement:'أرسلت تشجيعاً لـ: "{{title}}"',aRequest:"طلب"},editProfile:{title:"تعديل الملف الشخصي",location:"الموقع",locationPlaceholder:"مثال: بيروت، لبنان",bio:"نبذة تعريفية",bioPlaceholder:"أخبرنا القليل عن نفسك...",save:"حفظ التغييرات"},showQrCode:"رمز QR",qrCodeTitle:"رمز QR الخاص بك",qrCodeDesc:"شارك هذا الرمز للتواصل مع {{name}}.",qrCodeMissing:"احفظ ملفك الشخصي لإنشاء رمز QR.",notifications:{enable:"تفعيل الإشعارات",disable:"إلغاء تفعيل الإشعارات",loading:"جاري التحميل...",testTitle:"إرسال إشعار اختباري",unsupported:"الإشعارات الفورية غير مدعومة على هذا المتصفح."}},wI={title:"نسيج الأمل",subtitle:"أرشيف حي للصمود والتحول، منسوج من خيوط العطاء",threads:"خيوط",echoes:"أصداء",souls:"أرواح",filterAll:"الكل",filterBuilders:"بناة المجتمع",filterHeroes:"أبطال صامتون",filterVoices:"أصوات التعاطف",thread:"خيط",livesTouched:"أرواح تأثرت",echoStory:"صدى ({count})",emptyTitle:"لا توجد خيوط في هذا القسم بعد.",emptySubtitle:"لكن النسيج ينمو كل يوم بفضل أمثالك.",story:{revealed:"قصة أمل جديدة، كُشفت للعالم من خلال الشجاعة والرحمة.",anonymous:"وهج نجم صامت، شعر به الكثيرون، وعرفه القليلون. شهادة على القوة الهادئة."}},EI={noNomination:"لا يوجد ترشيح نشط.",title:"لقد وصل نورك إلى المعبد",subtitle:"تم ترشيحك لجائزة حامل الأمل. هل تود أن تخطو إلى الأمام، أم تبقى نجماً صامتاً؟",revealIdentity:"كشف الهوية",stayAnonymous:"البقاء مجهولاً",confirmRevealTitle:"تأكيد كشف الهوية",confirmRevealBody:'باختيارك كشف هويتك، سيتم عرض اسمك الحقيقي وصورتك بشكل علني على خيط قصتك في "نسيج الأمل". هذا العمل القوي يربط وجهاً بالأمل الذي ألهمته، مما يسمح للمجتمع برؤية الشخص خلف الاسم الرمزي والاحتفاء به. هل أنت مستعد للخطو نحو النور؟',confirmRevealButton:"نعم، أؤكد الكشف",back:"العودة",revealFormTitle:"الكشف عن هويتك",realName:"الاسم الحقيقي",realNamePlaceholder:"اسمك الذي سيظهر في الاحتفال",photo:"صورة شخصية (اختياري)",confirmAndContinue:"تأكيد ومتابعة",confirmAnonymousTitle:"تأكيد البقاء مجهولاً",confirmAnonymousBody:'باختيارك البقاء مجهولاً، سيستمر اسمك وأيقونتك الرمزية في تمثيلك في "نسيج الأمل". ستلهم قصتك الآخرين بينما تظل هويتك سراً ثميناً. هل هذا هو طريقك المختار؟',confirmAnonymousButton:"نعم، أؤكد إخفاء الهوية",finishedTitle:"سواء كان اسمك معروفاً أم لا، فإن إرثك خالد.",finishedSubtitle:"سيتم تكريم اختيارك بكل تبجيل واحترام.",viewTapestry:"شاهد نسيج الأمل"},II={title:"الإشعارات",empty:"لا توجد إشعارات جديدة.",nomination:"لقد وصل نورك إلى المعبد. تم ترشيحك لجائزة حامل الأمل. هل تود أن تخطو إلى الأمام، أم تبقى نجماً صامتاً؟",encouragement:'رسالة تشجيع جديدة على طلبك "{{title}}..."',helpOffer:'مستخدم "{{name}}" بدأ بمساعدتك في طلبك "{{title}}...".',receiptConfirm:'صاحب الطلب "{{title}}..." أكد استلام المساعدة. يمكنك الآن المطالبة بنقاط الأمل.',fulfillment:'تمت تلبية طلبك "{{title}}..."! شكراً للمستخدم الذي ساعدك.',achievementUnlocked:"لقد حصلت على إنجاز: {{achievement}}!"},bI={Citizen:"مواطن",NGO:"منظمة غير حكومية",PublicWorker:"عامل في القطاع العام",Admin:"مدير"},TI={Food:"طعام",Shelter:"مأوى",Medical:"دعم طبي",Emotional:"دعم نفسي",Legal:"مساعدة قانونية",Employment:"فرصة عمل"},SI={SilentHero:"بطل صامت",VoiceOfCompassion:"صوت التعاطف",CommunityBuilder:"باني المجتمع",CommunityGift:"هدية مجتمعية",Ritual:"طقس"},AI={success:"اكتملت الطقوس اليومية — تم منح نقطة أمل!",error:"تعذر إكمال الطقس."},RI={title:"الحالة",Open:"مفتوح",Pending:"قيد المساعدة",Fulfilled:"تمت المساعدة",Closed:"مغلق"},PI={status:{scanning:"ابحث عن رمز QR...",processing:"جاري المعالجة...",noCamera:"لا يمكن الوصول إلى الكاميرا. يرجى التحقق من الأذونات."},success:{giftSent:"لقد أهديت نقطة أمل إلى {{name}}. لقد ربحت أيضاً نقطة واحدة!"},error:{notLoggedIn:"يجب عليك تسجيل الدخول للقيام بذلك.",selfGift:"لا يمكنك إعطاء نقطة لنفسك.",alreadyGiven:"لقد أهديت نقطتك اليومية بالفعل. حاول مرة أخرى غداً.",userNotFound:"لم يتم العثور على هذا المستخدم.",invalidQR:"هذا ليس رمز QR صالح لمستخدم Mitché."}},CI={title:"فعاليات المجتمع",subtitle:"فرص للتواصل والعطاء والمشاركة",emptyTitle:"كن شرارة التواصل",emptySubtitle:"لا توجد فعاليات مجدولة بعد. هذه فرصتك لجمع الناس معًا. أنشئ فعالية وعزز روابط مجتمعنا."},xI={title:"إنشاء فعالية جديدة",subtitle:"اجمع المجتمع حول قضية أو نشاط.",form:{title:"عنوان الفعالية",titlePlaceholder:"مثال: حملة تنظيف الشاطئ",category:"نوع الفعالية",region:"المنطقة",regionPlaceholder:"مثال: بيروت",description:"وصف الفعالية",descriptionPlaceholder:"اشرح تفاصيل الفعالية، الزمان، المكان...",submit:"نشر الفعالية"},discardTitle:"تجاهل الفعالية؟",discardConfirm:"نعم، تجاهل",discardCancel:"إلغاء",discardBody:"هل أنت متأكد أنك تريد تجاهل هذه الفعالية؟ لن يتم حفظ التغييرات التي قمت بها."},NI={Volunteer:"فرصة تطوع",Event:"فعالية"},kI={title:"لوحة تحكم المدير",subtitle:"نظرة عامة على نشاط المنصة",loading:"جاري تحميل الإحصائيات...",totalUsers:"إجمالي المستخدمين",totalRequests:"إجمالي الطلبات",totalEvents:"إجمالي الفعاليات",userManagement:"إدارة المستخدمين",verificationRequests:"طلبات التوثيق",approve:"موافقة",reject:"رفض",noPendingRequests:"لا توجد طلبات توثيق معلقة."},DI={title:"Sample Content",searchPlaceholder:"Search sample items...",noItems:"No items",addSuccess:"Item added",addError:"Failed to add item",deleteSuccess:"Item deleted",deleteError:"Failed to delete item",confirmDelete:"Delete item? This action cannot be undone.",showing:"عرض"},VI={quickActions:"الإجراءات السريعة",recent:"الأحدث",noQuickActions:"لا توجد إجراءات سريعة متاحة"},OI={open:"افتح"},LI={title:"قائمة المتصدرين للأمل",subtitle:"تكريم حاملي الأمل الأكثر نشاطاً",rank:"الترتيب",bearer:"الحامل",points:"النقاط",yourPosition:"ترتيبك"},MI={title:"تفاصيل الطلب",notFound:"لم يتم العثور على الطلب.",backToWall:"العودة إلى جدار الصدى",requester:"صاحب الطلب",helper:"يتم المساعدة من قبل",postedOn:"نشر في",encouragementTitle:"كلمات التشجيع",noEncouragement:"كن أول من يرسل كلمة تشجيع.",detailsTitle:"التفاصيل"},FI={subtitle:"مركزك الرئيسي للعمل المجتمعي والدعم.",metrics:{openRequests:"طلبات مفتوحة",silentRequests:"همسات صامتة",eventsOrganized:"فعاليات منظمة"},silentWhispers:{title:"همسات صامتة",subtitle:"طلبات سرية تحتاج إلى اهتمامك.",empty:"لا توجد طلبات صامتة في الوقت الحالي."},echoes:{title:"نظرة على جدار الصدى"},events:{title:"فعالياتك المجتمعية"},viewAll:"عرض الكل",createEvent:"إنشاء فعالية جديدة"},UI={title:"مركز الموارد",subtitle:"ابحث عن دعم وخدمات مستمرة من شركائنا في المجتمع.",emptyTitle:"المركز ينمو",emptySubtitle:"ستقوم المنظمات الموثوقة بنشر مواردها المستمرة هنا قريباً."},jI={title:"نشر مورد جديد",subtitle:"شارك بالخدمات المستمرة التي تقدمها منظمتك.",form:{title:"عنوان المورد",titlePlaceholder:"مثال: مطبخ مجتمعي أسبوعي",category:"الفئة",region:"المنطقة",regionPlaceholder:"مثال: بيروت",description:"الوصف",descriptionPlaceholder:"اشرح ما هو المورد، لمن هو موجه، وأي متطلبات.",schedule:"الجدول الزمني / الساعات",schedulePlaceholder:"مثال: كل ثلاثاء، 10 صباحاً - 1 ظهراً",contact:"معلومات الاتصال (اختياري)",contactPlaceholder:"مثال: رقم هاتف أو بريد إلكتروني",submit:"نشر المورد"}},BI={Food:"طعام",Health:"صحة",Legal:"مساعدة قانونية",Education:"تعليم",Shelter:"مأوى"},qI={title:"الثناءات المستلمة",leaveTitle:"اترك ثناء",leaveSubtitle:"كيف كانت تجربتك مع {{name}}؟",leaveButton:"اترك ثناء",submit:"إرسال الثناء",types:{Kind:"لطيف وعطوف",Punctual:"دقيق وموثوق",Respectful:"محترم ومراعي للخصوصية"},praisedFor:"أُثني عليه لكونه {{type}} {{count}} مرات"},$I="منظمة موثوقة",zI={Pending:"قيد المراجعة",Approved:"موثق",Rejected:"مرفوض"},HI={verificationPending:"حسابك قيد المراجعة للتوثيق. سيتم إعلامك عند اكتمال المراجعة.",verificationRejected:"تم رفض طلب توثيق حسابك. يرجى الاتصال بالدعم إذا كنت تعتقد أن هذا خطأ."},GI={appName:lI,appSlogan:uI,modal:hI,nav:dI,login:fI,auth:mI,onboarding:pI,sanctuary:gI,echoes:yI,createRequest:_I,constellation:vI,tapestry:wI,nomination:EI,notifications:II,roles:bI,requestTypes:TI,hopePointCategories:SI,ritual:AI,requestStatus:RI,scanner:PI,events:CI,createEvent:xI,communityEventTypes:NI,admin:kI,sampleContent:DI,dashboard:VI,common:OI,leaderboard:LI,requestDetail:MI,orgDashboard:FI,resources:UI,createResource:jI,resourceCategories:BI,commendations:qI,verifiedOrg:$I,verificationStatus:zI,profile:HI},KI="Mitché",WI="Where Hope Echoes",QI={close:"Close modal"},YI={home:"Home",echoes:"Echoes",resources:"Resources",events:"Events",leaderboard:"Leaderboard",constellation:"Profile",tapestry:"Hope Tapestry",admin:"Admin"},JI={welcome:"Welcome to Mitché",startJourney:"Start Your Journey",safeHavenTitle:"Your Safe Haven",safeHavenDesc:"Mitché is a safe haven for giving and receiving help while maintaining anonymity. Here, requests for help are 'Echoes', and offers of support are 'Offerings'. Your identity is protected, allowing dignity and compassion to flourish.",agreement:"By entering, you agree to the principles of confidentiality and mutual respect that our platform is built upon."},XI={modalTitle:"Enter the Sanctuary",login:"Log In",signup:"Sign Up",username:"Username",password:"Password",loginLoading:"Logging in...",signupLoading:"Creating Account...",googleSignIn:"Continue with Google",googleSignInLoading:"Signing in with Google...",orDivider:"or",errorInvalid:"Incorrect username or password.",errorExists:"Username already exists.",errorPassword:"Please enter a password.",errorUsernameRequired:"Please enter a username.",errorSymbolicName:"Please choose a symbolic name.",errorGoogleSignIn:"Failed to sign in with Google. Please try again.",identityChoiceInfo:"You will choose your symbolic identity after creating your account.",role:"Role",uploadDocs:"Upload verification documents (if applicable)",documentsSelected:"documents selected",pendingApproval:"Your account has been submitted for review. An administrator will review your documents and approve your account shortly.",errorUsernameNotSelected:"Please select a username.",generatingUsernames:"Generating unique names...",chooseUsername:"Choose your username",refreshUsernames:"Refresh names"},ZI={step1:{title:"Welcome to Mitché",subtitle:"A sanctuary where hope echoes. Let's walk through the core principles that shape our world."},step2:{title:"Echoes: Calls of Hope",description:"When you need help, you cast an 'Echo'. It is your anonymous request that reaches the community, like a ripple in a quiet pond."},step3:{title:"Offerings: Seeds of Compassion",description:"You can respond to Echoes with 'Offerings' — either material help or words of encouragement. Each offering is a light in the darkness."},step4:{title:"Your Identity: A Hope Bearer",description:"Here, you are known by your chosen name and symbol, ensuring dignity and safety for all. This is the shield that protects your true identity."},step5:{title:"Forge Your Symbolic Identity",subtitle:"Choose the name and symbol that will represent your light in this community.",chooseName:"Choose Your Name",chooseIcon:"Choose Your Symbol"},step6:{title:"You Are Now Part of the Tapestry",subtitle:"This is your identity as a Hope Bearer. Remember, behind every symbol lies a human heart."},buttons:{begin:"Begin",next:"Next",back:"Back",createIdentity:"Create Your Identity",complete:"Enter the Sanctuary"},selectName:"-- Select a Name --",symbolicNames:{hopeBearer:"Hope Bearer",voiceOfLight:"Voice of Light",helpingHand:"Helping Hand",morningStar:"Morning Star",braveHeart:"Brave Heart"}},eb={welcome:"Welcome, {{name}}",quote:'"May your light be an echo in this world"',tiles:{echoes:"Wall of Echoes",echoesSub:"Request or respond to calls",events:"Community Events",eventsSub:"Join initiatives and gatherings",tapestry:"Hope Tapestry",tapestrySub:"Read stories of resilience"}},tb={title:"Wall of Echoes",subtitle:"Here, voices rise and hands meet",filter:"Filter",allCategories:"All Categories",loading:"Loading echoes...",emptyTitle:"The Wall is a Sanctuary of Peace",emptySubtitle:"Its silence is a sign that for now, needs are met. New echoes will appear as they are cast by the community.",time:{just_now:"just now",seconds_ago_one:"{{count}} second ago",seconds_ago_other:"{{count}} seconds ago",minutes_ago_one:"{{count}} minute ago",minutes_ago_other:"{{count}} minutes ago",hours_ago_one:"{{count}} hour ago",hours_ago_other:"{{count}} hours ago",days_ago_one:"{{count}} day ago",days_ago_other:"{{count}} days ago",months_ago_one:"{{count}} month ago",months_ago_other:"{{count}} months ago",years_ago_one:"{{count}} year ago",years_ago_other:"{{count}} years ago"},card:{provideHelp:"Provide Help",sendEncouragement:"Send Encouragement",confirmReceipt:"Confirm Receipt",claimHopePoints:"Claim Hope Points",waitingReceipt:"Awaiting Receipt"},helpModal:{titleHelp:"Provide Help",bodyHelp:"You are about to start helping with this request. The requester will be notified. Please contact them at the number below to proceed.",phoneNumber:"📞 +961 71 123 456",dummyPhone:"(This is a dummy number for demonstration purposes)",confirmHelp:"I Confirm, I Will Help"},encourageModal:{title:"Send a Message of Encouragement",placeholder:"Write your message here... Your words might be the light someone needs.",send:"Send"}},nb={title:"Launch Your Echo",subtitle:"Every request is a seed of hope. Describe what you need with sincerity.",form:{title:"Request Title",titlePlaceholder:"e.g., In need of emotional support",category:"Request Category",region:"Region",regionPlaceholder:"e.g., Beirut",description:"Request Description",descriptionPlaceholder:"Explain your request in detail...",mode:"Request Mode",modeLoud:"Loud (Public)",modeLoudDesc:"Appears on the Wall of Echoes for everyone",modeSilent:"Silent (Private)",modeSilentDesc:"Sent only to relevant organizations and entities",submit:"Submit Request"},discardTitle:"Discard Request?",discardConfirm:"Yes, Discard",discardCancel:"Cancel",discardBody:"Are you sure you want to discard this request? Your changes will not be saved."},rb={starOfHope:"A Star in the Constellation of Hope",totalHopePoints:"Total Hope Points",quote:'"Every point is a testament to your light"',breakdownTitle:"Hope Points Breakdown",installApp:"Install App",appInstalled:"App is installed",awardNominations:"Award Nominations",privacySettings:"Privacy Settings",logout:"Log Out",scanToGiveHope:"Scan to Give Hope",accessCamera:"Access Camera",cameraAccessGranted:"Camera access granted!",cameraAccessDenied:"Camera access denied. Please check your browser permissions.",cameraNotSupported:"Camera access is not supported on this browser.",yourEvents:"Your Events",noEvents:"You have not created any events yet.",accolades:{title:"Accolades & Badges"},achievements:{firstEcho:{title:"First Echo",description:"Made your first request for help."},firstOffering:{title:"First Offering",description:"Made your first offering of help or encouragement."},compassionateVoice:{title:"Compassionate Voice",description:"Sent 3 messages of encouragement."},communityPillar:{title:"Community Pillar",description:"Fulfilled 2 requests for help."},beaconOfHope:{title:"Beacon of Hope",description:"Your story received 10 echoes."},"Bearer of Inner Light":{title:"Bearer of Inner Light",description:"For grounding others in faith, values, or meaning during adversity."},"Weaver of Wisdom":{title:"Weaver of Wisdom",description:"For transforming personal suffering into stories that guide and uplift."},"Keeper of Sacred Symbols":{title:"Keeper of Sacred Symbols",description:"For creating rituals, gestures, or art that turn pain into communal meaning."},"Voice of Compassion":{title:"Voice of Compassion",description:"For nurturing healing through dialogue—with others, with God, or with self."},"Legacy of Light":{title:"Legacy of Light",description:"For extending hope beyond the self—into families, communities, and time."},"Silent Hero":{title:"Silent Hero",description:"For quiet acts of dignity that ripple without recognition."},"Community Builder":{title:"Community Builder",description:"For constructing spaces/activities—physical or emotional—where others can heal."},"Lantern of Continuity":{title:"Lantern of Continuity",description:"For sustaining hope across generations, especially in posthumous or long-term impact, or laws submitted, reform achieved."},"Flower of Testimony":{title:"Flower of Testimony",description:"For offering one’s story as a seed of transformation for others."}},activity:{title:"Recent Activity",noActivity:"No recent activity to show.",createdRequest:'You created a request: "{{title}}"',helpedRequest:'You helped with a request: "{{title}}"',sentEncouragement:'You sent encouragement for: "{{title}}"',aRequest:"a request"},editProfile:{title:"Edit Profile",location:"Location",locationPlaceholder:"e.g., Beirut, Lebanon",bio:"Bio",bioPlaceholder:"Tell us a little about yourself...",save:"Save Changes"},showQrCode:"QR Code",qrCodeTitle:"Your QR Code",qrCodeDesc:"Share this code to connect with {{name}}.",qrCodeMissing:"Save your profile to generate a QR code.",notifications:{enable:"Enable Push Notifications",disable:"Disable Push Notifications",loading:"Loading...",testTitle:"Send Test Notification",unsupported:"Push notifications are not supported on this browser."}},sb={title:"Hope Tapestry",subtitle:"A living archive of resilience and transformation, woven from threads of giving",threads:"Threads",echoes:"Echoes",souls:"Souls",filterAll:"All",filterBuilders:"Community Builders",filterHeroes:"Silent Heroes",filterVoices:"Voices of Compassion",thread:"Thread",livesTouched:"Lives Touched",echoStory:"Echo ({{count}})",emptyTitle:"No threads in this section yet.",emptySubtitle:"But the tapestry grows every day, thanks to people like you.",story:{revealed:"A new story of hope, revealed to the world through courage and compassion.",anonymous:"The glow of a silent star, felt by many, known by few. A testament to quiet strength."}},ib={noNomination:"No active nomination.",title:"Your Light Has Reached the Temple",subtitle:"You have been nominated for the Hope Bearer Award. Will you step forward, or remain a silent star?",revealIdentity:"Reveal Identity",stayAnonymous:"Stay Anonymous",confirmRevealTitle:"Confirm Identity Reveal",confirmRevealBody:"By choosing to reveal your identity, your real name and photo will be publicly displayed on your story's thread in the 'Hope Tapestry'. This powerful act connects a face to the hope you've inspired, allowing the community to see and celebrate the person behind the symbol. Are you ready to step into the light?",confirmRevealButton:"Yes, I Confirm Reveal",back:"Go Back",revealFormTitle:"Reveal Your Identity",realName:"Real Name",realNamePlaceholder:"Your name as it will appear in celebration",photo:"Profile Picture (Optional)",confirmAndContinue:"Confirm and Continue",confirmAnonymousTitle:"Confirm Remaining Anonymous",confirmAnonymousBody:"By choosing to remain anonymous, your symbolic name and icon will continue to represent you in the 'Hope Tapestry'. Your story will inspire others while your identity remains a cherished secret. Is this your chosen path?",confirmAnonymousButton:"Yes, I Confirm Anonymity",finishedTitle:"Whether your name is known or not, your legacy is eternal.",finishedSubtitle:"Your choice will be honored with all due reverence.",viewTapestry:"View the Hope Tapestry"},ob={title:"Notifications",empty:"No new notifications.",nomination:"Your light has reached the temple. You've been nominated for the Hope Bearer award. Will you step forward, or remain a silent star?",encouragement:'New encouragement on your request "{{title}}..."',helpOffer:'User "{{name}}" has started helping with your request "{{title}}...".',receiptConfirm:'The requester of "{{title}}..." confirmed receipt of help. You can now claim your hope points.',fulfillment:'Your request "{{title}}..." has been fulfilled! Thanks to the user who helped you.'},ab={Citizen:"Citizen",NGO:"NGO",PublicWorker:"Public Worker",Admin:"Admin"},cb={Food:"Food",Shelter:"Shelter",Medical:"Medical Support",Emotional:"Emotional Support",Legal:"Legal Aid",Employment:"Job Opportunity"},lb={SilentHero:"Silent Hero",VoiceOfCompassion:"Voice of Compassion",CommunityBuilder:"Community Builder",CommunityGift:"Community Gift",Ritual:"Ritual"},ub={title:"Status",Open:"Open",Pending:"Pending",Fulfilled:"Fulfilled",Closed:"Closed"},hb={status:{scanning:"Looking for a QR code...",processing:"Processing...",noCamera:"Could not access camera. Please check permissions."},success:{giftSent:"You gave 1 Hope Point to {{name}}. You also earned 1 point!"},error:{notLoggedIn:"You must be logged in to do this.",selfGift:"You cannot give a point to yourself.",alreadyGiven:"You have already given your daily point. Try again tomorrow.",userNotFound:"This user could not be found.",invalidQR:"This is not a valid Mitché user QR code."}},db={success:"Daily ritual completed — Hope point awarded!",error:"Unable to complete the ritual."},fb={title:"Community Events",subtitle:"Opportunities to connect, give, and participate",emptyTitle:"Be the Spark of Connection",emptySubtitle:"No events are scheduled yet. This is your chance to bring people together. Create an event and foster our community bonds."},mb={title:"Create a New Event",subtitle:"Bring the community together around a cause or activity.",form:{title:"Event Title",titlePlaceholder:"e.g., Beach Cleanup Drive",category:"Event Type",region:"Region",regionPlaceholder:"e.g., Beirut",description:"Event Description",descriptionPlaceholder:"Explain the details of the event, time, location...",submit:"Publish Event"},discardTitle:"Discard Event?",discardConfirm:"Yes, Discard",discardCancel:"Cancel",discardBody:"Are you sure you want to discard this event? Your changes will not be saved."},pb={Volunteer:"Volunteering Opportunity",Event:"Event"},gb={title:"Admin Dashboard",subtitle:"An overview of platform activity",loading:"Loading stats...",totalUsers:"Total Users",totalRequests:"Total Requests",totalEvents:"Total Events",userManagement:"All Users",verificationRequests:"Verification Requests",approve:"Approve",reject:"Reject",noPendingRequests:"No pending verification requests."},yb={title:"Sample Content",searchPlaceholder:"Search sample items...",noItems:"No items",addSuccess:"Item added",addError:"Failed to add item",deleteSuccess:"Item deleted",deleteError:"Failed to delete item",confirmDelete:"Delete item? This cannot be undone.",showing:"Showing"},_b={quickActions:"Quick Actions",recent:"Recent",noQuickActions:"No quick actions available"},vb={open:"Open"},wb={title:"Hope Leaderboard",subtitle:"Celebrating the most active bearers of hope",rank:"Rank",bearer:"Bearer",points:"Points",yourPosition:"Your Position"},Eb={title:"Request Details",notFound:"Request not found.",backToWall:"Back to Wall of Echoes",requester:"Requester",helper:"Being helped by",postedOn:"Posted",encouragementTitle:"Words of Encouragement",noEncouragement:"Be the first to send a word of encouragement.",detailsTitle:"Details"},Ib={subtitle:"Your central hub for community action and support.",metrics:{openRequests:"Open Requests",silentRequests:"Silent Whispers",eventsOrganized:"Events Organized"},silentWhispers:{title:"Silent Whispers",subtitle:"Confidential requests needing your attention.",empty:"No silent requests at the moment."},echoes:{title:"Wall of Echoes Overview"},events:{title:"Your Community Events"},viewAll:"View All",createEvent:"Create New Event"},bb={title:"Resource Hub",subtitle:"Find continuous support and services from our community partners.",emptyTitle:"The Hub is Growing",emptySubtitle:"Verified organizations will post their ongoing resources here soon."},Tb={title:"Post a New Resource",subtitle:"Share ongoing services your organization provides.",form:{title:"Resource Title",titlePlaceholder:"e.g., Weekly Community Kitchen",category:"Category",region:"Region",regionPlaceholder:"e.g., Beirut",description:"Description",descriptionPlaceholder:"Explain what the resource is, who it's for, and any requirements.",schedule:"Schedule / Hours",schedulePlaceholder:"e.g., Tuesdays, 10 AM - 1 PM",contact:"Contact Info (Optional)",contactPlaceholder:"e.g., Phone number or email",submit:"Publish Resource"}},Sb={Food:"Food",Health:"Health",Legal:"Legal Aid",Education:"Education",Shelter:"Shelter"},Ab={title:"Commendations Received",leaveTitle:"Leave a Commendation",leaveSubtitle:"How was your experience with {{name}}?",leaveButton:"Leave Commendation",submit:"Send Commendation",types:{Kind:"Kind & Compassionate",Punctual:"Punctual & Reliable",Respectful:"Respectful & Discreet"},praisedFor:"Praised for being {{type}} {{count}} times"},Rb="Verified Organization",Pb={Pending:"Pending",Approved:"Approved",Rejected:"Rejected"},Cb={verificationPending:"Your account is pending verification. You will be notified when the review is complete.",verificationRejected:"Your account verification was rejected. Please contact support if you believe this is a mistake."},xb="Achievements",Nb="Rarity",kb="Category",Db="Loading achievements...",Vb="Error loading achievements.",Ob="No achievements yet.",Lb="Common",Mb="Rare",Fb="Epic",Ub="Legendary",jb="Pillar",Bb="Symbolic",qb="Helper",$b="Community",zb="Dedication",Hb="Special",Gb={appName:KI,appSlogan:WI,modal:QI,nav:YI,login:JI,auth:XI,onboarding:ZI,sanctuary:eb,echoes:tb,createRequest:nb,constellation:rb,tapestry:sb,nomination:ib,notifications:ob,roles:ab,requestTypes:cb,hopePointCategories:lb,requestStatus:ub,scanner:hb,ritual:db,events:fb,createEvent:mb,communityEventTypes:pb,admin:gb,sampleContent:yb,dashboard:_b,common:vb,leaderboard:wb,requestDetail:Eb,orgDashboard:Ib,resources:bb,createResource:Tb,resourceCategories:Sb,commendations:Ab,verifiedOrg:Rb,verificationStatus:Pb,profile:Cb,achievements:xb,rarity:Nb,category:kb,loadingAchievements:Db,errorLoadingAchievements:Vb,noAchievementsYet:Ob,"Bearer of Inner Light":"Bearer of Inner Light","For grounding others in faith, values, or meaning during adversity.":"For grounding others in faith, values, or meaning during adversity.","Weaver of Wisdom":"Weaver of Wisdom","For transforming personal suffering into stories that guide and uplift.":"For transforming personal suffering into stories that guide and uplift.","Keeper of Sacred Symbols":"Keeper of Sacred Symbols","For creating rituals, gestures, or art that turn pain into communal meaning.":"For creating rituals, gestures, or art that turn pain into communal meaning.","Voice of Compassion":"Voice of Compassion","For nurturing healing through dialogue—with others, with God, or with self.":"For nurturing healing through dialogue—with others, with God, or with self.","Legacy of Light":"Legacy of Light","For extending hope beyond the self—into families, communities, and time.":"For extending hope beyond the self—into families, communities, and time.","Silent Hero":"Silent Hero","For quiet acts of dignity that ripple without recognition.":"For quiet acts of dignity that ripple without recognition.","Community Builder":"Community Builder","For constructing spaces/activities—physical or emotional—where others can heal.":"For constructing spaces/activities—physical or emotional—where others can heal.","Lantern of Continuity":"Lantern of Continuity","For sustaining hope across generations, especially in posthumous or long-term impact, or laws submitted, reform achieved.":"For sustaining hope across generations, especially in posthumous or long-term impact, or laws submitted, reform achieved.","Flower of Testimony":"Flower of Testimony","For offering one’s story as a seed of transformation for others.":"For offering one’s story as a seed of transformation for others.",Common:Lb,Rare:Mb,Epic:Fb,Legendary:Ub,Pillar:jb,Symbolic:Bb,Helper:qb,Community:$b,Dedication:zb,Special:Hb},Kb="Mitché",Wb="Où l'espoir résonne",Qb={close:"Fermer la fenêtre modale"},Yb={home:"Accueil",echoes:"Échos",resources:"Ressources",events:"Événements",leaderboard:"Classement",constellation:"Profil",tapestry:"Tapisserie de l'Espoir",admin:"Admin"},Jb={welcome:"Bienvenue à Mitché",startJourney:"Commencez Votre Voyage",safeHavenTitle:"Votre Havre de Paix",safeHavenDesc:"Mitché est un havre de paix pour donner et recevoir de l'aide tout en préservant l'anonymat. Ici, les demandes d'aide sont des 'Échos', et les offres de soutien sont des 'Offrandes'. Votre identité est protégée, permettant à la dignité et à la compassion de s'épanouir.",agreement:"En entrant, vous acceptez les principes de confidentialité et de respect mutuel sur lesquels notre plateforme est bâtie."},Xb={modalTitle:"Entrer dans le Sanctuaire",login:"Connexion",signup:"Inscription",username:"Nom d'utilisateur",password:"Mot de passe",loginLoading:"Connexion en cours...",signupLoading:"Création du compte...",errorInvalid:"Nom d'utilisateur ou mot de passe incorrect.",errorExists:"Ce nom d'utilisateur existe déjà.",errorPassword:"Veuillez entrer un mot de passe.",errorUsernameRequired:"Veuillez entrer un nom d'utilisateur.",errorSymbolicName:"Veuillez choisir un nom symbolique.",identityChoiceInfo:"Vous choisirez votre identité symbolique après avoir créé votre compte.",role:"Rôle",uploadDocs:"Téléversez les documents de vérification (si nécessaire)",documentsSelected:"documents sélectionnés",pendingApproval:"Votre compte a été soumis pour examen. Un administrateur examinera vos documents et approuvera votre compte sous peu.",errorUsernameNotSelected:"Veuillez sélectionner un nom d'utilisateur.",generatingUsernames:"Génération de noms uniques...",chooseUsername:"Choisissez votre nom d'utilisateur",refreshUsernames:"Rafraîchir les noms",googleSignIn:"Se connecter avec Google",googleSignInLoading:"Connexion avec Google...",orDivider:"ou",errorGoogleSignIn:"Échec de la connexion avec Google. Veuillez réessayer."},Zb={step1:{title:"Bienvenue à Mitché",subtitle:"Un sanctuaire où l'espoir résonne. Parcourons les principes fondamentaux qui façonnent notre monde."},step2:{title:"Échos : Appels d'Espoir",description:"Lorsque vous avez besoin d'aide, vous lancez un 'Écho'. C'est votre demande anonyme qui atteint la communauté, comme une onde dans un étang tranquille."},step3:{title:"Offrandes : Graines de Compassion",description:"Vous pouvez répondre aux Échos avec des 'Offrandes' - une aide matérielle ou des mots d'encouragement. Chaque offrande est une lumière dans l'obscurité."},step4:{title:"Votre Identité : Un Porteur d'Espoir",description:"Ici, vous êtes connu par le nom et le symbole que vous avez choisis, garantissant la dignité et la sécurité pour tous. C'est le bouclier qui protège votre véritable identité."},step5:{title:"Créez Votre Identité Symbolique",subtitle:"Choisissez le nom et le symbole qui représenteront votre lumière dans cette communauté.",chooseName:"Choisissez Votre Nom",chooseIcon:"Choisissez Votre Symbole"},step6:{title:"Vous Faites Maintenant Partie de la Tapisserie",subtitle:"Ceci est votre identité en tant que Porteur d'Espoir. Souvenez-vous, derrière chaque symbole se cache un cœur humain."},buttons:{begin:"Commencer",next:"Suivant",back:"Retour",createIdentity:"Créez Votre Identité",complete:"Entrer dans le Sanctuaire"},selectName:"-- Choisissez un Nom --",symbolicNames:{hopeBearer:"Porteur d'Espoir",voiceOfLight:"Voix de Lumière",helpingHand:"Main Tendue",morningStar:"Étoile du Matin",braveHeart:"Cœur Brave"}},eT={welcome:"Bienvenue, {{name}}",quote:'"Que ta lumière soit un écho dans ce monde"',tiles:{echoes:"Mur des Échos",echoesSub:"Demandez ou répondez aux appels",events:"Événements Communautaires",eventsSub:"Participez à des initiatives",tapestry:"Tapisserie de l'Espoir",tapestrySub:"Lisez des histoires de résilience"}},tT={title:"Mur des Échos",subtitle:"Ici, les voix s'élèvent et les mains se rencontrent",filter:"Filtrer",allCategories:"Toutes les catégories",loading:"Chargement des échos...",emptyTitle:"Le Mur est un Sanctuaire de Paix",emptySubtitle:"Son silence est un signe que, pour l'instant, les besoins sont comblés. De nouveaux échos apparaîtront dès qu'ils seront lancés par la communauté.",time:{just_now:"à l'instant",seconds_ago_one:"il y a {{count}} seconde",seconds_ago_other:"il y a {{count}} secondes",minutes_ago_one:"il y a {{count}} minute",minutes_ago_other:"il y a {{count}} minutes",hours_ago_one:"il y a {{count}} heure",hours_ago_other:"il y a {{count}} heures",days_ago_one:"il y a {{count}} jour",days_ago_other:"il y a {{count}} jours",months_ago_one:"il y a {{count}} mois",months_ago_other:"il y a {{count}} mois",years_ago_one:"il y a {{count}} an",years_ago_other:"il y a {{count}} ans"},card:{provideHelp:"Apporter de l'aide",sendEncouragement:"Envoyer un encouragement",confirmReceipt:"Confirmer la réception",claimHopePoints:"Réclamer des points d'espoir",waitingReceipt:"En attente de réception"},helpModal:{titleHelp:"Apporter de l'Aide",bodyHelp:"Vous êtes sur le point de commencer à aider pour cette demande. Le demandeur sera notifié. Veuillez le contacter au numéro ci-dessous pour continuer.",phoneNumber:"📞 +961 71 123 456",dummyPhone:"(Ceci est un numéro fictif à des fins de démonstration)",confirmHelp:"Je confirme, je vais aider"},encourageModal:{title:"Envoyer un Message d'Encouragement",placeholder:"Écrivez votre message ici... Vos mots pourraient être la lumière dont quelqu'un a besoin.",send:"Envoyer"}},nT={title:"Lancez Votre Écho",subtitle:"Chaque demande est une graine d'espoir. Décrivez ce dont vous avez besoin avec sincérité.",form:{title:"Titre de la demande",titlePlaceholder:"Ex: Besoin de soutien émotionnel",category:"Catégorie de la demande",region:"Région",regionPlaceholder:"Ex: Beyrouth",description:"Description de la demande",descriptionPlaceholder:"Expliquez votre demande en détail...",mode:"Mode de la demande",modeLoud:"Fort (Public)",modeLoudDesc:"Apparaît sur le Mur des Échos pour tous",modeSilent:"Silencieux (Privé)",modeSilentDesc:"Envoyé uniquement aux organisations et entités concernées",submit:"Soumettre la demande"},discardTitle:"Annuler la demande ?",discardConfirm:"Oui, annuler",discardCancel:"Retour",discardBody:"Êtes-vous sûr de vouloir annuler cette demande ? Vos modifications ne seront pas enregistrées."},rT={starOfHope:"Une Étoile dans la Constellation de l'Espoir",totalHopePoints:"Total des Points d'Espoir",quote:'"Chaque point est un témoignage de votre lumière"',breakdownTitle:"Détail des Points d'Espoir",installApp:"Installer l'application",appInstalled:"Application installée",awardNominations:"Nominations aux prix",privacySettings:"Paramètres de confidentialité",logout:"Déconnexion",scanToGiveHope:"Scannez pour donner de l'espoir",accessCamera:"Accéder à la caméra",cameraAccessGranted:"Accès à la caméra autorisé !",cameraAccessDenied:"Accès à la caméra refusé. Veuillez vérifier les autorisations de votre navigateur.",cameraNotSupported:"L'accès à la caméra n'est pas pris en charge par votre navigateur.",yourEvents:"Vos Événements",noEvents:"Vous n'avez pas encore créé d'événements.",accolades:{title:"Distinctions & Badges"},achievements:{firstEcho:{title:"Premier Écho",description:"Vous avez fait votre première demande d'aide."},firstOffering:{title:"Première Offrande",description:"Vous avez offert de l'aide ou un encouragement pour la première fois."},compassionateVoice:{title:"Voix Compatissante",description:"Vous avez envoyé 3 messages d'encouragement."},communityPillar:{title:"Pilier de la Communauté",description:"Vous avez répondu à 2 demandes d'aide."},beaconOfHope:{title:"Phare d'Espoir",description:"Votre histoire a reçu 10 échos."}},activity:{title:"Activité Récente",noActivity:"Aucune activité récente à afficher.",createdRequest:'Vous avez créé une demande : "{{title}}"',helpedRequest:'Vous avez aidé avec une demande : "{{title}}"',sentEncouragement:'Vous avez envoyé un encouragement pour : "{{title}}"',aRequest:"une demande"},editProfile:{title:"Modifier le Profil",location:"Lieu",locationPlaceholder:"Ex: Beyrouth, Liban",bio:"Bio",bioPlaceholder:"Dites-nous en un peu plus sur vous...",save:"Enregistrer les modifications"},showQrCode:"QR Code",qrCodeTitle:"Votre QR Code",qrCodeDesc:"Partagez ce code pour vous connecter avec {{name}}.",qrCodeMissing:"Enregistrez votre profil pour générer un code QR.",notifications:{enable:"Activer les notifications push",disable:"Désactiver les notifications push",loading:"Chargement...",testTitle:"Envoyer une notification test",unsupported:"Les notifications push ne sont pas prises en charge sur ce navigateur."}},sT={title:"Tapisserie de l'Espoir",subtitle:"Une archive vivante de résilience et de transformation, tissée de fils de don",threads:"Fils",echoes:"Échos",souls:"Âmes",filterAll:"Tous",filterBuilders:"Bâtisseurs de Communauté",filterHeroes:"Héros Silencieux",filterVoices:"Voix de la Compassion",thread:"fil",livesTouched:"Vies Touchées",echoStory:"Écho ({{count}})",emptyTitle:"Aucun fil dans cette section pour le moment.",emptySubtitle:"Mais la tapisserie grandit chaque jour, grâce à des gens comme vous.",story:{revealed:"Une nouvelle histoire d'espoir, révélée au monde par le courage et la compassion.",anonymous:"L'éclat d'une étoile silencieuse, ressenti par beaucoup, connu de peu. Un témoignage de force tranquille."}},iT={noNomination:"Aucune nomination active.",title:"Votre Lumière a Atteint le Temple",subtitle:"Vous avez été nominé pour le Prix du Porteur d'Espoir. Allez-vous vous avancer, ou rester une étoile silencieuse ?",revealIdentity:"Révéler l'Identité",stayAnonymous:"Rester Anonyme",confirmRevealTitle:"Confirmer la Révélation d'Identité",confirmRevealBody:"En choisissant de révéler votre identité, votre vrai nom et votre photo seront affichés publiquement sur le fil de votre histoire dans la 'Tapisserie de l'Espoir'. Cet acte puissant associe un visage à l'espoir que vous avez inspiré, permettant à la communauté de voir et de célébrer la personne derrière le symbole. Êtes-vous prêt à entrer dans la lumière ?",confirmRevealButton:"Oui, je confirme la révélation",back:"Retour",revealFormTitle:"Révéler Votre Identité",realName:"Vrai Nom",realNamePlaceholder:"Votre nom tel qu'il apparaîtra lors de la célébration",photo:"Photo de profil (Optionnel)",confirmAndContinue:"Confirmer et Continuer",confirmAnonymousTitle:"Confirmer le Maintien de l'Anonymat",confirmAnonymousBody:"En choisissant de rester anonyme, votre nom symbolique et votre icône continueront de vous représenter dans la 'Tapisserie de l'Espoir'. Votre histoire inspirera les autres tandis que votre identité restera un secret précieux. Est-ce le chemin que vous avez choisi ?",confirmAnonymousButton:"Oui, je confirme l'anonymat",finishedTitle:"Que votre nom soit connu ou non, votre héritage est éternel.",finishedSubtitle:"Votre choix sera honoré avec toute la révérence due.",viewTapestry:"Voir la Tapisserie de l'Espoir"},oT={title:"Notifications",empty:"Aucune nouvelle notification.",nomination:"Votre lumière a atteint le temple. Vous avez été nominé pour le prix du Porteur d'Espoir. Allez-vous vous avancer, ou rester une étoile silencieuse ?",encouragement:'Nouvel encouragement sur votre demande "{{title}}..."',helpOffer:`L'utilisateur "{{name}}" a commencé à aider avec votre demande "{{title}}...".`,receiptConfirm:`Le demandeur de "{{title}}..." a confirmé la réception de l'aide. Vous pouvez maintenant réclamer vos points d'espoir.`,fulfillment:`Votre demande "{{title}}..." a été satisfaite ! Merci à l'utilisateur qui vous a aidé.`},aT={Citizen:"Citoyen",NGO:"ONG",PublicWorker:"Agent Public",Admin:"Admin"},cT={Food:"Nourriture",Shelter:"Abri",Medical:"Soutien Médical",Emotional:"Soutien Émotionnel",Legal:"Aide Juridique",Employment:"Opportunité d'Emploi"},lT={SilentHero:"Héros Silencieux",VoiceOfCompassion:"Voix de la Compassion",CommunityBuilder:"Bâtisseur de Communauté",CommunityGift:"Don de la Communauté",Ritual:"Rituel"},uT={success:"Rituel quotidien complété — Point d'espoir attribué !",error:"Impossible de compléter le rituel."},hT={title:"Statut",Open:"Ouvert",Pending:"En attente",Fulfilled:"Rempli",Closed:"Fermé"},dT={status:{scanning:"Recherche d'un code QR...",processing:"Traitement...",noCamera:"Impossible d'accéder à la caméra. Veuillez vérifier les autorisations."},success:{giftSent:"Vous avez donné 1 Point d'Espoir à {{name}}. Vous avez aussi gagné 1 point !"},error:{notLoggedIn:"Vous devez être connecté pour faire cela.",selfGift:"Vous ne pouvez pas vous donner de point à vous-même.",alreadyGiven:"Vous avez déjà donné votre point quotidien. Réessayez demain.",userNotFound:"Cet utilisateur n'a pas pu être trouvé.",invalidQR:"Ceci n'est pas un code QR d'utilisateur Mitché valide."}},fT={title:"Événements Communautaires",subtitle:"Opportunités de se connecter, donner et participer",emptyTitle:"Soyez l'Étincelle de la Connexion",emptySubtitle:"Aucun événement n'est encore programmé. C'est votre chance de rassembler les gens. Créez un événement et renforcez nos liens communautaires."},mT={title:"Créer un Nouvel Événement",subtitle:"Rassemblez la communauté autour d'une cause ou d'une activité.",form:{title:"Titre de l'événement",titlePlaceholder:"Ex: Nettoyage de la plage",category:"Type d'événement",region:"Région",regionPlaceholder:"Ex: Beyrouth",description:"Description de l'événement",descriptionPlaceholder:"Expliquez les détails de l'événement, l'heure, le lieu...",submit:"Publier l'événement"},discardTitle:"Annuler l'événement ?",discardConfirm:"Oui, annuler",discardCancel:"Retour",discardBody:"Êtes-vous sûr de vouloir annuler cet événement ? Vos modifications ne seront pas enregistrées."},pT={Volunteer:"Opportunité de bénévolat",Event:"Événement"},gT={title:"Tableau de Bord Admin",subtitle:"Un aperçu de l'activité de la plateforme",loading:"Chargement des statistiques...",totalUsers:"Utilisateurs totaux",totalRequests:"Demandes totales",totalEvents:"Événements totaux",userManagement:"Tous les utilisateurs",verificationRequests:"Demandes de vérification",approve:"Approuver",reject:"Rejeter",noPendingRequests:"Aucune demande de vérification en attente."},yT={title:"Classement de l'Espoir",subtitle:"Célébration des porteurs d'espoir les plus actifs",rank:"Rang",bearer:"Porteur",points:"Points",yourPosition:"Votre Position"},_T={title:"Détails de la Demande",notFound:"Demande non trouvée.",backToWall:"Retour au Mur des Échos",requester:"Demandeur",helper:"Aidée par",postedOn:"Posté",encouragementTitle:"Mots d'Encouragement",noEncouragement:"Soyez le premier à envoyer un mot d'encouragement.",detailsTitle:"Détails"},vT={subtitle:"Votre pôle central pour l'action et le soutien communautaire.",metrics:{openRequests:"Demandes Ouvertes",silentRequests:"Murmures Silencieux",eventsOrganized:"Événements Organisés"},silentWhispers:{title:"Murmures Silencieux",subtitle:"Demandes confidentielles nécessitant votre attention.",empty:"Aucune demande silencieuse pour le moment."},echoes:{title:"Aperçu du Mur des Échos"},events:{title:"Vos Événements Communautaires"},viewAll:"Voir Tout",createEvent:"Créer un Nouvel Événement"},wT={title:"Centre de Ressources",subtitle:"Trouvez un soutien et des services continus de nos partenaires communautaires.",emptyTitle:"Le Centre se développe",emptySubtitle:"Les organisations vérifiées publieront bientôt leurs ressources ici."},ET={title:"Publier une Nouvelle Ressource",subtitle:"Partagez les services continus que votre organisation fournit.",form:{title:"Titre de la ressource",titlePlaceholder:"Ex: Cuisine communautaire hebdomadaire",category:"Catégorie",region:"Région",regionPlaceholder:"Ex: Beyrouth",description:"Description",descriptionPlaceholder:"Expliquez la ressource, à qui elle s'adresse et les exigences.",schedule:"Horaire / Heures",schedulePlaceholder:"Ex: Les mardis, 10h - 13h",contact:"Infos de contact (Optionnel)",contactPlaceholder:"Ex: Numéro de téléphone ou e-mail",submit:"Publier la ressource"}},IT={Food:"Nourriture",Health:"Santé",Legal:"Aide juridique",Education:"Éducation",Shelter:"Abri"},bT={title:"Recommandations Reçues",leaveTitle:"Laisser une recommandation",leaveSubtitle:"Comment s'est passée votre expérience avec {{name}}?",leaveButton:"Laisser une recommandation",submit:"Envoyer la recommandation",types:{Kind:"Aimable & Compatissant",Punctual:"Ponctuel & Fiable",Respectful:"Respectueux & Discret"},praisedFor:"Loué pour être {{type}} {{count}} fois"},TT="Organisation Vérifiée",ST={Pending:"En attente",Approved:"Approuvé",Rejected:"Rejeté"},AT={verificationPending:"Votre compte est en attente de vérification. Vous serez averti lorsque l'examen sera terminé.",verificationRejected:"La vérification de votre compte a été rejetée. Veuillez contacter le support si vous pensez qu'il s'agit d'une erreur."},RT={title:"Sample Content",searchPlaceholder:"Search sample items...",noItems:"No items",addSuccess:"Item added",addError:"Failed to add item",deleteSuccess:"Item deleted",deleteError:"Failed to delete item",confirmDelete:"Delete item? This action is irreversible.",showing:"Affichage"},PT={quickActions:"Actions rapides",recent:"Récents",noQuickActions:"Aucune action rapide disponible"},CT={open:"Ouvrir"},xT={appName:Kb,appSlogan:Wb,modal:Qb,nav:Yb,login:Jb,auth:Xb,onboarding:Zb,sanctuary:eT,echoes:tT,createRequest:nT,constellation:rT,tapestry:sT,nomination:iT,notifications:oT,roles:aT,requestTypes:cT,hopePointCategories:lT,ritual:uT,requestStatus:hT,scanner:dT,events:fT,createEvent:mT,communityEventTypes:pT,admin:gT,leaderboard:yT,requestDetail:_T,orgDashboard:vT,resources:wT,createResource:ET,resourceCategories:IT,commendations:bT,verifiedOrg:TT,verificationStatus:ST,profile:AT,sampleContent:RT,dashboard:PT,common:CT},NT={ar:{translation:GI},en:{translation:Gb},fr:{translation:xT}};de.use(sp).use(EE).init({resources:NT,fallbackLng:"ar",debug:!1,interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]},react:{useSuspense:!0}});let _o=null;async function Pt(){return _o||(_o=(await st(()=>Promise.resolve().then(()=>R_),[],import.meta.url)).firebaseService,_o)}const ip=x.createContext(void 0),wd=["Silent","Hopeful","Golden","Brave","Kind","Guiding","Gentle","Mystic","Radiant","Shining"],Ed=["Star","Echo","River","Guardian","Light","Flower","Stone","Heart","Voice","Hand"],Id=({children:r})=>{const[e,t]=x.useState(null),[n,s]=x.useState(!0),[i,o]=x.useState(!1),c=x.useRef(null),[l,u]=x.useState(null);x.useEffect(()=>{let y=!0;return st(()=>import("./firebase-enhanced-Bq4h_lrM.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(w=>{if(!y)return;const _=w&&w.enhancedFirebaseService?w.enhancedFirebaseService:w&&w.EnhancedFirebaseService?new w.EnhancedFirebaseService:null;u(_)}).catch(w=>console.warn("Failed to load enhancedFirebaseService dynamically",w)),()=>{y=!1}},[]),x.useEffect(()=>{const y=async()=>{try{const _=await Pt();c.current=_.onAuthStateChange(S=>{if(console.debug("Auth state changed, firebaseUser:",S),o(!!S),s(!1),S){const v=_.subscribeToUser(S.id,ie=>{t(ie)});c.current=()=>{v()}}else t(null)}),console.debug("Initialized auth listener; waiting briefly for Firebase to populate state"),setTimeout(()=>{i||w()},2e3)}catch(_){console.warn("Firebase not available, using localStorage:",_),w()}},w=()=>{try{const _=localStorage.getItem("michyUser");if(_){const S=JSON.parse(_);if(S&&S.id&&S.username){const ie=d().find(_e=>_e.id===S.id);ie?t(ie):localStorage.removeItem("michyUser")}else localStorage.removeItem("michyUser")}}catch(_){console.error("Failed to parse user from localStorage",_),localStorage.removeItem("michyUser")}finally{s(!1)}};return y(),()=>{c.current&&c.current()}},[]);const d=()=>{try{const y=localStorage.getItem("mitcheUsers");return y?JSON.parse(y):[]}catch(y){return console.error("Failed to parse users from localStorage",y),[]}},m=y=>{try{localStorage.setItem("mitcheUsers",JSON.stringify(y))}catch(w){console.error("Failed to save users to localStorage",w)}},p=async(y,w)=>{if(!y.trim()||!w.trim())return{success:!1,message:de.t("auth.errorInvalid")};if(i){const _=y.includes("@")?y:`${y}@mitche.local`;return await(await Pt()).signInWithEmailPassword(_,w)}else{const S=d().find(v=>v.username.toLowerCase()===y.toLowerCase()&&v.password===w);if(S)try{return localStorage.setItem("michyUser",JSON.stringify(S)),t(S),{success:!0}}catch(v){return console.error("Failed to save user to localStorage during login",v),{success:!1,message:"Storage error occurred"}}return{success:!1,message:de.t("auth.errorInvalid")}}},b=async(y,w,_)=>{if(!y.trim()||!w.trim())return{success:!1,message:de.t("auth.errorInvalid")};if(y.length<3)return{success:!1,message:"Username must be at least 3 characters"};if(w.length<4)return{success:!1,message:"Password must be at least 4 characters"};let S=(_==null?void 0:_.role)||re.Citizen,v="NotRequested";if(_!=null&&_.role)(S===re.NGO||S===re.PublicWorker)&&(v="Pending");else{const ie=y.toUpperCase();ie.includes("NGO")?(S=re.NGO,v="Pending"):ie.includes("GOV")||ie.includes("GOVERNMENT")?(S=re.PublicWorker,v="Pending"):ie.includes("ADMIN")&&(S=re.Admin,v="Approved")}if(i){const ie=y.includes("@")?y:`${y}@mitche.local`,_e=await Pt(),Ce=await _e.createUserWithEmailPassword(ie,w,{username:y.trim(),role:S,verificationStatus:v,symbolicName:"",symbolicIcon:"",hopePoints:0,hopePointsBreakdown:{},hasCompletedOnboarding:!1,isVerified:S===re.Admin,commendations:{Kind:0,Punctual:0,Respectful:0}});if(Ce.success&&(_!=null&&_.submittedFiles)&&_.submittedFiles.length>0)try{const at=await _e.uploadDocuments(Ce.user.id,_.submittedFiles);at&&at.length>0&&await _e.updateUser(Ce.user.id,{submittedDocuments:at,verificationStatus:"Pending"})}catch(at){console.error("Document upload during signup failed:",at)}return Ce}else{const ie=d();if(ie.find(Ce=>Ce.username.toLowerCase()===y.toLowerCase()))return{success:!1,message:de.t("auth.errorExists")};const _e={id:`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,username:y.trim(),password:w.trim(),symbolicName:"",symbolicIcon:"",role:S,hopePoints:0,hopePointsBreakdown:{},hasCompletedOnboarding:!1,isVerified:S===re.Admin,verificationStatus:v,submittedDocuments:(_==null?void 0:_.submittedDocuments)||[],commendations:{Kind:0,Punctual:0,Respectful:0}};try{return ie.push(_e),m(ie),await p(y,w)}catch(Ce){return console.error("Failed to create user",Ce),{success:!1,message:"Failed to create account"}}}},R=async()=>{try{const y=await Pt();return!y||typeof y.signInWithGoogle!="function"?{success:!1,message:"Google sign-in requires Firebase authentication"}:await y.signInWithGoogle()}catch(y){return console.error("Error signing in with Google:",y),{success:!1,message:(y==null?void 0:y.message)||"Google sign-in requires Firebase authentication"}}},A=async()=>{try{i?await(await Pt()).signOut():(localStorage.removeItem("michyUser"),t(null))}catch(y){console.error("Error during logout",y)}},N=async()=>{await(await Pt()).signOut(),t(null),localStorage.removeItem("user"),localStorage.removeItem("users")},D=async y=>{if(e)if(i)await(await Pt()).updateUser(e.id,y)&&t({...e,...y});else{const w={...e,...y};t(w),localStorage.setItem("michyUser",JSON.stringify(w));const _=d(),S=_.findIndex(v=>v.id===w.id);S!==-1&&(_[S]=w,m(_))}},V=(y,w)=>{if(!e)return;const _={...e,hopePoints:e.hopePoints+y,hopePointsBreakdown:{...e.hopePointsBreakdown,[w]:(e.hopePointsBreakdown[w]||0)+y}};D(_)},j=y=>{if(!i)return d().find(_=>_.id===y)},U=y=>{if(i)Pt().then(w=>w.updateUser(y.id,y)).catch(w=>console.error("updateAnyUser failed",w));else{const w=d(),_=w.findIndex(S=>S.id===y.id);_!==-1&&(w[_]=y,m(w),e&&e.id===y.id&&(t(y),localStorage.setItem("michyUser",JSON.stringify(y))))}},Q=(y,w)=>{if(i)Pt().then(_=>_.updateUser(y,{verificationStatus:w,isVerified:w==="Approved"})).catch(_=>console.error("updateVerificationStatus failed",_));else{const _=d(),S=_.findIndex(v=>v.id===y);S!==-1&&(_[S].verificationStatus=w,_[S].isVerified=w==="Approved",m(_),e&&e.id===y&&(t(_[S]),localStorage.setItem("michyUser",JSON.stringify(_[S]))))}},H=()=>i?[]:d(),I=()=>{const y=i?[]:d(),w=new Set(y.map(v=>v.username.toLowerCase())),_=new Set;let S=0;for(;_.size<5&&S<50;){const v=wd[Math.floor(Math.random()*wd.length)],ie=Ed[Math.floor(Math.random()*Ed.length)],_e=Math.floor(100+Math.random()*900),Ce=`${v}${ie}_${_e}`;w.has(Ce.toLowerCase())||_.add(Ce),S++}return Array.from(_)},E=async()=>{i?(await(await Pt()).migrateFromLocalStorage(),console.log("Migration to Firebase completed!")):console.warn("Firebase not available for migration")};return T.jsx(ip.Provider,{value:{user:e,isLoading:n,isFirebaseEnabled:i,login:p,signup:b,signInWithGoogle:R,logout:A,signOutUser:N,addHopePoints:V,updateUser:D,getUserById:j,updateAnyUser:U,getAllUsers:H,generateUniqueUsernames:I,updateVerificationStatus:Q,migrateToFirebase:E,enhancedFirebase:l},children:r})},Mi=()=>{const r=x.useContext(ip);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r};try{Id.displayName="AuthProvider",Id.__docgenInfo={description:"",displayName:"AuthProvider",props:{}}}catch{}const Qc=()=>{const{t:r}=Ar(),{user:e}=Mi(),n=[{path:"/",label:r("nav.home"),icon:jw,roles:[re.Citizen,re.NGO,re.PublicWorker,re.Admin]},{path:"/echoes",label:r("nav.echoes"),icon:Hw,roles:[re.Citizen,re.NGO,re.PublicWorker,re.Admin]},{path:"/resources",label:r("nav.resources"),icon:Kw,roles:[re.Citizen,re.NGO,re.PublicWorker,re.Admin]},{path:"/events",label:r("nav.events"),icon:kw,roles:[re.Citizen,re.NGO,re.PublicWorker,re.Admin]},{path:"/ritual",label:r("nav.ritual","Daily Ritual"),icon:$c,roles:[re.Citizen,re.NGO,re.PublicWorker,re.Admin]},{path:"/leaderboard",label:r("nav.leaderboard"),icon:aE,roles:[re.Citizen,re.NGO,re.PublicWorker,re.Admin]},{path:"/achievements",label:r("nav.achievements"),icon:Qm,roles:[re.Citizen,re.NGO,re.PublicWorker,re.Admin]}].filter(s=>e&&s.roles.includes(e.role));return T.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-[#FFFDF9] border-t border-[#EAE2D6] shadow-md z-10",children:T.jsx("div",{className:"flex justify-around max-w-lg mx-auto",children:n.map(({path:s,label:i,icon:o})=>T.jsxs(Gm,{to:s,end:s==="/",className:({isActive:c})=>`flex flex-col items-center justify-center w-full py-3 transition-colors duration-300 ${c?"text-amber-700 bg-amber-100 font-semibold":"text-gray-500 hover:text-amber-600"}`,children:[T.jsx(o,{size:24}),T.jsx("span",{className:"text-xs mt-1",children:i})]},s))})})};try{Qc.displayName="BottomNav",Qc.__docgenInfo={description:"",displayName:"BottomNav",props:{}}}catch{}const kT=[{id:"demo_req_1",userSymbolicName:"Sample_Hope",userSymbolicIcon:"Lantern",title:"Need help with groceries",description:"Looking for short-term food assistance for the week.",type:"Food",mode:"Loud",timestamp:new Date,region:"Sample City",status:"Open"}],DT=[{id:"demo_evt_1",organizerSymbolicName:"Sample_NGO",organizerSymbolicIcon:"Lantern",title:"Community Clean-up",description:"Join us to clean the local park and share a meal.",timestamp:new Date,region:"Sample City",type:"Volunteer"}],VT=[{id:"demo_res_1",organizerSymbolicName:"Sample_Resource",organizerSymbolicIcon:"Star",title:"Free legal clinic",description:"Volunteer lawyers offering first-line advice every month.",category:"Legal",region:"Sample City",schedule:"First Friday, 09:00 - 13:00",timestamp:new Date}];let vo=null;async function Ae(){return vo||(vo=(await st(()=>Promise.resolve().then(()=>R_),void 0,import.meta.url)).firebaseService,vo)}const op=x.createContext(void 0),OT=[{id:"req_1",userId:"user_123",userSymbolicName:"Bearer_324",userSymbolicIcon:"Star",title:"بحاجة إلى دعم نفسي",description:"أمر بفترة صعبة وأحتاج لمن أتحدث معه بسرية تامة. الشعور بالوحدة يقتلني.",type:xo.Emotional,mode:No.Loud,timestamp:new Date(Date.now()-864e5*1),region:"بيروت",status:Ht.Open,isConfirmedByRequester:!1,requesterCommended:!1,helperCommended:!1},{id:"req_2",userId:"user_456",userSymbolicName:"صوت_النور",userSymbolicIcon:"Lantern",title:"مساعدة في تأمين مأوى مؤقت",description:"عائلتي فقدت منزلها وتحتاج إلى مكان آمن لبضعة أيام حتى نجد حلاً دائماً.",type:xo.Shelter,mode:No.Loud,timestamp:new Date(Date.now()-864e5*2),region:"طرابلس",status:Ht.Fulfilled,helperId:"user_789",isConfirmedByRequester:!0,requesterCommended:!1,helperCommended:!1},{id:"req_3",userId:"user_789",userSymbolicName:"يد_العون",userSymbolicIcon:"Flower",title:"مساعدة في الحصول على دواء",description:"والدتي بحاجة ماسة إلى دواء للقلب ولا أستطيع تحمل تكلفته هذا الشهر.",type:xo.Medical,mode:No.Silent,timestamp:new Date(Date.now()-864e5*3),region:"صيدا",status:Ht.Pending,helperId:"user_123",isConfirmedByRequester:!1,requesterCommended:!1,helperCommended:!1}],LT=[{id:"offering_1",userId:"user_789",requestId:"req_1",type:"Encouragement",message:"أنت لست وحدك. القوة تكمن في طلب المساعدة. أتمنى لك السلام والطمأنينة.",timestamp:new Date(Date.now()-864e5*.5),pointsEarned:3},{id:"offering_2",userId:"user_123",requestId:"req_3",type:"Encouragement",message:"أتمنى لوالدتك الشفاء العاجل. لا تفقد الأمل، فالخير موجود.",timestamp:new Date(Date.now()-864e5*2.5),pointsEarned:3}],MT=[{id:"evt_1",organizerId:"user_ngo_1",organizerSymbolicName:"بناة_الغد",organizerSymbolicIcon:"Lantern",organizerRole:re.NGO,title:"فرصة تطوع لتنظيف الشاطئ",description:"ندعوكم للمشاركة في حملة تنظيف شاطئ الرملة البيضاء يوم السبت القادم. معاً نعيد لبيروت رونقها. نوفر الأدوات والمياه للمشاركين.",type:tp.Volunteer,timestamp:new Date(Date.now()-864e5*.5),region:"بيروت",organizerIsVerified:!0}],FT=[{id:"res_1",organizerId:"user_ngo_1",organizerSymbolicName:"بناة_الغد",organizerSymbolicIcon:"Lantern",organizerIsVerified:!0,title:"مطبخ مجتمعي أسبوعي",description:"نقدم وجبات ساخنة ومغذية كل يوم ثلاثاء وخميس للمحتاجين. لا حاجة للتسجيل المسبق.",category:Gc.Food,region:"بيروت",schedule:"الثلاثاء والخميس، 12:00 ظهراً - 2:00 عصراً",contactInfo:"اتصل على 01-555-123 لمزيد من المعلومات",timestamp:new Date(Date.now()-864e5*7)},{id:"res_2",organizerId:"user_gov_1",organizerSymbolicName:"دعم_وطن",organizerSymbolicIcon:"Anchor",organizerIsVerified:!0,title:"استشارات قانونية مجانية",description:"يقدم محامون متطوعون استشارات قانونية مجانية في قضايا الأحوال الشخصية والعمل أول جمعة من كل شهر.",category:Gc.Legal,region:"كل المحافظات",schedule:"أول جمعة من كل شهر، 9:00 صباحاً - 1:00 ظهراً",contactInfo:"احجز موعدك عبر موقعنا الإلكتروني",timestamp:new Date(Date.now()-864e5*14)}],UT=[{id:"thread_1",honoreeUserId:"user_456",honoreeSymbolicName:"صوت_النور",honoreeSymbolicIcon:"Lantern",isAnonymous:!0,story:'عندما فقدت الأمل، وجدت هنا صوتاً يفهمني. لم أكن أبحث عن حلول، بل عن قلب يسمع. شكراً لـ "صوت_النور" على كلماته التي كانت كالشمعة في عتمتي.',color:sr.Amber,pattern:ir.Spirals,rippleTag:1,echoes:15,timestamp:new Date(Date.now()-864e5*5)},{id:"thread_2",honoreeUserId:"user_789",honoreeSymbolicName:"يد_العون",honoreeSymbolicIcon:"Flower",honoreeRealName:"فاطمة ك.",honoreePhotoUrl:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=100&auto=format&fit=crop",isAnonymous:!1,story:"لم أتردد لحظة في تقديم المساعدة. الدواء لم يكن مجرد علاج، بل كان رسالة حب وأمل. كلنا عائلة واحدة في هذا الوطن.",color:sr.Gold,pattern:ir.Lines,rippleTag:3,echoes:28,timestamp:new Date(Date.now()-864e5*10)}],bd=({children:r})=>{const[e,t]=x.useState([]),[n,s]=x.useState([]),[i,o]=x.useState([]),[c,l]=x.useState([]),[u,d]=x.useState([]),[m,p]=x.useState([]),[b,R]=x.useState(!0),{user:A,addHopePoints:N,updateUser:D,getUserById:V,updateAnyUser:j,isFirebaseEnabled:U}=Mi();x.useEffect(()=>{if(U){console.log("🔥 Initializing Firebase real-time data connections...");const B=[];return(async()=>{try{const F=await Ae(),L=F.subscribeToRequests(ce=>{console.log("📝 Received requests from Firebase:",ce.length),t(ce)});B.push(L);const M=F.subscribeToEvents(ce=>{console.log("🎉 Received events from Firebase:",ce.length),d(ce)});B.push(M);const $=F.subscribeToResources(ce=>{console.log("📚 Received resources from Firebase:",ce.length),p(ce)});B.push($);const W=F.subscribeToOfferings(ce=>{console.log("🤝 Received offerings from Firebase:",ce.length),s(ce)});B.push(W);const me=F.subscribeToTapestryThreads(ce=>{console.log("🧵 Received tapestry threads from Firebase:",ce.length),l(ce)});if(B.push(me),A){const ce=F.subscribeToNotifications(qe=>{const zt=qe.filter(ct=>ct.userId===A.id);console.log("🔔 Received notifications from Firebase:",zt.length),o(zt)});B.push(ce)}R(!1)}catch(F){console.error("Failed to initialize Firebase listeners",F),R(!1)}})(),()=>{console.log("🧹 Cleaning up Firebase listeners..."),B.forEach(F=>F())}}else console.log("📦 Using demo/mock data (Firebase not available)"),setTimeout(()=>{t([...OT,...kT]),s(LT),l(UT),d([...MT,...DT]),p([...FT,...VT]),R(!1)},1e3)},[U,A]),x.useEffect(()=>{if(A&&!A.nominationStatus){const B={id:`notif_nomination_${A.id}`,userId:A.id,message:"DEPRECATED",messageKey:"notifications.nomination",timestamp:new Date,isRead:!1,type:"Nomination"};o(F=>F.find(L=>L.id===B.id)?F:[B,...F]),D({nominationStatus:"Nominated"})}},[A,D]);const Q=async(B,F)=>{const L={...B,timestamp:new Date,userId:F.id,userSymbolicName:F.symbolicName,userSymbolicIcon:F.symbolicIcon,status:Ht.Open,isConfirmedByRequester:!1,requesterCommended:!1,helperCommended:!1};if(U){console.log("🔥 Creating request in Firebase...");try{await(await Ae()).createRequest(L)?console.log("✅ Request created successfully in Firebase"):console.error("❌ Failed to create request in Firebase")}catch(M){console.error("Error creating request in Firebase:",M)}}else{const M={...L,id:`req_${Date.now()}`};t($=>[M,...$])}},H=async(B,F)=>{const L={...B,timestamp:new Date,organizerId:F.id,organizerSymbolicName:F.symbolicName,organizerSymbolicIcon:F.symbolicIcon,organizerRole:F.role,organizerIsVerified:F.isVerified};if(U){console.log("🔥 Creating event in Firebase...");try{await(await Ae()).createEvent(L)?console.log("✅ Event created successfully in Firebase"):console.error("❌ Failed to create event in Firebase")}catch(M){console.error("Error creating event in Firebase:",M)}}else{const M={...L,id:`evt_${Date.now()}`};d($=>[M,...$])}},I=async(B,F)=>{const L={...B,timestamp:new Date,organizerId:F.id,organizerSymbolicName:F.symbolicName,organizerSymbolicIcon:F.symbolicIcon,organizerIsVerified:F.isVerified};if(U){console.log("🔥 Creating resource in Firebase...");try{await(await Ae()).createResource(L)?console.log("✅ Resource created successfully in Firebase"):console.error("❌ Failed to create resource in Firebase")}catch(M){console.error("Error creating resource in Firebase:",M)}}else{const M={...L,id:`res_${Date.now()}`};p($=>[M,...$])}},E=async(B,F)=>{const L={...B,timestamp:new Date,userId:F};if(U){console.log("🔥 Creating offering in Firebase...");try{await(await Ae()).createOffering(L)?console.log("✅ Offering created successfully in Firebase"):console.error("❌ Failed to create offering in Firebase")}catch($){console.error("Error creating offering in Firebase:",$)}}else{const $={...L,id:`offering_${Date.now()}`};s(W=>[$,...W])}B.type==="Encouragement"&&N(B.pointsEarned,gt.VoiceOfCompassion);const M=e.find($=>$.id===B.requestId);if(M&&M.userId!==F){const $={id:`notif_${Date.now()}`,userId:M.userId,requestId:M.id,message:"DEPRECATED",messageKey:"notifications.encouragement",messageOptions:{title:M.title.substring(0,20)},timestamp:new Date,isRead:!1,type:"Generic"};if(U)try{await(await Ae()).createNotification($)}catch(W){console.error("Failed to create notification",W)}else o(W=>[$,...W])}},y=async B=>{const F={...B,timestamp:new Date};if(U)try{return await(await Ae()).addTapestryThread(F)}catch(L){return console.error("Error adding tapestry thread to Firebase:",L),null}else{const L={...F,id:`thread_${Date.now()}`};return l(M=>[L,...M]),L.id}},w=(B,F)=>{const L=e.find($=>$.id===B),M=A;if(U)(async()=>{try{const $=await Ae();if(await $.updateRequest(B,{status:Ht.Pending,helperId:F}),L&&M){const W={id:`notif_${Date.now()}_help_offer`,userId:L.userId,requestId:L.id,message:"DEPRECATED",messageKey:"notifications.helpOffer",messageOptions:{name:M.symbolicName,title:L.title.substring(0,20)},timestamp:new Date,isRead:!1,type:"Generic"};await $.createNotification(W)}}catch($){console.error("initiateHelp firebase error",$)}})();else if(t($=>$.map(W=>W.id===B?{...W,status:Ht.Pending,helperId:F}:W)),L&&M){const $={id:`notif_${Date.now()}_help_offer`,userId:L.userId,requestId:L.id,message:"DEPRECATED",messageKey:"notifications.helpOffer",messageOptions:{name:M.symbolicName,title:L.title.substring(0,20)},timestamp:new Date,isRead:!1,type:"Generic"};o(W=>[$,...W])}},_=B=>{const F=e.find(L=>L.id===B);if(U)(async()=>{try{const L=await Ae();if(await L.updateRequest(B,{isConfirmedByRequester:!0}),F&&F.helperId){const M={id:`notif_${Date.now()}_help_confirm`,userId:F.helperId,requestId:F.id,message:"DEPRECATED",messageKey:"notifications.receiptConfirm",messageOptions:{title:F.title.substring(0,20)},timestamp:new Date,isRead:!1,type:"Generic"};await L.createNotification(M)}}catch(L){console.error("confirmReceipt firebase error",L)}})();else if(t(L=>L.map(M=>M.id===B?{...M,isConfirmedByRequester:!0}:M)),F&&F.helperId){const L={id:`notif_${Date.now()}_help_confirm`,userId:F.helperId,requestId:F.id,message:"DEPRECATED",messageKey:"notifications.receiptConfirm",messageOptions:{title:F.title.substring(0,20)},timestamp:new Date,isRead:!1,type:"Generic"};o(M=>[L,...M])}},S=async(B,F)=>{const L=e.find(M=>M.id===B);if(U)try{const M=await Ae();if(await M.updateRequest(B,{status:Ht.Fulfilled,helperId:F}),L&&L.userId!==F){const $={id:`notif_${Date.now()}_fulfill`,userId:L.userId,requestId:L.id,message:"DEPRECATED",messageKey:"notifications.fulfillment",messageOptions:{title:L.title.substring(0,20)},timestamp:new Date,isRead:!1,type:"Generic"};await M.createNotification($)}}catch(M){console.error("fulfillRequest firebase error",M)}else if(t(M=>M.map($=>$.id===B?{...$,status:Ht.Fulfilled,helperId:F}:$)),L&&L.userId!==F){const M={id:`notif_${Date.now()}_fulfill`,userId:L.userId,requestId:L.id,message:"DEPRECATED",messageKey:"notifications.fulfillment",messageOptions:{title:L.title.substring(0,20)},timestamp:new Date,isRead:!1,type:"Generic"};o($=>[M,...$])}},v=B=>{const F=i.filter(L=>L.userId===B).sort((L,M)=>M.timestamp.getTime()-L.timestamp.getTime());return F.length>0||U&&(async()=>{try{const M=await(await Ae()).getUserNotifications(B);M&&M.length&&o(M)}catch(L){console.error("Error fetching notifications for user:",L)}})(),F},ie=B=>{o(F=>F.map(L=>L.id===B?{...L,isRead:!0}:L)),U&&(async()=>{try{await(await Ae()).updateNotification(B,{isRead:!0})}catch(F){console.error("markAsRead firebase error",F)}})()},_e=(B,F,L)=>{if(A)if(F==="Reveal"&&L)if(U)(async()=>{try{const M=await Ae();await M.updateUser(A.id,{nominationStatus:"AcceptedReveal",realName:L.realName,photoUrl:L.photoUrl});const $={id:`thread_${Date.now()}`,honoreeUserId:B,honoreeSymbolicName:A.symbolicName,honoreeSymbolicIcon:A.symbolicIcon,honoreeRealName:L.realName,honoreePhotoUrl:L.photoUrl,isAnonymous:!1,story:de.t("tapestry.story.revealed"),color:sr.Gold,pattern:ir.Lines,rippleTag:5,echoes:0,timestamp:new Date};await M.addTapestryThread($)}catch(M){console.error("acceptNomination(reveal) firebase error",M)}})();else{D({nominationStatus:"AcceptedReveal",realName:L.realName,photoUrl:L.photoUrl});const M={id:`thread_${Date.now()}`,honoreeUserId:B,honoreeSymbolicName:A.symbolicName,honoreeSymbolicIcon:A.symbolicIcon,honoreeRealName:L.realName,honoreePhotoUrl:L.photoUrl,isAnonymous:!1,story:de.t("tapestry.story.revealed"),color:sr.Gold,pattern:ir.Lines,rippleTag:5,echoes:0,timestamp:new Date};l($=>[M,...$])}else if(U)(async()=>{try{const M=await Ae();await M.updateUser(A.id,{nominationStatus:"AcceptedAnonymous"});const $={id:`thread_${Date.now()}`,honoreeUserId:B,honoreeSymbolicName:A.symbolicName,honoreeSymbolicIcon:A.symbolicIcon,isAnonymous:!0,story:de.t("tapestry.story.anonymous"),color:sr.Blue,pattern:ir.Spirals,rippleTag:3,echoes:0,timestamp:new Date};await M.addTapestryThread($)}catch(M){console.error("acceptNomination(anon) firebase error",M)}})();else{D({nominationStatus:"AcceptedAnonymous"});const M={id:`thread_${Date.now()}`,honoreeUserId:B,honoreeSymbolicName:A.symbolicName,honoreeSymbolicIcon:A.symbolicIcon,isAnonymous:!0,story:de.t("tapestry.story.anonymous"),color:sr.Blue,pattern:ir.Spirals,rippleTag:3,echoes:0,timestamp:new Date};l($=>[M,...$])}},Ce=B=>{const F=c.find(M=>M.id===B);if(!F)return;const L=F.echoes+1;l(M=>M.map($=>$.id===B?{...$,echoes:L}:$)),U&&(async()=>{try{await(await Ae()).updateTapestryThread(B,{echoes:L})}catch(M){console.error("echoThread firebase error",M)}})()},at=async B=>{if(!A)return{success:!1,messageKey:"scanner.error.notLoggedIn"};if(A.id===B)return{success:!1,messageKey:"scanner.error.selfGift"};const F=new Date;if(F.setHours(0,0,0,0),A.lastPointGivenTimestamp&&A.lastPointGivenTimestamp>=F.getTime())return{success:!1,messageKey:"scanner.error.alreadyGiven"};let L=V(B);if(U)try{const me=await(await Ae()).getUser(B);me&&(L=me)}catch(W){console.error("Error fetching receiver:",W)}if(!L)return{success:!1,messageKey:"scanner.error.userNotFound"};const M={hopePoints:(L.hopePoints||0)+1,hopePointsBreakdown:{...L.hopePointsBreakdown||{},[gt.CommunityGift]:(L.hopePointsBreakdown&&L.hopePointsBreakdown[gt.CommunityGift]||0)+1}},$={hopePoints:(A.hopePoints||0)+1,hopePointsBreakdown:{...A.hopePointsBreakdown||{},[gt.CommunityGift]:(A.hopePointsBreakdown&&A.hopePointsBreakdown[gt.CommunityGift]||0)+1},lastPointGivenTimestamp:Date.now()};if(U)try{const W=await Ae();await W.updateUser(B,M),await W.updateUser(A.id,$);const me={id:`notif_${Date.now()}_gift`,userId:B,message:"DEPRECATED",messageKey:"notifications.dailyGift",timestamp:new Date,isRead:!1,type:"Generic"};return await W.createNotification(me),D($),{success:!0,messageKey:"scanner.success.giftSent",receiverName:L.symbolicName}}catch(W){return console.error("Error applying daily point via Firebase:",W),{success:!1,messageKey:"scanner.error.server"}}else{const W={...L,hopePoints:(L.hopePoints||0)+1,hopePointsBreakdown:{...L.hopePointsBreakdown||{},[gt.CommunityGift]:(L.hopePointsBreakdown&&L.hopePointsBreakdown[gt.CommunityGift]||0)+1}};j(W);const me={...A,hopePoints:(A.hopePoints||0)+1,hopePointsBreakdown:{...A.hopePointsBreakdown||{},[gt.CommunityGift]:(A.hopePointsBreakdown&&A.hopePointsBreakdown[gt.CommunityGift]||0)+1},lastPointGivenTimestamp:Date.now()};return D(me),{success:!0,messageKey:"scanner.success.giftSent",receiverName:L.symbolicName}}},xe=B=>{const F=e.find(L=>L.id===B);if(F)return F;U&&(async()=>{try{const M=await(await Ae()).getRequests();M&&M.length&&t(M)}catch(L){console.error("Error fetching request by id:",L)}})()},Xe=B=>{const F=n.filter(L=>L.requestId===B).sort((L,M)=>M.timestamp.getTime()-L.timestamp.getTime());return F.length>0||U&&(async()=>{try{const M=await(await Ae()).getOfferingsForRequest(B);M&&M.length&&s($=>{const W=new Set($.map(ce=>ce.id)),me=[...$];return M.forEach(ce=>{W.has(ce.id)||me.push(ce)}),me.sort((ce,qe)=>qe.timestamp.getTime()-ce.timestamp.getTime())})}catch(L){console.error("Error fetching offerings for request:",L)}})(),F},Et=(B,F,L)=>{const M=e.find(W=>W.id===B);if(!M)return;const $=F==="requester"?M.helperId:M.userId;if($)if(U)(async()=>{try{const W=await Ae(),me=await W.getUser($);if(!me)return;const ce={...me.commendations||{}};L.forEach(qe=>{ce[qe]=(ce[qe]||0)+1}),await W.updateUser($,{commendations:ce}),F==="requester"?await W.updateRequest(B,{requesterCommended:!0}):await W.updateRequest(B,{helperCommended:!0})}catch(W){console.error("Error leaving commendation via Firebase:",W)}})();else{const W=V($);if(!W)return;const me={...W.commendations};L.forEach(ce=>{me[ce]=(me[ce]||0)+1}),j({...W,commendations:me}),t(ce=>ce.map(qe=>qe.id===B?{...qe,...F==="requester"&&{requesterCommended:!0},...F==="helper"&&{helperCommended:!0}}:qe))}},X=async(B,F,L,M,$,W=1)=>{if(!U)return{success:!1};try{const{enhancedFirebaseService:me}=await st(async()=>{const{enhancedFirebaseService:qe}=await import("./firebase-enhanced-Bq4h_lrM.js");return{enhancedFirebaseService:qe}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url);return{success:(await me.recordHopePoints(B,F,L,M,$,W)).success}}catch(me){return console.error("Error recording hope points wrapper",me),{success:!1}}},Ge=async B=>{try{const F=[];return F.push({id:"create_request",title:de.t("createRequest.title"),subtitle:de.t("createRequest.subtitle"),action:"createRequest"}),u&&u.length>0&&F.push({id:"view_events",title:de.t("sanctuary.tiles.events"),subtitle:de.t("sanctuary.tiles.eventsSub"),action:"viewEvents"}),c&&c.length>0&&F.push({id:"view_tapestry",title:de.t("tapestry.title"),subtitle:de.t("tapestry.subtitle"),action:"viewTapestry"}),F}catch{return[]}},Bn=(B,F)=>{if(!B)return()=>{};let L=()=>{};if(U)(async()=>{try{L=(await Ae()).subscribeToUser(B,$=>{if(!$)return;const W=$.pillars||$.hopePointsBreakdown||{};F(W)})}catch(M){console.error("subscribeToUserPillars error",M)}})();else{const M=V(B);M&&F(M.pillars||M.hopePointsBreakdown||{})}return()=>{try{L()}catch{}}},$t=async B=>{try{const F=[],L=i.slice(0,10).map(W=>({id:W.id,text:W.messageKey?de.t(W.messageKey,W.messageOptions||{}):W.message||""}));F.push(...L);const M=c.slice(0,5).map(W=>{var me;return{id:W.id,text:(me=W.story)==null?void 0:me.slice(0,120)}});F.push(...M);const $=e.slice(0,5).map(W=>({id:W.id,text:W.title}));return F.push(...$),F.slice(0,10)}catch{return[]}},Is=async(B,F)=>{if(!A)return{success:!1,messageKey:"scanner.error.notLoggedIn"};let L=V(B);if(U)try{const W=await(await Ae()).getUser(B);W&&(L=W)}catch($){console.error("Error fetching receiver for encouragement:",$)}if(!L)return{success:!1,messageKey:"scanner.error.userNotFound"};const M={id:`notif_${Date.now()}_encourage`,userId:B,message:F,messageKey:void 0,timestamp:new Date,isRead:!1,type:"Generic"};if(U)try{const $=await Ae();return await $.createNotification(M),await $.updateUser(B,{hopePoints:(L.hopePoints||0)+1}),{success:!0}}catch($){return console.error("Error sending encouragement via Firebase:",$),{success:!1,messageKey:"scanner.error.server"}}else{const $={...L,hopePoints:(L.hopePoints||0)+1};return j($),o(W=>[M,...W]),{success:!0}}},bs=async B=>{if(!A)return{success:!1,messageKey:"scanner.error.notLoggedIn"};try{const F=new Date;if(F.setHours(0,0,0,0),A.lastRitualTimestamp&&A.lastRitualTimestamp>=F.getTime())return{success:!1,messageKey:"scanner.error.alreadyGiven"};const L={hopePoints:(A.hopePoints||0)+1,hopePointsBreakdown:{...A.hopePointsBreakdown||{},[gt.Ritual]:(A.hopePointsBreakdown&&A.hopePointsBreakdown[gt.Ritual]||0)+1},lastRitualTimestamp:Date.now()},M={userId:A.id,timestamp:new Date().toISOString(),prompt:(B==null?void 0:B.prompt)||void 0,locale:typeof navigator<"u"&&navigator.language?navigator.language:A.preferredLanguage||"en",userAgent:typeof navigator<"u"&&navigator.userAgent||""};if(U)try{const{getFunctions:$,httpsCallable:W}=await st(async()=>{const{getFunctions:Se,httpsCallable:Ke}=await import("./index.esm-BgrrfS07.js");return{getFunctions:Se,httpsCallable:Ke}},__vite__mapDeps([7,1,2,3,4,5,6]),import.meta.url),me=$(),ce=W(me,"awardRitual"),qe={prompt:B==null?void 0:B.prompt},zt=await ce(qe),ct=zt&&zt.data;if(ct&&ct.success){if(ct.newHopePoints||ct.newBreakdown){const Se={};typeof ct.newHopePoints=="number"&&(Se.hopePoints=ct.newHopePoints),ct.newBreakdown&&(Se.hopePointsBreakdown=ct.newBreakdown),Se.lastRitualTimestamp=Date.now(),D(Se)}else D(L);return{success:!0,messageKey:"ritual.success"}}else return console.warn("awardRitual returned unexpected payload",ct),{success:!1,messageKey:"ritual.error"}}catch($){const W=($==null?void 0:$.code)||($==null?void 0:$.status)||null;return W==="failed-precondition"||W==="already-completed"?{success:!1,messageKey:"scanner.error.alreadyGiven"}:(console.error("Failed to call awardRitual:",$),{success:!1,messageKey:"ritual.error"})}return D(L),{success:!0,messageKey:"ritual.success"}}catch(F){return console.error("Error giving ritual point",F),{success:!1,messageKey:"ritual.error"}}},Ts=async B=>{if(!U)return null;try{const{enhancedFirebaseService:F}=await st(async()=>{const{enhancedFirebaseService:M}=await import("./firebase-enhanced-Bq4h_lrM.js");return{enhancedFirebaseService:M}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url);try{if(typeof F.getPreaggregatedGlobal=="function"){const M=await F.getPreaggregatedGlobal();if(M&&M.success&&Array.isArray(M.data))return M.data.slice(0,(B==null?void 0:B.limit)||100)}}catch{}const L=await F.getLeaderboard(B);return L&&L.success?L.data||[]:null}catch(F){return console.error("Error fetching leaderboard",F),null}};return T.jsx(op.Provider,{value:{requests:e,offerings:n,addRequest:Q,addOffering:E,fulfillRequest:S,notifications:i,getNotificationsForUser:v,markAsRead:ie,loading:b,tapestryThreads:c,acceptNomination:_e,echoThread:Ce,initiateHelp:w,confirmReceipt:_,giveDailyPoint:at,giveRitualPoint:bs,communityEvents:u,addCommunityEvent:H,getRequestById:xe,getOfferingsForRequest:Xe,resources:m,addResource:I,leaveCommendation:Et,addTapestryThread:y,recordHopePoints:X,getLeaderboard:Ts,sendEncouragement:Is,getQuickActionsForUser:Ge,getRecentActivityForUser:$t,subscribeToUserPillars:Bn},children:r})},ap=()=>{const r=x.useContext(op);if(!r)throw new Error("useData must be used within a DataProvider");return r};try{bd.displayName="DataProvider",bd.__docgenInfo={description:"",displayName:"DataProvider",props:{}}}catch{}const jT=(r,e)=>{const t=Math.floor((new Date().getTime()-r.getTime())/1e3);if(t<5)return e("echoes.time.just_now");let n=t/31536e3;if(n>1){const i=Math.floor(n);return e("echoes.time.years_ago",{count:i})}if(n=t/2592e3,n>1){const i=Math.floor(n);return e("echoes.time.months_ago",{count:i})}if(n=t/86400,n>1){const i=Math.floor(n);return e("echoes.time.days_ago",{count:i})}if(n=t/3600,n>1){const i=Math.floor(n);return e("echoes.time.hours_ago",{count:i})}if(n=t/60,n>1){const i=Math.floor(n);return e("echoes.time.minutes_ago",{count:i})}const s=Math.floor(t);return e("echoes.time.seconds_ago",{count:s})},Xo=({name:r,className:e="w-6 h-6"})=>{switch(r){case"Star":return T.jsx(rE,{className:e});case"Lantern":return T.jsx(iE,{className:e});case"Flower":return T.jsx(Fw,{className:e});default:return T.jsx(Tw,{className:e})}};try{Xo.displayName="SymbolIcon",Xo.__docgenInfo={description:"",displayName:"SymbolIcon",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},className:{defaultValue:{value:"w-6 h-6"},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}const Yc=({alt:r="Mitché Logo",className:e="",sizes:t})=>{const n="/optimized/awardlogo";return T.jsxs("picture",{className:e,children:[T.jsx("source",{type:"image/avif",srcSet:`${n}-64.avif 64w, ${n}-160.avif 160w, ${n}-320.avif 320w`,sizes:t}),T.jsx("source",{type:"image/webp",srcSet:`${n}-64.webp 64w, ${n}-160.webp 160w, ${n}-320.webp 320w`,sizes:t}),T.jsx("img",{src:`${n}-160.png`,alt:r,width:160,height:160,loading:"eager"})]})};try{Yc.displayName="ResponsiveLogo",Yc.__docgenInfo={description:"",displayName:"ResponsiveLogo",props:{alt:{defaultValue:{value:"Mitché Logo"},description:"",name:"alt",required:!1,type:{name:"string"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}},sizes:{defaultValue:null,description:"",name:"sizes",required:!1,type:{name:"string"}}}}}catch{}const Zo=({isOpen:r,onClose:e,title:t,children:n})=>{const{t:s}=Ar();return r?T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-4",onClick:e,"aria-modal":"true",role:"dialog",children:T.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl shadow-xl w-full max-w-md sm:animate-fade-in-down animate-slide-in-up",onClick:i=>i.stopPropagation(),children:[T.jsxs("div",{className:"p-5 border-b flex justify-between items-center",children:[T.jsx("h2",{className:"text-xl font-bold text-gray-800",children:t}),T.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 p-2","aria-label":s("modal.close"),children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[T.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),T.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),T.jsx("div",{className:"p-6",children:n})]})}):null};try{Zo.displayName="Modal",Zo.__docgenInfo={description:"",displayName:"Modal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}}}}}catch{}const Jc=({isOpen:r,onClose:e,user:t})=>{const{updateUser:n}=Mi(),{t:s}=Ar(),[i,o]=wc.useState(""),[c,l]=wc.useState("");wc.useEffect(()=>{t&&(o(t.bio||""),l(t.location||""))},[t,r]);const u=d=>{d.preventDefault();const m=`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${t.id}`;n({bio:i,location:c,qrCodeUrl:m}),e()};return T.jsx(Zo,{isOpen:r,onClose:e,title:s("constellation.editProfile.title"),children:T.jsxs("form",{onSubmit:u,className:"space-y-4",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:s("constellation.editProfile.location")}),T.jsx("input",{type:"text",value:c,onChange:d=>l(d.target.value),className:"w-full px-4 py-2 bg-white border border-[#EAE2D6] rounded-lg focus:outline-none focus:ring-1 focus:ring-[#D4AF37]",placeholder:s("constellation.editProfile.locationPlaceholder")})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:s("constellation.editProfile.bio")}),T.jsx("textarea",{value:i,onChange:d=>o(d.target.value),rows:4,className:"w-full px-4 py-2 bg-white border border-[#EAE2D6] rounded-lg focus:outline-none focus:ring-1 focus:ring-[#D4AF37]",placeholder:s("constellation.editProfile.bioPlaceholder")})]}),T.jsx("button",{type:"submit",className:"w-full mt-4 bg-[#D4AF37] text-white py-3 rounded-lg font-bold hover:bg-opacity-90",children:s("constellation.editProfile.save")})]})})};try{Jc.displayName="EditProfileModal",Jc.__docgenInfo={description:"",displayName:"EditProfileModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},user:{defaultValue:null,description:"",name:"user",required:!0,type:{name:"User"}}}}}catch{}const BT=()=>{};var Td={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cp=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},qT=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const s=r[t++];if(s<128)e[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=r[t++];e[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=r[t++],o=r[t++],c=r[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(l>>10)),e[n++]=String.fromCharCode(56320+(l&1023))}else{const i=r[t++],o=r[t++];e[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},lp={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const i=r[s],o=s+1<r.length,c=o?r[s+1]:0,l=s+2<r.length,u=l?r[s+2]:0,d=i>>2,m=(i&3)<<4|c>>4;let p=(c&15)<<2|u>>6,b=u&63;l||(b=64,o||(p=64)),n.push(t[d],t[m],t[p],t[b])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(cp(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):qT(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const i=t[r.charAt(s++)],c=s<r.length?t[r.charAt(s)]:0;++s;const u=s<r.length?t[r.charAt(s)]:64;++s;const m=s<r.length?t[r.charAt(s)]:64;if(++s,i==null||c==null||u==null||m==null)throw new $T;const p=i<<2|c>>4;if(n.push(p),u!==64){const b=c<<4&240|u>>2;if(n.push(b),m!==64){const R=u<<6&192|m;n.push(R)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class $T extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const zT=function(r){const e=cp(r);return lp.encodeByteArray(e,!0)},ea=function(r){return zT(r).replace(/\./g,"")},up=function(r){try{return lp.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hp(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HT=()=>hp().__FIREBASE_DEFAULTS__,GT=()=>{if(typeof process>"u"||typeof Td>"u")return;const r=Td.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},KT=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&up(r[1]);return e&&JSON.parse(e)},xa=()=>{try{return BT()||HT()||GT()||KT()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},dp=r=>{var e,t;return(t=(e=xa())==null?void 0:e.emulatorHosts)==null?void 0:t[r]},WT=r=>{const e=dp(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},fp=()=>{var r;return(r=xa())==null?void 0:r.config},mp=r=>{var e;return(e=xa())==null?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ds(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function pp(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YT(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...r};return[ea(JSON.stringify(t)),ea(JSON.stringify(o)),""].join(".")}const li={};function JT(){const r={prod:[],emulator:[]};for(const e of Object.keys(li))li[e]?r.emulator.push(e):r.prod.push(e);return r}function XT(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}let Sd=!1;function gp(r,e){if(typeof window>"u"||typeof document>"u"||!ds(window.location.host)||li[r]===e||li[r]||Sd)return;li[r]=e;function t(p){return`__firebase__banner__${p}`}const n="__firebase__banner",i=JT().prod.length>0;function o(){const p=document.getElementById(n);p&&p.remove()}function c(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,b){p.setAttribute("width","24"),p.setAttribute("id",b),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{Sd=!0,o()},p}function d(p,b){p.setAttribute("id",b),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function m(){const p=XT(n),b=t("text"),R=document.getElementById(b)||document.createElement("span"),A=t("learnmore"),N=document.getElementById(A)||document.createElement("a"),D=t("preprendIcon"),V=document.getElementById(D)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const j=p.element;c(j),d(N,A);const U=u();l(V,D),j.append(V,R,N,U),document.body.appendChild(j)}i?(R.innerText="Preview backend disconnected.",V.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(V.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,R.innerText="Preview backend running in this workspace."),R.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ZT(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(je())}function yp(){var e;const r=(e=xa())==null?void 0:e.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function e0(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function t0(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function n0(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function r0(){const r=je();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function _p(){return!yp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vp(){return!yp()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function wp(){try{return typeof indexedDB=="object"}catch{return!1}}function s0(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i0="FirebaseError";class rn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=i0,Object.setPrototypeOf(this,rn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Fi.prototype.create)}}class Fi{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?o0(i,n):"Error",c=`${this.serviceName}: ${o} (${s}).`;return new rn(s,c,n)}}function o0(r,e){return r.replace(a0,(t,n)=>{const s=e[n];return s!=null?String(s):`<${n}?>`})}const a0=/\{\$([^}]+)}/g;function c0(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function kn(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const s of t){if(!n.includes(s))return!1;const i=r[s],o=e[s];if(Ad(i)&&Ad(o)){if(!kn(i,o))return!1}else if(i!==o)return!1}for(const s of n)if(!t.includes(s))return!1;return!0}function Ad(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Js(r){const e={};return r.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[s,i]=n.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Xs(r){const e=r.indexOf("?");if(!e)return"";const t=r.indexOf("#",e);return r.substring(e,t>0?t:void 0)}function l0(r,e){const t=new u0(r,e);return t.subscribe.bind(t)}class u0{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");h0(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:n},s.next===void 0&&(s.next=Sc),s.error===void 0&&(s.error=Sc),s.complete===void 0&&(s.complete=Sc);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function h0(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function Sc(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(r){return r&&r._delegate?r._delegate:r}class fr{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new QT;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(m0(e))try{this.getOrInitializeService({instanceIdentifier:Wn})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(e=Wn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Wn){return this.instances.has(e)}getOptions(e=Wn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&o.resolve(s)}return s}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(n)??new Set;s.add(e),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&e(i,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:f0(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Wn){return this.component?this.component.multipleInstances?e:Wn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function f0(r){return r===Wn?void 0:r}function m0(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new d0(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var le;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(le||(le={}));const g0={debug:le.DEBUG,verbose:le.VERBOSE,info:le.INFO,warn:le.WARN,error:le.ERROR,silent:le.SILENT},y0=le.INFO,_0={[le.DEBUG]:"log",[le.VERBOSE]:"log",[le.INFO]:"info",[le.WARN]:"warn",[le.ERROR]:"error"},v0=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),s=_0[e];if(s)console[s](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Kl{constructor(e){this.name=e,this._logLevel=y0,this._logHandler=v0,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?g0[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,le.DEBUG,...e),this._logHandler(this,le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,le.VERBOSE,...e),this._logHandler(this,le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,le.INFO,...e),this._logHandler(this,le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,le.WARN,...e),this._logHandler(this,le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,le.ERROR,...e),this._logHandler(this,le.ERROR,...e)}}const w0=(r,e)=>e.some(t=>r instanceof t);let Rd,Pd;function E0(){return Rd||(Rd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function I0(){return Pd||(Pd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ep=new WeakMap,Xc=new WeakMap,Ip=new WeakMap,Ac=new WeakMap,Wl=new WeakMap;function b0(r){const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",o)},i=()=>{t(Sn(r.result)),s()},o=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Ep.set(t,r)}).catch(()=>{}),Wl.set(e,r),e}function T0(r){if(Xc.has(r))return;const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",o),r.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",o),r.addEventListener("abort",o)});Xc.set(r,e)}let Zc={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Xc.get(r);if(e==="objectStoreNames")return r.objectStoreNames||Ip.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Sn(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function S0(r){Zc=r(Zc)}function A0(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(Rc(this),e,...t);return Ip.set(n,e.sort?e.sort():[e]),Sn(n)}:I0().includes(r)?function(...e){return r.apply(Rc(this),e),Sn(Ep.get(this))}:function(...e){return Sn(r.apply(Rc(this),e))}}function R0(r){return typeof r=="function"?A0(r):(r instanceof IDBTransaction&&T0(r),w0(r,E0())?new Proxy(r,Zc):r)}function Sn(r){if(r instanceof IDBRequest)return b0(r);if(Ac.has(r))return Ac.get(r);const e=R0(r);return e!==r&&(Ac.set(r,e),Wl.set(e,r)),e}const Rc=r=>Wl.get(r);function P0(r,e,{blocked:t,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(r,e),c=Sn(o);return n&&o.addEventListener("upgradeneeded",l=>{n(Sn(o.result),l.oldVersion,l.newVersion,Sn(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}const C0=["get","getKey","getAll","getAllKeys","count"],x0=["put","add","delete","clear"],Pc=new Map;function Cd(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Pc.get(e))return Pc.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,s=x0.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(s||C0.includes(t)))return;const i=async function(o,...c){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return n&&(u=u.index(c.shift())),(await Promise.all([u[t](...c),s&&l.done]))[0]};return Pc.set(e,i),i}S0(r=>({...r,get:(e,t,n)=>Cd(e,t)||r.get(e,t,n),has:(e,t)=>!!Cd(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(k0(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function k0(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const el="@firebase/app",xd="0.14.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt=new Kl("@firebase/app"),D0="@firebase/app-compat",V0="@firebase/analytics-compat",O0="@firebase/analytics",L0="@firebase/app-check-compat",M0="@firebase/app-check",F0="@firebase/auth",U0="@firebase/auth-compat",j0="@firebase/database",B0="@firebase/data-connect",q0="@firebase/database-compat",$0="@firebase/functions",z0="@firebase/functions-compat",H0="@firebase/installations",G0="@firebase/installations-compat",K0="@firebase/messaging",W0="@firebase/messaging-compat",Q0="@firebase/performance",Y0="@firebase/performance-compat",J0="@firebase/remote-config",X0="@firebase/remote-config-compat",Z0="@firebase/storage",eS="@firebase/storage-compat",tS="@firebase/firestore",nS="@firebase/ai",rS="@firebase/firestore-compat",sS="firebase",iS="12.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl="[DEFAULT]",oS={[el]:"fire-core",[D0]:"fire-core-compat",[O0]:"fire-analytics",[V0]:"fire-analytics-compat",[M0]:"fire-app-check",[L0]:"fire-app-check-compat",[F0]:"fire-auth",[U0]:"fire-auth-compat",[j0]:"fire-rtdb",[B0]:"fire-data-connect",[q0]:"fire-rtdb-compat",[$0]:"fire-fn",[z0]:"fire-fn-compat",[H0]:"fire-iid",[G0]:"fire-iid-compat",[K0]:"fire-fcm",[W0]:"fire-fcm-compat",[Q0]:"fire-perf",[Y0]:"fire-perf-compat",[J0]:"fire-rc",[X0]:"fire-rc-compat",[Z0]:"fire-gcs",[eS]:"fire-gcs-compat",[tS]:"fire-fst",[rS]:"fire-fst-compat",[nS]:"fire-vertex","fire-js":"fire-js",[sS]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta=new Map,aS=new Map,nl=new Map;function Nd(r,e){try{r.container.addComponent(e)}catch(t){Xt.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Yr(r){const e=r.name;if(nl.has(e))return Xt.debug(`There were multiple attempts to register component ${e}.`),!1;nl.set(e,r);for(const t of ta.values())Nd(t,r);for(const t of aS.values())Nd(t,r);return!0}function Ql(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function lt(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},An=new Fi("app","Firebase",cS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lS{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new fr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw An.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fs=iS;function bp(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n={name:tl,automaticDataCollectionEnabled:!0,...e},s=n.name;if(typeof s!="string"||!s)throw An.create("bad-app-name",{appName:String(s)});if(t||(t=fp()),!t)throw An.create("no-options");const i=ta.get(s);if(i){if(kn(t,i.options)&&kn(n,i.config))return i;throw An.create("duplicate-app",{appName:s})}const o=new p0(s);for(const l of nl.values())o.addComponent(l);const c=new lS(t,n,o);return ta.set(s,c),c}function Tp(r=tl){const e=ta.get(r);if(!e&&r===tl&&fp())return bp();if(!e)throw An.create("no-app",{appName:r});return e}function Rn(r,e,t){let n=oS[r]??r;t&&(n+=`-${t}`);const s=n.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${n}" with version "${e}":`];s&&o.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xt.warn(o.join(" "));return}Yr(new fr(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uS="firebase-heartbeat-database",hS=1,wi="firebase-heartbeat-store";let Cc=null;function Sp(){return Cc||(Cc=P0(uS,hS,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(wi)}catch(t){console.warn(t)}}}}).catch(r=>{throw An.create("idb-open",{originalErrorMessage:r.message})})),Cc}async function dS(r){try{const t=(await Sp()).transaction(wi),n=await t.objectStore(wi).get(Ap(r));return await t.done,n}catch(e){if(e instanceof rn)Xt.warn(e.message);else{const t=An.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Xt.warn(t.message)}}}async function kd(r,e){try{const n=(await Sp()).transaction(wi,"readwrite");await n.objectStore(wi).put(e,Ap(r)),await n.done}catch(t){if(t instanceof rn)Xt.warn(t.message);else{const n=An.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Xt.warn(n.message)}}}function Ap(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fS=1024,mS=30;class pS{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new yS(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Dd();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>mS){const o=_S(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Xt.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Dd(),{heartbeatsToSend:n,unsentEntries:s}=gS(this._heartbeatsCache.heartbeats),i=ea(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Xt.warn(t),""}}}function Dd(){return new Date().toISOString().substring(0,10)}function gS(r,e=fS){const t=[];let n=r.slice();for(const s of r){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Vd(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Vd(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class yS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return wp()?s0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await dS(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return kd(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return kd(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Vd(r){return ea(JSON.stringify({version:2,heartbeats:r})).length}function _S(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vS(r){Yr(new fr("platform-logger",e=>new N0(e),"PRIVATE")),Yr(new fr("heartbeat",e=>new pS(e),"PRIVATE")),Rn(el,xd,r),Rn(el,xd,"esm2020"),Rn("fire-js","")}vS("");var Od=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pn,Rp;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,E){function y(){}y.prototype=E.prototype,I.F=E.prototype,I.prototype=new y,I.prototype.constructor=I,I.D=function(w,_,S){for(var v=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)v[ie-2]=arguments[ie];return E.prototype[_].apply(w,v)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,E,y){y||(y=0);const w=Array(16);if(typeof E=="string")for(var _=0;_<16;++_)w[_]=E.charCodeAt(y++)|E.charCodeAt(y++)<<8|E.charCodeAt(y++)<<16|E.charCodeAt(y++)<<24;else for(_=0;_<16;++_)w[_]=E[y++]|E[y++]<<8|E[y++]<<16|E[y++]<<24;E=I.g[0],y=I.g[1],_=I.g[2];let S=I.g[3],v;v=E+(S^y&(_^S))+w[0]+3614090360&4294967295,E=y+(v<<7&4294967295|v>>>25),v=S+(_^E&(y^_))+w[1]+3905402710&4294967295,S=E+(v<<12&4294967295|v>>>20),v=_+(y^S&(E^y))+w[2]+606105819&4294967295,_=S+(v<<17&4294967295|v>>>15),v=y+(E^_&(S^E))+w[3]+3250441966&4294967295,y=_+(v<<22&4294967295|v>>>10),v=E+(S^y&(_^S))+w[4]+4118548399&4294967295,E=y+(v<<7&4294967295|v>>>25),v=S+(_^E&(y^_))+w[5]+1200080426&4294967295,S=E+(v<<12&4294967295|v>>>20),v=_+(y^S&(E^y))+w[6]+2821735955&4294967295,_=S+(v<<17&4294967295|v>>>15),v=y+(E^_&(S^E))+w[7]+4249261313&4294967295,y=_+(v<<22&4294967295|v>>>10),v=E+(S^y&(_^S))+w[8]+1770035416&4294967295,E=y+(v<<7&4294967295|v>>>25),v=S+(_^E&(y^_))+w[9]+2336552879&4294967295,S=E+(v<<12&4294967295|v>>>20),v=_+(y^S&(E^y))+w[10]+4294925233&4294967295,_=S+(v<<17&4294967295|v>>>15),v=y+(E^_&(S^E))+w[11]+2304563134&4294967295,y=_+(v<<22&4294967295|v>>>10),v=E+(S^y&(_^S))+w[12]+1804603682&4294967295,E=y+(v<<7&4294967295|v>>>25),v=S+(_^E&(y^_))+w[13]+4254626195&4294967295,S=E+(v<<12&4294967295|v>>>20),v=_+(y^S&(E^y))+w[14]+2792965006&4294967295,_=S+(v<<17&4294967295|v>>>15),v=y+(E^_&(S^E))+w[15]+1236535329&4294967295,y=_+(v<<22&4294967295|v>>>10),v=E+(_^S&(y^_))+w[1]+4129170786&4294967295,E=y+(v<<5&4294967295|v>>>27),v=S+(y^_&(E^y))+w[6]+3225465664&4294967295,S=E+(v<<9&4294967295|v>>>23),v=_+(E^y&(S^E))+w[11]+643717713&4294967295,_=S+(v<<14&4294967295|v>>>18),v=y+(S^E&(_^S))+w[0]+3921069994&4294967295,y=_+(v<<20&4294967295|v>>>12),v=E+(_^S&(y^_))+w[5]+3593408605&4294967295,E=y+(v<<5&4294967295|v>>>27),v=S+(y^_&(E^y))+w[10]+38016083&4294967295,S=E+(v<<9&4294967295|v>>>23),v=_+(E^y&(S^E))+w[15]+3634488961&4294967295,_=S+(v<<14&4294967295|v>>>18),v=y+(S^E&(_^S))+w[4]+3889429448&4294967295,y=_+(v<<20&4294967295|v>>>12),v=E+(_^S&(y^_))+w[9]+568446438&4294967295,E=y+(v<<5&4294967295|v>>>27),v=S+(y^_&(E^y))+w[14]+3275163606&4294967295,S=E+(v<<9&4294967295|v>>>23),v=_+(E^y&(S^E))+w[3]+4107603335&4294967295,_=S+(v<<14&4294967295|v>>>18),v=y+(S^E&(_^S))+w[8]+1163531501&4294967295,y=_+(v<<20&4294967295|v>>>12),v=E+(_^S&(y^_))+w[13]+2850285829&4294967295,E=y+(v<<5&4294967295|v>>>27),v=S+(y^_&(E^y))+w[2]+4243563512&4294967295,S=E+(v<<9&4294967295|v>>>23),v=_+(E^y&(S^E))+w[7]+1735328473&4294967295,_=S+(v<<14&4294967295|v>>>18),v=y+(S^E&(_^S))+w[12]+2368359562&4294967295,y=_+(v<<20&4294967295|v>>>12),v=E+(y^_^S)+w[5]+4294588738&4294967295,E=y+(v<<4&4294967295|v>>>28),v=S+(E^y^_)+w[8]+2272392833&4294967295,S=E+(v<<11&4294967295|v>>>21),v=_+(S^E^y)+w[11]+1839030562&4294967295,_=S+(v<<16&4294967295|v>>>16),v=y+(_^S^E)+w[14]+4259657740&4294967295,y=_+(v<<23&4294967295|v>>>9),v=E+(y^_^S)+w[1]+2763975236&4294967295,E=y+(v<<4&4294967295|v>>>28),v=S+(E^y^_)+w[4]+1272893353&4294967295,S=E+(v<<11&4294967295|v>>>21),v=_+(S^E^y)+w[7]+4139469664&4294967295,_=S+(v<<16&4294967295|v>>>16),v=y+(_^S^E)+w[10]+3200236656&4294967295,y=_+(v<<23&4294967295|v>>>9),v=E+(y^_^S)+w[13]+681279174&4294967295,E=y+(v<<4&4294967295|v>>>28),v=S+(E^y^_)+w[0]+3936430074&4294967295,S=E+(v<<11&4294967295|v>>>21),v=_+(S^E^y)+w[3]+3572445317&4294967295,_=S+(v<<16&4294967295|v>>>16),v=y+(_^S^E)+w[6]+76029189&4294967295,y=_+(v<<23&4294967295|v>>>9),v=E+(y^_^S)+w[9]+3654602809&4294967295,E=y+(v<<4&4294967295|v>>>28),v=S+(E^y^_)+w[12]+3873151461&4294967295,S=E+(v<<11&4294967295|v>>>21),v=_+(S^E^y)+w[15]+530742520&4294967295,_=S+(v<<16&4294967295|v>>>16),v=y+(_^S^E)+w[2]+3299628645&4294967295,y=_+(v<<23&4294967295|v>>>9),v=E+(_^(y|~S))+w[0]+4096336452&4294967295,E=y+(v<<6&4294967295|v>>>26),v=S+(y^(E|~_))+w[7]+1126891415&4294967295,S=E+(v<<10&4294967295|v>>>22),v=_+(E^(S|~y))+w[14]+2878612391&4294967295,_=S+(v<<15&4294967295|v>>>17),v=y+(S^(_|~E))+w[5]+4237533241&4294967295,y=_+(v<<21&4294967295|v>>>11),v=E+(_^(y|~S))+w[12]+1700485571&4294967295,E=y+(v<<6&4294967295|v>>>26),v=S+(y^(E|~_))+w[3]+2399980690&4294967295,S=E+(v<<10&4294967295|v>>>22),v=_+(E^(S|~y))+w[10]+4293915773&4294967295,_=S+(v<<15&4294967295|v>>>17),v=y+(S^(_|~E))+w[1]+2240044497&4294967295,y=_+(v<<21&4294967295|v>>>11),v=E+(_^(y|~S))+w[8]+1873313359&4294967295,E=y+(v<<6&4294967295|v>>>26),v=S+(y^(E|~_))+w[15]+4264355552&4294967295,S=E+(v<<10&4294967295|v>>>22),v=_+(E^(S|~y))+w[6]+2734768916&4294967295,_=S+(v<<15&4294967295|v>>>17),v=y+(S^(_|~E))+w[13]+1309151649&4294967295,y=_+(v<<21&4294967295|v>>>11),v=E+(_^(y|~S))+w[4]+4149444226&4294967295,E=y+(v<<6&4294967295|v>>>26),v=S+(y^(E|~_))+w[11]+3174756917&4294967295,S=E+(v<<10&4294967295|v>>>22),v=_+(E^(S|~y))+w[2]+718787259&4294967295,_=S+(v<<15&4294967295|v>>>17),v=y+(S^(_|~E))+w[9]+3951481745&4294967295,I.g[0]=I.g[0]+E&4294967295,I.g[1]=I.g[1]+(_+(v<<21&4294967295|v>>>11))&4294967295,I.g[2]=I.g[2]+_&4294967295,I.g[3]=I.g[3]+S&4294967295}n.prototype.v=function(I,E){E===void 0&&(E=I.length);const y=E-this.blockSize,w=this.C;let _=this.h,S=0;for(;S<E;){if(_==0)for(;S<=y;)s(this,I,S),S+=this.blockSize;if(typeof I=="string"){for(;S<E;)if(w[_++]=I.charCodeAt(S++),_==this.blockSize){s(this,w),_=0;break}}else for(;S<E;)if(w[_++]=I[S++],_==this.blockSize){s(this,w),_=0;break}}this.h=_,this.o+=E},n.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var E=1;E<I.length-8;++E)I[E]=0;E=this.o*8;for(var y=I.length-8;y<I.length;++y)I[y]=E&255,E/=256;for(this.v(I),I=Array(16),E=0,y=0;y<4;++y)for(let w=0;w<32;w+=8)I[E++]=this.g[y]>>>w&255;return I};function i(I,E){var y=c;return Object.prototype.hasOwnProperty.call(y,I)?y[I]:y[I]=E(I)}function o(I,E){this.h=E;const y=[];let w=!0;for(let _=I.length-1;_>=0;_--){const S=I[_]|0;w&&S==E||(y[_]=S,w=!1)}this.g=y}var c={};function l(I){return-128<=I&&I<128?i(I,function(E){return new o([E|0],E<0?-1:0)}):new o([I|0],I<0?-1:0)}function u(I){if(isNaN(I)||!isFinite(I))return m;if(I<0)return N(u(-I));const E=[];let y=1;for(let w=0;I>=y;w++)E[w]=I/y|0,y*=4294967296;return new o(E,0)}function d(I,E){if(I.length==0)throw Error("number format error: empty string");if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(I.charAt(0)=="-")return N(d(I.substring(1),E));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=u(Math.pow(E,8));let w=m;for(let S=0;S<I.length;S+=8){var _=Math.min(8,I.length-S);const v=parseInt(I.substring(S,S+_),E);_<8?(_=u(Math.pow(E,_)),w=w.j(_).add(u(v))):(w=w.j(y),w=w.add(u(v)))}return w}var m=l(0),p=l(1),b=l(16777216);r=o.prototype,r.m=function(){if(A(this))return-N(this).m();let I=0,E=1;for(let y=0;y<this.g.length;y++){const w=this.i(y);I+=(w>=0?w:4294967296+w)*E,E*=4294967296}return I},r.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(R(this))return"0";if(A(this))return"-"+N(this).toString(I);const E=u(Math.pow(I,6));var y=this;let w="";for(;;){const _=U(y,E).g;y=D(y,_.j(E));let S=((y.g.length>0?y.g[0]:y.h)>>>0).toString(I);if(y=_,R(y))return S+w;for(;S.length<6;)S="0"+S;w=S+w}},r.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function R(I){if(I.h!=0)return!1;for(let E=0;E<I.g.length;E++)if(I.g[E]!=0)return!1;return!0}function A(I){return I.h==-1}r.l=function(I){return I=D(this,I),A(I)?-1:R(I)?0:1};function N(I){const E=I.g.length,y=[];for(let w=0;w<E;w++)y[w]=~I.g[w];return new o(y,~I.h).add(p)}r.abs=function(){return A(this)?N(this):this},r.add=function(I){const E=Math.max(this.g.length,I.g.length),y=[];let w=0;for(let _=0;_<=E;_++){let S=w+(this.i(_)&65535)+(I.i(_)&65535),v=(S>>>16)+(this.i(_)>>>16)+(I.i(_)>>>16);w=v>>>16,S&=65535,v&=65535,y[_]=v<<16|S}return new o(y,y[y.length-1]&-2147483648?-1:0)};function D(I,E){return I.add(N(E))}r.j=function(I){if(R(this)||R(I))return m;if(A(this))return A(I)?N(this).j(N(I)):N(N(this).j(I));if(A(I))return N(this.j(N(I)));if(this.l(b)<0&&I.l(b)<0)return u(this.m()*I.m());const E=this.g.length+I.g.length,y=[];for(var w=0;w<2*E;w++)y[w]=0;for(w=0;w<this.g.length;w++)for(let _=0;_<I.g.length;_++){const S=this.i(w)>>>16,v=this.i(w)&65535,ie=I.i(_)>>>16,_e=I.i(_)&65535;y[2*w+2*_]+=v*_e,V(y,2*w+2*_),y[2*w+2*_+1]+=S*_e,V(y,2*w+2*_+1),y[2*w+2*_+1]+=v*ie,V(y,2*w+2*_+1),y[2*w+2*_+2]+=S*ie,V(y,2*w+2*_+2)}for(I=0;I<E;I++)y[I]=y[2*I+1]<<16|y[2*I];for(I=E;I<2*E;I++)y[I]=0;return new o(y,0)};function V(I,E){for(;(I[E]&65535)!=I[E];)I[E+1]+=I[E]>>>16,I[E]&=65535,E++}function j(I,E){this.g=I,this.h=E}function U(I,E){if(R(E))throw Error("division by zero");if(R(I))return new j(m,m);if(A(I))return E=U(N(I),E),new j(N(E.g),N(E.h));if(A(E))return E=U(I,N(E)),new j(N(E.g),E.h);if(I.g.length>30){if(A(I)||A(E))throw Error("slowDivide_ only works with positive integers.");for(var y=p,w=E;w.l(I)<=0;)y=Q(y),w=Q(w);var _=H(y,1),S=H(w,1);for(w=H(w,2),y=H(y,2);!R(w);){var v=S.add(w);v.l(I)<=0&&(_=_.add(y),S=v),w=H(w,1),y=H(y,1)}return E=D(I,_.j(E)),new j(_,E)}for(_=m;I.l(E)>=0;){for(y=Math.max(1,Math.floor(I.m()/E.m())),w=Math.ceil(Math.log(y)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),S=u(y),v=S.j(E);A(v)||v.l(I)>0;)y-=w,S=u(y),v=S.j(E);R(S)&&(S=p),_=_.add(S),I=D(I,v)}return new j(_,I)}r.B=function(I){return U(this,I).h},r.and=function(I){const E=Math.max(this.g.length,I.g.length),y=[];for(let w=0;w<E;w++)y[w]=this.i(w)&I.i(w);return new o(y,this.h&I.h)},r.or=function(I){const E=Math.max(this.g.length,I.g.length),y=[];for(let w=0;w<E;w++)y[w]=this.i(w)|I.i(w);return new o(y,this.h|I.h)},r.xor=function(I){const E=Math.max(this.g.length,I.g.length),y=[];for(let w=0;w<E;w++)y[w]=this.i(w)^I.i(w);return new o(y,this.h^I.h)};function Q(I){const E=I.g.length+1,y=[];for(let w=0;w<E;w++)y[w]=I.i(w)<<1|I.i(w-1)>>>31;return new o(y,I.h)}function H(I,E){const y=E>>5;E%=32;const w=I.g.length-y,_=[];for(let S=0;S<w;S++)_[S]=E>0?I.i(S+y)>>>E|I.i(S+y+1)<<32-E:I.i(S+y);return new o(_,I.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Rp=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,Pn=o}).apply(typeof Od<"u"?Od:typeof self<"u"?self:typeof window<"u"?window:{});var wo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pp,Zs,Cp,ko,rl,xp,Np,kp;(function(){var r,e=Object.defineProperty;function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof wo=="object"&&wo];for(var h=0;h<a.length;++h){var f=a[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var n=t(this);function s(a,h){if(h)e:{var f=n;a=a.split(".");for(var g=0;g<a.length-1;g++){var C=a[g];if(!(C in f))break e;f=f[C]}a=a[a.length-1],g=f[a],h=h(g),h!=g&&h!=null&&e(f,a,{configurable:!0,writable:!0,value:h})}}s("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(a){return a||function(h){var f=[],g;for(g in h)Object.prototype.hasOwnProperty.call(h,g)&&f.push([g,h[g]]);return f}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function c(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function l(a,h,f){return a.call.apply(a.bind,arguments)}function u(a,h,f){return u=l,u.apply(null,arguments)}function d(a,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function m(a,h){function f(){}f.prototype=h.prototype,a.Z=h.prototype,a.prototype=new f,a.prototype.constructor=a,a.Ob=function(g,C,k){for(var G=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)G[oe-2]=arguments[oe];return h.prototype[C].apply(g,G)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function b(a){const h=a.length;if(h>0){const f=Array(h);for(let g=0;g<h;g++)f[g]=a[g];return f}return[]}function R(a,h){for(let g=1;g<arguments.length;g++){const C=arguments[g];var f=typeof C;if(f=f!="object"?f:C?Array.isArray(C)?"array":f:"null",f=="array"||f=="object"&&typeof C.length=="number"){f=a.length||0;const k=C.length||0;a.length=f+k;for(let G=0;G<k;G++)a[f+G]=C[G]}else a.push(C)}}class A{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return this.h>0?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function N(a){o.setTimeout(()=>{throw a},0)}function D(){var a=I;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class V{constructor(){this.h=this.g=null}add(h,f){const g=j.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var j=new A(()=>new U,a=>a.reset());class U{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let Q,H=!1,I=new V,E=()=>{const a=Promise.resolve(void 0);Q=()=>{a.then(y)}};function y(){for(var a;a=D();){try{a.h.call(a.g)}catch(f){N(f)}var h=j;h.j(a),h.h<100&&(h.h++,a.next=h.g,h.g=a)}H=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}_.prototype.h=function(){this.defaultPrevented=!0};var S=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const f=()=>{};o.addEventListener("test",f,h),o.removeEventListener("test",f,h)}catch{}return a})();function v(a){return/^[\s\xa0]*$/.test(a)}function ie(a,h){_.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,h)}m(ie,_),ie.prototype.init=function(a,h){const f=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget,h||(f=="mouseover"?h=a.fromElement:f=="mouseout"&&(h=a.toElement)),this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&ie.Z.h.call(this)},ie.prototype.h=function(){ie.Z.h.call(this);const a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var _e="closure_listenable_"+(Math.random()*1e6|0),Ce=0;function at(a,h,f,g,C){this.listener=a,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=C,this.key=++Ce,this.da=this.fa=!1}function xe(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Xe(a,h,f){for(const g in a)h.call(f,a[g],g,a)}function Et(a,h){for(const f in a)h.call(void 0,a[f],f,a)}function X(a){const h={};for(const f in a)h[f]=a[f];return h}const Ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Bn(a,h){let f,g;for(let C=1;C<arguments.length;C++){g=arguments[C];for(f in g)a[f]=g[f];for(let k=0;k<Ge.length;k++)f=Ge[k],Object.prototype.hasOwnProperty.call(g,f)&&(a[f]=g[f])}}function $t(a){this.src=a,this.g={},this.h=0}$t.prototype.add=function(a,h,f,g,C){const k=a.toString();a=this.g[k],a||(a=this.g[k]=[],this.h++);const G=bs(a,h,g,C);return G>-1?(h=a[G],f||(h.fa=!1)):(h=new at(h,this.src,k,!!g,C),h.fa=f,a.push(h)),h};function Is(a,h){const f=h.type;if(f in a.g){var g=a.g[f],C=Array.prototype.indexOf.call(g,h,void 0),k;(k=C>=0)&&Array.prototype.splice.call(g,C,1),k&&(xe(h),a.g[f].length==0&&(delete a.g[f],a.h--))}}function bs(a,h,f,g){for(let C=0;C<a.length;++C){const k=a[C];if(!k.da&&k.listener==h&&k.capture==!!f&&k.ha==g)return C}return-1}var Ts="closure_lm_"+(Math.random()*1e6|0),B={};function F(a,h,f,g,C){if(Array.isArray(h)){for(let k=0;k<h.length;k++)F(a,h[k],f,g,C);return null}return f=ct(f),a&&a[_e]?a.J(h,f,c(g)?!!g.capture:!1,C):L(a,h,f,!1,g,C)}function L(a,h,f,g,C,k){if(!h)throw Error("Invalid event type");const G=c(C)?!!C.capture:!!C;let oe=qe(a);if(oe||(a[Ts]=oe=new $t(a)),f=oe.add(h,f,g,G,k),f.proxy)return f;if(g=M(),f.proxy=g,g.src=a,g.listener=f,a.addEventListener)S||(C=G),C===void 0&&(C=!1),a.addEventListener(h.toString(),g,C);else if(a.attachEvent)a.attachEvent(me(h.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function M(){function a(f){return h.call(a.src,a.listener,f)}const h=ce;return a}function $(a,h,f,g,C){if(Array.isArray(h))for(var k=0;k<h.length;k++)$(a,h[k],f,g,C);else g=c(g)?!!g.capture:!!g,f=ct(f),a&&a[_e]?(a=a.i,k=String(h).toString(),k in a.g&&(h=a.g[k],f=bs(h,f,g,C),f>-1&&(xe(h[f]),Array.prototype.splice.call(h,f,1),h.length==0&&(delete a.g[k],a.h--)))):a&&(a=qe(a))&&(h=a.g[h.toString()],a=-1,h&&(a=bs(h,f,g,C)),(f=a>-1?h[a]:null)&&W(f))}function W(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[_e])Is(h.i,a);else{var f=a.type,g=a.proxy;h.removeEventListener?h.removeEventListener(f,g,a.capture):h.detachEvent?h.detachEvent(me(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=qe(h))?(Is(f,a),f.h==0&&(f.src=null,h[Ts]=null)):xe(a)}}}function me(a){return a in B?B[a]:B[a]="on"+a}function ce(a,h){if(a.da)a=!0;else{h=new ie(h,this);const f=a.listener,g=a.ha||a.src;a.fa&&W(a),a=f.call(g,h)}return a}function qe(a){return a=a[Ts],a instanceof $t?a:null}var zt="__closure_events_fn_"+(Math.random()*1e9>>>0);function ct(a){return typeof a=="function"?a:(a[zt]||(a[zt]=function(h){return a.handleEvent(h)}),a[zt])}function Se(){w.call(this),this.i=new $t(this),this.M=this,this.G=null}m(Se,w),Se.prototype[_e]=!0,Se.prototype.removeEventListener=function(a,h,f,g){$(this,a,h,f,g)};function Ke(a,h){var f,g=a.G;if(g)for(f=[];g;g=g.G)f.push(g);if(a=a.M,g=h.type||h,typeof h=="string")h=new _(h,a);else if(h instanceof _)h.target=h.target||a;else{var C=h;h=new _(g,a),Bn(h,C)}C=!0;let k,G;if(f)for(G=f.length-1;G>=0;G--)k=h.g=f[G],C=ro(k,g,!0,h)&&C;if(k=h.g=a,C=ro(k,g,!0,h)&&C,C=ro(k,g,!1,h)&&C,f)for(G=0;G<f.length;G++)k=h.g=f[G],C=ro(k,g,!1,h)&&C}Se.prototype.N=function(){if(Se.Z.N.call(this),this.i){var a=this.i;for(const h in a.g){const f=a.g[h];for(let g=0;g<f.length;g++)xe(f[g]);delete a.g[h],a.h--}}this.G=null},Se.prototype.J=function(a,h,f,g){return this.i.add(String(a),h,!1,f,g)},Se.prototype.K=function(a,h,f,g){return this.i.add(String(a),h,!0,f,g)};function ro(a,h,f,g){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();let C=!0;for(let k=0;k<h.length;++k){const G=h[k];if(G&&!G.da&&G.capture==f){const oe=G.listener,Fe=G.ha||G.src;G.fa&&Is(a.i,G),C=oe.call(Fe,g)!==!1&&C}}return C&&!g.defaultPrevented}function C_(a,h){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=u(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(h)>2147483647?-1:o.setTimeout(a,h||0)}function ih(a){a.g=C_(()=>{a.g=null,a.i&&(a.i=!1,ih(a))},a.l);const h=a.h;a.h=null,a.m.apply(null,h)}class x_ extends w{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:ih(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ss(a){w.call(this),this.h=a,this.g={}}m(Ss,w);var oh=[];function ah(a){Xe(a.g,function(h,f){this.g.hasOwnProperty(f)&&W(h)},a),a.g={}}Ss.prototype.N=function(){Ss.Z.N.call(this),ah(this)},Ss.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rc=o.JSON.stringify,N_=o.JSON.parse,k_=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function ch(){}function lh(){}var As={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function sc(){_.call(this,"d")}m(sc,_);function ic(){_.call(this,"c")}m(ic,_);var qn={},uh=null;function so(){return uh=uh||new Se}qn.Ia="serverreachability";function hh(a){_.call(this,qn.Ia,a)}m(hh,_);function Rs(a){const h=so();Ke(h,new hh(h))}qn.STAT_EVENT="statevent";function dh(a,h){_.call(this,qn.STAT_EVENT,a),this.stat=h}m(dh,_);function rt(a){const h=so();Ke(h,new dh(h,a))}qn.Ja="timingevent";function fh(a,h){_.call(this,qn.Ja,a),this.size=h}m(fh,_);function Ps(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},h)}function Cs(){this.g=!0}Cs.prototype.ua=function(){this.g=!1};function D_(a,h,f,g,C,k){a.info(function(){if(a.g)if(k){var G="",oe=k.split("&");for(let ve=0;ve<oe.length;ve++){var Fe=oe[ve].split("=");if(Fe.length>1){const $e=Fe[0];Fe=Fe[1];const Rt=$e.split("_");G=Rt.length>=2&&Rt[1]=="type"?G+($e+"="+Fe+"&"):G+($e+"=redacted&")}}}else G=null;else G=k;return"XMLHTTP REQ ("+g+") [attempt "+C+"]: "+h+`
`+f+`
`+G})}function V_(a,h,f,g,C,k,G){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+C+"]: "+h+`
`+f+`
`+k+" "+G})}function xr(a,h,f,g){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+L_(a,f)+(g?" "+g:"")})}function O_(a,h){a.info(function(){return"TIMEOUT: "+h})}Cs.prototype.info=function(){};function L_(a,h){if(!a.g)return h;if(!h)return null;try{const k=JSON.parse(h);if(k){for(a=0;a<k.length;a++)if(Array.isArray(k[a])){var f=k[a];if(!(f.length<2)){var g=f[1];if(Array.isArray(g)&&!(g.length<1)){var C=g[0];if(C!="noop"&&C!="stop"&&C!="close")for(let G=1;G<g.length;G++)g[G]=""}}}}return rc(k)}catch{return h}}var io={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},mh={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ph;function oc(){}m(oc,ch),oc.prototype.g=function(){return new XMLHttpRequest},ph=new oc;function xs(a){return encodeURIComponent(String(a))}function M_(a){var h=1;a=a.split(":");const f=[];for(;h>0&&a.length;)f.push(a.shift()),h--;return a.length&&f.push(a.join(":")),f}function ln(a,h,f,g){this.j=a,this.i=h,this.l=f,this.S=g||1,this.V=new Ss(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new gh}function gh(){this.i=null,this.g="",this.h=!1}var yh={},ac={};function cc(a,h,f){a.M=1,a.A=ao(At(h)),a.u=f,a.R=!0,_h(a,null)}function _h(a,h){a.F=Date.now(),oo(a),a.B=At(a.A);var f=a.B,g=a.S;Array.isArray(g)||(g=[String(g)]),Nh(f.i,"t",g),a.C=0,f=a.j.L,a.h=new gh,a.g=Qh(a.j,f?h:null,!a.u),a.P>0&&(a.O=new x_(u(a.Y,a,a.g),a.P)),h=a.V,f=a.g,g=a.ba;var C="readystatechange";Array.isArray(C)||(C&&(oh[0]=C.toString()),C=oh);for(let k=0;k<C.length;k++){const G=F(f,C[k],g||h.handleEvent,!1,h.h||h);if(!G)break;h.g[G.key]=G}h=a.J?X(a.J):{},a.u?(a.v||(a.v="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,h)):(a.v="GET",a.g.ea(a.B,a.v,null,h)),Rs(),D_(a.i,a.v,a.B,a.l,a.S,a.u)}ln.prototype.ba=function(a){a=a.target;const h=this.O;h&&dn(a)==3?h.j():this.Y(a)},ln.prototype.Y=function(a){try{if(a==this.g)e:{const oe=dn(this.g),Fe=this.g.ya(),ve=this.g.ca();if(!(oe<3)&&(oe!=3||this.g&&(this.h.h||this.g.la()||Fh(this.g)))){this.K||oe!=4||Fe==7||(Fe==8||ve<=0?Rs(3):Rs(2)),lc(this);var h=this.g.ca();this.X=h;var f=F_(this);if(this.o=h==200,V_(this.i,this.v,this.B,this.l,this.S,oe,h),this.o){if(this.U&&!this.L){t:{if(this.g){var g,C=this.g;if((g=C.g?C.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(g)){var k=g;break t}}k=null}if(a=k)xr(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,uc(this,a);else{this.o=!1,this.m=3,rt(12),$n(this),Ns(this);break e}}if(this.R){a=!0;let $e;for(;!this.K&&this.C<f.length;)if($e=U_(this,f),$e==ac){oe==4&&(this.m=4,rt(14),a=!1),xr(this.i,this.l,null,"[Incomplete Response]");break}else if($e==yh){this.m=4,rt(15),xr(this.i,this.l,f,"[Invalid Chunk]"),a=!1;break}else xr(this.i,this.l,$e,null),uc(this,$e);if(vh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),oe!=4||f.length!=0||this.h.h||(this.m=1,rt(16),a=!1),this.o=this.o&&a,!a)xr(this.i,this.l,f,"[Invalid Chunked Response]"),$n(this),Ns(this);else if(f.length>0&&!this.W){this.W=!0;var G=this.j;G.g==this&&G.aa&&!G.P&&(G.j.info("Great, no buffering proxy detected. Bytes received: "+f.length),_c(G),G.P=!0,rt(11))}}else xr(this.i,this.l,f,null),uc(this,f);oe==4&&$n(this),this.o&&!this.K&&(oe==4?Hh(this.j,this):(this.o=!1,oo(this)))}else Z_(this.g),h==400&&f.indexOf("Unknown SID")>0?(this.m=3,rt(12)):(this.m=0,rt(13)),$n(this),Ns(this)}}}catch{}finally{}};function F_(a){if(!vh(a))return a.g.la();const h=Fh(a.g);if(h==="")return"";let f="";const g=h.length,C=dn(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return $n(a),Ns(a),"";a.h.i=new o.TextDecoder}for(let k=0;k<g;k++)a.h.h=!0,f+=a.h.i.decode(h[k],{stream:!(C&&k==g-1)});return h.length=0,a.h.g+=f,a.C=0,a.h.g}function vh(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function U_(a,h){var f=a.C,g=h.indexOf(`
`,f);return g==-1?ac:(f=Number(h.substring(f,g)),isNaN(f)?yh:(g+=1,g+f>h.length?ac:(h=h.slice(g,g+f),a.C=g+f,h)))}ln.prototype.cancel=function(){this.K=!0,$n(this)};function oo(a){a.T=Date.now()+a.H,wh(a,a.H)}function wh(a,h){if(a.D!=null)throw Error("WatchDog timer not null");a.D=Ps(u(a.aa,a),h)}function lc(a){a.D&&(o.clearTimeout(a.D),a.D=null)}ln.prototype.aa=function(){this.D=null;const a=Date.now();a-this.T>=0?(O_(this.i,this.B),this.M!=2&&(Rs(),rt(17)),$n(this),this.m=2,Ns(this)):wh(this,this.T-a)};function Ns(a){a.j.I==0||a.K||Hh(a.j,a)}function $n(a){lc(a);var h=a.O;h&&typeof h.dispose=="function"&&h.dispose(),a.O=null,ah(a.V),a.g&&(h=a.g,a.g=null,h.abort(),h.dispose())}function uc(a,h){try{var f=a.j;if(f.I!=0&&(f.g==a||hc(f.h,a))){if(!a.L&&hc(f.h,a)&&f.I==3){try{var g=f.Ba.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var C=g;if(C[0]==0){e:if(!f.v){if(f.g)if(f.g.F+3e3<a.F)fo(f),uo(f);else break e;yc(f),rt(18)}}else f.xa=C[1],0<f.xa-f.K&&C[2]<37500&&f.F&&f.A==0&&!f.C&&(f.C=Ps(u(f.Va,f),6e3));bh(f.h)<=1&&f.ta&&(f.ta=void 0)}else Hn(f,11)}else if((a.L||f.g==a)&&fo(f),!v(h))for(C=f.Ba.g.parse(h),h=0;h<C.length;h++){let ve=C[h];const $e=ve[0];if(!($e<=f.K))if(f.K=$e,ve=ve[1],f.I==2)if(ve[0]=="c"){f.M=ve[1],f.ba=ve[2];const Rt=ve[3];Rt!=null&&(f.ka=Rt,f.j.info("VER="+f.ka));const Gn=ve[4];Gn!=null&&(f.za=Gn,f.j.info("SVER="+f.za));const fn=ve[5];fn!=null&&typeof fn=="number"&&fn>0&&(g=1.5*fn,f.O=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;const mn=a.g;if(mn){const po=mn.g?mn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(po){var k=g.h;k.g||po.indexOf("spdy")==-1&&po.indexOf("quic")==-1&&po.indexOf("h2")==-1||(k.j=k.l,k.g=new Set,k.h&&(dc(k,k.h),k.h=null))}if(g.G){const vc=mn.g?mn.g.getResponseHeader("X-HTTP-Session-Id"):null;vc&&(g.wa=vc,we(g.J,g.G,vc))}}f.I=3,f.l&&f.l.ra(),f.aa&&(f.T=Date.now()-a.F,f.j.info("Handshake RTT: "+f.T+"ms")),g=f;var G=a;if(g.na=Wh(g,g.L?g.ba:null,g.W),G.L){Th(g.h,G);var oe=G,Fe=g.O;Fe&&(oe.H=Fe),oe.D&&(lc(oe),oo(oe)),g.g=G}else $h(g);f.i.length>0&&ho(f)}else ve[0]!="stop"&&ve[0]!="close"||Hn(f,7);else f.I==3&&(ve[0]=="stop"||ve[0]=="close"?ve[0]=="stop"?Hn(f,7):gc(f):ve[0]!="noop"&&f.l&&f.l.qa(ve),f.A=0)}}Rs(4)}catch{}}var j_=class{constructor(a,h){this.g=a,this.map=h}};function Eh(a){this.l=a||10,o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ih(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function bh(a){return a.h?1:a.g?a.g.size:0}function hc(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function dc(a,h){a.g?a.g.add(h):a.h=h}function Th(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Eh.prototype.cancel=function(){if(this.i=Sh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function Sh(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let h=a.i;for(const f of a.g.values())h=h.concat(f.G);return h}return b(a.i)}var Ah=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function B_(a,h){if(a){a=a.split("&");for(let f=0;f<a.length;f++){const g=a[f].indexOf("=");let C,k=null;g>=0?(C=a[f].substring(0,g),k=a[f].substring(g+1)):C=a[f],h(C,k?decodeURIComponent(k.replace(/\+/g," ")):"")}}}function un(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let h;a instanceof un?(this.l=a.l,ks(this,a.j),this.o=a.o,this.g=a.g,Ds(this,a.u),this.h=a.h,fc(this,kh(a.i)),this.m=a.m):a&&(h=String(a).match(Ah))?(this.l=!1,ks(this,h[1]||"",!0),this.o=Vs(h[2]||""),this.g=Vs(h[3]||"",!0),Ds(this,h[4]),this.h=Vs(h[5]||"",!0),fc(this,h[6]||"",!0),this.m=Vs(h[7]||"")):(this.l=!1,this.i=new Ls(null,this.l))}un.prototype.toString=function(){const a=[];var h=this.j;h&&a.push(Os(h,Rh,!0),":");var f=this.g;return(f||h=="file")&&(a.push("//"),(h=this.o)&&a.push(Os(h,Rh,!0),"@"),a.push(xs(f).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.u,f!=null&&a.push(":",String(f))),(f=this.h)&&(this.g&&f.charAt(0)!="/"&&a.push("/"),a.push(Os(f,f.charAt(0)=="/"?z_:$_,!0))),(f=this.i.toString())&&a.push("?",f),(f=this.m)&&a.push("#",Os(f,G_)),a.join("")},un.prototype.resolve=function(a){const h=At(this);let f=!!a.j;f?ks(h,a.j):f=!!a.o,f?h.o=a.o:f=!!a.g,f?h.g=a.g:f=a.u!=null;var g=a.h;if(f)Ds(h,a.u);else if(f=!!a.h){if(g.charAt(0)!="/")if(this.g&&!this.h)g="/"+g;else{var C=h.h.lastIndexOf("/");C!=-1&&(g=h.h.slice(0,C+1)+g)}if(C=g,C==".."||C==".")g="";else if(C.indexOf("./")!=-1||C.indexOf("/.")!=-1){g=C.lastIndexOf("/",0)==0,C=C.split("/");const k=[];for(let G=0;G<C.length;){const oe=C[G++];oe=="."?g&&G==C.length&&k.push(""):oe==".."?((k.length>1||k.length==1&&k[0]!="")&&k.pop(),g&&G==C.length&&k.push("")):(k.push(oe),g=!0)}g=k.join("/")}else g=C}return f?h.h=g:f=a.i.toString()!=="",f?fc(h,kh(a.i)):f=!!a.m,f&&(h.m=a.m),h};function At(a){return new un(a)}function ks(a,h,f){a.j=f?Vs(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function Ds(a,h){if(h){if(h=Number(h),isNaN(h)||h<0)throw Error("Bad port number "+h);a.u=h}else a.u=null}function fc(a,h,f){h instanceof Ls?(a.i=h,K_(a.i,a.l)):(f||(h=Os(h,H_)),a.i=new Ls(h,a.l))}function we(a,h,f){a.i.set(h,f)}function ao(a){return we(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function Vs(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Os(a,h,f){return typeof a=="string"?(a=encodeURI(a).replace(h,q_),f&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function q_(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Rh=/[#\/\?@]/g,$_=/[#\?:]/g,z_=/[#\?]/g,H_=/[#\?@]/g,G_=/#/g;function Ls(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function zn(a){a.g||(a.g=new Map,a.h=0,a.i&&B_(a.i,function(h,f){a.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}r=Ls.prototype,r.add=function(a,h){zn(this),this.i=null,a=Nr(this,a);let f=this.g.get(a);return f||this.g.set(a,f=[]),f.push(h),this.h+=1,this};function Ph(a,h){zn(a),h=Nr(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function Ch(a,h){return zn(a),h=Nr(a,h),a.g.has(h)}r.forEach=function(a,h){zn(this),this.g.forEach(function(f,g){f.forEach(function(C){a.call(h,C,g,this)},this)},this)};function xh(a,h){zn(a);let f=[];if(typeof h=="string")Ch(a,h)&&(f=f.concat(a.g.get(Nr(a,h))));else for(a=Array.from(a.g.values()),h=0;h<a.length;h++)f=f.concat(a[h]);return f}r.set=function(a,h){return zn(this),this.i=null,a=Nr(this,a),Ch(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},r.get=function(a,h){return a?(a=xh(this,a),a.length>0?String(a[0]):h):h};function Nh(a,h,f){Ph(a,h),f.length>0&&(a.i=null,a.g.set(Nr(a,h),b(f)),a.h+=f.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],h=Array.from(this.g.keys());for(let g=0;g<h.length;g++){var f=h[g];const C=xs(f);f=xh(this,f);for(let k=0;k<f.length;k++){let G=C;f[k]!==""&&(G+="="+xs(f[k])),a.push(G)}}return this.i=a.join("&")};function kh(a){const h=new Ls;return h.i=a.i,a.g&&(h.g=new Map(a.g),h.h=a.h),h}function Nr(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function K_(a,h){h&&!a.j&&(zn(a),a.i=null,a.g.forEach(function(f,g){const C=g.toLowerCase();g!=C&&(Ph(this,g),Nh(this,C,f))},a)),a.j=h}function W_(a,h){const f=new Cs;if(o.Image){const g=new Image;g.onload=d(hn,f,"TestLoadImage: loaded",!0,h,g),g.onerror=d(hn,f,"TestLoadImage: error",!1,h,g),g.onabort=d(hn,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=d(hn,f,"TestLoadImage: timeout",!1,h,g),o.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else h(!1)}function Q_(a,h){const f=new Cs,g=new AbortController,C=setTimeout(()=>{g.abort(),hn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:g.signal}).then(k=>{clearTimeout(C),k.ok?hn(f,"TestPingServer: ok",!0,h):hn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(C),hn(f,"TestPingServer: error",!1,h)})}function hn(a,h,f,g,C){try{C&&(C.onload=null,C.onerror=null,C.onabort=null,C.ontimeout=null),g(f)}catch{}}function Y_(){this.g=new k_}function mc(a){this.i=a.Sb||null,this.h=a.ab||!1}m(mc,ch),mc.prototype.g=function(){return new co(this.i,this.h)};function co(a,h){Se.call(this),this.H=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(co,Se),r=co.prototype,r.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=h,this.readyState=1,Fs(this)},r.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const h={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(h.body=a),(this.H||o).fetch(new Request(this.D,h)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ms(this)),this.readyState=0},r.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Fs(this)),this.g&&(this.readyState=3,Fs(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Dh(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function Dh(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}r.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.B.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?Ms(this):Fs(this),this.readyState==3&&Dh(this)}},r.Oa=function(a){this.g&&(this.response=this.responseText=a,Ms(this))},r.Na=function(a){this.g&&(this.response=a,Ms(this))},r.ga=function(){this.g&&Ms(this)};function Ms(a){a.readyState=4,a.l=null,a.j=null,a.B=null,Fs(a)}r.setRequestHeader=function(a,h){this.A.append(a,h)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,a.push(f[0]+": "+f[1]),f=h.next();return a.join(`\r
`)};function Fs(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(co.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Vh(a){let h="";return Xe(a,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function pc(a,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=Vh(f),typeof a=="string"?f!=null&&xs(f):we(a,h,f))}function Ne(a){Se.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(Ne,Se);var J_=/^https?$/i,X_=["POST","PUT"];r=Ne.prototype,r.Fa=function(a){this.H=a},r.ea=function(a,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ph.g(),this.g.onreadystatechange=p(u(this.Ca,this));try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(k){Oh(this,k);return}if(a=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var C in g)f.set(C,g[C]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const k of g.keys())f.set(k,g.get(k));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(k=>k.toLowerCase()=="content-type"),C=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(X_,h,void 0)>=0)||g||C||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[k,G]of f)this.g.setRequestHeader(k,G);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(k){Oh(this,k)}};function Oh(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.o=5,Lh(a),lo(a)}function Lh(a){a.A||(a.A=!0,Ke(a,"complete"),Ke(a,"error"))}r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,Ke(this,"complete"),Ke(this,"abort"),lo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),lo(this,!0)),Ne.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?Mh(this):this.Xa())},r.Xa=function(){Mh(this)};function Mh(a){if(a.h&&typeof i<"u"){if(a.v&&dn(a)==4)setTimeout(a.Ca.bind(a),0);else if(Ke(a,"readystatechange"),dn(a)==4){a.h=!1;try{const k=a.ca();e:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=k===0){let G=String(a.D).match(Ah)[1]||null;!G&&o.self&&o.self.location&&(G=o.self.location.protocol.slice(0,-1)),g=!J_.test(G?G.toLowerCase():"")}f=g}if(f)Ke(a,"complete"),Ke(a,"success");else{a.o=6;try{var C=dn(a)>2?a.g.statusText:""}catch{C=""}a.l=C+" ["+a.ca()+"]",Lh(a)}}finally{lo(a)}}}}function lo(a,h){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);const f=a.g;a.g=null,h||Ke(a,"ready");try{f.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function dn(a){return a.g?a.g.readyState:0}r.ca=function(){try{return dn(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),N_(h)}};function Fh(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Z_(a){const h={};a=(a.g&&dn(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(v(a[g]))continue;var f=M_(a[g]);const C=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const k=h[C]||[];h[C]=k,k.push(f)}Et(h,function(g){return g.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Us(a,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[a]||h}function Uh(a){this.za=0,this.i=[],this.j=new Cs,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Us("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Us("baseRetryDelayMs",5e3,a),this.Za=Us("retryDelaySeedMs",1e4,a),this.Ta=Us("forwardChannelMaxRetries",2,a),this.va=Us("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new Eh(a&&a.concurrentRequestLimit),this.Ba=new Y_,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=Uh.prototype,r.ka=8,r.I=1,r.connect=function(a,h,f,g){rt(0),this.W=a,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.J=Wh(this,null,this.W),ho(this)};function gc(a){if(jh(a),a.I==3){var h=a.V++,f=At(a.J);if(we(f,"SID",a.M),we(f,"RID",h),we(f,"TYPE","terminate"),js(a,f),h=new ln(a,a.j,h),h.M=2,h.A=ao(At(f)),f=!1,o.navigator&&o.navigator.sendBeacon)try{f=o.navigator.sendBeacon(h.A.toString(),"")}catch{}!f&&o.Image&&(new Image().src=h.A,f=!0),f||(h.g=Qh(h.j,null),h.g.ea(h.A)),h.F=Date.now(),oo(h)}Kh(a)}function uo(a){a.g&&(_c(a),a.g.cancel(),a.g=null)}function jh(a){uo(a),a.v&&(o.clearTimeout(a.v),a.v=null),fo(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&o.clearTimeout(a.m),a.m=null)}function ho(a){if(!Ih(a.h)&&!a.m){a.m=!0;var h=a.Ea;Q||E(),H||(Q(),H=!0),I.add(h,a),a.D=0}}function ev(a,h){return bh(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=h.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=Ps(u(a.Ea,a,h),Gh(a,a.D)),a.D++,!0)}r.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;const C=new ln(this,this.j,a);let k=this.o;if(this.U&&(k?(k=X(k),Bn(k,this.U)):k=this.U),this.u!==null||this.R||(C.J=k,k=null),this.S)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,h>4096){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=qh(this,C,h),f=At(this.J),we(f,"RID",a),we(f,"CVER",22),this.G&&we(f,"X-HTTP-Session-Id",this.G),js(this,f),k&&(this.R?h="headers="+xs(Vh(k))+"&"+h:this.u&&pc(f,this.u,k)),dc(this.h,C),this.Ra&&we(f,"TYPE","init"),this.S?(we(f,"$req",h),we(f,"SID","null"),C.U=!0,cc(C,f,null)):cc(C,f,h),this.I=2}}else this.I==3&&(a?Bh(this,a):this.i.length==0||Ih(this.h)||Bh(this))};function Bh(a,h){var f;h?f=h.l:f=a.V++;const g=At(a.J);we(g,"SID",a.M),we(g,"RID",f),we(g,"AID",a.K),js(a,g),a.u&&a.o&&pc(g,a.u,a.o),f=new ln(a,a.j,f,a.D+1),a.u===null&&(f.J=a.o),h&&(a.i=h.G.concat(a.i)),h=qh(a,f,1e3),f.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),dc(a.h,f),cc(f,g,h)}function js(a,h){a.H&&Xe(a.H,function(f,g){we(h,g,f)}),a.l&&Xe({},function(f,g){we(h,g,f)})}function qh(a,h,f){f=Math.min(a.i.length,f);const g=a.l?u(a.l.Ka,a.l,a):null;e:{var C=a.i;let oe=-1;for(;;){const Fe=["count="+f];oe==-1?f>0?(oe=C[0].g,Fe.push("ofs="+oe)):oe=0:Fe.push("ofs="+oe);let ve=!0;for(let $e=0;$e<f;$e++){var k=C[$e].g;const Rt=C[$e].map;if(k-=oe,k<0)oe=Math.max(0,C[$e].g-100),ve=!1;else try{k="req"+k+"_"||"";try{var G=Rt instanceof Map?Rt:Object.entries(Rt);for(const[Gn,fn]of G){let mn=fn;c(fn)&&(mn=rc(fn)),Fe.push(k+Gn+"="+encodeURIComponent(mn))}}catch(Gn){throw Fe.push(k+"type="+encodeURIComponent("_badmap")),Gn}}catch{g&&g(Rt)}}if(ve){G=Fe.join("&");break e}}G=void 0}return a=a.i.splice(0,f),h.G=a,G}function $h(a){if(!a.g&&!a.v){a.Y=1;var h=a.Da;Q||E(),H||(Q(),H=!0),I.add(h,a),a.A=0}}function yc(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=Ps(u(a.Da,a),Gh(a,a.A)),a.A++,!0)}r.Da=function(){if(this.v=null,zh(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=Ps(u(this.Wa,this),a)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,rt(10),uo(this),zh(this))};function _c(a){a.B!=null&&(o.clearTimeout(a.B),a.B=null)}function zh(a){a.g=new ln(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var h=At(a.na);we(h,"RID","rpc"),we(h,"SID",a.M),we(h,"AID",a.K),we(h,"CI",a.F?"0":"1"),!a.F&&a.ia&&we(h,"TO",a.ia),we(h,"TYPE","xmlhttp"),js(a,h),a.u&&a.o&&pc(h,a.u,a.o),a.O&&(a.g.H=a.O);var f=a.g;a=a.ba,f.M=1,f.A=ao(At(h)),f.u=null,f.R=!0,_h(f,a)}r.Va=function(){this.C!=null&&(this.C=null,uo(this),yc(this),rt(19))};function fo(a){a.C!=null&&(o.clearTimeout(a.C),a.C=null)}function Hh(a,h){var f=null;if(a.g==h){fo(a),_c(a),a.g=null;var g=2}else if(hc(a.h,h))f=h.G,Th(a.h,h),g=1;else return;if(a.I!=0){if(h.o)if(g==1){f=h.u?h.u.length:0,h=Date.now()-h.F;var C=a.D;g=so(),Ke(g,new fh(g,f)),ho(a)}else $h(a);else if(C=h.m,C==3||C==0&&h.X>0||!(g==1&&ev(a,h)||g==2&&yc(a)))switch(f&&f.length>0&&(h=a.h,h.i=h.i.concat(f)),C){case 1:Hn(a,5);break;case 4:Hn(a,10);break;case 3:Hn(a,6);break;default:Hn(a,2)}}}function Gh(a,h){let f=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(f*=2),f*h}function Hn(a,h){if(a.j.info("Error code "+h),h==2){var f=u(a.bb,a),g=a.Ua;const C=!g;g=new un(g||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||ks(g,"https"),ao(g),C?W_(g.toString(),f):Q_(g.toString(),f)}else rt(2);a.I=0,a.l&&a.l.pa(h),Kh(a),jh(a)}r.bb=function(a){a?(this.j.info("Successfully pinged google.com"),rt(2)):(this.j.info("Failed to ping google.com"),rt(1))};function Kh(a){if(a.I=0,a.ja=[],a.l){const h=Sh(a.h);(h.length!=0||a.i.length!=0)&&(R(a.ja,h),R(a.ja,a.i),a.h.i.length=0,b(a.i),a.i.length=0),a.l.oa()}}function Wh(a,h,f){var g=f instanceof un?At(f):new un(f);if(g.g!="")h&&(g.g=h+"."+g.g),Ds(g,g.u);else{var C=o.location;g=C.protocol,h=h?h+"."+C.hostname:C.hostname,C=+C.port;const k=new un(null);g&&ks(k,g),h&&(k.g=h),C&&Ds(k,C),f&&(k.h=f),g=k}return f=a.G,h=a.wa,f&&h&&we(g,f,h),we(g,"VER",a.ka),js(a,g),g}function Qh(a,h,f){if(h&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Aa&&!a.ma?new Ne(new mc({ab:f})):new Ne(a.ma),h.Fa(a.L),h}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Yh(){}r=Yh.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function mo(){}mo.prototype.g=function(a,h){return new ht(a,h)};function ht(a,h){Se.call(this),this.g=new Uh(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.sa&&(a?a["X-WebChannel-Client-Profile"]=h.sa:a={"X-WebChannel-Client-Profile":h.sa}),this.g.U=a,(a=h&&h.Qb)&&!v(a)&&(this.g.u=a),this.A=h&&h.supportsCrossDomainXhr||!1,this.v=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!v(h)&&(this.g.G=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new kr(this)}m(ht,Se),ht.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ht.prototype.close=function(){gc(this.g)},ht.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var f={};f.__data__=a,a=f}else this.v&&(f={},f.__data__=rc(a),a=f);h.i.push(new j_(h.Ya++,a)),h.I==3&&ho(h)},ht.prototype.N=function(){this.g.l=null,delete this.j,gc(this.g),delete this.g,ht.Z.N.call(this)};function Jh(a){sc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(const f in h){a=f;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}m(Jh,sc);function Xh(){ic.call(this),this.status=1}m(Xh,ic);function kr(a){this.g=a}m(kr,Yh),kr.prototype.ra=function(){Ke(this.g,"a")},kr.prototype.qa=function(a){Ke(this.g,new Jh(a))},kr.prototype.pa=function(a){Ke(this.g,new Xh)},kr.prototype.oa=function(){Ke(this.g,"b")},mo.prototype.createWebChannel=mo.prototype.g,ht.prototype.send=ht.prototype.o,ht.prototype.open=ht.prototype.m,ht.prototype.close=ht.prototype.close,kp=function(){return new mo},Np=function(){return so()},xp=qn,rl={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},io.NO_ERROR=0,io.TIMEOUT=8,io.HTTP_ERROR=6,ko=io,mh.COMPLETE="complete",Cp=mh,lh.EventType=As,As.OPEN="a",As.CLOSE="b",As.ERROR="c",As.MESSAGE="d",Se.prototype.listen=Se.prototype.J,Zs=lh,Ne.prototype.listenOnce=Ne.prototype.K,Ne.prototype.getLastError=Ne.prototype.Ha,Ne.prototype.getLastErrorCode=Ne.prototype.ya,Ne.prototype.getStatus=Ne.prototype.ca,Ne.prototype.getResponseJson=Ne.prototype.La,Ne.prototype.getResponseText=Ne.prototype.la,Ne.prototype.send=Ne.prototype.ea,Ne.prototype.setWithCredentials=Ne.prototype.Fa,Pp=Ne}).apply(typeof wo<"u"?wo:typeof self<"u"?self:typeof window<"u"?window:{});const Ld="@firebase/firestore",Md="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qe.UNAUTHENTICATED=new Qe(null),Qe.GOOGLE_CREDENTIALS=new Qe("google-credentials-uid"),Qe.FIRST_PARTY=new Qe("first-party-uid"),Qe.MOCK_USER=new Qe("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ms="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mr=new Kl("@firebase/firestore");function Br(){return mr.logLevel}function q(r,...e){if(mr.logLevel<=le.DEBUG){const t=e.map(Yl);mr.debug(`Firestore (${ms}): ${r}`,...t)}}function it(r,...e){if(mr.logLevel<=le.ERROR){const t=e.map(Yl);mr.error(`Firestore (${ms}): ${r}`,...t)}}function pr(r,...e){if(mr.logLevel<=le.WARN){const t=e.map(Yl);mr.warn(`Firestore (${ms}): ${r}`,...t)}}function Yl(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,Dp(r,n,t)}function Dp(r,e,t){let n=`FIRESTORE (${ms}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw it(n),new Error(n)}function J(r,e,t,n){let s="Unexpected state";typeof t=="string"?s=t:n=t,r||Dp(e,s,n)}function ne(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class z extends rn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class wS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Qe.UNAUTHENTICATED)))}shutdown(){}}class ES{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class IS{constructor(e){this.t=e,this.currentUser=Qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){J(this.o===void 0,42304);let n=this.i;const s=l=>this.i!==n?(n=this.i,t(l)):Promise.resolve();let i=new Lt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Lt,e.enqueueRetryable((()=>s(this.currentUser)))};const o=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},c=l=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((l=>c(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?c(l):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Lt)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(J(typeof n.accessToken=="string",31837,{l:n}),new Vp(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return J(e===null||typeof e=="string",2055,{h:e}),new Qe(e)}}class bS{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Qe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class TS{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new bS(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Qe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Fd{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class SS{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,lt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){J(this.o===void 0,3512);const n=i=>{i.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>n(i)))};const s=i=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Fd(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(J(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Fd(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AS(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=AS(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+=e.charAt(s[i]%62))}return n}}function se(r,e){return r<e?-1:r>e?1:0}function sl(r,e){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++){const s=r.charAt(n),i=e.charAt(n);if(s!==i)return xc(s)===xc(i)?se(s,i):xc(s)?1:-1}return se(r.length,e.length)}const RS=55296,PS=57343;function xc(r){const e=r.charCodeAt(0);return e>=RS&&e<=PS}function Jr(r,e,t){return r.length===e.length&&r.every(((n,s)=>t(n,e[s])))}function Op(r){return r+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ud="__name__";class kt{constructor(e,t,n){t===void 0?t=0:t>e.length&&Y(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&Y(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return kt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof kt?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const i=kt.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return se(e.length,t.length)}static compareSegments(e,t){const n=kt.isNumericId(e),s=kt.isNumericId(t);return n&&!s?-1:!n&&s?1:n&&s?kt.extractNumericId(e).compare(kt.extractNumericId(t)):sl(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Pn.fromString(e.substring(4,e.length-2))}}class fe extends kt{construct(e,t,n){return new fe(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new z(O.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((s=>s.length>0)))}return new fe(t)}static emptyPath(){return new fe([])}}const CS=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pe extends kt{construct(e,t,n){return new Pe(e,t,n)}static isValidIdentifier(e){return CS.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Pe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ud}static keyField(){return new Pe([Ud])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(n.length===0)throw new z(O.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new z(O.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new z(O.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=l,s+=2}else c==="`"?(o=!o,s++):c!=="."||o?(n+=c,s++):(i(),s++)}if(i(),o)throw new z(O.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Pe(t)}static emptyPath(){return new Pe([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(e){this.path=e}static fromPath(e){return new K(fe.fromString(e))}static fromName(e){return new K(fe.fromString(e).popFirst(5))}static empty(){return new K(fe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&fe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return fe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new K(new fe(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lp(r,e,t){if(!t)throw new z(O.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function xS(r,e,t,n){if(e===!0&&n===!0)throw new z(O.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function jd(r){if(!K.isDocumentKey(r))throw new z(O.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Bd(r){if(K.isDocumentKey(r))throw new z(O.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Mp(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Na(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":Y(12329,{type:typeof r})}function He(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new z(O.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Na(r);throw new z(O.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function NS(r,e){if(e<=0)throw new z(O.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Le(r,e){const t={typeString:r};return e&&(t.value=e),t}function ji(r,e){if(!Mp(r))throw new z(O.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const s=e[n].typeString,i="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}const o=r[n];if(s&&typeof o!==s){t=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${n}' field to equal '${i.value}'`;break}}if(t)throw new z(O.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qd=-62135596800,$d=1e6;class pe{static now(){return pe.fromMillis(Date.now())}static fromDate(e){return pe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*$d);return new pe(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new z(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new z(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<qd)throw new z(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new z(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$d}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:pe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ji(e,pe._jsonSchema))return new pe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-qd;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}pe._jsonSchemaVersion="firestore/timestamp/1.0",pe._jsonSchema={type:Le("string",pe._jsonSchemaVersion),seconds:Le("number"),nanoseconds:Le("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z{static fromTimestamp(e){return new Z(e)}static min(){return new Z(new pe(0,0))}static max(){return new Z(new pe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ei=-1;class na{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}}function il(r){return r.fields.find((e=>e.kind===2))}function Qn(r){return r.fields.filter((e=>e.kind!==2))}na.UNKNOWN_ID=-1;class Do{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ii{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ii(0,mt.min())}}function kS(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=Z.fromTimestamp(n===1e9?new pe(t+1,0):new pe(t,n));return new mt(s,K.empty(),e)}function Fp(r){return new mt(r.readTime,r.key,Ei)}class mt{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new mt(Z.min(),K.empty(),Ei)}static max(){return new mt(Z.max(),K.empty(),Ei)}}function Xl(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=K.comparator(r.documentKey,e.documentKey),t!==0?t:se(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class jp{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rr(r){if(r.code!==O.FAILED_PRECONDITION||r.message!==Up)throw r;q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Y(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,n)=>{t(e)}))}static reject(e){return new P(((t,n)=>{n(e)}))}static waitFor(e){return new P(((t,n)=>{let s=0,i=0,o=!1;e.forEach((c=>{++s,c.next((()=>{++i,o&&i===s&&t()}),(l=>n(l)))})),o=!0,i===s&&t()}))}static or(e){let t=P.resolve(!1);for(const n of e)t=t.next((s=>s?P.resolve(s):n()));return t}static forEach(e,t){const n=[];return e.forEach(((s,i)=>{n.push(t.call(this,s,i))})),this.waitFor(n)}static mapArray(e,t){return new P(((n,s)=>{const i=e.length,o=new Array(i);let c=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next((d=>{o[u]=d,++c,c===i&&n(o)}),(d=>s(d)))}}))}static doWhile(e,t){return new P(((n,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):n()};i()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dt="SimpleDb";class ka{static open(e,t,n,s){try{return new ka(t,e.transaction(s,n))}catch(i){throw new ui(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Lt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new ui(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{const s=Zl(n.target.error);this.S.reject(new ui(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(q(dt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new VS(t)}}class Cn{static delete(e){return q(dt,"Removing database:",e),er(hp().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!wp())return!1;if(Cn.F())return!0;const e=je(),t=Cn.M(e),n=0<t&&t<10,s=Bp(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,Cn.M(je())===12.2&&it("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(q(dt,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{n(new ui(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?n(new z(O.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new z(O.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new ui(e,o))},s.onupgradeneeded=i=>{q(dt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next((()=>{q(dt,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const c=ka.open(this.db,e,i?"readonly":"readwrite",n),l=s(c).next((u=>(c.C(),u))).catch((u=>(c.abort(u),P.reject(u)))).toPromise();return l.catch((()=>{})),await c.D,l}catch(c){const l=c,u=l.name!=="FirebaseError"&&o<3;if(q(dt,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Bp(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class DS{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return er(this.U.delete())}}class ui extends z{constructor(e,t){super(O.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Mn(r){return r.name==="IndexedDbTransactionError"}class VS{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(q(dt,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(q(dt,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),er(n)}add(e){return q(dt,"ADD",this.store.name,e,e),er(this.store.add(e))}get(e){return er(this.store.get(e)).next((t=>(t===void 0&&(t=null),q(dt,"GET",this.store.name,e,t),t)))}delete(e){return q(dt,"DELETE",this.store.name,e),er(this.store.delete(e))}count(){return q(dt,"COUNT",this.store.name),er(this.store.count())}J(e,t){const n=this.options(e,t),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(n.range);return new P(((o,c)=>{i.onerror=l=>{c(l.target.error)},i.onsuccess=l=>{o(l.target.result)}}))}{const i=this.cursor(n),o=[];return this.H(i,((c,l)=>{o.push(l)})).next((()=>o))}}Y(e,t){const n=this.store.getAll(e,t===null?void 0:t);return new P(((s,i)=>{n.onerror=o=>{i(o.target.error)},n.onsuccess=o=>{s(o.target.result)}}))}Z(e,t){q(dt,"DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const s=this.cursor(n);return this.H(s,((i,o,c)=>c.delete()))}ee(e,t){let n;t?n=e:(n={},t=e);const s=this.cursor(n);return this.H(s,t)}te(e){const t=this.cursor({});return new P(((n,s)=>{t.onerror=i=>{const o=Zl(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next((c=>{c?o.continue():n()})):n()}}))}H(e,t){const n=[];return new P(((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const c=o.target.result;if(!c)return void s();const l=new DS(c),u=t(c.primaryKey,c.value,l);if(u instanceof P){const d=u.catch((m=>(l.done(),P.reject(m))));n.push(d)}l.isDone?s():l.G===null?c.continue():c.continue(l.G)}})).next((()=>P.waitFor(n)))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function er(r){return new P(((e,t)=>{r.onsuccess=n=>{const s=n.target.result;e(s)},r.onerror=n=>{const s=Zl(n.target.error);t(s)}}))}let zd=!1;function Zl(r){const e=Cn.M(je());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return zd||(zd=!0,setTimeout((()=>{throw n}),0)),n}}return r}const hi="IndexBackfiller";class OS{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){q(hi,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();q(hi,`Documents written: ${t}`)}catch(t){Mn(t)?q(hi,"Ignoring IndexedDB error during index backfill: ",t):await Rr(t)}await this.re(6e4)}))}}class LS{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const n=new Set;let s=t,i=!0;return P.doWhile((()=>i===!0&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((o=>{if(o!==null&&!n.has(o))return q(hi,`Processing collection: ${o}`),this.oe(e,o,s).next((c=>{s-=c,n.add(o)}));i=!1})))).next((()=>t-s))}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((s=>this.localStore.localDocuments.getNextDocuments(e,t,s,n).next((i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next((()=>this._e(s,i))).next((c=>(q(hi,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c)))).next((()=>o.size))}))))}_e(e,t){let n=e;return t.changes.forEach(((s,i)=>{const o=Fp(i);Xl(o,n)>0&&(n=o)})),new mt(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}_t.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cr=-1;function Da(r){return r==null}function bi(r){return r===0&&1/r==-1/0}function MS(r){return typeof r=="number"&&Number.isInteger(r)&&!bi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ra="";function nt(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Hd(e)),e=FS(r.get(t),e);return Hd(e)}function FS(r,e){let t=e;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":t+="";break;case ra:t+="";break;default:t+=i}}return t}function Hd(r){return r+ra+""}function Vt(r){const e=r.length;if(J(e>=2,64408,{path:r}),e===2)return J(r.charAt(0)===ra&&r.charAt(1)==="",56145,{path:r}),fe.emptyPath();const t=e-2,n=[];let s="";for(let i=0;i<e;){const o=r.indexOf(ra,i);switch((o<0||o>t)&&Y(50515,{path:r}),r.charAt(o+1)){case"":const c=r.substring(i,o);let l;s.length===0?l=c:(s+=c,l=s,s=""),n.push(l);break;case"":s+=r.substring(i,o),s+="\0";break;case"":s+=r.substring(i,o+1);break;default:Y(61167,{path:r})}i=o+2}return new fe(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yn="remoteDocuments",Bi="owner",Or="owner",Ti="mutationQueues",US="userId",bt="mutations",Gd="batchId",or="userMutationsIndex",Kd=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vo(r,e){return[r,nt(e)]}function qp(r,e,t){return[r,nt(e),t]}const jS={},Xr="documentMutations",sa="remoteDocumentsV14",BS=["prefixPath","collectionGroup","readTime","documentId"],Oo="documentKeyIndex",qS=["prefixPath","collectionGroup","documentId"],$p="collectionGroupIndex",$S=["collectionGroup","readTime","prefixPath","documentId"],Si="remoteDocumentGlobal",ol="remoteDocumentGlobalKey",Zr="targets",zp="queryTargetsIndex",zS=["canonicalId","targetId"],es="targetDocuments",HS=["targetId","path"],eu="documentTargetsIndex",GS=["path","targetId"],ia="targetGlobalKey",lr="targetGlobal",Ai="collectionParents",KS=["collectionId","parent"],ts="clientMetadata",WS="clientId",Va="bundles",QS="bundleId",Oa="namedQueries",YS="name",tu="indexConfiguration",JS="indexId",al="collectionGroupIndex",XS="collectionGroup",di="indexState",ZS=["indexId","uid"],Hp="sequenceNumberIndex",eA=["uid","sequenceNumber"],fi="indexEntries",tA=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Gp="documentKeyIndex",nA=["indexId","uid","orderedDocumentKey"],La="documentOverlays",rA=["userId","collectionPath","documentId"],cl="collectionPathOverlayIndex",sA=["userId","collectionPath","largestBatchId"],Kp="collectionGroupOverlayIndex",iA=["userId","collectionGroup","largestBatchId"],nu="globals",oA="name",Wp=[Ti,bt,Xr,Yn,Zr,Bi,lr,es,ts,Si,Ai,Va,Oa],aA=[...Wp,La],Qp=[Ti,bt,Xr,sa,Zr,Bi,lr,es,ts,Si,Ai,Va,Oa,La],Yp=Qp,ru=[...Yp,tu,di,fi],cA=ru,Jp=[...ru,nu],lA=Jp;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll extends jp{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Be(r,e){const t=ne(r);return Cn.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Fn(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Xp(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e,t){this.comparator=e,this.root=t||Ye.EMPTY}insert(e,t){return new be(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ye.BLACK,null,null))}remove(e){return new be(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ye.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Eo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Eo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Eo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Eo(this.root,e,this.comparator,!0)}}class Eo{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ye{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=n??Ye.RED,this.left=s??Ye.EMPTY,this.right=i??Ye.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Ye(e??this.key,t??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ye.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ye.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ye.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ye.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Y(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Y(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Y(27949);return e+(this.isRed()?0:1)}}Ye.EMPTY=null,Ye.RED=!0,Ye.BLACK=!1;Ye.EMPTY=new class{constructor(){this.size=0}get key(){throw Y(57766)}get value(){throw Y(16141)}get color(){throw Y(16727)}get left(){throw Y(29726)}get right(){throw Y(36894)}copy(e,t,n,s,i){return this}insert(e,t,n){return new Ye(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{constructor(e){this.comparator=e,this.data=new be(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Qd(this.data.getIterator())}getIteratorFrom(e){return new Qd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof ye)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ye(this.comparator);return t.data=e,t}}class Qd{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Lr(r){return r.hasNext()?r.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ut{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new ut([])}unionWith(e){let t=new ye(Pe.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ut(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Jr(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Zp("Invalid base64 string: "+i):i}})(e);return new Me(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i})(e);return new Me(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Me.EMPTY_BYTE_STRING=new Me("");const uA=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zt(r){if(J(!!r,39018),typeof r=="string"){let e=0;const t=uA.exec(r);if(J(!!t,46558,{timestamp:r}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ie(r.seconds),nanos:Ie(r.nanos)}}function Ie(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function en(r){return typeof r=="string"?Me.fromBase64String(r):Me.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eg="server_timestamp",tg="__type__",ng="__previous_value__",rg="__local_write_time__";function su(r){var t,n;return((n=(((t=r==null?void 0:r.mapValue)==null?void 0:t.fields)||{})[tg])==null?void 0:n.stringValue)===eg}function Ma(r){const e=r.mapValue.fields[ng];return su(e)?Ma(e):e}function Ri(r){const e=Zt(r.mapValue.fields[rg].timestampValue);return new pe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{constructor(e,t,n,s,i,o,c,l,u,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=d}}const oa="(default)";class gr{constructor(e,t){this.projectId=e,this.database=t||oa}static empty(){return new gr("","")}get isDefaultDatabase(){return this.database===oa}isEqual(e){return e instanceof gr&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iu="__type__",sg="__max__",Tn={mapValue:{fields:{__type__:{stringValue:sg}}}},ou="__vector__",ns="value",Lo={nullValue:"NULL_VALUE"};function Dn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?su(r)?4:ig(r)?9007199254740991:Fa(r)?10:11:Y(28295,{value:r})}function Bt(r,e){if(r===e)return!0;const t=Dn(r);if(t!==Dn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Ri(r).isEqual(Ri(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Zt(s.timestampValue),c=Zt(i.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos})(r,e);case 5:return r.stringValue===e.stringValue;case 6:return(function(s,i){return en(s.bytesValue).isEqual(en(i.bytesValue))})(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return(function(s,i){return Ie(s.geoPointValue.latitude)===Ie(i.geoPointValue.latitude)&&Ie(s.geoPointValue.longitude)===Ie(i.geoPointValue.longitude)})(r,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return Ie(s.integerValue)===Ie(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Ie(s.doubleValue),c=Ie(i.doubleValue);return o===c?bi(o)===bi(c):isNaN(o)&&isNaN(c)}return!1})(r,e);case 9:return Jr(r.arrayValue.values||[],e.arrayValue.values||[],Bt);case 10:case 11:return(function(s,i){const o=s.mapValue.fields||{},c=i.mapValue.fields||{};if(Wd(o)!==Wd(c))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(c[l]===void 0||!Bt(o[l],c[l])))return!1;return!0})(r,e);default:return Y(52216,{left:r})}}function Pi(r,e){return(r.values||[]).find((t=>Bt(t,e)))!==void 0}function Vn(r,e){if(r===e)return 0;const t=Dn(r),n=Dn(e);if(t!==n)return se(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(r.booleanValue,e.booleanValue);case 2:return(function(i,o){const c=Ie(i.integerValue||i.doubleValue),l=Ie(o.integerValue||o.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1})(r,e);case 3:return Yd(r.timestampValue,e.timestampValue);case 4:return Yd(Ri(r),Ri(e));case 5:return sl(r.stringValue,e.stringValue);case 6:return(function(i,o){const c=en(i),l=en(o);return c.compareTo(l)})(r.bytesValue,e.bytesValue);case 7:return(function(i,o){const c=i.split("/"),l=o.split("/");for(let u=0;u<c.length&&u<l.length;u++){const d=se(c[u],l[u]);if(d!==0)return d}return se(c.length,l.length)})(r.referenceValue,e.referenceValue);case 8:return(function(i,o){const c=se(Ie(i.latitude),Ie(o.latitude));return c!==0?c:se(Ie(i.longitude),Ie(o.longitude))})(r.geoPointValue,e.geoPointValue);case 9:return Jd(r.arrayValue,e.arrayValue);case 10:return(function(i,o){var p,b,R,A;const c=i.fields||{},l=o.fields||{},u=(p=c[ns])==null?void 0:p.arrayValue,d=(b=l[ns])==null?void 0:b.arrayValue,m=se(((R=u==null?void 0:u.values)==null?void 0:R.length)||0,((A=d==null?void 0:d.values)==null?void 0:A.length)||0);return m!==0?m:Jd(u,d)})(r.mapValue,e.mapValue);case 11:return(function(i,o){if(i===Tn.mapValue&&o===Tn.mapValue)return 0;if(i===Tn.mapValue)return 1;if(o===Tn.mapValue)return-1;const c=i.fields||{},l=Object.keys(c),u=o.fields||{},d=Object.keys(u);l.sort(),d.sort();for(let m=0;m<l.length&&m<d.length;++m){const p=sl(l[m],d[m]);if(p!==0)return p;const b=Vn(c[l[m]],u[d[m]]);if(b!==0)return b}return se(l.length,d.length)})(r.mapValue,e.mapValue);default:throw Y(23264,{he:t})}}function Yd(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return se(r,e);const t=Zt(r),n=Zt(e),s=se(t.seconds,n.seconds);return s!==0?s:se(t.nanos,n.nanos)}function Jd(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const i=Vn(t[s],n[s]);if(i)return i}return se(t.length,n.length)}function rs(r){return ul(r)}function ul(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(t){const n=Zt(t);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(t){return en(t).toBase64()})(r.bytesValue):"referenceValue"in r?(function(t){return K.fromName(t).toString()})(r.referenceValue):"geoPointValue"in r?(function(t){return`geo(${t.latitude},${t.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(t){let n="[",s=!0;for(const i of t.values||[])s?s=!1:n+=",",n+=ul(i);return n+"]"})(r.arrayValue):"mapValue"in r?(function(t){const n=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of n)i?i=!1:s+=",",s+=`${o}:${ul(t.fields[o])}`;return s+"}"})(r.mapValue):Y(61005,{value:r})}function Mo(r){switch(Dn(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ma(r);return e?16+Mo(e):16;case 5:return 2*r.stringValue.length;case 6:return en(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((s,i)=>s+Mo(i)),0)})(r.arrayValue);case 10:case 11:return(function(n){let s=0;return Fn(n.fields,((i,o)=>{s+=i.length+Mo(o)})),s})(r.mapValue);default:throw Y(13486,{value:r})}}function Ci(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function hl(r){return!!r&&"integerValue"in r}function xi(r){return!!r&&"arrayValue"in r}function Xd(r){return!!r&&"nullValue"in r}function Zd(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Fo(r){return!!r&&"mapValue"in r}function Fa(r){var t,n;return((n=(((t=r==null?void 0:r.mapValue)==null?void 0:t.fields)||{})[iu])==null?void 0:n.stringValue)===ou}function mi(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return Fn(r.mapValue.fields,((t,n)=>e.mapValue.fields[t]=mi(n))),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=mi(r.arrayValue.values[t]);return e}return{...r}}function ig(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===sg}const og={mapValue:{fields:{[iu]:{stringValue:ou},[ns]:{arrayValue:{}}}}};function dA(r){return"nullValue"in r?Lo:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Ci(gr.empty(),K.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Fa(r)?og:{mapValue:{}}:Y(35942,{value:r})}function fA(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Ci(gr.empty(),K.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?og:"mapValue"in r?Fa(r)?{mapValue:{}}:Tn:Y(61959,{value:r})}function ef(r,e){const t=Vn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function tf(r,e){const t=Vn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e){this.value=e}static empty(){return new tt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Fo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=mi(t)}setAll(e){let t=Pe.emptyPath(),n={},s=[];e.forEach(((o,c)=>{if(!t.isImmediateParentOf(c)){const l=this.getFieldsMap(t);this.applyChanges(l,n,s),n={},s=[],t=c.popLast()}o?n[c.lastSegment()]=mi(o):s.push(c.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());Fo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Bt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];Fo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Fn(t,((s,i)=>e[s]=i));for(const s of n)delete e[s]}clone(){return new tt(mi(this.value))}}function ag(r){const e=[];return Fn(r.fields,((t,n)=>{const s=new Pe([t]);if(Fo(n)){const i=ag(n.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)})),new ut(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(e,t,n,s,i,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=o,this.documentState=c}static newInvalidDocument(e){return new ke(e,0,Z.min(),Z.min(),Z.min(),tt.empty(),0)}static newFoundDocument(e,t,n,s){return new ke(e,1,t,Z.min(),n,s,0)}static newNoDocument(e,t){return new ke(e,2,t,Z.min(),Z.min(),tt.empty(),0)}static newUnknownDocument(e,t){return new ke(e,3,t,Z.min(),Z.min(),tt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ke&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ke(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(e,t){this.position=e,this.inclusive=t}}function nf(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const i=e[s],o=r.position[s];if(i.field.isKeyField()?n=K.comparator(K.fromName(o.referenceValue),t.key):n=Vn(o,t.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function rf(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Bt(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni{constructor(e,t="asc"){this.field=e,this.dir=t}}function mA(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{}class ue extends cg{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new pA(e,t,n):t==="array-contains"?new _A(e,n):t==="in"?new mg(e,n):t==="not-in"?new vA(e,n):t==="array-contains-any"?new wA(e,n):new ue(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new gA(e,n):new yA(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Vn(t,this.value)):t!==null&&Dn(this.value)===Dn(t)&&this.matchesComparison(Vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Y(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ge extends cg{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ge(e,t)}matches(e){return is(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function is(r){return r.op==="and"}function dl(r){return r.op==="or"}function au(r){return lg(r)&&is(r)}function lg(r){for(const e of r.filters)if(e instanceof ge)return!1;return!0}function fl(r){if(r instanceof ue)return r.field.canonicalString()+r.op.toString()+rs(r.value);if(au(r))return r.filters.map((e=>fl(e))).join(",");{const e=r.filters.map((t=>fl(t))).join(",");return`${r.op}(${e})`}}function ug(r,e){return r instanceof ue?(function(n,s){return s instanceof ue&&n.op===s.op&&n.field.isEqual(s.field)&&Bt(n.value,s.value)})(r,e):r instanceof ge?(function(n,s){return s instanceof ge&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce(((i,o,c)=>i&&ug(o,s.filters[c])),!0):!1})(r,e):void Y(19439)}function hg(r,e){const t=r.filters.concat(e);return ge.create(t,r.op)}function dg(r){return r instanceof ue?(function(t){return`${t.field.canonicalString()} ${t.op} ${rs(t.value)}`})(r):r instanceof ge?(function(t){return t.op.toString()+" {"+t.getFilters().map(dg).join(" ,")+"}"})(r):"Filter"}class pA extends ue{constructor(e,t,n){super(e,t,n),this.key=K.fromName(n.referenceValue)}matches(e){const t=K.comparator(e.key,this.key);return this.matchesComparison(t)}}class gA extends ue{constructor(e,t){super(e,"in",t),this.keys=fg("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class yA extends ue{constructor(e,t){super(e,"not-in",t),this.keys=fg("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function fg(r,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((n=>K.fromName(n.referenceValue)))}class _A extends ue{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return xi(t)&&Pi(t.arrayValue,this.value)}}class mg extends ue{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Pi(this.value.arrayValue,t)}}class vA extends ue{constructor(e,t){super(e,"not-in",t)}matches(e){if(Pi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Pi(this.value.arrayValue,t)}}class wA extends ue{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!xi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>Pi(this.value.arrayValue,n)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(e,t=null,n=[],s=[],i=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=o,this.endAt=c,this.Te=null}}function ml(r,e=null,t=[],n=[],s=null,i=null,o=null){return new EA(r,e,t,n,s,i,o)}function yr(r){const e=ne(r);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>fl(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(i){return i.field.canonicalString()+i.dir})(n))).join(","),Da(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>rs(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>rs(n))).join(",")),e.Te=t}return e.Te}function qi(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!mA(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!ug(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!rf(r.startAt,e.startAt)&&rf(r.endAt,e.endAt)}function aa(r){return K.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function ca(r,e){return r.filters.filter((t=>t instanceof ue&&t.field.isEqual(e)))}function sf(r,e,t){let n=Lo,s=!0;for(const i of ca(r,e)){let o=Lo,c=!0;switch(i.op){case"<":case"<=":o=dA(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,c=!1;break;case"!=":case"not-in":o=Lo}ef({value:n,inclusive:s},{value:o,inclusive:c})<0&&(n=o,s=c)}if(t!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(e)){const o=t.position[i];ef({value:n,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(n=o,s=t.inclusive);break}}return{value:n,inclusive:s}}function of(r,e,t){let n=Tn,s=!0;for(const i of ca(r,e)){let o=Tn,c=!0;switch(i.op){case">=":case">":o=fA(i.value),c=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,c=!1;break;case"!=":case"not-in":o=Tn}tf({value:n,inclusive:s},{value:o,inclusive:c})>0&&(n=o,s=c)}if(t!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(e)){const o=t.position[i];tf({value:n,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(n=o,s=t.inclusive);break}}return{value:n,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e,t=null,n=[],s=[],i=null,o="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=o,this.startAt=c,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function IA(r,e,t,n,s,i,o,c){return new ps(r,e,t,n,s,i,o,c)}function $i(r){return new ps(r)}function af(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function pg(r){return r.collectionGroup!==null}function pi(r){const e=ne(r);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new ye(Pe.comparator);return o.filters.forEach((l=>{l.getFlattenedFilters().forEach((u=>{u.isInequality()&&(c=c.add(u.field))}))})),c})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Ni(i,n))})),t.has(Pe.keyField().canonicalString())||e.Ie.push(new Ni(Pe.keyField(),n))}return e.Ie}function vt(r){const e=ne(r);return e.Ee||(e.Ee=bA(e,pi(r))),e.Ee}function bA(r,e){if(r.limitType==="F")return ml(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Ni(s.field,i)}));const t=r.endAt?new ss(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new ss(r.startAt.position,r.startAt.inclusive):null;return ml(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function pl(r,e){const t=r.filters.concat([e]);return new ps(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function la(r,e,t){return new ps(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Ua(r,e){return qi(vt(r),vt(e))&&r.limitType===e.limitType}function gg(r){return`${yr(vt(r))}|lt:${r.limitType}`}function qr(r){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((s=>dg(s))).join(", ")}]`),Da(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((s=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(s))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((s=>rs(s))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((s=>rs(s))).join(",")),`Target(${n})`})(vt(r))}; limitType=${r.limitType})`}function zi(r,e){return e.isFoundDocument()&&(function(n,s){const i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):K.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)})(r,e)&&(function(n,s){for(const i of pi(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(r,e)&&(function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0})(r,e)&&(function(n,s){return!(n.startAt&&!(function(o,c,l){const u=nf(o,c,l);return o.inclusive?u<=0:u<0})(n.startAt,pi(n),s)||n.endAt&&!(function(o,c,l){const u=nf(o,c,l);return o.inclusive?u>=0:u>0})(n.endAt,pi(n),s))})(r,e)}function TA(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function yg(r){return(e,t)=>{let n=!1;for(const s of pi(r)){const i=SA(s,e,t);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function SA(r,e,t){const n=r.field.isKeyField()?K.comparator(e.key,t.key):(function(i,o,c){const l=o.data.field(i),u=c.data.field(i);return l!==null&&u!==null?Vn(l,u):Y(42886)})(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Y(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[s,i]of n)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return n.length===1?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Fn(this.inner,((t,n)=>{for(const[s,i]of n)e(s,i)}))}isEmpty(){return Xp(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AA=new be(K.comparator);function ft(){return AA}const _g=new be(K.comparator);function ei(...r){let e=_g;for(const t of r)e=e.insert(t.key,t);return e}function vg(r){let e=_g;return r.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Ot(){return gi()}function wg(){return gi()}function gi(){return new sn((r=>r.toString()),((r,e)=>r.isEqual(e)))}const RA=new be(K.comparator),PA=new ye(K.comparator);function ae(...r){let e=PA;for(const t of r)e=e.add(t);return e}const CA=new ye(se);function xA(){return CA}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cu(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bi(e)?"-0":e}}function Eg(r){return{integerValue:""+r}}function Ig(r,e){return MS(e)?Eg(e):cu(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(){this._=void 0}}function NA(r,e,t){return r instanceof os?(function(s,i){const o={fields:{[tg]:{stringValue:eg},[rg]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&su(i)&&(i=Ma(i)),i&&(o.fields[ng]=i),{mapValue:o}})(t,e):r instanceof _r?Tg(r,e):r instanceof as?Sg(r,e):(function(s,i){const o=bg(s,i),c=cf(o)+cf(s.Ae);return hl(o)&&hl(s.Ae)?Eg(c):cu(s.serializer,c)})(r,e)}function kA(r,e,t){return r instanceof _r?Tg(r,e):r instanceof as?Sg(r,e):t}function bg(r,e){return r instanceof cs?(function(n){return hl(n)||(function(i){return!!i&&"doubleValue"in i})(n)})(e)?e:{integerValue:0}:null}class os extends ja{}class _r extends ja{constructor(e){super(),this.elements=e}}function Tg(r,e){const t=Ag(e);for(const n of r.elements)t.some((s=>Bt(s,n)))||t.push(n);return{arrayValue:{values:t}}}class as extends ja{constructor(e){super(),this.elements=e}}function Sg(r,e){let t=Ag(e);for(const n of r.elements)t=t.filter((s=>!Bt(s,n)));return{arrayValue:{values:t}}}class cs extends ja{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function cf(r){return Ie(r.integerValue||r.doubleValue)}function Ag(r){return xi(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e,t){this.field=e,this.transform=t}}function DA(r,e){return r.field.isEqual(e.field)&&(function(n,s){return n instanceof _r&&s instanceof _r||n instanceof as&&s instanceof as?Jr(n.elements,s.elements,Bt):n instanceof cs&&s instanceof cs?Bt(n.Ae,s.Ae):n instanceof os&&s instanceof os})(r.transform,e.transform)}class VA{constructor(e,t){this.version=e,this.transformResults=t}}class Ue{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ue}static exists(e){return new Ue(void 0,e)}static updateTime(e){return new Ue(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Uo(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class qa{}function Rg(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Hi(r.key,Ue.none()):new gs(r.key,r.data,Ue.none());{const t=r.data,n=tt.empty();let s=new ye(Pe.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?n.delete(i):n.set(i,o),s=s.add(i)}return new on(r.key,n,new ut(s.toArray()),Ue.none())}}function OA(r,e,t){r instanceof gs?(function(s,i,o){const c=s.value.clone(),l=uf(s.fieldTransforms,i,o.transformResults);c.setAll(l),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(r,e,t):r instanceof on?(function(s,i,o){if(!Uo(s.precondition,i))return void i.convertToUnknownDocument(o.version);const c=uf(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Pg(s)),l.setAll(c),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(r,e,t):(function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function yi(r,e,t,n){return r instanceof gs?(function(i,o,c,l){if(!Uo(i.precondition,o))return c;const u=i.value.clone(),d=hf(i.fieldTransforms,l,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(r,e,t,n):r instanceof on?(function(i,o,c,l){if(!Uo(i.precondition,o))return c;const u=hf(i.fieldTransforms,l,o),d=o.data;return d.setAll(Pg(i)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((m=>m.field)))})(r,e,t,n):(function(i,o,c){return Uo(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c})(r,e,t)}function LA(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),i=bg(n.transform,s||null);i!=null&&(t===null&&(t=tt.empty()),t.set(n.field,i))}return t||null}function lf(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Jr(n,s,((i,o)=>DA(i,o)))})(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class gs extends qa{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class on extends qa{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Pg(r){const e=new Map;return r.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}})),e}function uf(r,e,t){const n=new Map;J(r.length===t.length,32656,{Re:t.length,Ve:r.length});for(let s=0;s<t.length;s++){const i=r[s],o=i.transform,c=e.data.field(i.field);n.set(i.field,kA(o,c,t[s]))}return n}function hf(r,e,t){const n=new Map;for(const s of r){const i=s.transform,o=t.data.field(s.field);n.set(s.field,NA(i,o,e))}return n}class Hi extends qa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Cg extends qa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&OA(i,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=yi(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=yi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=wg();return this.mutations.forEach((s=>{const i=e.get(s.key),o=i.overlayedDocument;let c=this.applyToLocalView(o,i.mutatedFields);c=t.has(s.key)?null:c;const l=Rg(o,c);l!==null&&n.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Z.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ae())}isEqual(e){return this.batchId===e.batchId&&Jr(this.mutations,e.mutations,((t,n)=>lf(t,n)))&&Jr(this.baseMutations,e.baseMutations,((t,n)=>lf(t,n)))}}class uu{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){J(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let s=(function(){return RA})();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,n[o].version);return new uu(e,t,n,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MA{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oe,he;function FA(r){switch(r){case O.OK:return Y(64938);case O.CANCELLED:case O.UNKNOWN:case O.DEADLINE_EXCEEDED:case O.RESOURCE_EXHAUSTED:case O.INTERNAL:case O.UNAVAILABLE:case O.UNAUTHENTICATED:return!1;case O.INVALID_ARGUMENT:case O.NOT_FOUND:case O.ALREADY_EXISTS:case O.PERMISSION_DENIED:case O.FAILED_PRECONDITION:case O.ABORTED:case O.OUT_OF_RANGE:case O.UNIMPLEMENTED:case O.DATA_LOSS:return!0;default:return Y(15467,{code:r})}}function xg(r){if(r===void 0)return it("GRPC error has no .code"),O.UNKNOWN;switch(r){case Oe.OK:return O.OK;case Oe.CANCELLED:return O.CANCELLED;case Oe.UNKNOWN:return O.UNKNOWN;case Oe.DEADLINE_EXCEEDED:return O.DEADLINE_EXCEEDED;case Oe.RESOURCE_EXHAUSTED:return O.RESOURCE_EXHAUSTED;case Oe.INTERNAL:return O.INTERNAL;case Oe.UNAVAILABLE:return O.UNAVAILABLE;case Oe.UNAUTHENTICATED:return O.UNAUTHENTICATED;case Oe.INVALID_ARGUMENT:return O.INVALID_ARGUMENT;case Oe.NOT_FOUND:return O.NOT_FOUND;case Oe.ALREADY_EXISTS:return O.ALREADY_EXISTS;case Oe.PERMISSION_DENIED:return O.PERMISSION_DENIED;case Oe.FAILED_PRECONDITION:return O.FAILED_PRECONDITION;case Oe.ABORTED:return O.ABORTED;case Oe.OUT_OF_RANGE:return O.OUT_OF_RANGE;case Oe.UNIMPLEMENTED:return O.UNIMPLEMENTED;case Oe.DATA_LOSS:return O.DATA_LOSS;default:return Y(39323,{code:r})}}(he=Oe||(Oe={}))[he.OK=0]="OK",he[he.CANCELLED=1]="CANCELLED",he[he.UNKNOWN=2]="UNKNOWN",he[he.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",he[he.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",he[he.NOT_FOUND=5]="NOT_FOUND",he[he.ALREADY_EXISTS=6]="ALREADY_EXISTS",he[he.PERMISSION_DENIED=7]="PERMISSION_DENIED",he[he.UNAUTHENTICATED=16]="UNAUTHENTICATED",he[he.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",he[he.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",he[he.ABORTED=10]="ABORTED",he[he.OUT_OF_RANGE=11]="OUT_OF_RANGE",he[he.UNIMPLEMENTED=12]="UNIMPLEMENTED",he[he.INTERNAL=13]="INTERNAL",he[he.UNAVAILABLE=14]="UNAVAILABLE",he[he.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UA(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jA=new Pn([4294967295,4294967295],0);function df(r){const e=UA().encode(r),t=new Rp;return t.update(e),new Uint8Array(t.digest())}function ff(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Pn([t,n],0),new Pn([s,i],0)]}class du{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ti(`Invalid padding: ${t}`);if(n<0)throw new ti(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new ti(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new ti(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Pn.fromNumber(this.ge)}ye(e,t,n){let s=e.add(t.multiply(Pn.fromNumber(n)));return s.compare(jA)===1&&(s=new Pn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=df(e),[n,s]=ff(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(n,s,i);if(!this.we(o))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new du(i,s,t);return n.forEach((c=>o.insert(c))),o}insert(e){if(this.ge===0)return;const t=df(e),[n,s]=ff(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(n,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ti extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,Gi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new $a(Z.min(),s,new be(se),ft(),ae())}}class Gi{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Gi(n,t,ae(),ae(),ae())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e,t,n,s){this.be=e,this.removedTargetIds=t,this.key=n,this.De=s}}class Ng{constructor(e,t){this.targetId=e,this.Ce=t}}class kg{constructor(e,t,n=Me.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class mf{constructor(){this.ve=0,this.Fe=pf(),this.Me=Me.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ae(),t=ae(),n=ae();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:Y(38017,{changeType:i})}})),new Gi(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=pf()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,J(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class BA{constructor(e){this.Ge=e,this.ze=new Map,this.je=ft(),this.Je=Io(),this.He=Io(),this.Ye=new be(se)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Y(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,n=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(aa(i))if(n===0){const o=new K(i.path);this.et(t,o,ke.newNoDocument(o,Z.min()))}else J(n===1,20013,{expectedCount:n});else{const o=this._t(t);if(o!==n){const c=this.ut(e),l=c?this.ct(c,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let o,c;try{o=en(n).toUint8Array()}catch(l){if(l instanceof Zp)return pr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new du(o,s,i)}catch(l){return pr(l instanceof ti?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.ge===0?null:c}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let s=0;return n.forEach((i=>{const o=this.Ge.ht(),c=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,o)=>{const c=this.ot(o);if(c){if(i.current&&aa(c.target)){const l=new K(c.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,ke.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}}));let n=ae();this.He.forEach(((i,o)=>{let c=!0;o.forEachWhile((l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(n=n.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(e)));const s=new $a(e,t,this.Ye,this.je,n);return this.je=ft(),this.Je=Io(),this.He=Io(),this.Ye=new be(se),s}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new mf,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ye(se),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ye(se),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||q("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new mf),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Io(){return new be(K.comparator)}function pf(){return new be(K.comparator)}const qA={asc:"ASCENDING",desc:"DESCENDING"},$A={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zA={and:"AND",or:"OR"};class HA{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function gl(r,e){return r.useProto3Json||Da(e)?e:{value:e}}function ls(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Dg(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function GA(r,e){return ls(r,e.toTimestamp())}function ot(r){return J(!!r,49232),Z.fromTimestamp((function(t){const n=Zt(t);return new pe(n.seconds,n.nanos)})(r))}function fu(r,e){return yl(r,e).canonicalString()}function yl(r,e){const t=(function(s){return new fe(["projects",s.projectId,"databases",s.database])})(r).child("documents");return e===void 0?t:t.child(e)}function Vg(r){const e=fe.fromString(r);return J($g(e),10190,{key:e.toString()}),e}function ua(r,e){return fu(r.databaseId,e.path)}function ur(r,e){const t=Vg(e);if(t.get(1)!==r.databaseId.projectId)throw new z(O.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new z(O.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new K(Mg(t))}function Og(r,e){return fu(r.databaseId,e)}function Lg(r){const e=Vg(r);return e.length===4?fe.emptyPath():Mg(e)}function _l(r){return new fe(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Mg(r){return J(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function gf(r,e,t){return{name:ua(r,e),fields:t.value.mapValue.fields}}function KA(r,e,t){const n=ur(r,e.name),s=ot(e.updateTime),i=e.createTime?ot(e.createTime):Z.min(),o=new tt({mapValue:{fields:e.fields}}),c=ke.newFoundDocument(n,s,i,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function WA(r,e){let t;if("targetChange"in e){e.targetChange;const n=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Y(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(u,d){return u.useProto3Json?(J(d===void 0||typeof d=="string",58123),Me.fromBase64String(d||"")):(J(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Me.fromUint8Array(d||new Uint8Array))})(r,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&(function(u){const d=u.code===void 0?O.UNKNOWN:xg(u.code);return new z(d,u.message||"")})(o);t=new kg(n,s,i,c||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const s=ur(r,n.document.name),i=ot(n.document.updateTime),o=n.document.createTime?ot(n.document.createTime):Z.min(),c=new tt({mapValue:{fields:n.document.fields}}),l=ke.newFoundDocument(s,i,o,c),u=n.targetIds||[],d=n.removedTargetIds||[];t=new jo(u,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const s=ur(r,n.document),i=n.readTime?ot(n.readTime):Z.min(),o=ke.newNoDocument(s,i),c=n.removedTargetIds||[];t=new jo([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const s=ur(r,n.document),i=n.removedTargetIds||[];t=new jo([],i,s,null)}else{if(!("filter"in e))return Y(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:s=0,unchangedNames:i}=n,o=new MA(s,i),c=n.targetId;t=new Ng(c,o)}}return t}function ha(r,e){let t;if(e instanceof gs)t={update:gf(r,e.key,e.value)};else if(e instanceof Hi)t={delete:ua(r,e.key)};else if(e instanceof on)t={update:gf(r,e.key,e.data),updateMask:e1(e.fieldMask)};else{if(!(e instanceof Cg))return Y(16599,{Vt:e.type});t={verify:ua(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(i,o){const c=o.transform;if(c instanceof os)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof _r)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof as)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof cs)return{fieldPath:o.field.canonicalString(),increment:c.Ae};throw Y(20930,{transform:o.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:GA(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Y(27497)})(r,e.precondition)),t}function vl(r,e){const t=e.currentDocument?(function(i){return i.updateTime!==void 0?Ue.updateTime(ot(i.updateTime)):i.exists!==void 0?Ue.exists(i.exists):Ue.none()})(e.currentDocument):Ue.none(),n=e.updateTransforms?e.updateTransforms.map((s=>(function(o,c){let l=null;if("setToServerValue"in c)J(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),l=new os;else if("appendMissingElements"in c){const d=c.appendMissingElements.values||[];l=new _r(d)}else if("removeAllFromArray"in c){const d=c.removeAllFromArray.values||[];l=new as(d)}else"increment"in c?l=new cs(o,c.increment):Y(16584,{proto:c});const u=Pe.fromServerFormat(c.fieldPath);return new Ba(u,l)})(r,s))):[];if(e.update){e.update.name;const s=ur(r,e.update.name),i=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=(function(l){const u=l.fieldPaths||[];return new ut(u.map((d=>Pe.fromServerFormat(d))))})(e.updateMask);return new on(s,i,o,t,n)}return new gs(s,i,t,n)}if(e.delete){const s=ur(r,e.delete);return new Hi(s,t)}if(e.verify){const s=ur(r,e.verify);return new Cg(s,t)}return Y(1463,{proto:e})}function QA(r,e){return r&&r.length>0?(J(e!==void 0,14353),r.map((t=>(function(s,i){let o=s.updateTime?ot(s.updateTime):ot(i);return o.isEqual(Z.min())&&(o=ot(i)),new VA(o,s.transformResults||[])})(t,e)))):[]}function Fg(r,e){return{documents:[Og(r,e.path)]}}function Ug(r,e){const t={structuredQuery:{}},n=e.path;let s;e.collectionGroup!==null?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Og(r,s);const i=(function(u){if(u.length!==0)return qg(ge.create(u,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const o=(function(u){if(u.length!==0)return u.map((d=>(function(p){return{field:$r(p.field),direction:JA(p.dir)}})(d)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=gl(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{ft:t,parent:s}}function jg(r){let e=Lg(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){J(n===1,65062);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=(function(m){const p=Bg(m);return p instanceof ge&&au(p)?p.getFilters():[p]})(t.where));let o=[];t.orderBy&&(o=(function(m){return m.map((p=>(function(R){return new Ni(zr(R.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(R.direction))})(p)))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let p;return p=typeof m=="object"?m.value:m,Da(p)?null:p})(t.limit));let l=null;t.startAt&&(l=(function(m){const p=!!m.before,b=m.values||[];return new ss(b,p)})(t.startAt));let u=null;return t.endAt&&(u=(function(m){const p=!m.before,b=m.values||[];return new ss(b,p)})(t.endAt)),IA(e,s,o,i,c,"F",l,u)}function YA(r,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Y(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Bg(r){return r.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=zr(t.unaryFilter.field);return ue.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=zr(t.unaryFilter.field);return ue.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=zr(t.unaryFilter.field);return ue.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=zr(t.unaryFilter.field);return ue.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Y(61313);default:return Y(60726)}})(r):r.fieldFilter!==void 0?(function(t){return ue.create(zr(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Y(58110);default:return Y(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(t){return ge.create(t.compositeFilter.filters.map((n=>Bg(n))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Y(1026)}})(t.compositeFilter.op))})(r):Y(30097,{filter:r})}function JA(r){return qA[r]}function XA(r){return $A[r]}function ZA(r){return zA[r]}function $r(r){return{fieldPath:r.canonicalString()}}function zr(r){return Pe.fromServerFormat(r.fieldPath)}function qg(r){return r instanceof ue?(function(t){if(t.op==="=="){if(Zd(t.value))return{unaryFilter:{field:$r(t.field),op:"IS_NAN"}};if(Xd(t.value))return{unaryFilter:{field:$r(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Zd(t.value))return{unaryFilter:{field:$r(t.field),op:"IS_NOT_NAN"}};if(Xd(t.value))return{unaryFilter:{field:$r(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$r(t.field),op:XA(t.op),value:t.value}}})(r):r instanceof ge?(function(t){const n=t.getFilters().map((s=>qg(s)));return n.length===1?n[0]:{compositeFilter:{op:ZA(t.op),filters:n}}})(r):Y(54877,{filter:r})}function e1(r){const e=[];return r.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $g(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e,t,n,s,i=Z.min(),o=Z.min(),c=Me.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new Kt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Kt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Kt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Kt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e){this.yt=e}}function t1(r,e){let t;if(e.document)t=KA(r.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=K.fromSegments(e.noDocument.path),s=wr(e.noDocument.readTime);t=ke.newNoDocument(n,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Y(56709);{const n=K.fromSegments(e.unknownDocument.path),s=wr(e.unknownDocument.version);t=ke.newUnknownDocument(n,s)}}return e.readTime&&t.setReadTime((function(s){const i=new pe(s[0],s[1]);return Z.fromTimestamp(i)})(e.readTime)),t}function yf(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:da(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=(function(i,o){return{name:ua(i,o.key),fields:o.data.value.mapValue.fields,updateTime:ls(i,o.version.toTimestamp()),createTime:ls(i,o.createTime.toTimestamp())}})(r.yt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:vr(e.version)};else{if(!e.isUnknownDocument())return Y(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:vr(e.version)}}return n}function da(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function vr(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function wr(r){const e=new pe(r.seconds,r.nanoseconds);return Z.fromTimestamp(e)}function tr(r,e){const t=(e.baseMutations||[]).map((i=>vl(r.yt,i)));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const c=e.mutations[i+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const n=e.mutations.map((i=>vl(r.yt,i))),s=pe.fromMillis(e.localWriteTimeMs);return new lu(e.batchId,s,t,n)}function ni(r){const e=wr(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?wr(r.lastLimboFreeSnapshotVersion):Z.min();let n;return n=(function(i){return i.documents!==void 0})(r.query)?(function(i){const o=i.documents.length;return J(o===1,1966,{count:o}),vt($i(Lg(i.documents[0])))})(r.query):(function(i){return vt(jg(i))})(r.query),new Kt(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Me.fromBase64String(r.resumeToken))}function Hg(r,e){const t=vr(e.snapshotVersion),n=vr(e.lastLimboFreeSnapshotVersion);let s;s=aa(e.target)?Fg(r.yt,e.target):Ug(r.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:yr(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Gg(r){const e=jg({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?la(e,e.limit,"L"):e}function Nc(r,e){return new hu(e.largestBatchId,vl(r.yt,e.overlayMutation))}function _f(r,e){const t=e.path.lastSegment();return[r,nt(e.path.popLast()),t]}function vf(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:vr(n.readTime),documentKey:nt(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{getBundleMetadata(e,t){return wf(e).get(t).next((n=>{if(n)return(function(i){return{id:i.bundleId,createTime:wr(i.createTime),version:i.version}})(n)}))}saveBundleMetadata(e,t){return wf(e).put((function(s){return{bundleId:s.id,createTime:vr(ot(s.createTime)),version:s.version}})(t))}getNamedQuery(e,t){return Ef(e).get(t).next((n=>{if(n)return(function(i){return{name:i.name,query:Gg(i.bundledQuery),readTime:wr(i.readTime)}})(n)}))}saveNamedQuery(e,t){return Ef(e).put((function(s){return{name:s.name,readTime:vr(ot(s.readTime)),bundledQuery:s.bundledQuery}})(t))}}function wf(r){return Be(r,Va)}function Ef(r){return Be(r,Oa)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class za{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const n=t.uid||"";return new za(e,n)}getOverlay(e,t){return Hs(e).get(_f(this.userId,t)).next((n=>n?Nc(this.serializer,n):null))}getOverlays(e,t){const n=Ot();return P.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(e,t,n){const s=[];return n.forEach(((i,o)=>{const c=new hu(t,o);s.push(this.St(e,c))})),P.waitFor(s)}removeOverlaysForBatchId(e,t,n){const s=new Set;t.forEach((o=>s.add(nt(o.getCollectionPath()))));const i=[];return s.forEach((o=>{const c=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);i.push(Hs(e).Z(cl,c))})),P.waitFor(i)}getOverlaysForCollection(e,t,n){const s=Ot(),i=nt(t),o=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Hs(e).J(cl,o).next((c=>{for(const l of c){const u=Nc(this.serializer,l);s.set(u.getKey(),u)}return s}))}getOverlaysForCollectionGroup(e,t,n,s){const i=Ot();let o;const c=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Hs(e).ee({index:Kp,range:c},((l,u,d)=>{const m=Nc(this.serializer,u);i.size()<s||m.largestBatchId===o?(i.set(m.getKey(),m),o=m.largestBatchId):d.done()})).next((()=>i))}St(e,t){return Hs(e).put((function(s,i,o){const[c,l,u]=_f(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ha(s.yt,o.mutation)}})(this.serializer,this.userId,t))}}function Hs(r){return Be(r,La)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{bt(e){return Be(e,nu)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const n=t==null?void 0:t.value;return n?Me.fromUint8Array(n):Me.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Ie(e.integerValue));else if("doubleValue"in e){const n=Ie(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),bi(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),typeof n=="string"&&(n=Zt(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(en(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?ig(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Fa(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Y(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const s of Object.keys(n))this.Ot(s,t),this.Ct(n[s],t)}kt(e,t){var o,c;const n=e.fields||{};this.Ft(t,53);const s=ns,i=((c=(o=n[s].arrayValue)==null?void 0:o.values)==null?void 0:c.length)||0;this.Ft(t,15),t.Mt(Ie(i)),this.Ot(s,t),this.Ct(n[s],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const s of n)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),K.fromName(e).path.forEach((n=>{this.Ft(t,60),this.Ut(n,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}nr.Kt=new nr;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mr=255;function s1(r){if(r===0)return 8;let e=0;return r>>4||(e+=4,r<<=4),r>>6||(e+=2,r<<=2),r>>7||(e+=1),e}function If(r){const e=64-(function(n){let s=0;for(let i=0;i<8;++i){const o=s1(255&n[i]);if(s+=o,o!==8)break}return s})(r);return Math.ceil(e/8)}class i1{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),n=If(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),n=If(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(Mr),this.sn(255)}_n(){this.an(Mr),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)})(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let s=1;s<t.length;++s)t[s]^=n?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Mr?(this.sn(Mr),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Mr?(this.an(Mr),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class o1{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class a1{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Gs{constructor(){this.cn=new i1,this.ln=new o1(this.cn),this.hn=new a1(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e,t,n,s){this.Tn=e,this.In=t,this.En=n,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new rr(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:Bo(this.En),directionalValue:Bo(this.dn),orderedDocumentKey:Bo(t),documentKey:n.path.toArray()}}Vn(e,t,n){const s=this.Rn(e,t,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function pn(r,e){let t=r.Tn-e.Tn;return t!==0?t:(t=bf(r.En,e.En),t!==0?t:(t=bf(r.dn,e.dn),t!==0?t:K.comparator(r.In,e.In)))}function bf(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}function Bo(r){return vp()?(function(t){let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return n})(r):r}function Tf(r){return typeof r!="string"?r:(function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n})(r)}class Sf{constructor(e){this.mn=new ye(((t,n)=>Pe.comparator(t.field,n.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const n=t;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(e){if(J(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=il(e);if(t!==void 0&&!this.wn(t))return!1;const n=Qn(e);let s=new Set,i=0,o=0;for(;i<n.length&&this.wn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){const c=this.mn.getIterator().getNext();if(!s.has(c.field.canonicalString())){const l=n[i];if(!this.Sn(c,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<n.length;++i){const c=n[i];if(o>=this.fn.length||!this.bn(this.fn[o++],c))return!1}return!0}Dn(){if(this.pn)return null;let e=new ye(Pe.comparator);const t=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new Do(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Do(n.field,0))}for(const n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Do(n.field,n.dir==="asc"?0:1)));return new na(na.UNKNOWN_ID,this.collectionId,t,Ii.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kg(r){var t,n;if(J(r instanceof ue||r instanceof ge,20012),r instanceof ue){if(r instanceof mg){const s=((n=(t=r.value.arrayValue)==null?void 0:t.values)==null?void 0:n.map((i=>ue.create(r.field,"==",i))))||[];return ge.create(s,"or")}return r}const e=r.filters.map((s=>Kg(s)));return ge.create(e,r.op)}function c1(r){if(r.getFilters().length===0)return[];const e=Il(Kg(r));return J(Wg(e),7391),wl(e)||El(e)?[e]:e.getFilters()}function wl(r){return r instanceof ue}function El(r){return r instanceof ge&&au(r)}function Wg(r){return wl(r)||El(r)||(function(t){if(t instanceof ge&&dl(t)){for(const n of t.getFilters())if(!wl(n)&&!El(n))return!1;return!0}return!1})(r)}function Il(r){if(J(r instanceof ue||r instanceof ge,34018),r instanceof ue)return r;if(r.filters.length===1)return Il(r.filters[0]);const e=r.filters.map((n=>Il(n)));let t=ge.create(e,r.op);return t=fa(t),Wg(t)?t:(J(t instanceof ge,64498),J(is(t),40251),J(t.filters.length>1,57927),t.filters.reduce(((n,s)=>mu(n,s))))}function mu(r,e){let t;return J(r instanceof ue||r instanceof ge,38388),J(e instanceof ue||e instanceof ge,25473),t=r instanceof ue?e instanceof ue?(function(s,i){return ge.create([s,i],"and")})(r,e):Af(r,e):e instanceof ue?Af(e,r):(function(s,i){if(J(s.filters.length>0&&i.filters.length>0,48005),is(s)&&is(i))return hg(s,i.getFilters());const o=dl(s)?s:i,c=dl(s)?i:s,l=o.filters.map((u=>mu(u,c)));return ge.create(l,"or")})(r,e),fa(t)}function Af(r,e){if(is(e))return hg(e,r.getFilters());{const t=e.filters.map((n=>mu(r,n)));return ge.create(t,"or")}}function fa(r){if(J(r instanceof ue||r instanceof ge,11850),r instanceof ue)return r;const e=r.getFilters();if(e.length===1)return fa(e[0]);if(lg(r))return r;const t=e.map((s=>fa(s))),n=[];return t.forEach((s=>{s instanceof ue?n.push(s):s instanceof ge&&(s.op===r.op?n.push(...s.filters):n.push(s))})),n.length===1?n[0]:ge.create(n,r.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l1{constructor(){this.Cn=new pu}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(mt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(mt.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class pu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new ye(fe.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new ye(fe.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rf="IndexedDbIndexManager",bo=new Uint8Array(0);class u1{constructor(e,t){this.databaseId=t,this.vn=new pu,this.Fn=new sn((n=>yr(n)),((n,s)=>qi(n,s))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),s=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const i={collectionId:n,parent:nt(s)};return Pf(e).put(i)}return P.resolve()}getCollectionParents(e,t){const n=[],s=IDBKeyRange.bound([t,""],[Op(t),""],!1,!0);return Pf(e).J(s).next((i=>{for(const o of i){if(o.collectionId!==t)break;n.push(Vt(o.parent))}return n}))}addFieldIndex(e,t){const n=Ks(e),s=(function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(t);delete s.indexId;const i=n.add(s);if(t.indexState){const o=Ur(e);return i.next((c=>{o.put(vf(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Ks(e),s=Ur(e),i=Fr(e);return n.delete(t.indexId).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Ks(e),n=Fr(e),s=Ur(e);return t.Z().next((()=>n.Z())).next((()=>s.Z()))}createTargetIndexes(e,t){return P.forEach(this.Mn(t),(n=>this.getIndexType(e,n).next((s=>{if(s===0||s===1){const i=new Sf(n).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))))}getDocumentsMatchingTarget(e,t){const n=Fr(e);let s=!0;const i=new Map;return P.forEach(this.Mn(t),(o=>this.xn(e,o).next((c=>{s&&(s=!!c),i.set(o,c)})))).next((()=>{if(s){let o=ae();const c=[];return P.forEach(i,((l,u)=>{q(Rf,`Using index ${(function(j){return`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map((U=>`${U.fieldPath}:${U.kind}`)).join(",")}`})(l)} to execute ${yr(t)}`);const d=(function(j,U){const Q=il(U);if(Q===void 0)return null;for(const H of ca(j,Q.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null})(u,l),m=(function(j,U){const Q=new Map;for(const H of Qn(U))for(const I of ca(j,H.fieldPath))switch(I.op){case"==":case"in":Q.set(H.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return Q.set(H.fieldPath.canonicalString(),I.value),Array.from(Q.values())}return null})(u,l),p=(function(j,U){const Q=[];let H=!0;for(const I of Qn(U)){const E=I.kind===0?sf(j,I.fieldPath,j.startAt):of(j,I.fieldPath,j.startAt);Q.push(E.value),H&&(H=E.inclusive)}return new ss(Q,H)})(u,l),b=(function(j,U){const Q=[];let H=!0;for(const I of Qn(U)){const E=I.kind===0?of(j,I.fieldPath,j.endAt):sf(j,I.fieldPath,j.endAt);Q.push(E.value),H&&(H=E.inclusive)}return new ss(Q,H)})(u,l),R=this.On(l,u,p),A=this.On(l,u,b),N=this.Nn(l,u,m),D=this.Bn(l.indexId,d,R,p.inclusive,A,b.inclusive,N);return P.forEach(D,(V=>n.Y(V,t.limit).next((j=>{j.forEach((U=>{const Q=K.fromSegments(U.documentKey);o.has(Q)||(o=o.add(Q),c.push(Q))}))}))))})).next((()=>c))}return P.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=c1(ge.create(e.filters,"and")).map((n=>ml(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,n,s,i,o,c){const l=(t!=null?t.length:1)*Math.max(n.length,i.length),u=l/(t!=null?t.length:1),d=[];for(let m=0;m<l;++m){const p=t?this.Ln(t[m/u]):bo,b=this.kn(e,p,n[m%u],s),R=this.qn(e,p,i[m%u],o),A=c.map((N=>this.kn(e,p,N,!0)));d.push(...this.createRange(b,R,A))}return d}kn(e,t,n,s){const i=new rr(e,K.empty(),t,n);return s?i:i.An()}qn(e,t,n,s){const i=new rr(e,K.empty(),t,n);return s?i.An():i}xn(e,t){const n=new Sf(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next((i=>{let o=null;for(const c of i)n.yn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o}))}getIndexType(e,t){let n=2;const s=this.Mn(t);return P.forEach(s,(i=>this.xn(e,i).next((o=>{o?n!==0&&o.fields.length<(function(l){let u=new ye(Pe.comparator),d=!1;for(const m of l.filters)for(const p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?d=!0:u=u.add(p.field));for(const m of l.orderBy)m.field.isKeyField()||(u=u.add(m.field));return u.size+(d?1:0)})(i)&&(n=1):n=0})))).next((()=>(function(o){return o.limit!==null})(t)&&s.length>1&&n===2?1:n))}Qn(e,t){const n=new Gs;for(const s of Qn(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=n.Pn(s.kind);nr.Kt.Dt(i,o)}return n.un()}Ln(e){const t=new Gs;return nr.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const n=new Gs;return nr.Kt.Dt(Ci(this.databaseId,t),n.Pn((function(i){const o=Qn(i);return o.length===0?0:o[o.length-1].kind})(e))),n.un()}Nn(e,t,n){if(n===null)return[];let s=[];s.push(new Gs);let i=0;for(const o of Qn(e)){const c=n[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&xi(c))s=this.Kn(s,o,c);else{const u=l.Pn(o.kind);nr.Kt.Dt(c,u)}}return this.Wn(s)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){const s=[...e],i=[];for(const o of n.arrayValue.values||[])for(const c of s){const l=new Gs;l.seed(c.un()),nr.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find((n=>n instanceof ue&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(e,t){const n=Ks(e),s=Ur(e);return(t?n.J(al,IDBKeyRange.bound(t,t)):n.J()).next((i=>{const o=[];return P.forEach(i,(c=>s.get([c.indexId,this.uid]).next((l=>{o.push((function(d,m){const p=m?new Ii(m.sequenceNumber,new mt(wr(m.readTime),new K(Vt(m.documentKey)),m.largestBatchId)):Ii.empty(),b=d.fields.map((([R,A])=>new Do(Pe.fromServerFormat(R),A)));return new na(d.indexId,d.collectionGroup,b,p)})(c,l))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((n,s)=>{const i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:se(n.collectionGroup,s.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,n){const s=Ks(e),i=Ur(e);return this.Gn(e).next((o=>s.J(al,IDBKeyRange.bound(t,t)).next((c=>P.forEach(c,(l=>i.put(vf(l.indexId,this.uid,o,n))))))))}updateIndexEntries(e,t){const n=new Map;return P.forEach(t,((s,i)=>{const o=n.get(s.collectionGroup);return(o?P.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next((c=>(n.set(s.collectionGroup,c),P.forEach(c,(l=>this.zn(e,s,l).next((u=>{const d=this.jn(i,l);return u.isEqual(d)?P.resolve():this.Jn(e,i,l,u,d)})))))))}))}Hn(e,t,n,s){return Fr(e).put(s.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,s){return Fr(e).delete(s.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){const s=Fr(e);let i=new ye(pn);return s.ee({index:Gp,range:IDBKeyRange.only([n.indexId,this.uid,Bo(this.$n(n,t))])},((o,c)=>{i=i.add(new rr(n.indexId,t,Tf(c.arrayValue),Tf(c.directionalValue)))})).next((()=>i))}jn(e,t){let n=new ye(pn);const s=this.Qn(t,e);if(s==null)return n;const i=il(t);if(i!=null){const o=e.data.field(i.fieldPath);if(xi(o))for(const c of o.arrayValue.values||[])n=n.add(new rr(t.indexId,e.key,this.Ln(c),s))}else n=n.add(new rr(t.indexId,e.key,bo,s));return n}Jn(e,t,n,s,i){q(Rf,"Updating index entries for document '%s'",t.key);const o=[];return(function(l,u,d,m,p){const b=l.getIterator(),R=u.getIterator();let A=Lr(b),N=Lr(R);for(;A||N;){let D=!1,V=!1;if(A&&N){const j=d(A,N);j<0?V=!0:j>0&&(D=!0)}else A!=null?V=!0:D=!0;D?(m(N),N=Lr(R)):V?(p(A),A=Lr(b)):(A=Lr(b),N=Lr(R))}})(s,i,pn,(c=>{o.push(this.Hn(e,t,n,c))}),(c=>{o.push(this.Yn(e,t,n,c))})),P.waitFor(o)}Gn(e){let t=1;return Ur(e).ee({index:Hp,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,s,i)=>{i.done(),t=s.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((o,c)=>pn(o,c))).filter(((o,c,l)=>!c||pn(o,l[c-1])!==0));const s=[];s.push(e);for(const o of n){const c=pn(o,e),l=pn(o,t);if(c===0)s[0]=e.An();else if(c>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const c=s[o].Vn(this.uid,bo,K.empty()),l=s[o+1].Vn(this.uid,bo,K.empty());i.push(IDBKeyRange.bound(c,l))}return i}Zn(e,t){return pn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Cf)}getMinOffset(e,t){return P.mapArray(this.Mn(t),(n=>this.xn(e,n).next((s=>s||Y(44426))))).next(Cf)}}function Pf(r){return Be(r,Ai)}function Fr(r){return Be(r,fi)}function Ks(r){return Be(r,tu)}function Ur(r){return Be(r,di)}function Cf(r){J(r.length!==0,28825);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const s=r[n].indexState.offset;Xl(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new mt(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Qg=41943040;class et{static withCacheSize(e){return new et(e,et.DEFAULT_COLLECTION_PERCENTILE,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yg(r,e,t){const n=r.store(bt),s=r.store(Xr),i=[],o=IDBKeyRange.only(t.batchId);let c=0;const l=n.ee({range:o},((d,m,p)=>(c++,p.delete())));i.push(l.next((()=>{J(c===1,47070,{batchId:t.batchId})})));const u=[];for(const d of t.mutations){const m=qp(e,d.key.path,t.batchId);i.push(s.delete(m)),u.push(d.key)}return P.waitFor(i).next((()=>u))}function ma(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw Y(14731);e=r.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */et.DEFAULT_COLLECTION_PERCENTILE=10,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,et.DEFAULT=new et(Qg,et.DEFAULT_COLLECTION_PERCENTILE,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),et.DISABLED=new et(-1,0,0);class Ha{constructor(e,t,n,s){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=s,this.Xn={}}static wt(e,t,n,s){J(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Ha(i,t,n,s)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gn(e).ee({index:or,range:n},((s,i,o)=>{t=!1,o.done()})).next((()=>t))}addMutationBatch(e,t,n,s){const i=Hr(e),o=gn(e);return o.add({}).next((c=>{J(typeof c=="number",49019);const l=new lu(c,t,n,s),u=(function(b,R,A){const N=A.baseMutations.map((V=>ha(b.yt,V))),D=A.mutations.map((V=>ha(b.yt,V)));return{userId:R,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:N,mutations:D}})(this.serializer,this.userId,l),d=[];let m=new ye(((p,b)=>se(p.canonicalString(),b.canonicalString())));for(const p of s){const b=qp(this.userId,p.key.path,c);m=m.add(p.key.path.popLast()),d.push(o.put(u)),d.push(i.put(b,jS))}return m.forEach((p=>{d.push(this.indexManager.addToCollectionParentIndex(e,p))})),e.addOnCommittedListener((()=>{this.Xn[c]=l.keys()})),P.waitFor(d).next((()=>l))}))}lookupMutationBatch(e,t){return gn(e).get(t).next((n=>n?(J(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),tr(this.serializer,n)):null))}er(e,t){return this.Xn[t]?P.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((n=>{if(n){const s=n.keys();return this.Xn[t]=s,s}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return gn(e).ee({index:or,range:s},((o,c,l)=>{c.userId===this.userId&&(J(c.batchId>=n,47524,{tr:n}),i=tr(this.serializer,c)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=cr;return gn(e).ee({index:or,range:t,reverse:!0},((s,i,o)=>{n=i.batchId,o.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,cr],[this.userId,Number.POSITIVE_INFINITY]);return gn(e).J(or,t).next((n=>n.map((s=>tr(this.serializer,s)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Vo(this.userId,t.path),s=IDBKeyRange.lowerBound(n),i=[];return Hr(e).ee({range:s},((o,c,l)=>{const[u,d,m]=o,p=Vt(d);if(u===this.userId&&t.path.isEqual(p))return gn(e).get(m).next((b=>{if(!b)throw Y(61480,{nr:o,batchId:m});J(b.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:b.userId,batchId:m}),i.push(tr(this.serializer,b))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ye(se);const s=[];return t.forEach((i=>{const o=Vo(this.userId,i.path),c=IDBKeyRange.lowerBound(o),l=Hr(e).ee({range:c},((u,d,m)=>{const[p,b,R]=u,A=Vt(b);p===this.userId&&i.path.isEqual(A)?n=n.add(R):m.done()}));s.push(l)})),P.waitFor(s).next((()=>this.rr(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1,i=Vo(this.userId,n),o=IDBKeyRange.lowerBound(i);let c=new ye(se);return Hr(e).ee({range:o},((l,u,d)=>{const[m,p,b]=l,R=Vt(p);m===this.userId&&n.isPrefixOf(R)?R.length===s&&(c=c.add(b)):d.done()})).next((()=>this.rr(e,c)))}rr(e,t){const n=[],s=[];return t.forEach((i=>{s.push(gn(e).get(i).next((o=>{if(o===null)throw Y(35274,{batchId:i});J(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),n.push(tr(this.serializer,o))})))})),P.waitFor(s).next((()=>n))}removeMutationBatch(e,t){return Yg(e.le,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),P.forEach(n,(s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return P.resolve();const n=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),s=[];return Hr(e).ee({range:n},((i,o,c)=>{if(i[0]===this.userId){const l=Vt(i[1]);s.push(l)}else c.done()})).next((()=>{J(s.length===0,56720,{sr:s.map((i=>i.canonicalString()))})}))}))}containsKey(e,t){return Jg(e,this.userId,t)}_r(e){return Xg(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:cr,lastStreamToken:""}))}}function Jg(r,e,t){const n=Vo(e,t.path),s=n[1],i=IDBKeyRange.lowerBound(n);let o=!1;return Hr(r).ee({range:i,X:!0},((c,l,u)=>{const[d,m,p]=c;d===e&&m===s&&(o=!0),u.done()})).next((()=>o))}function gn(r){return Be(r,bt)}function Hr(r){return Be(r,Xr)}function Xg(r){return Be(r,Ti)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Er(0)}static cr(){return new Er(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const n=new Er(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>Z.fromTimestamp(new pe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.lr(e).next((s=>(s.highestListenSequenceNumber=t,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>jr(e).delete(t.targetId))).next((()=>this.lr(e))).next((n=>(J(n.targetCount>0,8065),n.targetCount-=1,this.hr(e,n))))}removeTargets(e,t,n){let s=0;const i=[];return jr(e).ee(((o,c)=>{const l=ni(c);l.sequenceNumber<=t&&n.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))})).next((()=>P.waitFor(i))).next((()=>s))}forEachTarget(e,t){return jr(e).ee(((n,s)=>{const i=ni(s);t(i)}))}lr(e){return Nf(e).get(ia).next((t=>(J(t!==null,2888),t)))}hr(e,t){return Nf(e).put(ia,t)}Pr(e,t){return jr(e).put(Hg(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const n=yr(t),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return jr(e).ee({range:s,index:zp},((o,c,l)=>{const u=ni(c);qi(t,u.target)&&(i=u,l.done())})).next((()=>i))}addMatchingKeys(e,t,n){const s=[],i=wn(e);return t.forEach((o=>{const c=nt(o.path);s.push(i.put({targetId:n,path:c})),s.push(this.referenceDelegate.addReference(e,n,o))})),P.waitFor(s)}removeMatchingKeys(e,t,n){const s=wn(e);return P.forEach(t,(i=>{const o=nt(i.path);return P.waitFor([s.delete([n,o]),this.referenceDelegate.removeReference(e,n,i)])}))}removeMatchingKeysForTargetId(e,t){const n=wn(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),s=wn(e);let i=ae();return s.ee({range:n,X:!0},((o,c,l)=>{const u=Vt(o[1]),d=new K(u);i=i.add(d)})).next((()=>i))}containsKey(e,t){const n=nt(t.path),s=IDBKeyRange.bound([n],[Op(n)],!1,!0);let i=0;return wn(e).ee({index:eu,X:!0,range:s},(([o,c],l,u)=>{o!==0&&(i++,u.done())})).next((()=>i>0))}At(e,t){return jr(e).get(t).next((n=>n?ni(n):null))}}function jr(r){return Be(r,Zr)}function Nf(r){return Be(r,lr)}function wn(r){return Be(r,es)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kf="LruGarbageCollector",d1=1048576;function Df([r,e],[t,n]){const s=se(r,t);return s===0?se(e,n):s}class f1{constructor(e){this.Ir=e,this.buffer=new ye(Df),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Df(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zg{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){q(kf,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Mn(t)?q(kf,"Ignoring IndexedDB error during garbage collection: ",t):await Rr(t)}await this.Vr(3e5)}))}}class m1{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(_t.ce);const n=new f1(t);return this.mr.forEachTarget(e,(s=>n.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>n.Ar(s))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(q("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(xf)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xf):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,s,i,o,c,l,u;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,o=Date.now(),this.nthSequenceNumber(e,s)))).next((m=>(n=m,c=Date.now(),this.removeTargets(e,n,t)))).next((m=>(i=m,l=Date.now(),this.removeOrphanedDocuments(e,n)))).next((m=>(u=Date.now(),Br()<=le.DEBUG&&q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(c-o)+`ms
	Removed ${i} targets in `+(l-c)+`ms
	Removed ${m} documents in `+(u-l)+`ms
Total Duration: ${u-d}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m}))))}}function ey(r,e){return new m1(r,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{constructor(e,t){this.db=e,this.garbageCollector=ey(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((n=>t.next((s=>n+s))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((n,s)=>t(s)))}addReference(e,t,n){return To(e,n)}removeReference(e,t,n){return To(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return To(e,t)}br(e,t){return(function(s,i){let o=!1;return Xg(s).te((c=>Jg(s,c,i).next((l=>(l&&(o=!0),P.resolve(!l)))))).next((()=>o))})(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,((o,c)=>{if(c<=t){const l=this.br(e,o).next((u=>{if(!u)return i++,n.getEntry(e,o).next((()=>(n.removeEntry(o,Z.min()),wn(e).delete((function(m){return[0,nt(m.path)]})(o)))))}));s.push(l)}})).next((()=>P.waitFor(s))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return To(e,t)}Sr(e,t){const n=wn(e);let s,i=_t.ce;return n.ee({index:eu},(([o,c],{path:l,sequenceNumber:u})=>{o===0?(i!==_t.ce&&t(new K(Vt(s)),i),i=u,s=l):i=_t.ce})).next((()=>{i!==_t.ce&&t(new K(Vt(s)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function To(r,e){return wn(r).put((function(n,s){return{targetId:0,path:nt(n.path),sequenceNumber:s}})(e,r.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(){this.changes=new sn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ke.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Kn(e).put(n)}removeEntry(e,t,n){return Kn(e).delete((function(i,o){const c=i.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],da(o),c[c.length-1]]})(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Dr(e,n))))}getEntry(e,t){let n=ke.newInvalidDocument(t);return Kn(e).ee({index:Oo,range:IDBKeyRange.only(Ws(t))},((s,i)=>{n=this.Cr(t,i)})).next((()=>n))}vr(e,t){let n={size:0,document:ke.newInvalidDocument(t)};return Kn(e).ee({index:Oo,range:IDBKeyRange.only(Ws(t))},((s,i)=>{n={document:this.Cr(t,i),size:ma(i)}})).next((()=>n))}getEntries(e,t){let n=ft();return this.Fr(e,t,((s,i)=>{const o=this.Cr(s,i);n=n.insert(s,o)})).next((()=>n))}Mr(e,t){let n=ft(),s=new be(K.comparator);return this.Fr(e,t,((i,o)=>{const c=this.Cr(i,o);n=n.insert(i,c),s=s.insert(i,ma(o))})).next((()=>({documents:n,Or:s})))}Fr(e,t,n){if(t.isEmpty())return P.resolve();let s=new ye(Lf);t.forEach((l=>s=s.add(l)));const i=IDBKeyRange.bound(Ws(s.first()),Ws(s.last())),o=s.getIterator();let c=o.getNext();return Kn(e).ee({index:Oo,range:i},((l,u,d)=>{const m=K.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;c&&Lf(c,m)<0;)n(c,null),c=o.getNext();c&&c.isEqual(m)&&(n(c,u),c=o.hasNext()?o.getNext():null),c?d.j(Ws(c)):d.done()})).next((()=>{for(;c;)n(c,null),c=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,n,s,i){const o=t.path,c=[o.popLast().toArray(),o.lastSegment(),da(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Kn(e).J(IDBKeyRange.bound(c,l,!0)).next((u=>{i==null||i.incrementDocumentReadCount(u.length);let d=ft();for(const m of u){const p=this.Cr(K.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(zi(t,p)||s.has(p.key))&&(d=d.insert(p.key,p))}return d}))}getAllFromCollectionGroup(e,t,n,s){let i=ft();const o=Of(t,n),c=Of(t,mt.max());return Kn(e).ee({index:$p,range:IDBKeyRange.bound(o,c,!0)},((l,u,d)=>{const m=this.Cr(K.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(m.key,m),i.size===s&&d.done()})).next((()=>i))}newChangeBuffer(e){return new y1(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return Vf(e).get(ol).next((t=>(J(!!t,20021),t)))}Dr(e,t){return Vf(e).put(ol,t)}Cr(e,t){if(t){const n=t1(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(Z.min())))return n}return ke.newInvalidDocument(e)}}function ny(r){return new g1(r)}class y1 extends ty{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new sn((n=>n.toString()),((n,s)=>n.isEqual(s)))}applyChanges(e){const t=[];let n=0,s=new ye(((i,o)=>se(i.canonicalString(),o.canonicalString())));return this.changes.forEach(((i,o)=>{const c=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,c.readTime)),o.isValidDocument()){const l=yf(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=ma(l);n+=u-c.size,t.push(this.Nr.addEntry(e,i,l))}else if(n-=c.size,this.trackRemovals){const l=yf(this.Nr.serializer,o.convertToNoDocument(Z.min()));t.push(this.Nr.addEntry(e,i,l))}})),s.forEach((i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))})),t.push(this.Nr.updateMetadata(e,n)),P.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((n=>(this.Br.set(t,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:n,Or:s})=>(s.forEach(((i,o)=>{this.Br.set(i,{size:o,readTime:n.get(i).readTime})})),n)))}}function Vf(r){return Be(r,Si)}function Kn(r){return Be(r,sa)}function Ws(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Of(r,e){const t=e.documentKey.path.toArray();return[r,da(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Lf(r,e){const t=r.path.toArray(),n=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<n.length-2;++i)if(s=se(t[i],n[i]),s)return s;return s=se(t.length,n.length),s||(s=se(t[t.length-2],n[n.length-2]),s||se(t[t.length-1],n[n.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(n=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(n!==null&&yi(n.mutation,s,ut.empty(),pe.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,ae()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=ae()){const s=Ot();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,n).next((i=>{let o=ei();return i.forEach(((c,l)=>{o=o.insert(c,l.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const n=Ot();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ae())))}populateOverlays(e,t,n){const s=[];return n.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((o,c)=>{t.set(o,c)}))}))}computeViews(e,t,n,s){let i=ft();const o=gi(),c=(function(){return gi()})();return t.forEach(((l,u)=>{const d=n.get(u.key);s.has(u.key)&&(d===void 0||d.mutation instanceof on)?i=i.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),yi(d.mutation,u,d.mutation.getFieldMask(),pe.now())):o.set(u.key,ut.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((u,d)=>o.set(u,d))),t.forEach(((u,d)=>c.set(u,new _1(d,o.get(u)??null)))),c)))}recalculateAndSaveOverlays(e,t){const n=gi();let s=new be(((o,c)=>o-c)),i=ae();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const c of o)c.keys().forEach((l=>{const u=t.get(l);if(u===null)return;let d=n.get(l)||ut.empty();d=c.applyToLocalView(u,d),n.set(l,d);const m=(s.get(c.batchId)||ae()).add(l);s=s.insert(c.batchId,m)}))})).next((()=>{const o=[],c=s.getReverseIterator();for(;c.hasNext();){const l=c.getNext(),u=l.key,d=l.value,m=wg();d.forEach((p=>{if(!i.has(p)){const b=Rg(t.get(p),n.get(p));b!==null&&m.set(p,b),i=i.add(p)}})),o.push(this.documentOverlayCache.saveOverlays(e,u,m))}return P.waitFor(o)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,s){return(function(o){return K.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):pg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next((i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):P.resolve(Ot());let c=Ei,l=i;return o.next((u=>P.forEach(u,((d,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),i.get(d)?P.resolve():this.remoteDocumentCache.getEntry(e,d).next((p=>{l=l.insert(d,p)}))))).next((()=>this.populateOverlays(e,u,i))).next((()=>this.computeViews(e,l,u,ae()))).next((d=>({batchId:c,changes:vg(d)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new K(t)).next((n=>{let s=ei();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let o=ei();return this.indexManager.getCollectionParents(e,i).next((c=>P.forEach(c,(l=>{const u=(function(m,p){return new ps(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,n,s).next((d=>{d.forEach(((m,p)=>{o=o.insert(m,p)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s)))).next((o=>{i.forEach(((l,u)=>{const d=u.getKey();o.get(d)===null&&(o=o.insert(d,ke.newInvalidDocument(d)))}));let c=ei();return o.forEach(((l,u)=>{const d=i.get(l);d!==void 0&&yi(d.mutation,u,ut.empty(),pe.now()),zi(t,u)&&(c=c.insert(l,u))})),c}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:ot(s.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:Gg(s.bundledQuery),readTime:ot(s.readTime)}})(t)),P.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(){this.overlays=new be(K.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ot();return P.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((s,i)=>{this.St(e,t,i)})),P.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.qr.get(n);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){const s=Ot(),i=t.length+1,o=new K(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const l=c.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>n&&s.set(l.getKey(),l)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new be(((u,d)=>u-d));const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){let d=i.get(u.largestBatchId);d===null&&(d=Ot(),i=i.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const c=Ot(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((u,d)=>c.set(u,d))),!(c.size()>=s)););return P.resolve(c)}St(e,t,n){const s=this.overlays.get(n.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new hu(t,n));let i=this.qr.get(t);i===void 0&&(i=ae(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E1{constructor(){this.sessionToken=Me.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(){this.Qr=new ye(ze.$r),this.Ur=new ye(ze.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new ze(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new ze(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new K(new fe([])),n=new ze(t,e),s=new ze(t,e+1),i=[];return this.Ur.forEachInRange([n,s],(o=>{this.Gr(o),i.push(o.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new K(new fe([])),n=new ze(t,e),s=new ze(t,e+1);let i=ae();return this.Ur.forEachInRange([n,s],(o=>{i=i.add(o.key)})),i}containsKey(e){const t=new ze(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class ze{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return K.comparator(e.key,t.key)||se(e.Yr,t.Yr)}static Kr(e,t){return se(e.Yr,t.Yr)||K.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ye(ze.$r)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new lu(i,t,n,s);this.mutationQueue.push(o);for(const c of s)this.Zr=this.Zr.add(new ze(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.ei(n),i=s<0?0:s;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?cr:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ze(t,0),s=new ze(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,s],(o=>{const c=this.Xr(o.Yr);i.push(c)})),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ye(se);return t.forEach((s=>{const i=new ze(s,0),o=new ze(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],(c=>{n=n.add(c.Yr)}))})),P.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;K.isDocumentKey(i)||(i=i.child(""));const o=new ze(new K(i),0);let c=new ye(se);return this.Zr.forEachWhile((l=>{const u=l.key.path;return!!n.isPrefixOf(u)&&(u.length===s&&(c=c.add(l.Yr)),!0)}),o),P.resolve(this.ti(c))}ti(e){const t=[];return e.forEach((n=>{const s=this.Xr(n);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){J(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return P.forEach(t.mutations,(s=>{const i=new ze(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new ze(t,0),s=this.Zr.firstAfterOrEqual(n);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1{constructor(e){this.ri=e,this.docs=(function(){return new be(K.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():ke.newInvalidDocument(t))}getEntries(e,t){let n=ft();return t.forEach((s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():ke.newInvalidDocument(s))})),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=ft();const o=t.path,c=new K(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){const{key:u,value:{document:d}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Xl(Fp(d),n)<=0||(s.has(d.key)||zi(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return P.resolve(i)}getAllFromCollectionGroup(e,t,n,s){Y(9500)}ii(e,t){return P.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new T1(this)}getSize(e){return P.resolve(this.size)}}class T1 extends ty{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(n)})),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S1{constructor(e){this.persistence=e,this.si=new sn((t=>yr(t)),qi),this.lastRemoteSnapshotVersion=Z.min(),this.highestTargetId=0,this.oi=0,this._i=new gu,this.targetCount=0,this.ai=Er.ur()}forEachTarget(e,t){return this.si.forEach(((n,s)=>t(s))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Er(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.si.forEach(((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)})),P.waitFor(i).next((()=>s))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((o=>{i.push(s.markPotentiallyOrphaned(e,o))})),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu{constructor(e,t){this.ui={},this.overlays={},this.ci=new _t(0),this.li=!1,this.li=!0,this.hi=new E1,this.referenceDelegate=e(this),this.Pi=new S1(this),this.indexManager=new l1,this.remoteDocumentCache=(function(s){return new b1(s)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new zg(t),this.Ii=new v1(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new w1,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new I1(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){q("MemoryPersistence","Starting transaction:",e);const s=new A1(this.ci.next());return this.referenceDelegate.Ei(),n(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(e,t){return P.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class A1 extends jp{constructor(e){super(),this.currentSequenceNumber=e}}class Ga{constructor(e){this.persistence=e,this.Ri=new gu,this.Vi=null}static mi(e){return new Ga(e)}get fi(){if(this.Vi)return this.Vi;throw Y(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,(n=>{const s=K.fromPath(n);return this.gi(e,s).next((i=>{i||t.removeEntry(s,Z.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class pa{constructor(e,t){this.persistence=e,this.pi=new sn((n=>nt(n.path)),((n,s)=>n.isEqual(s))),this.garbageCollector=ey(this,t)}static mi(e,t){return new pa(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((s=>n+s))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return P.forEach(this.pi,((n,s)=>this.br(e,n,s).next((i=>i?P.resolve():t(s)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,(o=>this.br(e,o,t).next((c=>{c||(n++,i.removeEntry(o,Z.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),P.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Mo(e.data.value)),t}br(e,t,n){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return P.resolve(s!==void 0&&s>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(e){this.serializer=e}k(e,t,n,s){const i=new ka("createOrUpgrade",t);n<1&&s>=1&&((function(l){l.createObjectStore(Bi)})(e),(function(l){l.createObjectStore(Ti,{keyPath:US}),l.createObjectStore(bt,{keyPath:Gd,autoIncrement:!0}).createIndex(or,Kd,{unique:!0}),l.createObjectStore(Xr)})(e),Mf(e),(function(l){l.createObjectStore(Yn)})(e));let o=P.resolve();return n<3&&s>=3&&(n!==0&&((function(l){l.deleteObjectStore(es),l.deleteObjectStore(Zr),l.deleteObjectStore(lr)})(e),Mf(e)),o=o.next((()=>(function(l){const u=l.store(lr),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Z.min().toTimestamp(),targetCount:0};return u.put(ia,d)})(i)))),n<4&&s>=4&&(n!==0&&(o=o.next((()=>(function(l,u){return u.store(bt).J().next((m=>{l.deleteObjectStore(bt),l.createObjectStore(bt,{keyPath:Gd,autoIncrement:!0}).createIndex(or,Kd,{unique:!0});const p=u.store(bt),b=m.map((R=>p.put(R)));return P.waitFor(b)}))})(e,i)))),o=o.next((()=>{(function(l){l.createObjectStore(ts,{keyPath:WS})})(e)}))),n<5&&s>=5&&(o=o.next((()=>this.yi(i)))),n<6&&s>=6&&(o=o.next((()=>((function(l){l.createObjectStore(Si)})(e),this.wi(i))))),n<7&&s>=7&&(o=o.next((()=>this.Si(i)))),n<8&&s>=8&&(o=o.next((()=>this.bi(e,i)))),n<9&&s>=9&&(o=o.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)}))),n<10&&s>=10&&(o=o.next((()=>this.Di(i)))),n<11&&s>=11&&(o=o.next((()=>{(function(l){l.createObjectStore(Va,{keyPath:QS})})(e),(function(l){l.createObjectStore(Oa,{keyPath:YS})})(e)}))),n<12&&s>=12&&(o=o.next((()=>{(function(l){const u=l.createObjectStore(La,{keyPath:rA});u.createIndex(cl,sA,{unique:!1}),u.createIndex(Kp,iA,{unique:!1})})(e)}))),n<13&&s>=13&&(o=o.next((()=>(function(l){const u=l.createObjectStore(sa,{keyPath:BS});u.createIndex(Oo,qS),u.createIndex($p,$S)})(e))).next((()=>this.Ci(e,i))).next((()=>e.deleteObjectStore(Yn)))),n<14&&s>=14&&(o=o.next((()=>this.Fi(e,i)))),n<15&&s>=15&&(o=o.next((()=>(function(l){l.createObjectStore(tu,{keyPath:JS,autoIncrement:!0}).createIndex(al,XS,{unique:!1}),l.createObjectStore(di,{keyPath:ZS}).createIndex(Hp,eA,{unique:!1}),l.createObjectStore(fi,{keyPath:tA}).createIndex(Gp,nA,{unique:!1})})(e)))),n<16&&s>=16&&(o=o.next((()=>{t.objectStore(di).clear()})).next((()=>{t.objectStore(fi).clear()}))),n<17&&s>=17&&(o=o.next((()=>{(function(l){l.createObjectStore(nu,{keyPath:oA})})(e)}))),n<18&&s>=18&&vp()&&(o=o.next((()=>{t.objectStore(di).clear()})).next((()=>{t.objectStore(fi).clear()}))),o}wi(e){let t=0;return e.store(Yn).ee(((n,s)=>{t+=ma(s)})).next((()=>{const n={byteSize:t};return e.store(Si).put(ol,n)}))}yi(e){const t=e.store(Ti),n=e.store(bt);return t.J().next((s=>P.forEach(s,(i=>{const o=IDBKeyRange.bound([i.userId,cr],[i.userId,i.lastAcknowledgedBatchId]);return n.J(or,o).next((c=>P.forEach(c,(l=>{J(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=tr(this.serializer,l);return Yg(e,i.userId,u).next((()=>{}))}))))}))))}Si(e){const t=e.store(es),n=e.store(Yn);return e.store(lr).get(ia).next((s=>{const i=[];return n.ee(((o,c)=>{const l=new fe(o),u=(function(m){return[0,nt(m)]})(l);i.push(t.get(u).next((d=>d?P.resolve():(m=>t.put({targetId:0,path:nt(m),sequenceNumber:s.highestListenSequenceNumber}))(l))))})).next((()=>P.waitFor(i)))}))}bi(e,t){e.createObjectStore(Ai,{keyPath:KS});const n=t.store(Ai),s=new pu,i=o=>{if(s.add(o)){const c=o.lastSegment(),l=o.popLast();return n.put({collectionId:c,parent:nt(l)})}};return t.store(Yn).ee({X:!0},((o,c)=>{const l=new fe(o);return i(l.popLast())})).next((()=>t.store(Xr).ee({X:!0},(([o,c,l],u)=>{const d=Vt(c);return i(d.popLast())}))))}Di(e){const t=e.store(Zr);return t.ee(((n,s)=>{const i=ni(s),o=Hg(this.serializer,i);return t.put(o)}))}Ci(e,t){const n=t.store(Yn),s=[];return n.ee(((i,o)=>{const c=t.store(sa),l=(function(m){return m.document?new K(fe.fromString(m.document.name).popFirst(5)):m.noDocument?K.fromSegments(m.noDocument.path):m.unknownDocument?K.fromSegments(m.unknownDocument.path):Y(36783)})(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(c.put(u))})).next((()=>P.waitFor(s)))}Fi(e,t){const n=t.store(bt),s=ny(this.serializer),i=new yu(Ga.mi,this.serializer.yt);return n.J().next((o=>{const c=new Map;return o.forEach((l=>{let u=c.get(l.userId)??ae();tr(this.serializer,l).keys().forEach((d=>u=u.add(d))),c.set(l.userId,u)})),P.forEach(c,((l,u)=>{const d=new Qe(u),m=za.wt(this.serializer,d),p=i.getIndexManager(d),b=Ha.wt(d,this.serializer,p,i.referenceDelegate);return new ry(s,b,m,p).recalculateAndSaveOverlaysForDocumentKeys(new ll(t,_t.ce),l).next()}))}))}}function Mf(r){r.createObjectStore(es,{keyPath:HS}).createIndex(eu,GS,{unique:!0}),r.createObjectStore(Zr,{keyPath:"targetId"}).createIndex(zp,zS,{unique:!0}),r.createObjectStore(lr)}const yn="IndexedDbPersistence",kc=18e5,Dc=5e3,Vc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",P1="main";class _u{constructor(e,t,n,s,i,o,c,l,u,d,m=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=i,this.window=o,this.document=c,this.xi=u,this.Oi=d,this.Ni=m,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!_u.v())throw new z(O.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new p1(this,s),this.$i=t+P1,this.serializer=new zg(l),this.Ui=new Cn(this.$i,this.Ni,new R1(this.serializer)),this.hi=new r1,this.Pi=new h1(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ny(this.serializer),this.Ii=new n1,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,d===!1&&it(yn,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new z(O.FAILED_PRECONDITION,Vc);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new _t(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>So(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(Mn(e))return q(yn,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return q(yn,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Qs(e).get(Or).next((t=>P.resolve(this.es(t))))}ts(e){return So(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,kc)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const n=Be(t,ts);return n.J().next((s=>{const i=this.ss(s,kc),o=s.filter((c=>i.indexOf(c)===-1));return P.forEach(o,(c=>n.delete(c.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?P.resolve(!0):Qs(e).get(Or).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Dc)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new z(O.FAILED_PRECONDITION,Vc);return!1}}return!(!this.networkEnabled||!this.inForeground)||So(e).J().next((n=>this.ss(n,Dc).find((s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,c=this.networkEnabled===s.networkEnabled;if(i||o&&c)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&q(yn,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Bi,ts],(e=>{const t=new ll(e,_t.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((n=>this.rs(n.updateTimeMs,t)&&!this.us(n.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>So(e).J().next((t=>this.ss(t,kc).map((n=>n.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Ha.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new u1(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return za.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){q(yn,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?lA:l===17?Jp:l===16?cA:l===15?ru:l===14?Yp:l===13?Qp:l===12?aA:l===11?Wp:void Y(60245)})(this.Ni);let o;return this.Ui.runTransaction(e,s,i,(c=>(o=new ll(c,this.ci?this.ci.next():_t.ce),t==="readwrite-primary"?this.Hi(o).next((l=>!!l||this.Yi(o))).next((l=>{if(!l)throw it(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new z(O.FAILED_PRECONDITION,Up);return n(o)})).next((l=>this.Xi(o).next((()=>l)))):this.Is(o).next((()=>n(o)))))).then((c=>(o.raiseOnCommittedEvent(),c)))}Is(e){return Qs(e).get(Or).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Dc)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new z(O.FAILED_PRECONDITION,Vc)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Qs(e).put(Or,t)}static v(){return Cn.v()}Zi(e){const t=Qs(e);return t.get(Or).next((n=>this.es(n)?(q(yn,"Releasing primary lease."),t.delete(Or)):P.resolve()))}rs(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(it(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;_p()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const n=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return q(yn,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return it(yn,"Failed to get zombied client id.",n),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){it("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Qs(r){return Be(r,Bi)}function So(r){return Be(r,ts)}function C1(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=s}static As(e,t){let n=ae(),s=ae();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new vu(e,t.fromCache,n,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return _p()?8:Bp(je())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.ys(e,t).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ws(e,t,s,n).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new x1;return this.Ss(e,t,o).next((c=>{if(i.result=c,this.Vs)return this.bs(e,t,o,c.size)}))})).next((()=>i.result))}bs(e,t,n,s){return n.documentReadCount<this.fs?(Br()<=le.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",qr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(Br()<=le.DEBUG&&q("QueryEngine","Query:",qr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(Br()<=le.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",qr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vt(t))):P.resolve())}ys(e,t){if(af(t))return P.resolve(null);let n=vt(t);return this.indexManager.getIndexType(e,n).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=la(t,null,"F"),n=vt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((i=>{const o=ae(...i);return this.ps.getDocuments(e,o).next((c=>this.indexManager.getMinOffset(e,n).next((l=>{const u=this.Ds(t,c);return this.Cs(t,u,o,l.readTime)?this.ys(e,la(t,null,"F")):this.vs(e,u,t,l)}))))})))))}ws(e,t,n,s){return af(t)||s.isEqual(Z.min())?P.resolve(null):this.ps.getDocuments(e,n).next((i=>{const o=this.Ds(t,i);return this.Cs(t,o,n,s)?P.resolve(null):(Br()<=le.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),qr(t)),this.vs(e,o,t,kS(s,Ei)).next((c=>c)))}))}Ds(e,t){let n=new ye(yg(e));return t.forEach(((s,i)=>{zi(e,i)&&(n=n.add(i))})),n}Cs(e,t,n,s){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,n){return Br()<=le.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",qr(t)),this.ps.getDocumentsMatchingQuery(e,t,mt.min(),n)}vs(e,t,n,s){return this.ps.getDocumentsMatchingQuery(e,n,s).next((i=>(t.forEach((o=>{i=i.insert(o.key,o)})),i)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu="LocalStore",N1=3e8;class k1{constructor(e,t,n,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new be(se),this.xs=new sn((i=>yr(i)),qi),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ry(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function iy(r,e,t,n){return new k1(r,e,t,n)}async function oy(r,e){const t=ne(r);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next((i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((i=>{const o=[],c=[];let l=ae();for(const u of s){o.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}for(const u of i){c.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(n,l).next((u=>({Ls:u,removedBatchIds:o,addedBatchIds:c})))}))}))}function D1(r,e){const t=ne(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,l,u,d){const m=u.batch,p=m.keys();let b=P.resolve();return p.forEach((R=>{b=b.next((()=>d.getEntry(l,R))).next((A=>{const N=u.docVersions.get(R);J(N!==null,48541),A.version.compareTo(N)<0&&(m.applyToRemoteDocument(A,u),A.isValidDocument()&&(A.setReadTime(u.commitVersion),d.addEntry(A)))}))})),b.next((()=>c.mutationQueue.removeMutationBatch(l,m)))})(t,n,e,i).next((()=>i.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(c){let l=ae();for(let u=0;u<c.mutationResults.length;++u)c.mutationResults[u].transformResults.length>0&&(l=l.add(c.batch.mutations[u].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(n,s)))}))}function ay(r){const e=ne(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function V1(r,e){const t=ne(r),n=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const c=[];e.targetChanges.forEach(((d,m)=>{const p=s.get(m);if(!p)return;c.push(t.Pi.removeMatchingKeys(i,d.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(i,d.addedDocuments,m))));let b=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?b=b.withResumeToken(Me.EMPTY_BYTE_STRING,Z.min()).withLastLimboFreeSnapshotVersion(Z.min()):d.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(d.resumeToken,n)),s=s.insert(m,b),(function(A,N,D){return A.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=N1?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0})(p,b,d)&&c.push(t.Pi.updateTargetData(i,b))}));let l=ft(),u=ae();if(e.documentUpdates.forEach((d=>{e.resolvedLimboDocuments.has(d)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))})),c.push(O1(i,o,e.documentUpdates).next((d=>{l=d.ks,u=d.qs}))),!n.isEqual(Z.min())){const d=t.Pi.getLastRemoteSnapshotVersion(i).next((m=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n)));c.push(d)}return P.waitFor(c).next((()=>o.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,u))).next((()=>l))})).then((i=>(t.Ms=s,i)))}function O1(r,e,t){let n=ae(),s=ae();return t.forEach((i=>n=n.add(i))),e.getEntries(r,n).next((i=>{let o=ft();return t.forEach(((c,l)=>{const u=i.get(c);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(c)),l.isNoDocument()&&l.version.isEqual(Z.min())?(e.removeEntry(c,l.readTime),o=o.insert(c,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(c,l)):q(wu,"Ignoring outdated watch update for ",c,". Current version:",u.version," Watch version:",l.version)})),{ks:o,qs:s}}))}function L1(r,e){const t=ne(r);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=cr),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function M1(r,e){const t=ne(r);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let s;return t.Pi.getTargetData(n,e).next((i=>i?(s=i,P.resolve(s)):t.Pi.allocateTargetId(n).next((o=>(s=new Kt(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,s).next((()=>s)))))))})).then((n=>{const s=t.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function bl(r,e,t){const n=ne(r),s=n.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",i,(o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Mn(o))throw o;q(wu,`Failed to update sequence numbers for target ${e}: ${o}`)}n.Ms=n.Ms.remove(e),n.xs.delete(s.target)}function Ff(r,e,t){const n=ne(r);let s=Z.min(),i=ae();return n.persistence.runTransaction("Execute query","readwrite",(o=>(function(l,u,d){const m=ne(l),p=m.xs.get(d);return p!==void 0?P.resolve(m.Ms.get(p)):m.Pi.getTargetData(u,d)})(n,o,vt(e)).next((c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(o,c.targetId).next((l=>{i=l}))})).next((()=>n.Fs.getDocumentsMatchingQuery(o,e,t?s:Z.min(),t?i:ae()))).next((c=>(F1(n,TA(e),c),{documents:c,Qs:i})))))}function F1(r,e,t){let n=r.Os.get(e)||Z.min();t.forEach(((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)})),r.Os.set(e,n)}class Uf{constructor(){this.activeTargetIds=xA()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class cy{constructor(){this.Mo=new Uf,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Uf,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jf="ConnectivityMonitor";class Bf{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){q(jf,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){q(jf,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ao=null;function Tl(){return Ao===null?Ao=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ao++,"0x"+Ao.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oc="RestConnection",j1={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class B1{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===oa?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(e,t,n,s,i){const o=Tl(),c=this.zo(e,t.toUriEncodedString());q(Oc,`Sending RPC '${e}' ${o}:`,c,n);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(c),d=ds(u);return this.Jo(e,c,l,n,d).then((m=>(q(Oc,`Received RPC '${e}' ${o}: `,m),m)),(m=>{throw pr(Oc,`RPC '${e}' ${o} failed with error: `,m,"url: ",c,"request:",n),m}))}Ho(e,t,n,s,i,o){return this.Go(e,t,n,s,i)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+ms})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),n&&n.headers.forEach(((s,i)=>e[i]=s))}zo(e,t){const n=j1[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ze="WebChannelConnection";class $1 extends B1{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,s,i){const o=Tl();return new Promise(((c,l)=>{const u=new Pp;u.setWithCredentials(!0),u.listenOnce(Cp.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case ko.NO_ERROR:const m=u.getResponseJson();q(Ze,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),c(m);break;case ko.TIMEOUT:q(Ze,`RPC '${e}' ${o} timed out`),l(new z(O.DEADLINE_EXCEEDED,"Request time out"));break;case ko.HTTP_ERROR:const p=u.getStatus();if(q(Ze,`RPC '${e}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let b=u.getResponseJson();Array.isArray(b)&&(b=b[0]);const R=b==null?void 0:b.error;if(R&&R.status&&R.message){const A=(function(D){const V=D.toLowerCase().replace(/_/g,"-");return Object.values(O).indexOf(V)>=0?V:O.UNKNOWN})(R.status);l(new z(A,R.message))}else l(new z(O.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new z(O.UNAVAILABLE,"Connection failed."));break;default:Y(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{q(Ze,`RPC '${e}' ${o} completed.`)}}));const d=JSON.stringify(s);q(Ze,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",d,n,15)}))}T_(e,t,n){const s=Tl(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=kp(),c=Np(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;const d=i.join("");q(Ze,`Creating RPC '${e}' stream ${s}: ${d}`,l);const m=o.createWebChannel(d,l);this.I_(m);let p=!1,b=!1;const R=new q1({Yo:N=>{b?q(Ze,`Not sending because RPC '${e}' stream ${s} is closed:`,N):(p||(q(Ze,`Opening RPC '${e}' stream ${s} transport.`),m.open(),p=!0),q(Ze,`RPC '${e}' stream ${s} sending:`,N),m.send(N))},Zo:()=>m.close()}),A=(N,D,V)=>{N.listen(D,(j=>{try{V(j)}catch(U){setTimeout((()=>{throw U}),0)}}))};return A(m,Zs.EventType.OPEN,(()=>{b||(q(Ze,`RPC '${e}' stream ${s} transport opened.`),R.o_())})),A(m,Zs.EventType.CLOSE,(()=>{b||(b=!0,q(Ze,`RPC '${e}' stream ${s} transport closed`),R.a_(),this.E_(m))})),A(m,Zs.EventType.ERROR,(N=>{b||(b=!0,pr(Ze,`RPC '${e}' stream ${s} transport errored. Name:`,N.name,"Message:",N.message),R.a_(new z(O.UNAVAILABLE,"The operation could not be completed")))})),A(m,Zs.EventType.MESSAGE,(N=>{var D;if(!b){const V=N.data[0];J(!!V,16349);const j=V,U=(j==null?void 0:j.error)||((D=j[0])==null?void 0:D.error);if(U){q(Ze,`RPC '${e}' stream ${s} received error:`,U);const Q=U.status;let H=(function(y){const w=Oe[y];if(w!==void 0)return xg(w)})(Q),I=U.message;H===void 0&&(H=O.INTERNAL,I="Unknown error status: "+Q+" with message "+U.message),b=!0,R.a_(new z(H,I)),m.close()}else q(Ze,`RPC '${e}' stream ${s} received:`,V),R.u_(V)}})),A(c,xp.STAT_EVENT,(N=>{N.stat===rl.PROXY?q(Ze,`RPC '${e}' stream ${s} detected buffering proxy`):N.stat===rl.NOPROXY&&q(Ze,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{R.__()}),0),R}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z1(){return typeof window<"u"?window:null}function qo(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ka(r){return new HA(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(e,t,n=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-n);s>0&&q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qf="PersistentStream";class uy{constructor(e,t,n,s,i,o,c,l){this.Mi=e,this.S_=n,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ly(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===O.RESOURCE_EXHAUSTED?(it(t.toString()),it("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===O.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,s])=>{this.D_===t&&this.G_(n,s)}),(n=>{e((()=>{const s=new z(O.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{n((()=>this.z_(s)))})),this.stream.onMessage((s=>{n((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return q(qf,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(q(qf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class H1 extends uy{constructor(e,t,n,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=WA(this.serializer,e),n=(function(i){if(!("targetChange"in i))return Z.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Z.min():o.readTime?ot(o.readTime):Z.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=_l(this.serializer),t.addTarget=(function(i,o){let c;const l=o.target;if(c=aa(l)?{documents:Fg(i,l)}:{query:Ug(i,l).ft},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Dg(i,o.resumeToken);const u=gl(i,o.expectedCount);u!==null&&(c.expectedCount=u)}else if(o.snapshotVersion.compareTo(Z.min())>0){c.readTime=ls(i,o.snapshotVersion.toTimestamp());const u=gl(i,o.expectedCount);u!==null&&(c.expectedCount=u)}return c})(this.serializer,e);const n=YA(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=_l(this.serializer),t.removeTarget=e,this.q_(t)}}class G1 extends uy{constructor(e,t,n,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return J(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,J(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){J(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=QA(e.writeResults,e.commitTime),n=ot(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=_l(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>ha(this.serializer,n)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{}class W1 extends K1{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new z(O.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Go(e,yl(t,n),s,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new z(O.UNKNOWN,i.toString())}))}Ho(e,t,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,c])=>this.connection.Ho(e,yl(t,n),s,o,c,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new z(O.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Q1{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(it(t),this.aa=!1):q("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ir="RemoteStore";class Y1{constructor(e,t,n,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((o=>{n.enqueueAndForget((async()=>{Pr(this)&&(q(Ir,"Restarting streams for network reachability change."),await(async function(l){const u=ne(l);u.Ea.add(4),await ys(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Ki(u)})(this))}))})),this.Ra=new Q1(n,s)}}async function Ki(r){if(Pr(r))for(const e of r.da)await e(!0)}async function ys(r){for(const e of r.da)await e(!1)}function hy(r,e){const t=ne(r);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Tu(t)?bu(t):_s(t).O_()&&Iu(t,e))}function Eu(r,e){const t=ne(r),n=_s(t);t.Ia.delete(e),n.O_()&&dy(t,e),t.Ia.size===0&&(n.O_()?n.L_():Pr(t)&&t.Ra.set("Unknown"))}function Iu(r,e){if(r.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Z.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}_s(r).Y_(e)}function dy(r,e){r.Va.Ue(e),_s(r).Z_(e)}function bu(r){r.Va=new BA({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),_s(r).start(),r.Ra.ua()}function Tu(r){return Pr(r)&&!_s(r).x_()&&r.Ia.size>0}function Pr(r){return ne(r).Ea.size===0}function fy(r){r.Va=void 0}async function J1(r){r.Ra.set("Online")}async function X1(r){r.Ia.forEach(((e,t)=>{Iu(r,e)}))}async function Z1(r,e){fy(r),Tu(r)?(r.Ra.ha(e),bu(r)):r.Ra.set("Unknown")}async function eR(r,e,t){if(r.Ra.set("Online"),e instanceof kg&&e.state===2&&e.cause)try{await(async function(s,i){const o=i.cause;for(const c of i.targetIds)s.Ia.has(c)&&(await s.remoteSyncer.rejectListen(c,o),s.Ia.delete(c),s.Va.removeTarget(c))})(r,e)}catch(n){q(Ir,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ga(r,n)}else if(e instanceof jo?r.Va.Ze(e):e instanceof Ng?r.Va.st(e):r.Va.tt(e),!t.isEqual(Z.min()))try{const n=await ay(r.localStore);t.compareTo(n)>=0&&await(function(i,o){const c=i.Va.Tt(o);return c.targetChanges.forEach(((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.Ia.get(u);d&&i.Ia.set(u,d.withResumeToken(l.resumeToken,o))}})),c.targetMismatches.forEach(((l,u)=>{const d=i.Ia.get(l);if(!d)return;i.Ia.set(l,d.withResumeToken(Me.EMPTY_BYTE_STRING,d.snapshotVersion)),dy(i,l);const m=new Kt(d.target,l,u,d.sequenceNumber);Iu(i,m)})),i.remoteSyncer.applyRemoteEvent(c)})(r,t)}catch(n){q(Ir,"Failed to raise snapshot:",n),await ga(r,n)}}async function ga(r,e,t){if(!Mn(e))throw e;r.Ea.add(1),await ys(r),r.Ra.set("Offline"),t||(t=()=>ay(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{q(Ir,"Retrying IndexedDB access"),await t(),r.Ea.delete(1),await Ki(r)}))}function my(r,e){return e().catch((t=>ga(r,t,e)))}async function Wi(r){const e=ne(r),t=On(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:cr;for(;tR(e);)try{const s=await L1(e.localStore,n);if(s===null){e.Ta.length===0&&t.L_();break}n=s.batchId,nR(e,s)}catch(s){await ga(e,s)}py(e)&&gy(e)}function tR(r){return Pr(r)&&r.Ta.length<10}function nR(r,e){r.Ta.push(e);const t=On(r);t.O_()&&t.X_&&t.ea(e.mutations)}function py(r){return Pr(r)&&!On(r).x_()&&r.Ta.length>0}function gy(r){On(r).start()}async function rR(r){On(r).ra()}async function sR(r){const e=On(r);for(const t of r.Ta)e.ea(t.mutations)}async function iR(r,e,t){const n=r.Ta.shift(),s=uu.from(n,e,t);await my(r,(()=>r.remoteSyncer.applySuccessfulWrite(s))),await Wi(r)}async function oR(r,e){e&&On(r).X_&&await(async function(n,s){if((function(o){return FA(o)&&o!==O.ABORTED})(s.code)){const i=n.Ta.shift();On(n).B_(),await my(n,(()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s))),await Wi(n)}})(r,e),py(r)&&gy(r)}async function $f(r,e){const t=ne(r);t.asyncQueue.verifyOperationInProgress(),q(Ir,"RemoteStore received new credentials");const n=Pr(t);t.Ea.add(3),await ys(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ki(t)}async function aR(r,e){const t=ne(r);e?(t.Ea.delete(2),await Ki(t)):e||(t.Ea.add(2),await ys(t),t.Ra.set("Unknown"))}function _s(r){return r.ma||(r.ma=(function(t,n,s){const i=ne(t);return i.sa(),new H1(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Xo:J1.bind(null,r),t_:X1.bind(null,r),r_:Z1.bind(null,r),H_:eR.bind(null,r)}),r.da.push((async e=>{e?(r.ma.B_(),Tu(r)?bu(r):r.Ra.set("Unknown")):(await r.ma.stop(),fy(r))}))),r.ma}function On(r){return r.fa||(r.fa=(function(t,n,s){const i=ne(t);return i.sa(),new G1(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:rR.bind(null,r),r_:oR.bind(null,r),ta:sR.bind(null,r),na:iR.bind(null,r)}),r.da.push((async e=>{e?(r.fa.B_(),await Wi(r)):(await r.fa.stop(),r.Ta.length>0&&(q(Ir,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const o=Date.now()+n,c=new Su(e,t,o,s,i);return c.start(n),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new z(O.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Au(r,e){if(it("AsyncQueue",`${e}: ${r}`),Mn(r))return new z(O.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{static emptySet(e){return new Gr(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||K.comparator(t.key,n.key):(t,n)=>K.comparator(t.key,n.key),this.keyedMap=ei(),this.sortedSet=new be(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Gr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Gr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(){this.ga=new be(K.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Y(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class us{constructor(e,t,n,s,i,o,c,l,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,s,i){const o=[];return t.forEach((c=>{o.push({type:0,doc:c})})),new us(e,t,Gr.emptySet(t),o,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ua(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class lR{constructor(){this.queries=Hf(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const s=ne(t),i=s.queries;s.queries=Hf(),i.forEach(((o,c)=>{for(const l of c.Sa)l.onError(n)}))})(this,new z(O.ABORTED,"Firestore shutting down"))}}function Hf(){return new sn((r=>gg(r)),Ua)}async function Ru(r,e){const t=ne(r);let n=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(n=2):(i=new cR,n=e.Da()?0:1);try{switch(n){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const c=Au(o,`Initialization of query '${qr(e.query)}' failed`);return void e.onError(c)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Cu(t)}async function Pu(r,e){const t=ne(r),n=e.query;let s=3;const i=t.queries.get(n);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function uR(r,e){const t=ne(r);let n=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const c of o.Sa)c.Fa(s)&&(n=!0);o.wa=s}}n&&Cu(t)}function hR(r,e,t){const n=ne(r),s=n.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);n.queries.delete(e)}function Cu(r){r.Ca.forEach((e=>{e.next()}))}var Sl,Gf;(Gf=Sl||(Sl={})).Ma="default",Gf.Cache="cache";class xu{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)s.type!==3&&n.push(s);e=new us(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=us.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Sl.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yy{constructor(e){this.key=e}}class _y{constructor(e){this.key=e}}class dR{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ae(),this.mutatedKeys=ae(),this.eu=yg(e),this.tu=new Gr(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new zf,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,c=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((d,m)=>{const p=s.get(d),b=zi(this.query,m)?m:null,R=!!p&&this.mutatedKeys.has(p.key),A=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let N=!1;p&&b?p.data.isEqual(b.data)?R!==A&&(n.track({type:3,doc:b}),N=!0):this.su(p,b)||(n.track({type:2,doc:b}),N=!0,(l&&this.eu(b,l)>0||u&&this.eu(b,u)<0)&&(c=!0)):!p&&b?(n.track({type:0,doc:b}),N=!0):p&&!b&&(n.track({type:1,doc:p}),N=!0,(l||u)&&(c=!0)),N&&(b?(o=o.add(b),i=A?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),n.track({type:1,doc:d})}return{tu:o,iu:n,Cs:c,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((d,m)=>(function(b,R){const A=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Y(20277,{Rt:N})}};return A(b)-A(R)})(d.type,m.type)||this.eu(d.doc,m.doc))),this.ou(n),s=s??!1;const c=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new us(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new zf,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ae(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new _y(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new yy(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=ae();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return us.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Nu="SyncEngine";class fR{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class mR{constructor(e){this.key=e,this.hu=!1}}class pR{constructor(e,t,n,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new sn((c=>gg(c)),Ua),this.Iu=new Map,this.Eu=new Set,this.du=new be(K.comparator),this.Au=new Map,this.Ru=new gu,this.Vu={},this.mu=new Map,this.fu=Er.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function gR(r,e,t=!0){const n=Ty(r);let s;const i=n.Tu.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await vy(n,e,t,!0),s}async function yR(r,e){const t=Ty(r);await vy(t,e,!0,!1)}async function vy(r,e,t,n){const s=await M1(r.localStore,vt(e)),i=s.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let c;return n&&(c=await _R(r,e,i,o==="current",s.resumeToken)),r.isPrimaryClient&&t&&hy(r.remoteStore,s),c}async function _R(r,e,t,n,s){r.pu=(m,p,b)=>(async function(A,N,D,V){let j=N.view.ru(D);j.Cs&&(j=await Ff(A.localStore,N.query,!1).then((({documents:I})=>N.view.ru(I,j))));const U=V&&V.targetChanges.get(N.targetId),Q=V&&V.targetMismatches.get(N.targetId)!=null,H=N.view.applyChanges(j,A.isPrimaryClient,U,Q);return Wf(A,N.targetId,H.au),H.snapshot})(r,m,p,b);const i=await Ff(r.localStore,e,!0),o=new dR(e,i.Qs),c=o.ru(i.documents),l=Gi.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",s),u=o.applyChanges(c,r.isPrimaryClient,l);Wf(r,t,u.au);const d=new fR(e,t,o);return r.Tu.set(e,d),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),u.snapshot}async function vR(r,e,t){const n=ne(r),s=n.Tu.get(e),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter((o=>!Ua(o,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await bl(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Eu(n.remoteStore,s.targetId),Al(n,s.targetId)})).catch(Rr)):(Al(n,s.targetId),await bl(n.localStore,s.targetId,!0))}async function wR(r,e){const t=ne(r),n=t.Tu.get(e),s=t.Iu.get(n.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Eu(t.remoteStore,n.targetId))}async function ER(r,e,t){const n=Sy(r);try{const s=await(function(o,c){const l=ne(o),u=pe.now(),d=c.reduce(((b,R)=>b.add(R.key)),ae());let m,p;return l.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let R=ft(),A=ae();return l.Ns.getEntries(b,d).next((N=>{R=N,R.forEach(((D,V)=>{V.isValidDocument()||(A=A.add(D))}))})).next((()=>l.localDocuments.getOverlayedDocuments(b,R))).next((N=>{m=N;const D=[];for(const V of c){const j=LA(V,m.get(V.key).overlayedDocument);j!=null&&D.push(new on(V.key,j,ag(j.value.mapValue),Ue.exists(!0)))}return l.mutationQueue.addMutationBatch(b,u,D,c)})).next((N=>{p=N;const D=N.applyToLocalDocumentSet(m,A);return l.documentOverlayCache.saveOverlays(b,N.batchId,D)}))})).then((()=>({batchId:p.batchId,changes:vg(m)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),(function(o,c,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new be(se)),u=u.insert(c,l),o.Vu[o.currentUser.toKey()]=u})(n,s.batchId,t),await Qi(n,s.changes),await Wi(n.remoteStore)}catch(s){const i=Au(s,"Failed to persist write");t.reject(i)}}async function wy(r,e){const t=ne(r);try{const n=await V1(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const o=t.Au.get(i);o&&(J(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?J(o.hu,14607):s.removedDocuments.size>0&&(J(o.hu,42227),o.hu=!1))})),await Qi(t,n,e)}catch(n){await Rr(n)}}function Kf(r,e,t){const n=ne(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const s=[];n.Tu.forEach(((i,o)=>{const c=o.view.va(e);c.snapshot&&s.push(c.snapshot)})),(function(o,c){const l=ne(o);l.onlineState=c;let u=!1;l.queries.forEach(((d,m)=>{for(const p of m.Sa)p.va(c)&&(u=!0)})),u&&Cu(l)})(n.eventManager,e),s.length&&n.Pu.H_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function IR(r,e,t){const n=ne(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Au.get(e),i=s&&s.key;if(i){let o=new be(K.comparator);o=o.insert(i,ke.newNoDocument(i,Z.min()));const c=ae().add(i),l=new $a(Z.min(),new Map,new be(se),o,c);await wy(n,l),n.du=n.du.remove(i),n.Au.delete(e),ku(n)}else await bl(n.localStore,e,!1).then((()=>Al(n,e,t))).catch(Rr)}async function bR(r,e){const t=ne(r),n=e.batch.batchId;try{const s=await D1(t.localStore,e);Iy(t,n,null),Ey(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Qi(t,s)}catch(s){await Rr(s)}}async function TR(r,e,t){const n=ne(r);try{const s=await(function(o,c){const l=ne(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let d;return l.mutationQueue.lookupMutationBatch(u,c).next((m=>(J(m!==null,37113),d=m.keys(),l.mutationQueue.removeMutationBatch(u,m)))).next((()=>l.mutationQueue.performConsistencyCheck(u))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(u,d,c))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d))).next((()=>l.localDocuments.getDocuments(u,d)))}))})(n.localStore,e);Iy(n,e,t),Ey(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Qi(n,s)}catch(s){await Rr(s)}}function Ey(r,e){(r.mu.get(e)||[]).forEach((t=>{t.resolve()})),r.mu.delete(e)}function Iy(r,e,t){const n=ne(r);let s=n.Vu[n.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),n.Vu[n.currentUser.toKey()]=s}}function Al(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Iu.get(e))r.Tu.delete(n),t&&r.Pu.yu(n,t);r.Iu.delete(e),r.isPrimaryClient&&r.Ru.jr(e).forEach((n=>{r.Ru.containsKey(n)||by(r,n)}))}function by(r,e){r.Eu.delete(e.path.canonicalString());const t=r.du.get(e);t!==null&&(Eu(r.remoteStore,t),r.du=r.du.remove(e),r.Au.delete(t),ku(r))}function Wf(r,e,t){for(const n of t)n instanceof yy?(r.Ru.addReference(n.key,e),SR(r,n)):n instanceof _y?(q(Nu,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,e),r.Ru.containsKey(n.key)||by(r,n.key)):Y(19791,{wu:n})}function SR(r,e){const t=e.key,n=t.path.canonicalString();r.du.get(t)||r.Eu.has(n)||(q(Nu,"New document in limbo: "+t),r.Eu.add(n),ku(r))}function ku(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const e=r.Eu.values().next().value;r.Eu.delete(e);const t=new K(fe.fromString(e)),n=r.fu.next();r.Au.set(n,new mR(t)),r.du=r.du.insert(t,n),hy(r.remoteStore,new Kt(vt($i(t.path)),n,"TargetPurposeLimboResolution",_t.ce))}}async function Qi(r,e,t){const n=ne(r),s=[],i=[],o=[];n.Tu.isEmpty()||(n.Tu.forEach(((c,l)=>{o.push(n.pu(l,e,t).then((u=>{var d;if((u||t)&&n.isPrimaryClient){const m=u?!u.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:d.current;n.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(u){s.push(u);const m=vu.As(l.targetId,u);i.push(m)}})))})),await Promise.all(o),n.Pu.H_(s),await(async function(l,u){const d=ne(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>P.forEach(u,(p=>P.forEach(p.Es,(b=>d.persistence.referenceDelegate.addReference(m,p.targetId,b))).next((()=>P.forEach(p.ds,(b=>d.persistence.referenceDelegate.removeReference(m,p.targetId,b)))))))))}catch(m){if(!Mn(m))throw m;q(wu,"Failed to update sequence numbers: "+m)}for(const m of u){const p=m.targetId;if(!m.fromCache){const b=d.Ms.get(p),R=b.snapshotVersion,A=b.withLastLimboFreeSnapshotVersion(R);d.Ms=d.Ms.insert(p,A)}}})(n.localStore,i))}async function AR(r,e){const t=ne(r);if(!t.currentUser.isEqual(e)){q(Nu,"User change. New user:",e.toKey());const n=await oy(t.localStore,e);t.currentUser=e,(function(i,o){i.mu.forEach((c=>{c.forEach((l=>{l.reject(new z(O.CANCELLED,o))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Qi(t,n.Ls)}}function RR(r,e){const t=ne(r),n=t.Au.get(e);if(n&&n.hu)return ae().add(n.key);{let s=ae();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const c=t.Tu.get(o);s=s.unionWith(c.view.nu)}return s}}function Ty(r){const e=ne(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=wy.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=RR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=IR.bind(null,e),e.Pu.H_=uR.bind(null,e.eventManager),e.Pu.yu=hR.bind(null,e.eventManager),e}function Sy(r){const e=ne(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=bR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=TR.bind(null,e),e}class ki{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ka(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return iy(this.persistence,new sy,e.initialUser,this.serializer)}Cu(e){return new yu(Ga.mi,this.serializer)}Du(e){return new cy}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ki.provider={build:()=>new ki};class PR extends ki{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){J(this.persistence.referenceDelegate instanceof pa,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Zg(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?et.withCacheSize(this.cacheSizeBytes):et.DEFAULT;return new yu((n=>pa.mi(n,t)),this.serializer)}}class CR extends ki{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Sy(this.xu.syncEngine),await Wi(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return iy(this.persistence,new sy,e.initialUser,this.serializer)}Fu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Zg(n,e.asyncQueue,t)}Mu(e,t){const n=new LS(t,this.persistence);return new OS(e.asyncQueue,n)}Cu(e){const t=C1(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?et.withCacheSize(this.cacheSizeBytes):et.DEFAULT;return new _u(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,z1(),qo(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new cy}}class ya{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Kf(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=AR.bind(null,this.syncEngine),await aR(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new lR})()}createDatastore(e){const t=Ka(e.databaseInfo.databaseId),n=(function(i){return new $1(i)})(e.databaseInfo);return(function(i,o,c,l){return new W1(i,o,c,l)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,s,i,o,c){return new Y1(n,s,i,o,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>Kf(this.syncEngine,t,0)),(function(){return Bf.v()?new Bf:new U1})())}createSyncEngine(e,t){return(function(s,i,o,c,l,u,d){const m=new pR(s,i,o,c,l,u);return d&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(s){const i=ne(s);q(Ir,"RemoteStore shutting down."),i.Ea.add(5),await ys(i),i.Aa.shutdown(),i.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}ya.provider={build:()=>new ya};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):it("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ln="FirestoreClient";class xR{constructor(e,t,n,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Qe.UNAUTHENTICATED,this.clientId=Jl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async o=>{q(Ln,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,(o=>(q(Ln,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Au(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Lc(r,e){r.asyncQueue.verifyOperationInProgress(),q(Ln,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener((async s=>{n.isEqual(s)||(await oy(e.localStore,s),n=s)})),e.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=e}async function Qf(r,e){r.asyncQueue.verifyOperationInProgress();const t=await Ay(r);q(Ln,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener((n=>$f(e.remoteStore,n))),r.setAppCheckTokenChangeListener(((n,s)=>$f(e.remoteStore,s))),r._onlineComponents=e}async function Ay(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){q(Ln,"Using user provided OfflineComponentProvider");try{await Lc(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===O.FAILED_PRECONDITION||s.code===O.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;pr("Error using user provided cache. Falling back to memory cache: "+t),await Lc(r,new ki)}}else q(Ln,"Using default OfflineComponentProvider"),await Lc(r,new PR(void 0));return r._offlineComponents}async function Vu(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(q(Ln,"Using user provided OnlineComponentProvider"),await Qf(r,r._uninitializedComponentsProvider._online)):(q(Ln,"Using default OnlineComponentProvider"),await Qf(r,new ya))),r._onlineComponents}function Ry(r){return Ay(r).then((e=>e.persistence))}function Py(r){return Vu(r).then((e=>e.remoteStore))}function NR(r){return Vu(r).then((e=>e.syncEngine))}async function _a(r){const e=await Vu(r),t=e.eventManager;return t.onListen=gR.bind(null,e.syncEngine),t.onUnlisten=vR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=yR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=wR.bind(null,e.syncEngine),t}function kR(r){return r.asyncQueue.enqueue((async()=>{const e=await Ry(r),t=await Py(r);return e.setNetworkEnabled(!0),(function(s){const i=ne(s);return i.Ea.delete(0),Ki(i)})(t)}))}function DR(r){return r.asyncQueue.enqueue((async()=>{const e=await Ry(r),t=await Py(r);return e.setNetworkEnabled(!1),(async function(s){const i=ne(s);i.Ea.add(0),await ys(i),i.Ra.set("Offline")})(t)}))}function VR(r,e,t={}){const n=new Lt;return r.asyncQueue.enqueueAndForget((async()=>(function(i,o,c,l,u){const d=new Du({next:p=>{d.Nu(),o.enqueueAndForget((()=>Pu(i,m)));const b=p.docs.has(c);!b&&p.fromCache?u.reject(new z(O.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&p.fromCache&&l&&l.source==="server"?u.reject(new z(O.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),m=new xu($i(c.path),d,{includeMetadataChanges:!0,qa:!0});return Ru(i,m)})(await _a(r),r.asyncQueue,e,t,n))),n.promise}function OR(r,e,t={}){const n=new Lt;return r.asyncQueue.enqueueAndForget((async()=>(function(i,o,c,l,u){const d=new Du({next:p=>{d.Nu(),o.enqueueAndForget((()=>Pu(i,m))),p.fromCache&&l.source==="server"?u.reject(new z(O.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),m=new xu(c,d,{includeMetadataChanges:!0,qa:!0});return Ru(i,m)})(await _a(r),r.asyncQueue,e,t,n))),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cy(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yf=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xy="firestore.googleapis.com",Jf=!0;class Xf{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new z(O.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=xy,this.ssl=Jf}else this.host=e.host,this.ssl=e.ssl??Jf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Qg;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<d1)throw new z(O.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}xS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cy(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new z(O.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new z(O.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new z(O.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Wa{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Xf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new z(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new z(O.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Xf(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new wS;switch(n.type){case"firstParty":return new TS(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new z(O.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=Yf.get(t);n&&(q("ComponentProvider","Removing Datastore"),Yf.delete(t),n.terminate())})(this),Promise.resolve()}}function LR(r,e,t,n={}){var u;r=He(r,Wa);const s=ds(e),i=r._getSettings(),o={...i,emulatorOptions:r._getEmulatorOptions()},c=`${e}:${t}`;s&&(pp(`https://${c}`),gp("Firestore",!0)),i.host!==xy&&i.host!==c&&pr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:c,ssl:s,emulatorOptions:n};if(!kn(l,o)&&(r._setSettings(l),n.mockUserToken)){let d,m;if(typeof n.mockUserToken=="string")d=n.mockUserToken,m=Qe.MOCK_USER;else{d=YT(n.mockUserToken,(u=r._app)==null?void 0:u.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new z(O.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new Qe(p)}r._authCredentials=new ES(new Vp(d,m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new an(this.firestore,e,this._query)}}class De{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new De(this.firestore,e,this._key)}toJSON(){return{type:De._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ji(t,De._jsonSchema))return new De(e,n||null,new K(fe.fromString(t.referencePath)))}}De._jsonSchemaVersion="firestore/documentReference/1.0",De._jsonSchema={type:Le("string",De._jsonSchemaVersion),referencePath:Le("string")};class xn extends an{constructor(e,t,n){super(e,t,$i(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new De(this.firestore,null,new K(e))}withConverter(e){return new xn(this.firestore,e,this._path)}}function Re(r,e,...t){if(r=Ve(r),Lp("collection","path",e),r instanceof Wa){const n=fe.fromString(e,...t);return Bd(n),new xn(r,null,n)}{if(!(r instanceof De||r instanceof xn))throw new z(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(fe.fromString(e,...t));return Bd(n),new xn(r.firestore,null,n)}}function Ee(r,e,...t){if(r=Ve(r),arguments.length===1&&(e=Jl.newId()),Lp("doc","path",e),r instanceof Wa){const n=fe.fromString(e,...t);return jd(n),new De(r,null,new K(n))}{if(!(r instanceof De||r instanceof xn))throw new z(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(fe.fromString(e,...t));return jd(n),new De(r.firestore,r instanceof xn?r.converter:null,new K(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zf="AsyncQueue";class em{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ly(this,"async_queue_retry"),this._c=()=>{const n=qo();n&&q(Zf,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=qo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=qo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Lt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Mn(e))throw e;q(Zf,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,it("INTERNAL UNHANDLED ERROR: ",tm(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Su.createAndSchedule(this,e,t,n,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&Y(47125,{Pc:tm(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function tm(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nm(r){return(function(t,n){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1})(r,["next","error","complete"])}class pt extends Wa{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new em,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new em(e),this._firestoreClient=void 0,await e}}}function MR(r,e){const t=typeof r=="object"?r:Tp(),n=typeof r=="string"?r:oa,s=Ql(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=WT("firestore");i&&LR(s,...i)}return s}function Cr(r){if(r._terminated)throw new z(O.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Ny(r),r._firestoreClient}function Ny(r){var n,s,i;const e=r._freezeSettings(),t=(function(c,l,u,d){return new hA(c,l,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Cy(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(r._databaseId,((n=r._app)==null?void 0:n.options.appId)||"",r._persistenceKey,e);r._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new xR(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&(function(c){const l=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(l),_online:l}})(r._componentsProvider))}function FR(r,e){pr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings();return UR(r,ya.provider,{build:n=>new CR(n,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function UR(r,e,t){if((r=He(r,pt))._firestoreClient||r._terminated)throw new z(O.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new z(O.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:e,_offline:t},Ny(r)}function jR(r){return kR(Cr(r=He(r,pt)))}function BR(r){return DR(Cr(r=He(r,pt)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yt(Me.fromBase64String(e))}catch(t){throw new z(O.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new yt(Me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:yt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ji(e,yt._jsonSchema))return yt.fromBase64String(e.bytes)}}yt._jsonSchemaVersion="firestore/bytes/1.0",yt._jsonSchema={type:Le("string",yt._jsonSchemaVersion),bytes:Le("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new z(O.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new z(O.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new z(O.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Mt._jsonSchemaVersion}}static fromJSON(e){if(ji(e,Mt._jsonSchema))return new Mt(e.latitude,e.longitude)}}Mt._jsonSchemaVersion="firestore/geoPoint/1.0",Mt._jsonSchema={type:Le("string",Mt._jsonSchemaVersion),latitude:Le("number"),longitude:Le("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ft._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ji(e,Ft._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Ft(e.vectorValues);throw new z(O.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ft._jsonSchemaVersion="firestore/vectorValue/1.0",Ft._jsonSchema={type:Le("string",Ft._jsonSchemaVersion),vectorValues:Le("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qR=/^__.*__$/;class $R{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new on(e,this.data,this.fieldMask,t,this.fieldTransforms):new gs(e,this.data,t,this.fieldTransforms)}}class ky{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new on(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Dy(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Y(40011,{Ac:r})}}class Qa{constructor(e,t,n,s,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Qa({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return va(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Dy(this.Ac)&&qR.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class zR{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ka(e)}Cc(e,t,n,s=!1){return new Qa({Ac:e,methodName:t,Dc:n,path:Pe.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ji(r){const e=r._freezeSettings(),t=Ka(r._databaseId);return new zR(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Ou(r,e,t,n,s,i={}){const o=r.Cc(i.merge||i.mergeFields?2:0,e,t,s);Uu("Data must be an object, but it was:",o,n);const c=Ly(n,o);let l,u;if(i.merge)l=new ut(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const m of i.mergeFields){const p=Rl(e,m,t);if(!o.contains(p))throw new z(O.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Fy(d,p)||d.push(p)}l=new ut(d),u=o.fieldTransforms.filter((m=>l.covers(m.field)))}else l=null,u=o.fieldTransforms;return new $R(new tt(c),l,u)}class Ya extends vs{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ya}}function HR(r,e,t){return new Qa({Ac:3,Dc:e.settings.Dc,methodName:r._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Lu extends vs{_toFieldTransform(e){return new Ba(e.path,new os)}isEqual(e){return e instanceof Lu}}class Mu extends vs{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=HR(this,e,!0),n=this.vc.map((i=>ws(i,t))),s=new _r(n);return new Ba(e.path,s)}isEqual(e){return e instanceof Mu&&kn(this.vc,e.vc)}}class Fu extends vs{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new cs(e.serializer,Ig(e.serializer,this.Fc));return new Ba(e.path,t)}isEqual(e){return e instanceof Fu&&this.Fc===e.Fc}}function Vy(r,e,t,n){const s=r.Cc(1,e,t);Uu("Data must be an object, but it was:",s,n);const i=[],o=tt.empty();Fn(n,((l,u)=>{const d=ju(e,l,t);u=Ve(u);const m=s.yc(d);if(u instanceof Ya)i.push(d);else{const p=ws(u,m);p!=null&&(i.push(d),o.set(d,p))}}));const c=new ut(i);return new ky(o,c,s.fieldTransforms)}function Oy(r,e,t,n,s,i){const o=r.Cc(1,e,t),c=[Rl(e,n,t)],l=[s];if(i.length%2!=0)throw new z(O.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)c.push(Rl(e,i[p])),l.push(i[p+1]);const u=[],d=tt.empty();for(let p=c.length-1;p>=0;--p)if(!Fy(u,c[p])){const b=c[p];let R=l[p];R=Ve(R);const A=o.yc(b);if(R instanceof Ya)u.push(b);else{const N=ws(R,A);N!=null&&(u.push(b),d.set(b,N))}}const m=new ut(u);return new ky(d,m,o.fieldTransforms)}function GR(r,e,t,n=!1){return ws(t,r.Cc(n?4:3,e))}function ws(r,e){if(My(r=Ve(r)))return Uu("Unsupported field value:",e,r),Ly(r,e);if(r instanceof vs)return(function(n,s){if(!Dy(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,s){const i=[];let o=0;for(const c of n){let l=ws(c,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}})(r,e)}return(function(n,s){if((n=Ve(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Ig(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=pe.fromDate(n);return{timestampValue:ls(s.serializer,i)}}if(n instanceof pe){const i=new pe(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ls(s.serializer,i)}}if(n instanceof Mt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof yt)return{bytesValue:Dg(s.serializer,n._byteString)};if(n instanceof De){const i=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:fu(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Ft)return(function(o,c){return{mapValue:{fields:{[iu]:{stringValue:ou},[ns]:{arrayValue:{values:o.toArray().map((u=>{if(typeof u!="number")throw c.Sc("VectorValues must only contain numeric values.");return cu(c.serializer,u)}))}}}}}})(n,s);throw s.Sc(`Unsupported field value: ${Na(n)}`)})(r,e)}function Ly(r,e){const t={};return Xp(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Fn(r,((n,s)=>{const i=ws(s,e.mc(n));i!=null&&(t[n]=i)})),{mapValue:{fields:t}}}function My(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof pe||r instanceof Mt||r instanceof yt||r instanceof De||r instanceof vs||r instanceof Ft)}function Uu(r,e,t){if(!My(t)||!Mp(t)){const n=Na(t);throw n==="an object"?e.Sc(r+" a custom object"):e.Sc(r+" "+n)}}function Rl(r,e,t){if((e=Ve(e))instanceof Yi)return e._internalPath;if(typeof e=="string")return ju(r,e);throw va("Field path arguments must be of type string or ",r,!1,void 0,t)}const KR=new RegExp("[~\\*/\\[\\]]");function ju(r,e,t){if(e.search(KR)>=0)throw va(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Yi(...e.split("."))._internalPath}catch{throw va(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function va(r,e,t,n,s){const i=n&&!n.isEmpty(),o=s!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${n}`),o&&(l+=` in document ${s}`),l+=")"),new z(O.INVALID_ARGUMENT,c+r+l)}function Fy(r,e){return r.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new De(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new WR(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ja("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class WR extends Uy{data(){return super.data()}}function Ja(r,e){return typeof e=="string"?ju(r,e):e instanceof Yi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jy(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new z(O.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bu{}class qu extends Bu{}function It(r,e,...t){let n=[];e instanceof Bu&&n.push(e),n=n.concat(t),(function(i){const o=i.filter((l=>l instanceof $u)).length,c=i.filter((l=>l instanceof Xa)).length;if(o>1||o>0&&c>0)throw new z(O.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const s of n)r=s._apply(r);return r}class Xa extends qu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Xa(e,t,n)}_apply(e){const t=this._parse(e);return By(e._query,t),new an(e.firestore,e.converter,pl(e._query,t))}_parse(e){const t=Ji(e.firestore);return(function(i,o,c,l,u,d,m){let p;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new z(O.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){sm(m,d);const R=[];for(const A of m)R.push(rm(l,i,A));p={arrayValue:{values:R}}}else p=rm(l,i,m)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||sm(m,d),p=GR(c,o,m,d==="in"||d==="not-in");return ue.create(u,d,p)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Pl(r,e,t){const n=e,s=Ja("where",r);return Xa._create(s,n,t)}class $u extends Bu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new $u(e,t)}_parse(e){const t=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return t.length===1?t[0]:ge.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let o=s;const c=i.getFlattenedFilters();for(const l of c)By(o,l),o=pl(o,l)})(e._query,t),new an(e.firestore,e.converter,pl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class zu extends qu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new zu(e,t)}_apply(e){const t=(function(s,i,o){if(s.startAt!==null)throw new z(O.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new z(O.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ni(i,o)})(e._query,this._field,this._direction);return new an(e.firestore,e.converter,(function(s,i){const o=s.explicitOrderBy.concat([i]);return new ps(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,t))}}function Ct(r,e="asc"){const t=e,n=Ja("orderBy",r);return zu._create(n,t)}class Hu extends qu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Hu(e,t,n)}_apply(e){return new an(e.firestore,e.converter,la(e._query,this._limit,this._limitType))}}function Fx(r){return NS("limit",r),Hu._create("limit",r,"F")}function rm(r,e,t){if(typeof(t=Ve(t))=="string"){if(t==="")throw new z(O.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!pg(e)&&t.indexOf("/")!==-1)throw new z(O.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(fe.fromString(t));if(!K.isDocumentKey(n))throw new z(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Ci(r,new K(n))}if(t instanceof De)return Ci(r,t._key);throw new z(O.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Na(t)}.`)}function sm(r,e){if(!Array.isArray(r)||r.length===0)throw new z(O.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function By(r,e){const t=(function(s,i){for(const o of s)for(const c of o.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null})(r.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new z(O.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new z(O.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class QR{convertValue(e,t="none"){switch(Dn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(en(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Y(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Fn(e,((s,i)=>{n[s]=this.convertValue(i,t)})),n}convertVectorValue(e){var n,s,i;const t=(i=(s=(n=e.fields)==null?void 0:n[ns].arrayValue)==null?void 0:s.values)==null?void 0:i.map((o=>Ie(o.doubleValue)));return new Ft(t)}convertGeoPoint(e){return new Mt(Ie(e.latitude),Ie(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ma(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ri(e));default:return null}}convertTimestamp(e){const t=Zt(e);return new pe(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=fe.fromString(e);J($g(n),9688,{name:e});const s=new gr(n.get(1),n.get(3)),i=new K(n.popFirst(5));return s.isEqual(t)||it(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class ri{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hr extends Uy{constructor(e,t,n,s,i,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $o(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ja("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new z(O.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=hr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}hr._jsonSchemaVersion="firestore/documentSnapshot/1.0",hr._jsonSchema={type:Le("string",hr._jsonSchemaVersion),bundleSource:Le("string","DocumentSnapshot"),bundleName:Le("string"),bundle:Le("string")};class $o extends hr{data(e={}){return super.data(e)}}class dr{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ri(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new $o(this._firestore,this._userDataWriter,n.key,n,new ri(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new z(O.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map((c=>{const l=new $o(s._firestore,s._userDataWriter,c.doc.key,c.doc,new ri(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>i||c.type!==3)).map((c=>{const l=new $o(s._firestore,s._userDataWriter,c.doc.key,c.doc,new ri(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,d=-1;return c.type!==0&&(u=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),d=o.indexOf(c.doc.key)),{type:YR(c.type),doc:l,oldIndex:u,newIndex:d}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new z(O.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=dr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Jl.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function YR(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Y(61501,{type:r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JR(r){r=He(r,De);const e=He(r.firestore,pt);return VR(Cr(e),r._key).then((t=>qy(e,r,t)))}dr._jsonSchemaVersion="firestore/querySnapshot/1.0",dr._jsonSchema={type:Le("string",dr._jsonSchemaVersion),bundleSource:Le("string","QuerySnapshot"),bundleName:Le("string"),bundle:Le("string")};class Ku extends QR{constructor(e){super(),this.firestore=e}convertBytes(e){return new yt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new De(this.firestore,null,t)}}function si(r){r=He(r,an);const e=He(r.firestore,pt),t=Cr(e),n=new Ku(e);return jy(r._query),OR(t,r._query).then((s=>new dr(e,n,r,s)))}function We(r,e,t){r=He(r,De);const n=He(r.firestore,pt),s=Gu(r.converter,e,t);return Xi(n,[Ou(Ji(n),"setDoc",r._key,s,r.converter!==null,t).toMutation(r._key,Ue.none())])}function Ys(r,e,t,...n){r=He(r,De);const s=He(r.firestore,pt),i=Ji(s);let o;return o=typeof(e=Ve(e))=="string"||e instanceof Yi?Oy(i,"updateDoc",r._key,e,t,n):Vy(i,"updateDoc",r._key,e),Xi(s,[o.toMutation(r._key,Ue.exists(!0))])}function Ux(r){return Xi(He(r.firestore,pt),[new Hi(r._key,Ue.none())])}function jx(r,e){const t=He(r.firestore,pt),n=Ee(r),s=Gu(r.converter,e);return Xi(t,[Ou(Ji(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,Ue.exists(!1))]).then((()=>n))}function _n(r,...e){var l,u,d;r=Ve(r);let t={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||nm(e[n])||(t=e[n++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(nm(e[n])){const m=e[n];e[n]=(l=m.next)==null?void 0:l.bind(m),e[n+1]=(u=m.error)==null?void 0:u.bind(m),e[n+2]=(d=m.complete)==null?void 0:d.bind(m)}let i,o,c;if(r instanceof De)o=He(r.firestore,pt),c=$i(r._key.path),i={next:m=>{e[n]&&e[n](qy(o,r,m))},error:e[n+1],complete:e[n+2]};else{const m=He(r,an);o=He(m.firestore,pt),c=m._query;const p=new Ku(o);i={next:b=>{e[n]&&e[n](new dr(o,p,m,b))},error:e[n+1],complete:e[n+2]},jy(r._query)}return(function(p,b,R,A){const N=new Du(A),D=new xu(b,N,R);return p.asyncQueue.enqueueAndForget((async()=>Ru(await _a(p),D))),()=>{N.Nu(),p.asyncQueue.enqueueAndForget((async()=>Pu(await _a(p),D)))}})(Cr(o),c,s,i)}function Xi(r,e){return(function(n,s){const i=new Lt;return n.asyncQueue.enqueueAndForget((async()=>ER(await NR(n),s,i))),i.promise})(Cr(r),e)}function qy(r,e,t){const n=t.docs.get(e._key),s=new Ku(r);return new hr(r,s,e._key,n,new ri(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XR{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ji(e)}set(e,t,n){this._verifyNotCommitted();const s=Mc(e,this._firestore),i=Gu(s.converter,t,n),o=Ou(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(o.toMutation(s._key,Ue.none())),this}update(e,t,n,...s){this._verifyNotCommitted();const i=Mc(e,this._firestore);let o;return o=typeof(t=Ve(t))=="string"||t instanceof Yi?Oy(this._dataReader,"WriteBatch.update",i._key,t,n,s):Vy(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Ue.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Mc(e,this._firestore);return this._mutations=this._mutations.concat(new Hi(t._key,Ue.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new z(O.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Mc(r,e){if((r=Ve(r)).firestore!==e)throw new z(O.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function Bx(){return new Lu("serverTimestamp")}function qx(...r){return new Mu("arrayUnion",r)}function $x(r){return new Fu("increment",r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zx(r){return Cr(r=He(r,pt)),new XR(r,(e=>Xi(r,e)))}(function(e,t=!0){(function(s){ms=s})(fs),Yr(new fr("firestore",((n,{instanceIdentifier:s,options:i})=>{const o=n.getProvider("app").getImmediate(),c=new pt(new IS(n.getProvider("auth-internal")),new SS(o,n.getProvider("app-check-internal")),(function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new z(O.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gr(u.options.projectId,d)})(o,s),o);return i={useFetchStreams:t,...i},c._setSettings(i),c}),"PUBLIC").setMultipleInstances(!0)),Rn(Ld,Md,e),Rn(Ld,Md,"esm2020")})();var ZR="firebase",eP="12.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rn(ZR,eP,"app");const Jn=(...r)=>{},$y=(...r)=>{},zy=(...r)=>{},Fc=Object.freeze(Object.defineProperty({__proto__:null,error:zy,log:Jn,warn:$y},Symbol.toStringTag,{value:"Module"}));function Hy(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tP=Hy,Gy=new Fi("auth","Firebase",Hy());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wa=new Kl("@firebase/auth");function nP(r,...e){wa.logLevel<=le.WARN&&wa.warn(`Auth (${fs}): ${r}`,...e)}function zo(r,...e){wa.logLevel<=le.ERROR&&wa.error(`Auth (${fs}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wt(r,...e){throw Qu(r,...e)}function St(r,...e){return Qu(r,...e)}function Wu(r,e,t){const n={...tP(),[e]:t};return new Fi("auth","Firebase",n).create(e,{appName:r.name})}function Ut(r){return Wu(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ky(r,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&wt(r,"argument-error"),Wu(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Qu(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return Gy.create(r,...e)}function ee(r,e,...t){if(!r)throw Qu(e,...t)}function Wt(r){const e="INTERNAL ASSERTION FAILED: "+r;throw zo(e),new Error(e)}function tn(r,e){r||Wt(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cl(){var r;return typeof self<"u"&&((r=self.location)==null?void 0:r.href)||""}function rP(){return im()==="http:"||im()==="https:"}function im(){var r;return typeof self<"u"&&((r=self.location)==null?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rP()||t0()||"connection"in navigator)?navigator.onLine:!0}function iP(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e,t){this.shortDelay=e,this.longDelay=t,tn(t>e,"Short delay should be less than long delay!"),this.isMobile=ZT()||n0()}get(){return sP()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yu(r,e){tn(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Wt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Wt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Wt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aP=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],cP=new Zi(3e4,6e4);function Un(r,e){return r.tenantId&&!e.tenantId?{...e,tenantId:r.tenantId}:e}async function jn(r,e,t,n,s={}){return Qy(r,s,async()=>{let i={},o={};n&&(e==="GET"?o=n:i={body:JSON.stringify(n)});const c=Ui({key:r.config.apiKey,...o}).slice(1),l=await r._getAdditionalHeaders();l["Content-Type"]="application/json",r.languageCode&&(l["X-Firebase-Locale"]=r.languageCode);const u={method:e,headers:l,...i};return e0()||(u.referrerPolicy="no-referrer"),r.emulatorConfig&&ds(r.emulatorConfig.host)&&(u.credentials="include"),Wy.fetch()(await Yy(r,r.config.apiHost,t,c),u)})}async function Qy(r,e,t){r._canInitEmulator=!1;const n={...oP,...e};try{const s=new uP(r),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Ro(r,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const c=i.ok?o.errorMessage:o.error.message,[l,u]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ro(r,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Ro(r,"email-already-in-use",o);if(l==="USER_DISABLED")throw Ro(r,"user-disabled",o);const d=n[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Wu(r,d,u);wt(r,d)}}catch(s){if(s instanceof rn)throw s;wt(r,"network-request-failed",{message:String(s)})}}async function eo(r,e,t,n,s={}){const i=await jn(r,e,t,n,s);return"mfaPendingCredential"in i&&wt(r,"multi-factor-auth-required",{_serverResponse:i}),i}async function Yy(r,e,t,n){const s=`${e}${t}?${n}`,i=r,o=i.config.emulator?Yu(r.config,s):`${r.config.apiScheme}://${s}`;return aP.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function lP(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class uP{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(St(this.auth,"network-request-failed")),cP.get())})}}function Ro(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const s=St(r,e,n);return s.customData._tokenResponse=t,s}function om(r){return r!==void 0&&r.enterprise!==void 0}class hP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return lP(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function dP(r,e){return jn(r,"GET","/v2/recaptchaConfig",Un(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fP(r,e){return jn(r,"POST","/v1/accounts:delete",e)}async function Ea(r,e){return jn(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _i(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function mP(r,e=!1){const t=Ve(r),n=await t.getIdToken(e),s=Ju(n);ee(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:n,authTime:_i(Uc(s.auth_time)),issuedAtTime:_i(Uc(s.iat)),expirationTime:_i(Uc(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Uc(r){return Number(r)*1e3}function Ju(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return zo("JWT malformed, contained fewer than 3 sections"),null;try{const s=up(t);return s?JSON.parse(s):(zo("Failed to decode base64 JWT payload"),null)}catch(s){return zo("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function am(r){const e=Ju(r);return ee(e,"internal-error"),ee(typeof e.exp<"u","internal-error"),ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Di(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof rn&&pP(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function pP({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=_i(this.lastLoginAt),this.creationTime=_i(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ia(r){var m;const e=r.auth,t=await r.getIdToken(),n=await Di(r,Ea(e,{idToken:t}));ee(n==null?void 0:n.users.length,e,"internal-error");const s=n.users[0];r._notifyReloadListener(s);const i=(m=s.providerUserInfo)!=null&&m.length?Jy(s.providerUserInfo):[],o=_P(r.providerData,i),c=r.isAnonymous,l=!(r.email&&s.passwordHash)&&!(o!=null&&o.length),u=c?l:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new xl(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(r,d)}async function yP(r){const e=Ve(r);await Ia(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _P(r,e){return[...r.filter(n=>!e.some(s=>s.providerId===n.providerId)),...e]}function Jy(r){return r.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vP(r,e){const t=await Qy(r,{},async()=>{const n=Ui({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=r.config,o=await Yy(r,s,"/v1/token",`key=${i}`),c=await r._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:c,body:n};return r.emulatorConfig&&ds(r.emulatorConfig.host)&&(l.credentials="include"),Wy.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function wP(r,e){return jn(r,"POST","/v2/accounts:revokeToken",Un(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ee(e.idToken,"internal-error"),ee(typeof e.idToken<"u","internal-error"),ee(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):am(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ee(e.length!==0,"internal-error");const t=am(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:i}=await vP(e,t);this.updateTokensAndExpiration(n,s,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:s,expirationTime:i}=t,o=new Kr;return n&&(ee(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),s&&(ee(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ee(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Kr,this.toJSON())}_performRefresh(){return Wt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(r,e){ee(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class Tt{constructor({uid:e,auth:t,stsTokenManager:n,...s}){this.providerId="firebase",this.proactiveRefresh=new gP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new xl(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Di(this,this.stsTokenManager.getToken(this.auth,e));return ee(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return mP(this,e)}reload(){return yP(this)}_assign(e){this!==e&&(ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Tt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Ia(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(lt(this.auth.app))return Promise.reject(Ut(this.auth));const e=await this.getIdToken();return await Di(this,fP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,c=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:m,emailVerified:p,isAnonymous:b,providerData:R,stsTokenManager:A}=t;ee(m&&A,e,"internal-error");const N=Kr.fromJSON(this.name,A);ee(typeof m=="string",e,"internal-error"),vn(n,e.name),vn(s,e.name),ee(typeof p=="boolean",e,"internal-error"),ee(typeof b=="boolean",e,"internal-error"),vn(i,e.name),vn(o,e.name),vn(c,e.name),vn(l,e.name),vn(u,e.name),vn(d,e.name);const D=new Tt({uid:m,auth:e,email:s,emailVerified:p,displayName:n,isAnonymous:b,photoURL:o,phoneNumber:i,tenantId:c,stsTokenManager:N,createdAt:u,lastLoginAt:d});return R&&Array.isArray(R)&&(D.providerData=R.map(V=>({...V}))),l&&(D._redirectEventId=l),D}static async _fromIdTokenResponse(e,t,n=!1){const s=new Kr;s.updateFromServerResponse(t);const i=new Tt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:n});return await Ia(i),i}static async _fromGetAccountInfoResponse(e,t,n){const s=t.users[0];ee(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Jy(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),c=new Kr;c.updateFromIdToken(n);const l=new Tt({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new xl(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cm=new Map;function Qt(r){tn(r instanceof Function,"Expected a class definition");let e=cm.get(r);return e?(tn(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,cm.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Xy.type="NONE";const lm=Xy;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ho(r,e,t){return`firebase:${r}:${e}:${t}`}class Wr{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:s,name:i}=this.auth;this.fullUserKey=Ho(this.userKey,s.apiKey,i),this.fullPersistenceKey=Ho("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Ea(this.auth,{idToken:e}).catch(()=>{});return t?Tt._fromGetAccountInfoResponse(this.auth,t,e):null}return Tt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Wr(Qt(lm),e,n);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Qt(lm);const o=Ho(n,e.config.apiKey,e.name);let c=null;for(const u of t)try{const d=await u._get(o);if(d){let m;if(typeof d=="string"){const p=await Ea(e,{idToken:d}).catch(()=>{});if(!p)break;m=await Tt._fromGetAccountInfoResponse(e,p,d)}else m=Tt._fromJSON(e,d);u!==i&&(c=m),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Wr(i,e,n):(i=l[0],c&&await i._set(o,c.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Wr(i,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function um(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(n_(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Zy(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(s_(e))return"Blackberry";if(i_(e))return"Webos";if(e_(e))return"Safari";if((e.includes("chrome/")||t_(e))&&!e.includes("edge/"))return"Chrome";if(r_(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function Zy(r=je()){return/firefox\//i.test(r)}function e_(r=je()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function t_(r=je()){return/crios\//i.test(r)}function n_(r=je()){return/iemobile/i.test(r)}function r_(r=je()){return/android/i.test(r)}function s_(r=je()){return/blackberry/i.test(r)}function i_(r=je()){return/webos/i.test(r)}function Xu(r=je()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function EP(r=je()){var e;return Xu(r)&&!!((e=window.navigator)!=null&&e.standalone)}function IP(){return r0()&&document.documentMode===10}function o_(r=je()){return Xu(r)||r_(r)||i_(r)||s_(r)||/windows phone/i.test(r)||n_(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a_(r,e=[]){let t;switch(r){case"Browser":t=um(je());break;case"Worker":t=`${um(je())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${fs}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=i=>new Promise((o,c)=>{try{const l=e(i);o(l)}catch(l){c(l)}});n.onAbort=t,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TP(r,e={}){return jn(r,"GET","/v2/passwordPolicy",Un(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SP=6;class AP{constructor(e){var n;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??SP,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((n=e.allowedNonAlphanumericCharacters)==null?void 0:n.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let s=0;s<e.length;s++)n=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e,t,n,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hm(this),this.idTokenSubscription=new hm(this),this.beforeStateQueue=new bP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Gy,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Qt(t)),this._initializationPromise=this.queue(async()=>{var n,s,i;if(!this._deleted&&(this.persistenceManager=await Wr.create(this,e),(n=this._resolvePersistenceManagerAvailable)==null||n.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Ea(this,{idToken:e}),n=await Tt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(lt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,c=n==null?void 0:n._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===c)&&(l!=null&&l.user)&&(n=l.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ia(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iP()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(lt(this.app))return Promise.reject(Ut(this));const t=e?Ve(e):null;return t&&ee(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return lt(this.app)?Promise.reject(Ut(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return lt(this.app)?Promise.reject(Ut(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Qt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await TP(this),t=new AP(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Fi("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await wP(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Qt(e)||this._popupRedirectResolver;ee(t,this,"argument-error"),this.redirectPersistenceManager=await Wr.create(this,[Qt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)==null?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(ee(c,this,"internal-error"),c.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,n,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=a_(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){var t;if(lt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&nP(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function cn(r){return Ve(r)}class hm{constructor(e){this.auth=e,this.observer=null,this.addObserver=l0(t=>this.observer=t)}get next(){return ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Za={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function PP(r){Za=r}function c_(r){return Za.loadJS(r)}function CP(){return Za.recaptchaEnterpriseScript}function xP(){return Za.gapiScript}function NP(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class kP{constructor(){this.enterprise=new DP}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class DP{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const VP="recaptcha-enterprise",l_="NO_RECAPTCHA";class OP{constructor(e){this.type=VP,this.auth=cn(e)}async verify(e="verify",t=!1){async function n(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,c)=>{dP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const u=new hP(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{c(l)})})}function s(i,o,c){const l=window.grecaptcha;om(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(l_)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new kP().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{n(this.auth).then(c=>{if(!t&&om(window.grecaptcha))s(c,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=CP();l.length!==0&&(l+=c),c_(l).then(()=>{s(c,i,o)}).catch(u=>{o(u)})}}).catch(c=>{o(c)})})}}async function dm(r,e,t,n=!1,s=!1){const i=new OP(r);let o;if(s)o=l_;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const c={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const l=c.phoneEnrollmentInfo.phoneNumber,u=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const l=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return n?Object.assign(c,{captchaResp:o}):Object.assign(c,{captchaResponse:o}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function Nl(r,e,t,n,s){var i;if((i=r._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await dm(r,e,t,t==="getOobCode");return n(r,o)}else return n(r,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await dm(r,e,t,t==="getOobCode");return n(r,c)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LP(r,e){const t=Ql(r,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(kn(i,e??{}))return s;wt(s,"already-initialized")}return t.initialize({options:e})}function MP(r,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Qt);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function FP(r,e,t){const n=cn(r);ee(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const s=!1,i=u_(e),{host:o,port:c}=UP(e),l=c===null?"":`:${c}`,u={url:`${i}//${o}${l}/`},d=Object.freeze({host:o,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!n._canInitEmulator){ee(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),ee(kn(u,n.config.emulator)&&kn(d,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=u,n.emulatorConfig=d,n.settings.appVerificationDisabledForTesting=!0,ds(o)?(pp(`${i}//${o}${l}`),gp("Auth",!0)):jP()}function u_(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function UP(r){const e=u_(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){const i=s[1];return{host:i,port:fm(n.substr(i.length+1))}}else{const[i,o]=n.split(":");return{host:i,port:fm(o)}}}function fm(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function jP(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Wt("not implemented")}_getIdTokenResponse(e){return Wt("not implemented")}_linkToIdToken(e,t){return Wt("not implemented")}_getReauthenticationResolver(e){return Wt("not implemented")}}async function BP(r,e){return jn(r,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qP(r,e){return eo(r,"POST","/v1/accounts:signInWithPassword",Un(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $P(r,e){return eo(r,"POST","/v1/accounts:signInWithEmailLink",Un(r,e))}async function zP(r,e){return eo(r,"POST","/v1/accounts:signInWithEmailLink",Un(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi extends Zu{constructor(e,t,n,s=null){super("password",n),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Vi(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Vi(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Nl(e,t,"signInWithPassword",qP);case"emailLink":return $P(e,{email:this._email,oobCode:this._password});default:wt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Nl(e,n,"signUpPassword",BP);case"emailLink":return zP(e,{idToken:t,email:this._email,oobCode:this._password});default:wt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qr(r,e){return eo(r,"POST","/v1/accounts:signInWithIdp",Un(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HP="http://localhost";class br extends Zu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new br(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):wt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:s,...i}=t;if(!n||!s)return null;const o=new br(n,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Qr(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Qr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Qr(e,t)}buildRequest(){const e={requestUri:HP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ui(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GP(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function KP(r){const e=Js(Xs(r)).link,t=e?Js(Xs(e)).deep_link_id:null,n=Js(Xs(r)).deep_link_id;return(n?Js(Xs(n)).link:null)||n||t||e||r}class eh{constructor(e){const t=Js(Xs(e)),n=t.apiKey??null,s=t.oobCode??null,i=GP(t.mode??null);ee(n&&s&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=KP(e);try{return new eh(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(){this.providerId=Es.PROVIDER_ID}static credential(e,t){return Vi._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=eh.parseLink(t);return ee(n,"argument-error"),Vi._fromEmailAndCode(e,n.code,n.tenantId)}}Es.PROVIDER_ID="password";Es.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Es.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to extends ec{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En extends to{constructor(){super("facebook.com")}static credential(e){return br._fromParams({providerId:En.PROVIDER_ID,signInMethod:En.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return En.credentialFromTaggedObject(e)}static credentialFromError(e){return En.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return En.credential(e.oauthAccessToken)}catch{return null}}}En.FACEBOOK_SIGN_IN_METHOD="facebook.com";En.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt extends to{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return br._fromParams({providerId:Gt.PROVIDER_ID,signInMethod:Gt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Gt.credentialFromTaggedObject(e)}static credentialFromError(e){return Gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Gt.credential(t,n)}catch{return null}}}Gt.GOOGLE_SIGN_IN_METHOD="google.com";Gt.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In extends to{constructor(){super("github.com")}static credential(e){return br._fromParams({providerId:In.PROVIDER_ID,signInMethod:In.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return In.credentialFromTaggedObject(e)}static credentialFromError(e){return In.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return In.credential(e.oauthAccessToken)}catch{return null}}}In.GITHUB_SIGN_IN_METHOD="github.com";In.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn extends to{constructor(){super("twitter.com")}static credential(e,t){return br._fromParams({providerId:bn.PROVIDER_ID,signInMethod:bn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return bn.credentialFromTaggedObject(e)}static credentialFromError(e){return bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return bn.credential(t,n)}catch{return null}}}bn.TWITTER_SIGN_IN_METHOD="twitter.com";bn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WP(r,e){return eo(r,"POST","/v1/accounts:signUp",Un(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,s=!1){const i=await Tt._fromIdTokenResponse(e,n,s),o=mm(n);return new Tr({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const s=mm(n);return new Tr({user:e,providerId:s,_tokenResponse:n,operationType:t})}}function mm(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba extends rn{constructor(e,t,n,s){super(t.code,t.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,ba.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,s){return new ba(e,t,n,s)}}function h_(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ba._fromErrorAndOperation(r,i,e,n):i})}async function QP(r,e,t=!1){const n=await Di(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return Tr._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YP(r,e,t=!1){const{auth:n}=r;if(lt(n.app))return Promise.reject(Ut(n));const s="reauthenticate";try{const i=await Di(r,h_(n,s,e,r),t);ee(i.idToken,n,"internal-error");const o=Ju(i.idToken);ee(o,n,"internal-error");const{sub:c}=o;return ee(r.uid===c,n,"user-mismatch"),Tr._forOperation(r,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&wt(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d_(r,e,t=!1){if(lt(r.app))return Promise.reject(Ut(r));const n="signIn",s=await h_(r,n,e),i=await Tr._fromIdTokenResponse(r,n,s);return t||await r._updateCurrentUser(i.user),i}async function JP(r,e){return d_(cn(r),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f_(r){const e=cn(r);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function XP(r,e,t){if(lt(r.app))return Promise.reject(Ut(r));const n=cn(r),o=await Nl(n,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",WP).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&f_(r),l}),c=await Tr._fromIdTokenResponse(n,"signIn",o);return await n._updateCurrentUser(c.user),c}function ZP(r,e,t){return lt(r.app)?Promise.reject(Ut(r)):JP(Ve(r),Es.credential(e,t)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&f_(r),n})}function eC(r,e,t,n){return Ve(r).onIdTokenChanged(e,t,n)}function tC(r,e,t){return Ve(r).beforeAuthStateChanged(e,t)}function nC(r,e,t,n){return Ve(r).onAuthStateChanged(e,t,n)}function rC(r){return Ve(r).signOut()}const Ta="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ta,"1"),this.storage.removeItem(Ta),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sC=1e3,iC=10;class p_ extends m_{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=o_(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),s=this.localCache[t];n!==s&&e(t,s,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,l)=>{this.notifyListeners(o,l)});return}const n=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(n);!t&&this.localCache[n]===o||this.notifyListeners(n,o)},i=this.storage.getItem(n);IP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,iC):s()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},sC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}p_.type="LOCAL";const oC=p_;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_ extends m_{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}g_.type="SESSION";const y_=g_;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aC(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const n=new tc(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const c=Array.from(o).map(async u=>u(t.origin,i)),l=await aC(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}tc.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((c,l)=>{const u=th("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},n);o={messageChannel:s,onMessage(m){const p=m;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(p.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(){return window}function lC(r){jt().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __(){return typeof jt().WorkerGlobalScope<"u"&&typeof jt().importScripts=="function"}async function uC(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hC(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)==null?void 0:r.controller)||null}function dC(){return __()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v_="firebaseLocalStorageDb",fC=1,Sa="firebaseLocalStorage",w_="fbase_key";class no{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function nc(r,e){return r.transaction([Sa],e?"readwrite":"readonly").objectStore(Sa)}function mC(){const r=indexedDB.deleteDatabase(v_);return new no(r).toPromise()}function kl(){const r=indexedDB.open(v_,fC);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(Sa,{keyPath:w_})}catch(s){t(s)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(Sa)?e(n):(n.close(),await mC(),e(await kl()))})})}async function pm(r,e,t){const n=nc(r,!0).put({[w_]:e,value:t});return new no(n).toPromise()}async function pC(r,e){const t=nc(r,!1).get(e),n=await new no(t).toPromise();return n===void 0?null:n.value}function gm(r,e){const t=nc(r,!0).delete(e);return new no(t).toPromise()}const gC=800,yC=3;class E_{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await kl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>yC)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return __()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tc._getInstance(dC()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,n;if(this.activeServiceWorker=await uC(),!this.activeServiceWorker)return;this.sender=new cC(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(n=e[0])!=null&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||hC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kl();return await pm(e,Ta,"1"),await gm(e,Ta),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>pm(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>pC(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>gm(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=nc(s,!1).getAll();return new no(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),gC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}E_.type="LOCAL";const _C=E_;new Zi(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nh(r,e){return e?Qt(e):(ee(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh extends Zu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Qr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Qr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Qr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function vC(r){return d_(r.auth,new rh(r),r.bypassAuthState)}function wC(r){const{auth:e,user:t}=r;return ee(t,e,"internal-error"),YP(t,new rh(r),r.bypassAuthState)}async function EC(r){const{auth:e,user:t}=r;return ee(t,e,"internal-error"),QP(t,new rh(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I_{constructor(e,t,n,s,i=!1){this.auth=e,this.resolver=n,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:s,tenantId:i,error:o,type:c}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return vC;case"linkViaPopup":case"linkViaRedirect":return EC;case"reauthViaPopup":case"reauthViaRedirect":return wC;default:wt(this.auth,"internal-error")}}resolve(e){tn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){tn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IC=new Zi(2e3,1e4);async function bC(r,e,t){if(lt(r.app))return Promise.reject(St(r,"operation-not-supported-in-this-environment"));const n=cn(r);Ky(r,e,ec);const s=nh(n,t);return new ar(n,"signInViaPopup",e,s).executeNotNull()}class ar extends I_{constructor(e,t,n,s,i){super(e,t,s,i),this.provider=n,this.authWindow=null,this.pollId=null,ar.currentPopupAction&&ar.currentPopupAction.cancel(),ar.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ee(e,this.auth,"internal-error"),e}async onExecution(){tn(this.filter.length===1,"Popup operations only handle one event");const e=th();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(St(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(St(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ar.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if((n=(t=this.authWindow)==null?void 0:t.window)!=null&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(St(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,IC.get())};e()}}ar.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC="pendingRedirect",Go=new Map;class SC extends I_{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Go.get(this.auth._key());if(!e){try{const n=await AC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Go.set(this.auth._key(),e)}return this.bypassAuthState||Go.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function AC(r,e){const t=T_(e),n=b_(r);if(!await n._isAvailable())return!1;const s=await n._get(t)==="true";return await n._remove(t),s}async function RC(r,e){return b_(r)._set(T_(e),"true")}function PC(r,e){Go.set(r._key(),e)}function b_(r){return Qt(r._redirectPersistence)}function T_(r){return Ho(TC,r.config.apiKey,r.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx(r,e,t){return CC(r,e,t)}async function CC(r,e,t){if(lt(r.app))return Promise.reject(Ut(r));const n=cn(r);Ky(r,e,ec),await n._initializationPromise;const s=nh(n,t);return await RC(s,n),s._openRedirect(n,e,"signInViaRedirect")}async function xC(r,e,t=!1){if(lt(r.app))return Promise.reject(Ut(r));const n=cn(r),s=nh(n,e),o=await new SC(n,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC=600*1e3;class kC{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!DC(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!S_(e)){const s=((n=e.error.code)==null?void 0:n.split("auth/")[1])||"internal-error";t.onError(St(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=NC&&this.cachedEventUids.clear(),this.cachedEventUids.has(ym(e))}saveEventToCache(e){this.cachedEventUids.add(ym(e)),this.lastProcessedEventTime=Date.now()}}function ym(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function S_({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function DC(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return S_(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VC(r,e={}){return jn(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OC=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,LC=/^https?/;async function MC(r){if(r.config.emulator)return;const{authorizedDomains:e}=await VC(r);for(const t of e)try{if(FC(t))return}catch{}wt(r,"unauthorized-domain")}function FC(r){const e=Cl(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const o=new URL(r);return o.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!LC.test(t))return!1;if(OC.test(r))return n===r;const s=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UC=new Zi(3e4,6e4);function _m(){const r=jt().___jsl;if(r!=null&&r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function jC(r){return new Promise((e,t)=>{var s,i,o;function n(){_m(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{_m(),t(St(r,"network-request-failed"))},timeout:UC.get()})}if((i=(s=jt().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=jt().gapi)!=null&&o.load)n();else{const c=NP("iframefcb");return jt()[c]=()=>{gapi.load?n():t(St(r,"network-request-failed"))},c_(`${xP()}?onload=${c}`).catch(l=>t(l))}}).catch(e=>{throw Ko=null,e})}let Ko=null;function BC(r){return Ko=Ko||jC(r),Ko}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC=new Zi(5e3,15e3),$C="__/auth/iframe",zC="emulator/auth/iframe",HC={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},GC=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function KC(r){const e=r.config;ee(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?Yu(e,zC):`https://${r.config.authDomain}/${$C}`,n={apiKey:e.apiKey,appName:r.name,v:fs},s=GC.get(r.config.apiHost);s&&(n.eid=s);const i=r._getFrameworks();return i.length&&(n.fw=i.join(",")),`${t}?${Ui(n).slice(1)}`}async function WC(r){const e=await BC(r),t=jt().gapi;return ee(t,r,"internal-error"),e.open({where:document.body,url:KC(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:HC,dontclear:!0},n=>new Promise(async(s,i)=>{await n.restyle({setHideOnLeave:!1});const o=St(r,"network-request-failed"),c=jt().setTimeout(()=>{i(o)},qC.get());function l(){jt().clearTimeout(c),s(n)}n.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QC={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},YC=500,JC=600,XC="_blank",ZC="http://localhost";class vm{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ex(r,e,t,n=YC,s=JC){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const l={...QC,width:n.toString(),height:s.toString(),top:i,left:o},u=je().toLowerCase();t&&(c=t_(u)?XC:t),Zy(u)&&(e=e||ZC,l.scrollbars="yes");const d=Object.entries(l).reduce((p,[b,R])=>`${p}${b}=${R},`,"");if(EP(u)&&c!=="_self")return tx(e||"",c),new vm(null);const m=window.open(e||"",c,d);ee(m,r,"popup-blocked");try{m.focus()}catch{}return new vm(m)}function tx(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nx="__/auth/handler",rx="emulator/auth/handler",sx=encodeURIComponent("fac");async function wm(r,e,t,n,s,i){ee(r.config.authDomain,r,"auth-domain-config-required"),ee(r.config.apiKey,r,"invalid-api-key");const o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:fs,eventId:s};if(e instanceof ec){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",c0(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,m]of Object.entries({}))o[d]=m}if(e instanceof to){const d=e.getScopes().filter(m=>m!=="");d.length>0&&(o.scopes=d.join(","))}r.tenantId&&(o.tid=r.tenantId);const c=o;for(const d of Object.keys(c))c[d]===void 0&&delete c[d];const l=await r._getAppCheckToken(),u=l?`#${sx}=${encodeURIComponent(l)}`:"";return`${ix(r)}?${Ui(c).slice(1)}${u}`}function ix({config:r}){return r.emulator?Yu(r,rx):`https://${r.authDomain}/${nx}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc="webStorageSupport";class ox{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=y_,this._completeRedirectFn=xC,this._overrideRedirectResult=PC}async _openPopup(e,t,n,s){var o;tn((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await wm(e,t,n,Cl(),s);return ex(e,i,th())}async _openRedirect(e,t,n,s){await this._originValidation(e);const i=await wm(e,t,n,Cl(),s);return lC(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(tn(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await WC(e),n=new kC(e);return t.register("authEvent",s=>(ee(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:n.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(jc,{type:jc},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[jc];i!==void 0&&t(!!i),wt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=MC(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return o_()||e_()||Xu()}}const ax=ox;var Em="@firebase/auth",Im="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cx{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lx(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ux(r){Yr(new fr("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=n.options;ee(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const l={apiKey:o,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:a_(r)},u=new RP(n,s,i,l);return MP(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Yr(new fr("auth-internal",e=>{const t=cn(e.getProvider("auth").getImmediate());return(n=>new cx(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rn(Em,Im,lx(r)),Rn(Em,Im,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hx=300,dx=mp("authIdTokenMaxAge")||hx;let bm=null;const fx=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>dx)return;const s=t==null?void 0:t.token;bm!==s&&(bm=s,await fetch(r,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function mx(r=Tp()){const e=Ql(r,"auth");if(e.isInitialized())return e.getImmediate();const t=LP(r,{popupRedirectResolver:ax,persistence:[_C,oC,y_]}),n=mp("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(n,location.origin);if(location.origin===i.origin){const o=fx(i.toString());tC(t,o,()=>o(t.currentUser)),eC(t,c=>o(c))}}const s=dp("auth");return s&&FP(t,`http://${s}`),t}function px(){var r;return((r=document.getElementsByTagName("head"))==null?void 0:r[0])??document}PP({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=s=>{const i=St("internal-error");i.customData=s,t(i)},n.type="text/javascript",n.charset="UTF-8",px().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ux("Browser");const gx={apiKey:"AIzaSyDu4dcD95VZKrQQF6ivVYYnMYjT8Cp_PLQ",authDomain:"mitche-platform.firebaseapp.com",projectId:"mitche-platform",storageBucket:"mitche-platform.firebasestorage.app",messagingSenderId:"62893727673",appId:"1:62893727673:web:890b8e25627a966dca6068",measurementId:"G-5DMYKQD89X"},sh=bp(gx),te=MR(sh),Xn=mx(sh),Dl=new Gt;Dl.setCustomParameters({prompt:"select_account"});try{FR(te),st(async()=>{const{log:r}=await Promise.resolve().then(()=>Fc);return{log:r}},void 0,import.meta.url).then(({log:r})=>r("Offline persistence enabled"))}catch(r){r.code==="failed-precondition"?st(async()=>{const{warn:e}=await Promise.resolve().then(()=>Fc);return{warn:e}},void 0,import.meta.url).then(({warn:e})=>e("Multiple tabs open, offline persistence disabled")):r.code==="unimplemented"&&st(async()=>{const{warn:e}=await Promise.resolve().then(()=>Fc);return{warn:e}},void 0,import.meta.url).then(({warn:e})=>e("Browser doesn't support offline persistence"))}class A_{constructor(){this.authStateListeners=[],this.requestsListeners=[],this.eventsListeners=[],this.resourcesListeners=[]}async createUserWithEmailPassword(e,t,n){try{const i=(await XP(Xn,e,t)).user,o={id:i.uid,username:n.username||e.split("@")[0],password:"",symbolicName:n.symbolicName||"",symbolicIcon:n.symbolicIcon||"",role:n.role||re.Citizen,hopePoints:0,hopePointsBreakdown:{},hasCompletedOnboarding:!1,isVerified:n.role==="Admin",verificationStatus:n.role==="Admin"?"Approved":"NotRequested",commendations:{Kind:0,Punctual:0,Respectful:0},...n};return await We(Ee(te,"users",i.uid),{...o,createdAt:new Date,updatedAt:new Date}),{success:!0,user:o}}catch(s){return{success:!1,message:s.message}}}async signInWithEmailPassword(e,t){try{const n=await ZP(Xn,e,t);return{success:!0,user:await this.getUser(n.user.uid)}}catch(n){return{success:!1,message:n.message}}}async signInWithGoogle(){var e;try{try{const n=(await bC(Xn,Dl)).user;let s=await this.getUser(n.uid);if(s)return await Ys(Ee(te,"users",n.uid),{lastActive:new Date().toISOString(),avatar:n.photoURL||s.avatar}),{success:!0,user:s};{const i={id:n.uid,username:n.displayName||((e=n.email)==null?void 0:e.split("@")[0])||"User",password:"",symbolicName:"",symbolicIcon:"",role:re.Citizen,hopePoints:0,hopePointsBreakdown:{},hasCompletedOnboarding:!1,isVerified:!1,verificationStatus:"NotRequested",joinDate:new Date().toISOString(),lastActive:new Date().toISOString(),languagePreference:"en",avatar:n.photoURL||""};return await We(Ee(te,"users",n.uid),i),{success:!0,user:i}}}catch(t){return $y("Popup sign-in failed or blocked, trying redirect flow:",t),await st(async()=>{const{signInWithRedirect:n}=await import("./index.esm-Cy2Pwpsk.js");return{signInWithRedirect:n}},__vite__mapDeps([8,1,2,3,4,5,6]),import.meta.url).then(({signInWithRedirect:n})=>n(Xn,Dl)),{success:!1,message:"Redirecting for Google sign-in; complete sign-in in the opened window."}}}catch(t){return{success:!1,message:t.message}}}async signOut(){try{return await rC(Xn),{success:!0}}catch(e){return{success:!1,message:e.message}}}async getUser(e){try{const t=await JR(Ee(te,"users",e));return t.exists()?{id:t.id,...t.data()}:null}catch{return null}}async updateUser(e,t){try{return await Ys(Ee(te,"users",e),{...t,updatedAt:new Date}),!0}catch{return!1}}async getAllUsers(){try{return(await si(Re(te,"users"))).docs.map(t=>({id:t.id,...t.data()}))}catch{return[]}}async createRequest(e){try{const t=Ee(Re(te,"requests"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}async getRequests(){try{const e=It(Re(te,"requests"),Ct("timestamp","desc"));return(await si(e)).docs.map(n=>({id:n.id,...n.data()}))}catch{return[]}}subscribeToRequests(e){const t=It(Re(te,"requests"),Ct("timestamp","desc"));return _n(t,n=>{const s=n.docs.map(i=>{var o;return{id:i.id,...i.data(),timestamp:((o=i.data().timestamp)==null?void 0:o.toDate())||new Date}});e(s)},n=>{})}async updateRequest(e,t){try{return await Ys(Ee(te,"requests",e),{...t,updatedAt:new Date}),!0}catch{return!1}}async createEvent(e){try{const t=Ee(Re(te,"communityEvents"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}subscribeToEvents(e){const t=It(Re(te,"communityEvents"),Ct("timestamp","desc"));return _n(t,n=>{const s=n.docs.map(i=>{var o;return{id:i.id,...i.data(),timestamp:((o=i.data().timestamp)==null?void 0:o.toDate())||new Date}});e(s)})}async createResource(e){try{const t=Ee(Re(te,"resources"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}subscribeToResources(e){const t=It(Re(te,"resources"),Ct("timestamp","desc"));return _n(t,n=>{const s=n.docs.map(i=>{var o;return{id:i.id,...i.data(),timestamp:((o=i.data().timestamp)==null?void 0:o.toDate())||new Date}});e(s)})}async addOffering(e){try{const t=Ee(Re(te,"offerings"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}subscribeToOfferings(e){const t=It(Re(te,"offerings"),Ct("timestamp","desc"));return _n(t,n=>{const s=n.docs.map(i=>{var o;return{id:i.id,...i.data(),timestamp:((o=i.data().timestamp)==null?void 0:o.toDate())||new Date}});e(s)})}async createOffering(e){try{const t=Ee(Re(te,"offerings"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}async getOfferingsForRequest(e){try{const t=It(Re(te,"offerings"),Pl("requestId","==",e),Ct("timestamp","desc"));return(await si(t)).docs.map(s=>{var i;return{id:s.id,...s.data(),timestamp:((i=s.data().timestamp)==null?void 0:i.toDate())||new Date}})}catch{return[]}}async createNotification(e){try{const t=Ee(Re(te,"notifications"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}async getNominations(e){try{const{collection:t,query:n,where:s,orderBy:i,getDocs:o}=await st(async()=>{const{collection:u,query:d,where:m,orderBy:p,getDocs:b}=await import("./index.esm-B3xUtUBk.js");return{collection:u,query:d,where:m,orderBy:p,getDocs:b}},__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url);let c=t(te,"nominations");return e?c=n(t(te,"nominations"),s("status","==",e),i("createdAt","desc")):c=n(t(te,"nominations"),i("createdAt","desc")),(await o(c)).docs.map(u=>({id:u.id,...u.data()}))}catch{return[]}}subscribeToNominations(e,t){try{const{collection:n,query:s,where:i,orderBy:o,onSnapshot:c}=require("firebase/firestore");let l;return t?l=s(n(te,"nominations"),i("status","==",t),o("createdAt","desc")):l=s(n(te,"nominations"),o("createdAt","desc")),c(l,u=>{const d=u.docs.map(m=>({id:m.id,...m.data()}));e(d)},u=>zy("Nominations subscription error:",u))}catch{return()=>{}}}async addNomination(e){try{const{doc:t,collection:n,setDoc:s}=await st(async()=>{const{doc:c,collection:l,setDoc:u}=await import("./index.esm-B3xUtUBk.js");return{doc:c,collection:l,setDoc:u}},__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url),i=t(n(te,"nominations")),o=new Date;return await s(i,{id:i.id,userId:e.userId,nominatedBy:e.nominatedBy||null,reason:e.reason||"",metrics:e.metrics||{},status:e.status||"longlist",createdAt:o,updatedAt:o}),!0}catch{return!1}}async updateNomination(e,t){try{const{updateDoc:n,doc:s}=await st(async()=>{const{updateDoc:i,doc:o}=await import("./index.esm-B3xUtUBk.js");return{updateDoc:i,doc:o}},__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url);return await n(s(te,"nominations",e),{...t,updatedAt:new Date}),!0}catch{return!1}}async addNominationComment(e,t){try{const{updateDoc:n,doc:s,arrayUnion:i}=await st(async()=>{const{updateDoc:c,doc:l,arrayUnion:u}=await import("./index.esm-B3xUtUBk.js");return{updateDoc:c,doc:l,arrayUnion:u}},__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url),o={id:`${Date.now()}_${Math.random().toString(36).slice(2,9)}`,authorId:t.authorId,text:t.text,attachmentUrl:t.attachmentUrl||null,createdAt:new Date().toISOString()};return await n(s(te,"nominations",e),{comments:i(o),updatedAt:new Date}),!0}catch{return!1}}async getUserNotifications(e){try{const t=It(Re(te,"notifications"),Pl("userId","==",e),Ct("timestamp","desc"));return(await si(t)).docs.map(s=>{var i;return{id:s.id,...s.data(),timestamp:((i=s.data().timestamp)==null?void 0:i.toDate())||new Date}})}catch{return[]}}async addNotification(e){try{const t=Ee(Re(te,"notifications"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}subscribeToNotifications(e){const t=It(Re(te,"notifications"),Ct("timestamp","desc"));return _n(t,n=>{const s=n.docs.map(i=>{var o;return{id:i.id,...i.data(),timestamp:((o=i.data().timestamp)==null?void 0:o.toDate())||new Date}});e(s)})}subscribeToUser(e,t){try{const n=Ee(te,"users",e);return _n(n,s=>{s.exists()?t({id:s.id,...s.data()}):t(null)})}catch{return()=>{}}}async updateNotification(e,t){try{const n=Ee(te,"notifications",e);return await Ys(n,{...t,updatedAt:new Date}),!0}catch{return!1}}async addTapestryThread(e){try{const t=Ee(Re(te,"tapestryThreads"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),t.id}catch{return null}}subscribeToTapestryThreads(e){const t=It(Re(te,"tapestryThreads"),Ct("timestamp","desc"));return _n(t,n=>{const s=n.docs.map(i=>{var o;return{id:i.id,...i.data(),timestamp:((o=i.data().timestamp)==null?void 0:o.toDate())||new Date}});e(s)})}async updateTapestryThread(e,t){try{const n=Ee(te,"tapestryThreads",e);return await Ys(n,{...t,updatedAt:new Date}),!0}catch{return!1}}async addCommunityEvent(e){try{const t=Ee(Re(te,"communityEvents"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}subscribeToCommunityEvents(e){const t=It(Re(te,"communityEvents"),Ct("timestamp","desc"));return _n(t,n=>{const s=n.docs.map(i=>{var o;return{id:i.id,...i.data(),timestamp:((o=i.data().timestamp)==null?void 0:o.toDate())||new Date}});e(s)})}async addResource(e){try{const t=Ee(Re(te,"resources"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}async uploadSingleDocument(e,t,n){try{return{url:await(await(await st(()=>import("./storage-helper-BKfUg6bs.js"),__vite__mapDeps([10,3]),import.meta.url)).uploadFileToStaging(e,t,n)).promise}}catch(s){return{error:s}}}async uploadDocuments(e,t,n){try{const s=[];for(let i=0;i<t.length;i++){const o=t[i],c=await this.uploadSingleDocument(e,o,l=>n&&n(i,l));c.url&&s.push(c.url)}return s}catch{return[]}}async addRequest(e){try{const t=Ee(Re(te,"requests"));return await We(t,{...e,id:t.id,timestamp:new Date,createdAt:new Date}),!0}catch{return!1}}async migrateFromLocalStorage(){try{Jn("Starting migration from localStorage to Firestore...");const e=localStorage.getItem("mitcheUsers"),t=localStorage.getItem("requests"),n=localStorage.getItem("communityEvents"),s=localStorage.getItem("resources");if(e){const i=JSON.parse(e);for(const o of i)await We(Ee(te,"users",o.id),{...o,createdAt:new Date,updatedAt:new Date});Jn(`Migrated ${i.length} users`)}if(t){const i=JSON.parse(t);for(const o of i)await We(Ee(te,"requests",o.id),{...o,timestamp:new Date(o.timestamp),createdAt:new Date});Jn(`Migrated ${i.length} requests`)}if(n){const i=JSON.parse(n);for(const o of i)await We(Ee(te,"communityEvents",o.id),{...o,timestamp:new Date(o.timestamp),createdAt:new Date});Jn(`Migrated ${i.length} events`)}if(s){const i=JSON.parse(s);for(const o of i)await We(Ee(te,"resources",o.id),{...o,timestamp:new Date(o.timestamp),createdAt:new Date});Jn(`Migrated ${i.length} resources`)}Jn("Migration completed successfully!")}catch{}}async goOnline(){await jR(te)}async goOffline(){await BR(te)}onAuthStateChange(e){return nC(Xn,async t=>{if(t){const n=await this.getUser(t.uid);e(n)}else e(null)})}}const yx=new A_,R_=Object.freeze(Object.defineProperty({__proto__:null,app:sh,auth:Xn,db:te,default:A_,firebaseService:yx},Symbol.toStringTag,{value:"Module"}));var Zn=(r=>(r.Helper="Helper",r.Community="Community",r.Dedication="Dedication",r.Special="Special",r.Pillar="Pillar",r.Symbolic="Symbolic",r))(Zn||{}),ii=(r=>(r.Common="Common",r.Rare="Rare",r.Epic="Epic",r.Legendary="Legendary",r))(ii||{});const _x=()=>{const[r,e]=x.useState([]),[t,n]=x.useState(!0),[s,i]=x.useState(null);return x.useEffect(()=>{(async()=>{try{n(!0);const c=Re(te,"achievements"),l=It(c,Pl("isActive","==",!0)),d=(await si(l)).docs.map(m=>({id:m.id,...m.data()}));d.sort((m,p)=>{const b=[ii.Common,ii.Rare,ii.Epic,ii.Legendary],R=[Zn.Pillar,Zn.Symbolic,Zn.Helper,Zn.Community,Zn.Dedication,Zn.Special],A=b.indexOf(m.rarity)-b.indexOf(p.rarity);return A!==0?A:R.indexOf(m.category)-R.indexOf(p.category)}),e(d)}catch(c){i(c),console.error("Error fetching achievements: ",c)}finally{n(!1)}})()},[]),{achievements:r,loading:t,error:s}},Vl=()=>{const{t:r}=Ar(),{achievements:e,loading:t,error:n}=_x(),s=i=>{switch(i.toLowerCase()){case"legendary":return"text-purple-500";case"epic":return"text-orange-500";case"rare":return"text-blue-500";default:return"text-gray-500"}};return t?T.jsx(Nt,{children:T.jsx("p",{children:r("loadingAchievements","Loading achievements...")})}):n?T.jsx(Nt,{children:T.jsx("p",{className:"text-red-500",children:r("errorLoadingAchievements","Error loading achievements.")})}):T.jsxs(Nt,{children:[T.jsx("h3",{className:"text-lg font-semibold mb-3",children:r("achievements","Achievements")}),e.length===0?T.jsx("p",{className:"text-sm text-gray-500",children:r("noAchievementsYet","No achievements yet.")}):T.jsx("div",{className:"space-y-3",children:e.map(i=>T.jsxs("div",{className:"flex items-start gap-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[T.jsx("div",{className:"text-4xl flex-shrink-0 w-12 h-12 flex items-center justify-center bg-amber-100 rounded-full",children:i.icon}),T.jsxs("div",{className:"flex-grow",children:[T.jsx("h4",{className:"font-bold text-md text-gray-800",children:r(i.name,i.name)}),T.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r(i.description,i.description)}),T.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center gap-4",children:[T.jsxs("span",{className:"font-medium",children:[r("rarity","Rarity"),": ",T.jsx("span",{className:`font-bold ${s(i.rarity)}`,children:r(i.rarity,i.rarity)})]}),T.jsxs("span",{className:"font-medium",children:[r("category","Category"),": ",T.jsx("span",{className:"font-semibold",children:r(i.category,i.category)})]})]})]})]},i.id))})]})};try{Vl.displayName="AchievementsPanel",Vl.__docgenInfo={description:"",displayName:"AchievementsPanel",props:{}}}catch{}const vx="BDS15Y2fS-ImB30J6T05h1j7C_2VSeriHqhxCs2SCw1VGY23p1S2-bOOn2GfM1v3E0yQ7z-8o-U5h9yK4H110tI";function wx(r){const e="=".repeat((4-r.length%4)%4),t=(r+e).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),s=new Uint8Array(n.length);for(let i=0;i<n.length;++i)s[i]=n.charCodeAt(i);return s}function Ex(){return"serviceWorker"in navigator&&"PushManager"in window}async function Ix(){return(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function bx(){const r=await navigator.serviceWorker.ready,e=await r.pushManager.getSubscription();if(e)return e;const t=await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:wx(vx)});return console.log("User is subscribed:",JSON.stringify(t)),t}async function Tx(){const e=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(e){const t=await e.unsubscribe();return console.log("User is unsubscribed."),t}return!1}const Tm={ar:{nativeName:"العربية"},en:{nativeName:"English"},fr:{nativeName:"Français"}},Ol=()=>{const{i18n:r}=Ar(),e=r.resolvedLanguage||r.language||"en";return T.jsx("div",{className:"flex items-center justify-center space-x-2 rtl:space-x-reverse",children:Object.keys(Tm).map(t=>T.jsx("button",{type:"button",onClick:()=>r.changeLanguage(t),className:`text-sm px-3 py-1 rounded-full transition-colors font-semibold ${e===t?"bg-[#D4AF37] text-white shadow-sm":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-50"}`,"aria-label":`Switch language to ${t}`,children:Tm[t].nativeName},t))})};try{Ol.displayName="LanguageSwitcher",Ol.__docgenInfo={description:"",displayName:"LanguageSwitcher",props:{}}}catch{}function Sx({title:r,titleId:e,...t},n){return x.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},t),r?x.createElement("title",{id:e},r):null,x.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"}))}const Ax=x.forwardRef(Sx);function Rx({title:r,titleId:e,...t},n){return x.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},t),r?x.createElement("title",{id:e},r):null,x.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const Px=x.forwardRef(Rx),xt=({icon:r,label:e,onClick:t,isDestructive:n,children:s})=>T.jsxs(Gl,{to:t?"#":"",onClick:t,className:`w-full flex items-center text-left p-3 rounded-md transition-colors ${n?"text-red-600 hover:bg-red-50":"text-gray-700 hover:bg-gray-100"}`,children:[T.jsx(r,{className:"w-5 h-5 mr-3"}),T.jsx("span",{className:"flex-grow",children:e}),s||T.jsx(Px,{className:"w-5 h-5 text-gray-400"})]}),Ll=({isOpen:r,onClose:e})=>{const{user:t,logout:n,signOutUser:s}=Mi(),{t:i}=Ar(),o=Bl(),[c,l]=x.useState(null),[u,d]=x.useState(!1),[m,p]=x.useState(!1),[b,R]=x.useState(!1),[A,N]=x.useState(!1),[D,V]=x.useState(!1),[j,U]=x.useState(!0),[Q,H]=x.useState(null);x.useEffect(()=>{const X=window.matchMedia("(display-mode: standalone)").matches;X&&d(!0);const Ge=$t=>{$t.preventDefault(),X||l($t)},Bn=()=>{l(null),d(!0)};return window.addEventListener("beforeinstallprompt",Ge),window.addEventListener("appinstalled",Bn),()=>{window.removeEventListener("beforeinstallprompt",Ge),window.removeEventListener("appinstalled",Bn)}},[]),x.useEffect(()=>{const X=()=>R(!0);return window.addEventListener("mitche.openQr",X),()=>window.removeEventListener("mitche.openQr",X)},[]),x.useEffect(()=>{Ex()?(N(!0),Ix().then(X=>{V(!!X),U(!1)})):U(!1)},[]);const I=async()=>{c&&(c.prompt(),await c.userChoice)},E=async()=>{U(!0),D?(await Tx(),V(!1)):await Notification.requestPermission()==="granted"&&(await bx(),V(!0)),U(!1)},y=async()=>{if(H(null),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){H({message:i("constellation.cameraNotSupported"),type:"error"}),setTimeout(()=>H(null),4e3);return}try{const X=await navigator.mediaDevices.getUserMedia({video:!0});H({message:i("constellation.cameraAccessGranted"),type:"success"}),X.getTracks().forEach(Ge=>Ge.stop())}catch(X){console.error("Camera access denied:",X),H({message:i("constellation.cameraAccessDenied"),type:"error"})}setTimeout(()=>H(null),4e3)},w=X=>{e(),o(X)},{giveDailyPoint:_,sendEncouragement:S,communityEvents:v,requests:ie}=ap(),_e=async()=>{if(!t)return;const X=await _(t.id);X&&X.success?(H({message:i("scanner.success.giftSent",{name:X.receiverName||t.symbolicName}),type:"success"}),setTimeout(()=>H(null),3e3)):(H({message:i(X.messageKey||"scanner.error.server"),type:"error"}),setTimeout(()=>H(null),3e3))},Ce=async()=>{if(!t)return;const X=i("profile.motivate.defaultMessage","Keep going — you are not alone!"),Ge=await S(t.id,X);Ge&&Ge.success?(H({message:i("profile.motivate.sent"),type:"success"}),setTimeout(()=>H(null),3e3)):(H({message:i(Ge.messageKey||"scanner.error.server"),type:"error"}),setTimeout(()=>H(null),3e3))},at=async()=>{try{await s()}catch(X){console.error("Error signing out: ",X)}};if(!t)return null;const xe=t.role===re.NGO||t.role===re.PublicWorker,Xe=[re.Admin,re.NGO,re.PublicWorker].includes(t.role),Et=c&&!u;return T.jsxs(T.Fragment,{children:[T.jsx("div",{className:`fixed inset-0 bg-black/40 z-40 transition-opacity duration-300 ${r?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:e}),T.jsx("div",{className:`fixed top-0 right-0 rtl:right-auto rtl:left-0 h-full w-full max-w-sm bg-[#FBF9F4] shadow-2xl z-50 transform transition-transform duration-300 ease-in-out ${r?"translate-x-0":"translate-x-full rtl:-translate-x-full"}`,children:T.jsxs("div",{className:"flex flex-col h-full",children:[T.jsxs("header",{className:"flex-shrink-0 p-4 border-b border-[#F1EADF] flex justify-between items-center",children:[T.jsxs("h2",{className:"font-bold text-gray-700 text-lg flex items-center gap-2",children:[T.jsx(Xo,{name:t.symbolicIcon,className:"w-6 h-6 text-gray-600"}),t.symbolicName]}),T.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200/50",children:T.jsx(Jm,{className:"w-5 h-5 text-gray-600"})})]}),T.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[T.jsxs(Nt,{children:[T.jsxs("div",{className:"text-center",children:[T.jsx("p",{className:"text-sm bg-gray-100 text-gray-600 font-semibold inline-block px-3 py-1 rounded-full",children:i(`roles.${t.role}`)}),t.isVerified&&T.jsxs("p",{className:"mt-2 text-xs font-bold text-blue-600 flex items-center justify-center gap-1",children:[T.jsx(bc,{size:14})," ",i("verifiedOrg")]}),xe&&t.verificationStatus!=="Approved"&&T.jsxs("div",{className:`mt-2 text-xs font-bold p-2 rounded-md flex items-center justify-center gap-1 ${t.verificationStatus==="Pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[T.jsx(qw,{size:14})," ",t.verificationStatus==="Pending"?i("profile.verificationPending"):i("profile.verificationRejected")]}),T.jsxs("div",{className:"mt-4 text-sm text-gray-600 text-center space-y-2",children:[t.location&&T.jsxs("div",{className:"flex items-center justify-center gap-1",children:[T.jsx(rd,{className:"w-4 h-4 text-gray-400"}),T.jsx("span",{children:t.location})]}),t.bio&&T.jsxs("p",{className:"italic px-4",children:['"',t.bio,'"']})]})]}),t.qrCodeUrl&&T.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 flex justify-center",children:T.jsx("button",{onClick:()=>R(!0),className:"mt-3 p-2 rounded-full hover:bg-gray-200/50",children:T.jsx(Ym,{className:"w-6 h-6"})})})]}),T.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[T.jsxs("button",{onClick:_e,className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-green-600 text-white rounded-lg font-bold hover:bg-opacity-90 transition-colors text-sm shadow-sm active:scale-95",children:[T.jsx(eE,{className:"w-4 h-4"})," ",i("profile.giveDaily","Give daily Hope Point")]}),T.jsxs("button",{onClick:Ce,className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-blue-600 text-white rounded-lg font-bold hover:bg-opacity-90 transition-colors text-sm shadow-sm active:scale-95",children:[T.jsx($c,{className:"w-4 h-4"})," ",i("profile.motivate","Motivate")]})]}),T.jsxs(Nt,{children:[T.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:i("profile.yourEvents","Your Events")}),T.jsxs("div",{className:"space-y-2",children:[v.filter(X=>X.organizerId===t.id).map(X=>T.jsxs("div",{className:"p-2 border rounded flex justify-between items-center",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:X.title}),T.jsx("div",{className:"text-xs text-gray-500",children:X.region})]}),T.jsx("div",{children:T.jsx("button",{onClick:()=>w(`/events/${X.id}`),className:"px-2 py-1 bg-gray-100 rounded text-sm",children:i("open","Open")})})]},X.id)),v.filter(X=>X.organizerId===t.id).length===0&&T.jsx("div",{className:"text-xs text-gray-500",children:i("profile.noEvents","No events yet")})]})]}),T.jsxs(Nt,{children:[T.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:i("profile.yourRequests","Your Requests")}),T.jsxs("div",{className:"space-y-2",children:[ie.filter(X=>X.userId===t.id).map(X=>T.jsxs("div",{className:"p-2 border rounded flex justify-between items-center",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:X.title}),T.jsx("div",{className:"text-xs text-gray-500",children:X.region})]}),T.jsx("div",{children:T.jsx("button",{onClick:()=>w(`/echoes/${X.id}`),className:"px-2 py-1 bg-gray-100 rounded text-sm",children:i("open","Open")})})]},X.id)),ie.filter(X=>X.userId===t.id).length===0&&T.jsx("div",{className:"text-xs text-gray-500",children:i("profile.noRequests","No requests yet")})]})]}),t.commendations&&Object.keys(t.commendations).length>0&&T.jsxs(Nt,{children:[T.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:i("commendations.title")}),T.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(t.commendations).map(([X,Ge])=>T.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-amber-50 to-white text-amber-700 text-sm font-semibold shadow-sm",children:[T.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-amber-400 animate-pulse"}),i(`commendations.types.${X}`),T.jsx("span",{className:"ml-2 text-xs text-gray-600 bg-white rounded-full px-2 py-0.5",children:Ge})]},X))})]}),t.badges&&t.badges.length>0&&T.jsxs(Nt,{children:[T.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:i("achievements.title","Accolades & Badges")}),T.jsx("div",{className:"flex flex-wrap gap-2",children:t.badges.map(X=>T.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-white to-amber-50 text-amber-700 text-sm font-semibold shadow-sm",children:[T.jsx("img",{src:`/badges/${X}.png`,alt:X,width:20,height:20,className:"w-5 h-5 rounded-full",onError:Ge=>{Ge.target.style.display="none"}}),X]},X))})]}),T.jsx(Vl,{}),T.jsxs("button",{onClick:()=>w("/scanner"),className:"w-full flex items-center justify-center py-3 px-4 bg-[#D4AF37] text-white rounded-lg font-bold hover:bg-opacity-90 transition-colors text-md shadow-sm active:scale-95",children:[T.jsx(Xw,{className:"w-5 h-5 mx-2"})," ",i("constellation.scanToGiveHope")]}),T.jsx(Nt,{className:"!p-2",children:T.jsxs("div",{className:"space-y-1",children:[T.jsx(xt,{icon:Qw,label:i("constellation.editProfile.title"),onClick:()=>p(!0)}),T.jsx(xt,{icon:Qm,label:i("constellation.awardNominations"),onClick:()=>w("/nomination")}),T.jsx(xt,{icon:bc,label:i("constellation.privacySettings")}),T.jsx(xt,{icon:rd,label:i("search.advanced","Advanced Search"),onClick:()=>w("/search")})]})}),T.jsx(Nt,{className:"!p-2",children:T.jsxs("div",{className:"space-y-1",children:[t.role===re.Admin&&T.jsx(xt,{icon:bc,label:i("nav.admin","Admin"),onClick:()=>w("/admin")}),A&&T.jsx(xt,{icon:D?Rw:qc,label:i(j?"constellation.notifications.loading":D?"constellation.notifications.disable":"constellation.notifications.enable"),onClick:E}),Et&&T.jsx(xt,{icon:Lw,label:i("constellation.installApp"),onClick:I}),T.jsx(xt,{icon:Vw,label:i("constellation.accessCamera"),onClick:y,children:Q&&T.jsx("div",{className:`mt-1 p-2 text-xs rounded-md text-center animate-fade-in-down ${Q.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:Q.message})}),Xe&&T.jsx(xt,{icon:$c,label:i("analytics.title","Analytics"),onClick:()=>w("/analytics")}),T.jsx(xt,{icon:Ax,label:i("profile.logout"),onClick:at,isDestructive:!0})]})}),T.jsx("div",{className:"pt-2",children:T.jsx(Ol,{})})]})]})}),T.jsx(Jc,{isOpen:m,onClose:()=>p(!1),user:t}),T.jsx(Zo,{isOpen:b,onClose:()=>R(!1),title:i("constellation.qrCodeTitle"),children:T.jsx("div",{className:"flex flex-col items-center justify-center p-4",children:t.qrCodeUrl?T.jsxs(T.Fragment,{children:[T.jsx("img",{src:t.qrCodeUrl,alt:i("constellation.qrCodeTitle"),className:"w-48 h-48"}),T.jsx("p",{className:"text-xs text-gray-500 mt-4",children:i("constellation.qrCodeDesc",{name:t.symbolicName})})]}):T.jsx("p",{className:"text-gray-500",children:i("constellation.qrCodeMissing")})})})]})};try{Ll.displayName="ProfilePanel",Ll.__docgenInfo={description:"",displayName:"ProfilePanel",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}const P_=x.createContext(void 0),Cx={success:"bg-emerald-600",error:"bg-rose-600",info:"bg-slate-800"},Sm=({children:r})=>{const[e,t]=x.useState([]),n=(i,o="info",c)=>{const l=`toast_${Date.now()}_${Math.round(Math.random()*1e3)}`;t(d=>[...d,{id:l,message:i,type:o,action:c}]),setTimeout(()=>{t(d=>d.filter(m=>m.id!==l))},4e3)},s=i=>t(o=>o.filter(c=>c.id!==i));return T.jsxs(P_.Provider,{value:{show:n},children:[r,T.jsx("div",{"aria-live":"polite","aria-atomic":"false",className:"sr-only"}),T.jsx("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col gap-3 max-w-sm",children:e.map(i=>T.jsxs("div",{role:"status","aria-live":"polite",className:`flex items-start gap-3 p-3 rounded shadow-lg text-white ${Cx[i.type]} ring-1 ring-black/5`,children:[T.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.type==="success"?T.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:T.jsx("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):i.type==="error"?T.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[T.jsx("path",{d:"M12 9v4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),T.jsx("path",{d:"M12 17h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),T.jsx("path",{d:"M21 12A9 9 0 1112 3a9 9 0 019 9z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}):T.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[T.jsx("path",{d:"M13 16h-1v-4h-1",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),T.jsx("path",{d:"M12 8h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("div",{className:"text-sm font-medium truncate",children:i.message}),i.action&&T.jsx("button",{onClick:()=>{i.action.cb()},className:"mt-1 text-xs underline opacity-90",children:i.action.label})]}),T.jsx("div",{className:"flex items-center gap-2 ml-2",children:T.jsx("button",{"aria-label":"Dismiss",onClick:()=>s(i.id),className:"p-1 rounded bg-white/10 hover:bg-white/20",children:T.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:T.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})})]},i.id))})]})},xx=()=>{const r=x.useContext(P_);if(!r)throw new Error("useToast must be used within a ToastProvider");return r};try{Sm.displayName="ToastProvider",Sm.__docgenInfo={description:"",displayName:"ToastProvider",props:{}}}catch{}try{Toast.displayName="Toast",Toast.__docgenInfo={description:"",displayName:"Toast",props:{}}}catch{}const Ml=()=>{const{user:r}=Mi(),{getNotificationsForUser:e,markAsRead:t,giveRitualPoint:n}=ap(),[s,i]=x.useState(!1),[o,c]=x.useState(!1),l=Bl(),{t:u}=Ar(),d=xx();if(!r)return null;const m=e(r.id),p=m.filter(D=>!D.isRead).length,b=async()=>{const D=new Date,V=r.lastRitualTimestamp?new Date(r.lastRitualTimestamp):null;if(V&&V.getUTCFullYear()===D.getUTCFullYear()&&V.getUTCMonth()===D.getUTCMonth()&&V.getUTCDate()===D.getUTCDate()){d.show(u("ritual.alreadyCompleted","You have already completed the daily ritual today."),"info");return}try{const j=`ritual_${r.id}_${Date.now()}`,U=await n({requestId:j});U.success?d.show(u("ritual.success","Daily ritual completed — Hope point awarded!"),"success"):d.show(u(U.messageKey||"ritual.error","Unable to complete the ritual."),"error")}catch(j){console.error("Error completing ritual from header:",j),d.show(u("ritual.error","Unable to complete the ritual."),"error")}},R=()=>{i(!0)},A=D=>{D.isRead||t(D.id),i(!1),D.type==="Nomination"?l("/nomination"):D.requestId&&l(`/echoes/${D.requestId}`)},N=D=>D.messageKey?u(D.messageKey,D.messageOptions):D.message;return T.jsxs(T.Fragment,{children:[T.jsxs("header",{className:"fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-sm z-20 p-2 sm:p-4 flex justify-between items-center border-b",children:[T.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[T.jsx(Yc,{className:"h-8 w-8"}),T.jsx("span",{className:"text-lg font-bold text-[#3A3A3A] hidden sm:inline",children:u("appName")})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"relative",children:T.jsxs("button",{onClick:R,className:"relative p-2 rounded-full hover:bg-gray-200/50",children:[T.jsx(qc,{className:"w-6 h-6 text-gray-600"}),p>0&&T.jsx("span",{className:"absolute top-0 right-0 block h-4 w-4 rounded-full bg-red-500 text-white text-[10px] flex items-center justify-center ring-2 ring-[#FBF9F4]",children:p})]})}),(r.role==="Citizen"||r.role==="NGO"||r.role==="Admin")&&T.jsx("button",{onClick:()=>l("/tapestry"),title:u("tapestry.menu","Tapestry"),className:"p-2 rounded-full hover:bg-gray-200/50",children:T.jsx(xw,{className:"w-6 h-6 text-gray-600"})}),T.jsx("button",{onClick:b,className:"hidden sm:inline-flex items-center px-3 py-2 rounded-md bg-[var(--accent)] text-white text-sm",children:u("nav.ritual","Daily Ritual")}),T.jsx("button",{onClick:()=>{c(!0)},className:"p-2 rounded-full hover:bg-gray-200/50",children:T.jsx(Xo,{name:r.symbolicIcon,className:"w-6 h-6 text-gray-600"})}),T.jsx("button",{onClick:()=>{c(!0),window.dispatchEvent(new CustomEvent("mitche.openQr"))},title:u("constellation.showQrCode","Show QR"),className:"p-2 rounded-full hover:bg-gray-200/50",children:T.jsx(Ym,{className:"w-6 h-6 text-gray-600"})})]})]}),s&&T.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex flex-col justify-end",onClick:()=>i(!1),children:T.jsxs("div",{className:"bg-[#FBF9F4] rounded-t-2xl shadow-xl animate-slide-in-up flex flex-col h-[85vh] max-h-[600px]",onClick:D=>D.stopPropagation(),children:[T.jsxs("header",{className:"flex-shrink-0 p-4 border-b border-[#F1EADF] flex justify-between items-center",children:[T.jsx("h2",{className:"font-bold text-gray-700 text-lg",children:u("notifications.title")}),T.jsx("button",{onClick:()=>i(!1),className:"p-2 rounded-full hover:bg-gray-200/50",children:T.jsx(Jm,{className:"w-5 h-5 text-gray-600"})})]}),T.jsx("div",{className:"flex-grow overflow-y-auto",children:m.length>0?T.jsx("ul",{children:m.map(D=>T.jsxs("li",{onClick:()=>A(D),className:`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ${D.isRead?"":"bg-amber-50"}`,children:[T.jsx("p",{className:"text-sm text-gray-800",children:N(D)}),T.jsx("p",{className:"text-xs text-gray-400 mt-1",children:jT(D.timestamp,u)})]},D.id))}):T.jsxs("div",{className:"h-full flex flex-col justify-center items-center text-center text-gray-500 px-6",children:[T.jsx(qc,{className:"w-12 h-12 text-gray-300 mb-4"}),T.jsx("p",{className:"font-semibold",children:u("notifications.empty")})]})})]})}),T.jsx(Ll,{isOpen:o,onClose:()=>c(!1)})]})};try{Ml.displayName="Header",Ml.__docgenInfo={description:"",displayName:"Header",props:{}}}catch{}const Oi=()=>T.jsxs("div",{className:"min-h-screen flex flex-col",children:[T.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:bg-white focus:p-2 focus:rounded focus:shadow",children:"Skip to content"}),T.jsx(Ml,{}),T.jsx("main",{id:"main-content",className:"flex-grow",children:T.jsx(Bv,{})}),T.jsx("a",{className:"fab",href:"/echoes/new",title:"Create",children:T.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:T.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),T.jsx(Qc,{})]});try{Oi.displayName="Layout",Oi.__docgenInfo={description:"",displayName:"Layout",props:{}}}catch{}const Nx={title:"Layout/Layout",component:Oi},oi=()=>T.jsx("div",{style:{height:"600px"},children:T.jsx(Oi,{})}),ai=()=>T.jsx("div",{style:{height:"600px"},children:T.jsx(Oi,{})});var Am,Rm,Pm;oi.parameters={...oi.parameters,docs:{...(Am=oi.parameters)==null?void 0:Am.docs,source:{originalSource:`() => <div style={{
  height: '600px'
}}>
    <Layout />
  </div>`,...(Pm=(Rm=oi.parameters)==null?void 0:Rm.docs)==null?void 0:Pm.source}}};var Cm,xm,Nm;ai.parameters={...ai.parameters,docs:{...(Cm=ai.parameters)==null?void 0:Cm.docs,source:{originalSource:`() => <div style={{
  height: '600px'
}}>
    <Layout />
  </div>`,...(Nm=(xm=ai.parameters)==null?void 0:xm.docs)==null?void 0:Nm.source}}};const kx=["Default","WithFAB"],Gx=Object.freeze(Object.defineProperty({__proto__:null,Default:oi,WithFAB:ai,__namedExportsOrder:kx,default:Nx},Symbol.toStringTag,{value:"Module"}));export{gr as $,eh as A,yt as B,xn as C,De as D,Vi as E,En as F,In as G,vs as H,pt as I,z as J,Mt as K,$u as L,qu as M,$o as N,br as O,Xa as P,an as Q,Hu as R,zu as S,bn as T,dr as U,ri as V,pe as W,Ft as X,XR as Y,Me as Z,Jl as _,Zu as a,K as a0,wS as a1,Pe as a2,He as a3,pr as a4,xS as a5,jx as a6,qx as a7,Re as a8,LR as a9,pp as aA,gp as aB,rn as aC,Yr as aD,fr as aE,Rn as aF,lt as aG,YT as aH,fs as aI,Gx as aJ,Ux as aa,BR as ab,Ee as ac,FR as ad,jR as ae,Cr as af,Xi as ag,JR as ah,si as ai,MR as aj,$x as ak,Fx as al,_n as am,Ct as an,It as ao,Bx as ap,We as aq,Ys as ar,Pl as as,zx as at,te as au,Tp as av,Ql as aw,Ve as ax,WT as ay,ds as az,Es as b,Gt as c,tC as d,oC as e,ax as f,y_ as g,FP as h,XP as i,mx as j,mP as k,lm as l,_C as m,LP as n,nC as o,eC as p,tP as q,yP as r,JP as s,ZP as t,bC as u,Hx as v,rC as w,QR as x,hr as y,Yi as z};
